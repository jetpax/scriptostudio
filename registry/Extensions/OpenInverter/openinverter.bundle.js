// === EXTENSION_BUNDLE ===
// Generated by bundle_extensions.js
// Do not edit - regenerated on each build

export const __EXTENSION_META__ = {
  "name": "OpenInverter",
  "id": "openinverter",
  "version": [
    1,
    99,
    0
  ],
  "author": "JetPax",
  "description": "Complete OpenInverter suite. Configure parameters, map CAN messages, view spot values, and plot real-time signals from OpenInverter motor controllers.",
  "icon": "bolt",
  "iconSvg": "<svg xmlns=\"http://www.w3.org/2000/svg\" class=\"icon icon-tabler icon-tabler-bolt\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" stroke-width=\"2\" stroke=\"currentColor\" fill=\"none\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path stroke=\"none\" d=\"M0 0h24v24H0z\" fill=\"none\"/><path d=\"M13 3l0 7l6 0l-8 11l0 -7l-6 0l8 -11\" /></svg>",
  "menu": [
    {
      "id": "deviceselector",
      "label": "Device Manager"
    }
  ],
  "devices": true,
  "styles": ":root { --oi-blue: #1e88e5; --oi-blue-dark: #1565c0; --oi-blue-light: #e3f2fd; --oi-orange: #ff8c00; --oi-orange-light: #ffa726; --oi-beige: #fef8f0; --oi-yellow: #ffd54f; --oi-status-success: #4caf50; --oi-status-warning: #ff9800; --oi-status-error: #f44336; --oi-status-info: #1e88e5; --text-muted: #999; } .tabs-container { display: flex; flex-direction: column; height: 100%; } .tabs-header { border-bottom: 2px solid var(--border-color); background: var(--bg-secondary); } .tabs-nav { display: flex; gap: 0; overflow-x: auto; } .tab-button { background: transparent; border: none; border-radius: 0; padding: 16px 24px; font-size: 14px; font-weight: 600; color: var(--text-secondary); cursor: pointer; border-bottom: 3px solid transparent; transition: all 0.2s; white-space: nowrap; } .tab-button:hover:not(:disabled) { color: var(--oi-blue); background: var(--oi-blue-light); } .tab-button.active { border-bottom-color: var(--oi-blue); } .tab-button:disabled { opacity: 0.5; cursor: not-allowed; }",
  "devicePaths": {
    "lib/OI_helpers.py": "/lib/ext/openinverter/OI_helpers.py"
  }
};

export const __DEVICE_FILES__ = {
  "/lib/ext/openinverter/OI_helpers.py": "IiIiCk9wZW5JbnZlcnRlciBIZWxwZXIgRnVuY3Rpb25zCj09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQoKVGhpcyBtb2R1bGUgY29udGFpbnMgaGVscGVyIGZ1bmN0aW9ucyBmb3IgT3BlbkludmVydGVyIHBhcmFtZXRlciBtYW5hZ2VtZW50CmFuZCBDQU4gYnVzIG1hcHBpbmcuIFRoZXNlIGZ1bmN0aW9ucyBhcmUgY2FsbGFibGUgZnJvbSB0aGUgV2ViUkVQTCBjbGllbnQKYW5kIGF1dG9tYXRpY2FsbHkgc2VuZCB0aGVpciBKU09OIHJlc3BvbnNlcyBkaXJlY3RseSB0byB0aGUgY29ubmVjdGVkIGNsaWVudC4KCkNsaWVudC1jYWxsYWJsZSBmdW5jdGlvbnMgKGF1dG8tc2VuZCB0byBjbGllbnQpOgotIGdldE9pUGFyYW1zKCkgICAgICAgICAgIC0gR2V0IGxpc3Qgb2YgcGFyYW1ldGVycyAoaXNwYXJhbT1UcnVlKQotIHNldFBhcmFtZXRlcihhcmdzKSAgICAgIC0gU2V0IGEgc2luZ2xlIHBhcmFtZXRlciB2YWx1ZQotIHNhdmVQYXJhbWV0ZXJzKCkgICAgICAgIC0gU2F2ZSBwYXJhbWV0ZXJzIHRvIHBlcnNpc3RlbnQgc3RvcmFnZQotIGdldFBhcmFtZXRlcnNGb3JEb3dubG9hZCgpIC0gR2V0IHBhcmFtZXRlcnMgZm9yIGV4cG9ydC9kb3dubG9hZAotIHNldFBhcmFtZXRlcnNCYXRjaChhcmdzKSAtIFNldCBtdWx0aXBsZSBwYXJhbWV0ZXJzIGF0IG9uY2UKLSBnZXRTcG90VmFsdWVzKCkgICAgICAgICAtIEdldCBsaXN0IG9mIHNwb3QgdmFsdWVzIChpc3BhcmFtPUZhbHNlKQotIGdldFBsb3REYXRhKGFyZ3MpICAgICAgIC0gR2V0IHJlYWwtdGltZSB2YWx1ZXMgZm9yIHBsb3R0aW5nCi0gbWFwQ2FuU3BvdFZhbHVlKGFyZ3MpICAgLSBNYXAgYSBzcG90IHZhbHVlIHRvIENBTiBidXMKLSB1bm1hcENhblNwb3RWYWx1ZShhcmdzKSAtIFJlbW92ZSBDQU4gbWFwcGluZyBmcm9tIHNwb3QgdmFsdWUKLSBnZXRDYW5NYXBwaW5nRGF0YSgpICAgICAtIEdldCBhbGwgcGFyYW1ldGVycyB3aXRoIENBTiBtYXBwaW5nIGluZm8KLSBnZXRTeXNJbmZvKCkgICAgICAgICAgICAtIEdldCBPcGVuSW52ZXJ0ZXIgc3lzdGVtIGluZm8KLSBhY3Rpb25CdXR0b24oYXJncykgICAgICAtIEhhbmRsZSBhY3Rpb24gYnV0dG9uIHByZXNzCi0gdGVybUNtZChhcmdzKSAgICAgICAgICAgLSBIYW5kbGUgdGVybWluYWwgY29tbWFuZAoKR2xvYmFsIFBhcmFtZXRlcnMgU3RvcmU6Ci0gcGFyYW1ldGVyczogRGljdGlvbmFyeSBvZiBhbGwgcGFyYW1ldGVycyBhbmQgc3BvdCB2YWx1ZXMKICBTdHJ1Y3R1cmU6IHsKICAgICduYW1lJzogewogICAgICAndmFsdWUnOiA8bnVtYmVyPiwKICAgICAgJ3VuaXQnOiA8c3RyaW5nPiwKICAgICAgJ2lzcGFyYW0nOiA8Ym9vbD4sCiAgICAgICdjYXRlZ29yeSc6IDxzdHJpbmc+LAogICAgICAjIEZvciBwYXJhbWV0ZXIgb25seToKICAgICAgJ21pbmltdW0nOiA8bnVtYmVyPiwKICAgICAgJ21heGltdW0nOiA8bnVtYmVyPiwKICAgICAgJ2RlZmF1bHQnOiA8bnVtYmVyPiwKICAgICAgJ2VudW1zJzogezxpbnQ+OiA8c3RyaW5nPiwgLi4ufSwgICMgT3B0aW9uYWwgZm9yIGVudW0gcGFyYW1ldGVycwogICAgICAjIEZvciBDQU4tbWFwcGVkIHZhbHVlczoKICAgICAgJ2NhbklkJzogPGludD4sCiAgICAgICdjYW5Qb3NpdGlvbic6IDxpbnQ+LAogICAgICAnY2FuQml0cyc6IDxpbnQ+LAogICAgICAnY2FuR2Fpbic6IDxmbG9hdD4sCiAgICAgICdpc1R4JzogPGJvb2w+CiAgICB9CiAgfQoiIiIKCmltcG9ydCBqc29uCmltcG9ydCB0aW1lCgojIENBTiBtb2R1bGUgLSByZXF1aXJlZCBmb3IgT3BlbkludmVydGVyIGV4dGVuc2lvbgp0cnk6CiAgICBpbXBvcnQgQ0FOCmV4Y2VwdCBJbXBvcnRFcnJvcjoKICAgICMgQ0FOIG1vZHVsZSBub3QgYXZhaWxhYmxlIC0gZnVuY3Rpb25zIHdpbGwgZmFpbCBncmFjZWZ1bGx5CiAgICBDQU4gPSBOb25lCgojIFNETyBsaWJyYXJ5IGlzIGd1YXJhbnRlZWQgdG8gYmUgcHJlc2VudCBpbiBleHRlbnNpb24gKHNhbWUgcGFja2FnZSkKZnJvbSBsaWIuY2Fub3Blbl9zZG8gaW1wb3J0IFNET0NsaWVudCwgZml4ZWRfdG9fZmxvYXQsIGZsb2F0X3RvX2ZpeGVkLCBwYXJhbV9pZF90b19zZG8KZnJvbSBsaWIuY2Fub3Blbl9zZG8gaW1wb3J0IFNET1RpbWVvdXRFcnJvciwgU0RPQWJvcnRFcnJvcgoKIyAtLS0gR2xvYmFsIENBTiBhbmQgRGV2aWNlIFN0YXRlIC0tLQpjYW5fZGV2ID0gTm9uZQpzZG9fY2xpZW50ID0gTm9uZQpkZXZpY2VfY29ubmVjdGVkID0gRmFsc2UKZGV2aWNlX25vZGVfaWQgPSAxCmRldmljZV9iaXRyYXRlID0gNTAwMDAwCnBhcmFtX2RiX2NhY2hlID0gTm9uZQpzdHJlYW1pbmdfYWN0aXZlID0gRmFsc2UKCgojIC0tLSBHbG9iYWwgUGFyYW1ldGVycy9TcG90IFZhbHVlcyBTdG9yZSAtLS0KIyBQb3B1bGF0ZWQgZnJvbSBkZXZpY2Ugd2hlbiBjb25uZWN0ZWQKcGFyYW1ldGVycyA9IHt9CgoKZGVmIF9zZW5kX3Jlc3BvbnNlKGNtZCwgYXJnKToKICAgICIiIkludGVybmFsIGhlbHBlciB0byBzZW5kIEpTT04gcmVzcG9uc2UgdG8gV2ViUkVQTCBjbGllbnQgdmlhIFdlYlJFUEwgQmluYXJ5IFByb3RvY29sCiAgICAKICAgIFdpdGggV2ViUkVQTCBCaW5hcnkgUHJvdG9jb2wsIHJlc3BvbnNlcyBhcmUgdHJhY2tlZCBieSByZXF1ZXN0IElELCBzbyB3ZSBjYW4ganVzdAogICAgc2VuZCB0aGUgZGF0YSBkaXJlY3RseS4gRm9yIGJhY2t3YXJkIGNvbXBhdGliaWxpdHksIHdlIHN0aWxsIGFjY2VwdCBjbWQKICAgIHBhcmFtZXRlciBidXQgb25seSBwcmludCB0aGUgYXJnIGRhdGEuCiAgICAiIiIKICAgICMgV2ViUkVQTCBCaW5hcnkgUHJvdG9jb2w6IEp1c3Qgc2VuZCB0aGUgZGF0YSBkaXJlY3RseSAoY2xpZW50IHRyYWNrcyBieSByZXF1ZXN0IElEKQogICAgcHJpbnQoanNvbi5kdW1wcyhhcmcpKQoKCmRlZiBfc2VuZF9lcnJvcihtZXNzYWdlLCBjbWQpOgogICAgIiIiSW50ZXJuYWwgaGVscGVyIHRvIHNlbmQgZXJyb3IgcmVzcG9uc2UgdmlhIFdlYlJFUEwgQmluYXJ5IFByb3RvY29sIiIiCiAgICAjIFdlYlJFUEwgQmluYXJ5IFByb3RvY29sOiBTZW5kIGVycm9yIGFzIHNpbXBsZSBvYmplY3QKICAgIHByaW50KGpzb24uZHVtcHMoeydlcnJvcic6IG1lc3NhZ2V9KSkKCiMgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQojIENBTiBEZXZpY2UgSW5pdGlhbGl6YXRpb24gYW5kIE1hbmFnZW1lbnQKIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CgpkZWYgaW5pdGlhbGl6ZURldmljZShhcmdzPU5vbmUpOgogICAgIiIiCiAgICBJbml0aWFsaXplIENBTiBidXMgYW5kIGNvbm5lY3QgdG8gT3BlbkludmVydGVyIGRldmljZS4KICAgIAogICAgQXJncyAoZGljdCwgb3B0aW9uYWwpOgogICAgICAgIG5vZGVfaWQ6IENBTm9wZW4gbm9kZSBJRCAoZGVmYXVsdDogMSwgbXVzdCBiZSAxLTEyNykKICAgICAgICBiaXRyYXRlOiBDQU4gYnVzIGJpdHJhdGUgKGRlZmF1bHQ6IDUwMDAwMCkKICAgICAgICB0eF9waW46IFRYIEdQSU8gcGluIChkZWZhdWx0OiA1KQogICAgICAgIHJ4X3BpbjogUlggR1BJTyBwaW4gKGRlZmF1bHQ6IDQpCiAgICAgICAgbW9kZTogQ0FOIG1vZGUgKGRlZmF1bHQ6IENBTi5OT1JNQUwpCiAgICAKICAgIFJldHVybnM6CiAgICAgICAgQ29ubmVjdGlvbiBzdGF0dXMgYW5kIGRldmljZSBpbmZvCiAgICAiIiIKICAgIGdsb2JhbCBjYW5fZGV2LCBzZG9fY2xpZW50LCBkZXZpY2VfY29ubmVjdGVkLCBkZXZpY2Vfbm9kZV9pZCwgZGV2aWNlX2JpdHJhdGUKICAgIAogICAgIyBQYXJzZSBhcmd1bWVudHMKICAgIGlmIGFyZ3MgaXMgTm9uZToKICAgICAgICBhcmdzID0ge30KICAgIAogICAgbm9kZV9pZCA9IGFyZ3MuZ2V0KCdub2RlX2lkJywgMSkKICAgIAogICAgIyBSZWFsIGRldmljZSBtb2RlIC0gcmVxdWlyZXMgQ0FOIGhhcmR3YXJlCiAgICAjIENoZWNrIGlmIENBTiBtb2R1bGUgaXMgYXZhaWxhYmxlCiAgICBpZiBDQU4gaXMgTm9uZToKICAgICAgICBfc2VuZF9lcnJvcigiQ0FOIG1vZHVsZSBub3QgYXZhaWxhYmxlIG9uIHRoaXMgcGxhdGZvcm0iLCAnSU5JVC1ERVZJQ0UtRVJST1InKQogICAgICAgIHJldHVybgogICAgCiAgICBtb2RlID0gYXJncy5nZXQoJ21vZGUnLCBDQU4uTk9STUFMKQogICAgCiAgICAjIFJlYWQgQ0FOIGNvbmZpZ3VyYXRpb24gZnJvbSAvY29uZmlnL2Nhbi5qc29uICh3aXRoIGZhbGxiYWNrIHRvIG1haW4ucHkpCiAgICB0eF9waW4gPSBhcmdzLmdldCgndHhfcGluJykKICAgIHJ4X3BpbiA9IGFyZ3MuZ2V0KCdyeF9waW4nKQogICAgYml0cmF0ZSA9IGFyZ3MuZ2V0KCdiaXRyYXRlJykKICAgIAogICAgaWYgdHhfcGluIGlzIE5vbmUgb3IgcnhfcGluIGlzIE5vbmUgb3IgYml0cmF0ZSBpcyBOb25lOgogICAgICAgICMgVHJ5IHRvIGxvYWQgZnJvbSAvY29uZmlnL2Nhbi5qc29uCiAgICAgICAgdHJ5OgogICAgICAgICAgICBpbXBvcnQgb3MKICAgICAgICAgICAgY29uZmlnX2RpciA9ICcvY29uZmlnJwogICAgICAgICAgICBpZiBub3Qgb3MucGF0aC5leGlzdHMoY29uZmlnX2Rpcik6CiAgICAgICAgICAgICAgICBjb25maWdfZGlyID0gJy9zdG9yZS9jb25maWcnCiAgICAgICAgICAgIGNvbmZpZ19maWxlID0gY29uZmlnX2RpciArICcvY2FuLmpzb24nCiAgICAgICAgICAgIAogICAgICAgICAgICBpZiBvcy5wYXRoLmV4aXN0cyhjb25maWdfZmlsZSk6CiAgICAgICAgICAgICAgICBpbXBvcnQganNvbgogICAgICAgICAgICAgICAgd2l0aCBvcGVuKGNvbmZpZ19maWxlLCAncicpIGFzIGY6CiAgICAgICAgICAgICAgICAgICAgY2FuX2NvbmZpZyA9IGpzb24ubG9hZChmKQogICAgICAgICAgICAgICAgaWYgdHhfcGluIGlzIE5vbmU6CiAgICAgICAgICAgICAgICAgICAgdHhfcGluID0gY2FuX2NvbmZpZy5nZXQoJ3R4UGluJywgNSkKICAgICAgICAgICAgICAgIGlmIHJ4X3BpbiBpcyBOb25lOgogICAgICAgICAgICAgICAgICAgIHJ4X3BpbiA9IGNhbl9jb25maWcuZ2V0KCdyeFBpbicsIDQpCiAgICAgICAgICAgICAgICBpZiBiaXRyYXRlIGlzIE5vbmU6CiAgICAgICAgICAgICAgICAgICAgYml0cmF0ZSA9IGNhbl9jb25maWcuZ2V0KCdiaXRyYXRlJywgNTAwMDAwKQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgIyBGYWxsYmFjayB0byBtYWluLnB5CiAgICAgICAgICAgICAgICBpbXBvcnQgc3lzCiAgICAgICAgICAgICAgICBzeXMucGF0aC5pbnNlcnQoMCwgJy9kZXZpY2Ugc2NyaXB0cycpCiAgICAgICAgICAgICAgICBmcm9tIG1haW4gaW1wb3J0IENBTl9UWF9QSU4sIENBTl9SWF9QSU4sIENBTl9CSVRSQVRFCiAgICAgICAgICAgICAgICBpZiB0eF9waW4gaXMgTm9uZToKICAgICAgICAgICAgICAgICAgICB0eF9waW4gPSBDQU5fVFhfUElOCiAgICAgICAgICAgICAgICBpZiByeF9waW4gaXMgTm9uZToKICAgICAgICAgICAgICAgICAgICByeF9waW4gPSBDQU5fUlhfUElOCiAgICAgICAgICAgICAgICBpZiBiaXRyYXRlIGlzIE5vbmU6CiAgICAgICAgICAgICAgICAgICAgYml0cmF0ZSA9IENBTl9CSVRSQVRFCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBpZiB0eF9waW4gaXMgTm9uZToKICAgICAgICAgICAgICAgIHR4X3BpbiA9IDUKICAgICAgICAgICAgaWYgcnhfcGluIGlzIE5vbmU6CiAgICAgICAgICAgICAgICByeF9waW4gPSA0CiAgICAgICAgICAgIGlmIGJpdHJhdGUgaXMgTm9uZToKICAgICAgICAgICAgICAgIGJpdHJhdGUgPSA1MDAwMDAKICAgIAogICAgdHJ5OgogICAgICAgICMgSW5pdGlhbGl6ZSBDQU4gZGV2aWNlCiAgICAgICAgY2FuX2RldiA9IENBTigwLCBleHRmcmFtZT1GYWxzZSwgdHg9dHhfcGluLCByeD1yeF9waW4sIG1vZGU9bW9kZSwgYml0cmF0ZT1iaXRyYXRlLCBhdXRvX3Jlc3RhcnQ9RmFsc2UpCiAgICAgICAgCiAgICAgICAgIyBDcmVhdGUgU0RPIGNsaWVudAogICAgICAgIHNkb19jbGllbnQgPSBTRE9DbGllbnQoY2FuX2Rldiwgbm9kZV9pZD1ub2RlX2lkLCB0aW1lb3V0PTEuMCkKICAgICAgICAKICAgICAgICBkZXZpY2VfY29ubmVjdGVkID0gVHJ1ZQogICAgICAgIGRldmljZV9ub2RlX2lkID0gbm9kZV9pZAogICAgICAgIGRldmljZV9iaXRyYXRlID0gYml0cmF0ZQogICAgICAgIAogICAgICAgIAogICAgICAgICMgVHJ5IHRvIHJlYWQgYSBiYXNpYyBwYXJhbWV0ZXIgdG8gdmVyaWZ5IGNvbm5lY3Rpb24KICAgICAgICB0cnk6CiAgICAgICAgICAgICMgUmVhZCB1cHRpbWUgb3IgYW5vdGhlciBzYWZlIHNwb3QgdmFsdWUgdG8gdmVyaWZ5IGNvbm5lY3Rpb24KICAgICAgICAgICAgIyBGb3Igbm93LCBqdXN0IGNvbmZpcm0gaW5pdGlhbGl6YXRpb24KICAgICAgICAgICAgX3NlbmRfcmVzcG9uc2UoJ0RFVklDRS1JTklUSUFMSVpFRCcsIHsKICAgICAgICAgICAgICAgICdzdWNjZXNzJzogVHJ1ZSwKICAgICAgICAgICAgICAgICdub2RlX2lkJzogbm9kZV9pZCwKICAgICAgICAgICAgICAgICdiaXRyYXRlJzogYml0cmF0ZSwKICAgICAgICAgICAgICAgICdjb25uZWN0ZWQnOiBUcnVlCiAgICAgICAgICAgIH0pCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBfc2VuZF9yZXNwb25zZSgnREVWSUNFLUlOSVRJQUxJWkVEJywgewogICAgICAgICAgICAgICAgJ3N1Y2Nlc3MnOiBUcnVlLAogICAgICAgICAgICAgICAgJ25vZGVfaWQnOiBub2RlX2lkLAogICAgICAgICAgICAgICAgJ2JpdHJhdGUnOiBiaXRyYXRlLAogICAgICAgICAgICAgICAgJ2Nvbm5lY3RlZCc6IEZhbHNlLAogICAgICAgICAgICAgICAgJ3dhcm5pbmcnOiAnQ0FOIGluaXRpYWxpemVkIGJ1dCBkZXZpY2Ugbm90IHJlc3BvbmRpbmcnCiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIAogICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICMgTG9nIGVycm9yIChwcmludCgpIG91dHB1dCBnb2VzIHRvIE0yTSBjaGFubmVsIGF1dG9tYXRpY2FsbHkpCiAgICAgICAgcHJpbnQoZiJbT0ldIEVycm9yIGluaXRpYWxpemluZyBDQU46IHtlfSIpCiAgICAgICAgZGV2aWNlX2Nvbm5lY3RlZCA9IEZhbHNlCiAgICAgICAgZXJyb3JfbXNnID0gc3RyKGUpCiAgICAgICAgX3NlbmRfZXJyb3IoZiJGYWlsZWQgdG8gaW5pdGlhbGl6ZSBDQU46IHtlcnJvcl9tc2d9IiwgJ0lOSVQtREVWSUNFLUVSUk9SJykKCgpkZWYgZGlzY29ubmVjdERldmljZSgpOgogICAgIiIiCiAgICBEaXNjb25uZWN0IGZyb20gQ0FOIGJ1cyBhbmQgcmVsZWFzZSByZXNvdXJjZXMuCiAgICAiIiIKICAgIGdsb2JhbCBjYW5fZGV2LCBzZG9fY2xpZW50LCBkZXZpY2VfY29ubmVjdGVkLCBzdHJlYW1pbmdfYWN0aXZlCiAgICAKICAgIGlmIHN0cmVhbWluZ19hY3RpdmU6CiAgICAgICAgIyBTdG9wIHN0cmVhbWluZyBmaXJzdAogICAgICAgIHN0b3BMaXZlU3RyZWFtaW5nKCkKICAgIAogICAgZGV2aWNlX2Nvbm5lY3RlZCA9IEZhbHNlCiAgICBzZG9fY2xpZW50ID0gTm9uZQogICAgCiAgICAjIENBTiBkZXZpY2UgY2xlYW51cCB3b3VsZCBnbyBoZXJlIGlmIG5lZWRlZAogICAgIyBGb3Igbm93LCBqdXN0IG1hcmsgYXMgZGlzY29ubmVjdGVkCgoKZGVmIGdldERldmljZVN0YXR1cygpOgogICAgIiIiCiAgICBHZXQgY3VycmVudCBkZXZpY2UgY29ubmVjdGlvbiBzdGF0dXMuCiAgICAiIiIKICAgIHN0YXR1cyA9IHsKICAgICAgICAnY29ubmVjdGVkJzogZGV2aWNlX2Nvbm5lY3RlZCwKICAgICAgICAnY2FuX2F2YWlsYWJsZSc6IENBTiBpcyBub3QgTm9uZSwKICAgICAgICAnbm9kZV9pZCc6IGRldmljZV9ub2RlX2lkLAogICAgICAgICdiaXRyYXRlJzogZGV2aWNlX2JpdHJhdGUsCiAgICAgICAgJ3N0cmVhbWluZ19hY3RpdmUnOiBzdHJlYW1pbmdfYWN0aXZlCiAgICB9CiAgICAKICAgIF9zZW5kX3Jlc3BvbnNlKCdERVZJQ0UtU1RBVFVTJywgc3RhdHVzKQoKCmRlZiBmZXRjaFBhcmFtZXRlckRhdGFiYXNlKCk6CiAgICAiIiIKICAgIEZldGNoIHBhcmFtZXRlciBkYXRhYmFzZSBmcm9tIE9wZW5JbnZlcnRlciBkZXZpY2UuCiAgICAKICAgIFRoZSBwYXJhbWV0ZXIgZGF0YWJhc2UgaXMgc3RvcmVkIGFzIGEgSlNPTiBzdHJpbmcgaW4gdGhlIGRldmljZQogICAgYXQgU0RPIGluZGV4IDB4MTAyMS4gVGhpcyBjb250YWlucyBkZWZpbml0aW9ucyBmb3IgYWxsIHBhcmFtZXRlcnMKICAgIGFuZCBzcG90IHZhbHVlcyB3aXRoIHRoZWlyIHVuaXRzLCByYW5nZXMsIGNhdGVnb3JpZXMsIGV0Yy4KICAgIAogICAgUmV0dXJuczoKICAgICAgICBEaWN0aW9uYXJ5IG9mIHBhcmFtZXRlciBkZWZpbml0aW9ucwogICAgIiIiCiAgICBnbG9iYWwgcGFyYW1fZGJfY2FjaGUsIHBhcmFtZXRlcnMKICAgIAogICAgaWYgbm90IGRldmljZV9jb25uZWN0ZWQgb3Igc2RvX2NsaWVudCBpcyBOb25lOgogICAgICAgIF9zZW5kX2Vycm9yKCJEZXZpY2Ugbm90IGNvbm5lY3RlZCIsICdGRVRDSC1QQVJBTS1EQi1FUlJPUicpCiAgICAgICAgcmV0dXJuCiAgICAKICAgIHRyeToKICAgICAgICAjIFBhcmFtZXRlciBkYXRhYmFzZSBpcyBhdCBTRE8gMHgxMDIxLCBzdWJpbmRleCAwCiAgICAgICAgIyBJdCdzIHN0b3JlZCBhcyBhIGxhcmdlIEpTT04gc3RyaW5nLCBzbyB3ZSBuZWVkIHRvIHJlYWQgaXQgaW4gY2h1bmtzCiAgICAgICAgIyBGb3Igbm93LCB3ZSdsbCB1c2UgYSBzaW1wbGlmaWVkIGFwcHJvYWNoCiAgICAgICAgCiAgICAgICAgIyBOb3RlOiBPcGVuSW52ZXJ0ZXIgbWF5IHN0b3JlIHRoZSBEQiBkaWZmZXJlbnRseSwgdGhpcyBpcyBhIHBsYWNlaG9sZGVyCiAgICAgICAgIyBUaGUgYWN0dWFsIGltcGxlbWVudGF0aW9uIHdvdWxkIG5lZWQgdG8gcmVhZCB0aGUgSlNPTiBkYXRhYmFzZQogICAgICAgICMgd2hpY2ggbWlnaHQgYmUgbXVsdGlwbGUgU0RPIG9iamVjdHMgb3IgYSBmaWxlIHRyYW5zZmVyCiAgICAgICAgCiAgICAgICAgIyBGb3Igbm93LCByZXR1cm4gZXJyb3IgYXMgdGhpcyBuZWVkcyBkZXZpY2Utc3BlY2lmaWMgaW1wbGVtZW50YXRpb24KICAgICAgICBfc2VuZF9lcnJvcigiUGFyYW1ldGVyIGRhdGFiYXNlIGZldGNoaW5nIG5vdCB5ZXQgaW1wbGVtZW50ZWQgZm9yIHJlYWwgaGFyZHdhcmUiLCAnRkVUQ0gtUEFSQU0tREItRVJST1InKQogICAgICAgIAogICAgICAgICMgVE9ETzogSW1wbGVtZW50IGFjdHVhbCBEQiBmZXRjaGluZwogICAgICAgICMgVGhlIG9wZW5pbnZlcnRlci1jYW4tdG9vbCBkb2VzIHRoaXMgdmlhOgogICAgICAgICMgMS4gUmVhZGluZyBjaHVua3Mgb2YgZGF0YSBmcm9tIGRldmljZQogICAgICAgICMgMi4gQXNzZW1ibGluZyBKU09OIHN0cmluZwogICAgICAgICMgMy4gUGFyc2luZyB0byBnZXQgcGFyYW1ldGVyIGRlZmluaXRpb25zCiAgICAgICAgCiAgICBleGNlcHQgU0RPVGltZW91dEVycm9yIGFzIGU6CiAgICAgICAgIyBTaWxlbnQgLSBlcnJvcnMgc2VudCB2aWEgX3NlbmRfZXJyb3IoKQogICAgICAgIF9zZW5kX2Vycm9yKHN0cihlKSwgJ0ZFVENILVBBUkFNLURCLUVSUk9SJykKICAgIGV4Y2VwdCBTRE9BYm9ydEVycm9yIGFzIGU6CiAgICAgICAgIyBTaWxlbnQgLSBlcnJvcnMgc2VudCB2aWEgX3NlbmRfZXJyb3IoKQogICAgICAgIF9zZW5kX2Vycm9yKHN0cihlKSwgJ0ZFVENILVBBUkFNLURCLUVSUk9SJykKICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAjIFNpbGVudCAtIGVycm9ycyBzZW50IHZpYSBfc2VuZF9lcnJvcigpCiAgICAgICAgX3NlbmRfZXJyb3Ioc3RyKGUpLCAnRkVUQ0gtUEFSQU0tREItRVJST1InKQoKCmRlZiBsb2FkUGFyYW1ldGVyRGF0YWJhc2UoanNvbl9kYik6CiAgICAiIiIKICAgIExvYWQgcGFyYW1ldGVyIGRhdGFiYXNlIGZyb20gSlNPTiBzdHJ1Y3R1cmUuCiAgICAKICAgIEFyZ3M6CiAgICAgICAganNvbl9kYjogRGljdGlvbmFyeSBjb250YWluaW5nIHBhcmFtZXRlciBkZWZpbml0aW9ucwogICAgCiAgICBNZXJnZXMgcGFyYW1ldGVyIGRhdGFiYXNlIG1ldGFkYXRhIChJRHMsIHVuaXRzLCBjYXRlZ29yaWVzLCBldGMuKSBpbnRvIGV4aXN0aW5nIHBhcmFtZXRlcnMgZGljdGlvbmFyeS4KICAgIFByZXNlcnZlcyBleGlzdGluZyB2YWx1ZXMgYW5kIG90aGVyIGZpZWxkcy4KICAgICIiIgogICAgZ2xvYmFsIHBhcmFtZXRlcnMsIHBhcmFtX2RiX2NhY2hlCiAgICAKICAgIHRyeToKICAgICAgICAjIE1lcmdlIGRhdGFiYXNlIG1ldGFkYXRhIGludG8gZXhpc3RpbmcgcGFyYW1ldGVycyAoZG9uJ3QgcmVwbGFjZSBlbnRpcmVseSkKICAgICAgICBmb3IgcGFyYW1fbmFtZSwgcGFyYW1fZGVmIGluIGpzb25fZGIuaXRlbXMoKToKICAgICAgICAgICAgaWYgcGFyYW1fbmFtZSBpbiBwYXJhbWV0ZXJzOgogICAgICAgICAgICAgICAgIyBVcGRhdGUgZXhpc3RpbmcgcGFyYW1ldGVyIHdpdGggZGF0YWJhc2UgbWV0YWRhdGEKICAgICAgICAgICAgICAgIGlmICdpZCcgaW4gcGFyYW1fZGVmOgogICAgICAgICAgICAgICAgICAgIHBhcmFtZXRlcnNbcGFyYW1fbmFtZV1bJ2lkJ10gPSBwYXJhbV9kZWZbJ2lkJ10KICAgICAgICAgICAgICAgIGlmICd1bml0JyBpbiBwYXJhbV9kZWY6CiAgICAgICAgICAgICAgICAgICAgcGFyYW1ldGVyc1twYXJhbV9uYW1lXVsndW5pdCddID0gcGFyYW1fZGVmWyd1bml0J10KICAgICAgICAgICAgICAgIGlmICdjYXRlZ29yeScgaW4gcGFyYW1fZGVmOgogICAgICAgICAgICAgICAgICAgIHBhcmFtZXRlcnNbcGFyYW1fbmFtZV1bJ2NhdGVnb3J5J10gPSBwYXJhbV9kZWZbJ2NhdGVnb3J5J10KICAgICAgICAgICAgICAgIGlmICdpc3BhcmFtJyBpbiBwYXJhbV9kZWY6CiAgICAgICAgICAgICAgICAgICAgcGFyYW1ldGVyc1twYXJhbV9uYW1lXVsnaXNwYXJhbSddID0gcGFyYW1fZGVmWydpc3BhcmFtJ10KICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBGb3IgcGFyYW1ldGVycywgdXBkYXRlIG1pbi9tYXgvZGVmYXVsdCBpZiBwcm92aWRlZAogICAgICAgICAgICAgICAgaWYgcGFyYW1ldGVyc1twYXJhbV9uYW1lXS5nZXQoJ2lzcGFyYW0nKToKICAgICAgICAgICAgICAgICAgICBpZiAnbWluaW11bScgaW4gcGFyYW1fZGVmOgogICAgICAgICAgICAgICAgICAgICAgICBwYXJhbWV0ZXJzW3BhcmFtX25hbWVdWydtaW5pbXVtJ10gPSBwYXJhbV9kZWZbJ21pbmltdW0nXQogICAgICAgICAgICAgICAgICAgIGlmICdtYXhpbXVtJyBpbiBwYXJhbV9kZWY6CiAgICAgICAgICAgICAgICAgICAgICAgIHBhcmFtZXRlcnNbcGFyYW1fbmFtZV1bJ21heGltdW0nXSA9IHBhcmFtX2RlZlsnbWF4aW11bSddCiAgICAgICAgICAgICAgICAgICAgaWYgJ2RlZmF1bHQnIGluIHBhcmFtX2RlZjoKICAgICAgICAgICAgICAgICAgICAgICAgcGFyYW1ldGVyc1twYXJhbV9uYW1lXVsnZGVmYXVsdCddID0gcGFyYW1fZGVmWydkZWZhdWx0J10KICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBQYXJzZSBlbnVtZXJhdGlvbnMgZnJvbSB1bml0IHN0cmluZyBpZiBwcmVzZW50CiAgICAgICAgICAgICAgICAjIEZvcm1hdDogIjA9T2ZmIDE9T24gMj1BdXRvIgogICAgICAgICAgICAgICAgdW5pdCA9IHBhcmFtX2RlZi5nZXQoJ3VuaXQnLCAnJykKICAgICAgICAgICAgICAgIGlmICc9JyBpbiB1bml0OgogICAgICAgICAgICAgICAgICAgIGVudW1zID0ge30KICAgICAgICAgICAgICAgICAgICBmb3IgcGFydCBpbiB1bml0LnNwbGl0KCk6CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICc9JyBpbiBwYXJ0OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbCwgbmFtZSA9IHBhcnQuc3BsaXQoJz0nLCAxKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVudW1zW2ludCh2YWwpXSA9IG5hbWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXNzCiAgICAgICAgICAgICAgICAgICAgaWYgZW51bXM6CiAgICAgICAgICAgICAgICAgICAgICAgIHBhcmFtZXRlcnNbcGFyYW1fbmFtZV1bJ2VudW1zJ10gPSBlbnVtcwogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgIyBOZXcgcGFyYW1ldGVyIG5vdCBpbiBleGlzdGluZyBkaWN0aW9uYXJ5IC0gY3JlYXRlIGl0CiAgICAgICAgICAgICAgICBwYXJhbSA9IHsKICAgICAgICAgICAgICAgICAgICAndW5pdCc6IHBhcmFtX2RlZi5nZXQoJ3VuaXQnLCAnJyksCiAgICAgICAgICAgICAgICAgICAgJ2lzcGFyYW0nOiBwYXJhbV9kZWYuZ2V0KCdpc3BhcmFtJywgRmFsc2UpLAogICAgICAgICAgICAgICAgICAgICdjYXRlZ29yeSc6IHBhcmFtX2RlZi5nZXQoJ2NhdGVnb3J5JywgJ1VuY2F0ZWdvcml6ZWQnKSwKICAgICAgICAgICAgICAgICAgICAnaWQnOiBwYXJhbV9kZWYuZ2V0KCdpZCcpLAogICAgICAgICAgICAgICAgICAgICd2YWx1ZSc6IHBhcmFtX2RlZi5nZXQoJ2RlZmF1bHQnLCAwKSBpZiBwYXJhbV9kZWYuZ2V0KCdpc3BhcmFtJykgZWxzZSAwCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgRm9yIHBhcmFtZXRlcnMsIGFkZCBtaW4vbWF4L2RlZmF1bHQKICAgICAgICAgICAgICAgIGlmIHBhcmFtWydpc3BhcmFtJ106CiAgICAgICAgICAgICAgICAgICAgcGFyYW1bJ21pbmltdW0nXSA9IHBhcmFtX2RlZi5nZXQoJ21pbmltdW0nLCAwKQogICAgICAgICAgICAgICAgICAgIHBhcmFtWydtYXhpbXVtJ10gPSBwYXJhbV9kZWYuZ2V0KCdtYXhpbXVtJywgMCkKICAgICAgICAgICAgICAgICAgICBwYXJhbVsnZGVmYXVsdCddID0gcGFyYW1fZGVmLmdldCgnZGVmYXVsdCcsIDApCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgUGFyc2UgZW51bWVyYXRpb25zIGZyb20gdW5pdCBzdHJpbmcgaWYgcHJlc2VudAogICAgICAgICAgICAgICAgdW5pdCA9IHBhcmFtX2RlZi5nZXQoJ3VuaXQnLCAnJykKICAgICAgICAgICAgICAgIGlmICc9JyBpbiB1bml0OgogICAgICAgICAgICAgICAgICAgIGVudW1zID0ge30KICAgICAgICAgICAgICAgICAgICBmb3IgcGFydCBpbiB1bml0LnNwbGl0KCk6CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICc9JyBpbiBwYXJ0OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbCwgbmFtZSA9IHBhcnQuc3BsaXQoJz0nLCAxKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVudW1zW2ludCh2YWwpXSA9IG5hbWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXNzCiAgICAgICAgICAgICAgICAgICAgaWYgZW51bXM6CiAgICAgICAgICAgICAgICAgICAgICAgIHBhcmFtWydlbnVtcyddID0gZW51bXMKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgcGFyYW1ldGVyc1twYXJhbV9uYW1lXSA9IHBhcmFtCiAgICAgICAgCiAgICAgICAgcGFyYW1fZGJfY2FjaGUgPSBqc29uX2RiCiAgICAgICAgCiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgIyBTaWxlbnQgLSBlcnJvcnMgc2VudCB2aWEgX3NlbmRfZXJyb3IoKQogICAgICAgIF9zZW5kX2Vycm9yKHN0cihlKSwgJ1BBUkFNLURCLUxPQUQtRVJST1InKQoKCmRlZiBnZXRPaVBhcmFtcygpOgogICAgIiIiCiAgICBHZXQgbGlzdCBvZiBhbGwgcGFyYW1ldGVycyAoaXNwYXJhbT1UcnVlKS4KICAgIFNlbmRzIHRoZSByZXN1bHQgZGlyZWN0bHkgdG8gdGhlIFdlYlJFUEwgY2xpZW50IGFzIEpTT04uCiAgICAKICAgIFJlYWRzIGN1cnJlbnQgdmFsdWVzIHZpYSBTRE8gZnJvbSBjb25uZWN0ZWQgZGV2aWNlLgogICAgIiIiCiAgICBpZiBub3QgZGV2aWNlX2Nvbm5lY3RlZCBvciBzZG9fY2xpZW50IGlzIE5vbmUgb3IgQ0FOIGlzIE5vbmU6CiAgICAgICAgX3NlbmRfZXJyb3IoIkRldmljZSBub3QgY29ubmVjdGVkIiwgJ0dFVC1QQVJBTVMtRVJST1InKQogICAgICAgIHJldHVybgogICAgCiAgICBwYXJhbV9saXN0ID0ge30KICAgIAogICAgdHJ5OgogICAgICAgIGZvciBrZXksIGl0ZW0gaW4gcGFyYW1ldGVycy5pdGVtcygpOgogICAgICAgICAgICBpZiBpdGVtLmdldCgnaXNwYXJhbScpID09IFRydWU6CiAgICAgICAgICAgICAgICAjIFJlYWQgY3VycmVudCB2YWx1ZSBmcm9tIGRldmljZQogICAgICAgICAgICAgICAgcGFyYW1faWQgPSBpdGVtLmdldCgnaWQnKQogICAgICAgICAgICAgICAgaWYgcGFyYW1faWQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgICAgICBpbmRleCwgc3ViaW5kZXggPSBwYXJhbV9pZF90b19zZG8ocGFyYW1faWQpCiAgICAgICAgICAgICAgICAgICAgICAgIHJhd192YWx1ZSA9IHNkb19jbGllbnQucmVhZChpbmRleCwgc3ViaW5kZXgpCiAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW1bJ3ZhbHVlJ10gPSBmaXhlZF90b19mbG9hdChyYXdfdmFsdWUpCiAgICAgICAgICAgICAgICAgICAgZXhjZXB0IChTRE9UaW1lb3V0RXJyb3IsIFNET0Fib3J0RXJyb3IpIGFzIGU6CiAgICAgICAgICAgICAgICAgICAgICAgICMgS2VlcCBleGlzdGluZyB2YWx1ZQogICAgICAgICAgICAgICAgICAgICAgICBwYXNzCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIHBhcmFtX2xpc3Rba2V5XSA9IGl0ZW0KICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICBfc2VuZF9lcnJvcihzdHIoZSksICdHRVQtUEFSQU1TLUVSUk9SJykKICAgICAgICByZXR1cm4KICAgIAogICAgIyBBbHdheXMgc2VuZCByZXNwb25zZSwgZXZlbiBpZiBlbXB0eQogICAgdHJ5OgogICAgICAgIF9zZW5kX3Jlc3BvbnNlKCdQQVJBTUVURVJTLUxJU1QnLCBwYXJhbV9saXN0KQogICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICMgSWYgc2VuZGluZyBmYWlscywgdHJ5IHRvIHNlbmQgZXJyb3IgcmVzcG9uc2UKICAgICAgICB0cnk6CiAgICAgICAgICAgIF9zZW5kX2Vycm9yKGYiRmFpbGVkIHRvIHNlbmQgcGFyYW1ldGVycyBsaXN0OiB7c3RyKGUpfSIsICdQQVJBTUVURVJTLUxJU1QtRVJST1InKQogICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgcGFzcyAgIyBTaWxlbnQgZmFpbHVyZQoKCmRlZiBzZXRQYXJhbWV0ZXIoYXJncyk6CiAgICAiIiIKICAgIFNldCBhIHNpbmdsZSBwYXJhbWV0ZXIgdmFsdWUuCiAgICAKICAgIEFyZ3MgKGRpY3QpOgogICAgICAgIE5BTUU6IFBhcmFtZXRlciBuYW1lCiAgICAgICAgVkFMVUU6IE5ldyB2YWx1ZQogICAgCiAgICBTZW5kcyB0aGUgdXBkYXRlZCBwYXJhbWV0ZXIgb3IgZXJyb3IgdG8gV2ViUkVQTCBjbGllbnQuCiAgICAiIiIKICAgIHBhcmFtX25hbWUgPSBhcmdzLmdldCgnTkFNRScpCiAgICBwYXJhbV92YWx1ZSA9IGFyZ3MuZ2V0KCdWQUxVRScpCiAgICAKICAgIGlmIHBhcmFtX25hbWUgaXMgTm9uZSBvciBwYXJhbV92YWx1ZSBpcyBOb25lOgogICAgICAgIF9zZW5kX2Vycm9yKCJNaXNzaW5nIE5BTUUgb3IgVkFMVUUgZm9yIFNFVC1QQVJBTUVURVIiLCAnU0VULVBBUkFNRVRFUi1FUlJPUicpCiAgICAgICAgcmV0dXJuCiAgICAKICAgIGlmIHBhcmFtX25hbWUgaW4gcGFyYW1ldGVycyBhbmQgcGFyYW1ldGVyc1twYXJhbV9uYW1lXS5nZXQoJ2lzcGFyYW0nKSA9PSBUcnVlOgogICAgICAgICMgVmFsaWRhdGUgdmFsdWUgYWdhaW5zdCBtaW4vbWF4IGlmIHByZXNlbnQKICAgICAgICBwYXJhbV9kZWYgPSBwYXJhbWV0ZXJzW3BhcmFtX25hbWVdCiAgICAgICAgCiAgICAgICAgaWYgJ21pbmltdW0nIGluIHBhcmFtX2RlZiBhbmQgcGFyYW1fdmFsdWUgPCBwYXJhbV9kZWZbJ21pbmltdW0nXToKICAgICAgICAgICAgX3NlbmRfZXJyb3IoZiJWYWx1ZSB7cGFyYW1fdmFsdWV9IGJlbG93IG1pbmltdW0ge3BhcmFtX2RlZlsnbWluaW11bSddfSIsICdTRVQtUEFSQU1FVEVSLUVSUk9SJykKICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgCiAgICAgICAgaWYgJ21heGltdW0nIGluIHBhcmFtX2RlZiBhbmQgcGFyYW1fdmFsdWUgPiBwYXJhbV9kZWZbJ21heGltdW0nXToKICAgICAgICAgICAgX3NlbmRfZXJyb3IoZiJWYWx1ZSB7cGFyYW1fdmFsdWV9IGFib3ZlIG1heGltdW0ge3BhcmFtX2RlZlsnbWF4aW11bSddfSIsICdTRVQtUEFSQU1FVEVSLUVSUk9SJykKICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgCiAgICAgICAgIyBWYWxpZGF0ZSBlbnVtIGlmIHByZXNlbnQKICAgICAgICBpZiAnZW51bXMnIGluIHBhcmFtX2RlZiBhbmQgcGFyYW1fdmFsdWUgbm90IGluIHBhcmFtX2RlZlsnZW51bXMnXToKICAgICAgICAgICAgX3NlbmRfZXJyb3IoZiJWYWx1ZSB7cGFyYW1fdmFsdWV9IG5vdCBpbiB2YWxpZCBlbnVtcyIsICdTRVQtUEFSQU1FVEVSLUVSUk9SJykKICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgCiAgICAgICAgICAgICAgICAKICAgICAgICAjIFdyaXRlIHZpYSBTRE8KICAgICAgICBpZiBub3QgZGV2aWNlX2Nvbm5lY3RlZCBvciBzZG9fY2xpZW50IGlzIE5vbmUgb3IgQ0FOIGlzIE5vbmU6CiAgICAgICAgICAgIF9zZW5kX2Vycm9yKCJEZXZpY2Ugbm90IGNvbm5lY3RlZCIsICdTRVQtUEFSQU1FVEVSLUVSUk9SJykKICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgCiAgICAgICAgcGFyYW1faWQgPSBwYXJhbV9kZWYuZ2V0KCdpZCcpCiAgICAgICAgaWYgcGFyYW1faWQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIGluZGV4LCBzdWJpbmRleCA9IHBhcmFtX2lkX3RvX3NkbyhwYXJhbV9pZCkKICAgICAgICAgICAgICAgIGZpeGVkX3ZhbHVlID0gZmxvYXRfdG9fZml4ZWQocGFyYW1fdmFsdWUpCiAgICAgICAgICAgICAgICBzZG9fY2xpZW50LndyaXRlKGluZGV4LCBzdWJpbmRleCwgZml4ZWRfdmFsdWUpCiAgICAgICAgICAgIGV4Y2VwdCBTRE9UaW1lb3V0RXJyb3IgYXMgZToKICAgICAgICAgICAgICAgIF9zZW5kX2Vycm9yKGYiVGltZW91dCB3cml0aW5nIHBhcmFtZXRlcjoge3N0cihlKX0iLCAnU0VULVBBUkFNRVRFUi1FUlJPUicpCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgZXhjZXB0IFNET0Fib3J0RXJyb3IgYXMgZToKICAgICAgICAgICAgICAgIF9zZW5kX2Vycm9yKGYiRGV2aWNlIHJlamVjdGVkIHBhcmFtZXRlcjoge3N0cihlKX0iLCAnU0VULVBBUkFNRVRFUi1FUlJPUicpCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICAgICAgX3NlbmRfZXJyb3IoZiJFcnJvciB3cml0aW5nIHBhcmFtZXRlcjoge3N0cihlKX0iLCAnU0VULVBBUkFNRVRFUi1FUlJPUicpCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAKICAgICAgICAjIFVwZGF0ZSBjYWNoZWQgdmFsdWUKICAgICAgICBwYXJhbWV0ZXJzW3BhcmFtX25hbWVdWyd2YWx1ZSddID0gcGFyYW1fdmFsdWUKICAgICAgICAKICAgICAgICB1cGRhdGVkX3BhcmFtID0ge3BhcmFtX25hbWU6IHBhcmFtZXRlcnNbcGFyYW1fbmFtZV19CiAgICAgICAgX3NlbmRfcmVzcG9uc2UoJ1BBUkFNRVRFUi1VUERBVEVEJywgdXBkYXRlZF9wYXJhbSkKICAgIGVsc2U6CiAgICAgICAgX3NlbmRfZXJyb3IoZiJJbnZhbGlkIG9yIG5vbi1wYXJhbWV0ZXIgbmFtZToge3BhcmFtX25hbWV9IiwgJ1NFVC1QQVJBTUVURVItRVJST1InKQoKCmRlZiBzYXZlUGFyYW1ldGVycygpOgogICAgIiIiCiAgICBTYXZlIHBhcmFtZXRlcnMgdG8gcGVyc2lzdGVudCBzdG9yYWdlLgogICAgCiAgICBUT0RPOiBJbXBsZW1lbnQgYWN0dWFsIHNhdmluZyBsb2dpYyAoZS5nLiwgdG8gTlZTLCBKU09OIGZpbGUgb24gZmxhc2gpCiAgICBGb3Igbm93LCBqdXN0IGFja25vd2xlZGdlcyB0aGUgc2F2ZSByZXF1ZXN0LgogICAgIiIiCiAgICAgICAgIyBUT0RPOiBJbXBsZW1lbnQgYWN0dWFsIHNhdmluZyBsb2dpYwogICAgIyBFeGFtcGxlOgogICAgIyBpbXBvcnQganNvbgogICAgIyB3aXRoIG9wZW4oJy9mbGFzaC9vaV9wYXJhbXMuanNvbicsICd3JykgYXMgZjoKICAgICMgICAgIGpzb24uZHVtcCh7azogdiBmb3IgaywgdiBpbiBwYXJhbWV0ZXJzLml0ZW1zKCkgaWYgdi5nZXQoJ2lzcGFyYW0nKX0sIGYpCgoKZGVmIGdldEFsbFBhcmFtc1dpdGhJZHMoKToKICAgICIiIgogICAgR2V0IGFsbCBwYXJhbWV0ZXJzIGFuZCBzcG90IHZhbHVlcyB0aGF0IGhhdmUgSURzIChmb3IgQ0FOIG1hcHBpbmcpLgogICAgUmV0dXJucyBib3RoIHBhcmFtZXRlcnMgKGlzcGFyYW09VHJ1ZSkgYW5kIHNwb3QgdmFsdWVzIChpc3BhcmFtPUZhbHNlKSB0aGF0IGhhdmUgSURzLgogICAgCiAgICBJZiBwYXJhbWV0ZXIgZGF0YWJhc2UgaGFzbid0IGJlZW4gbG9hZGVkIHlldCwgdHJpZXMgdG8gZmV0Y2ggaXQgZmlyc3QuCiAgICAiIiIKICAgIGdsb2JhbCBwYXJhbWV0ZXJzCiAgICAKICAgIGlmIG5vdCBkZXZpY2VfY29ubmVjdGVkIG9yIHNkb19jbGllbnQgaXMgTm9uZToKICAgICAgICBfc2VuZF9lcnJvcigiRGV2aWNlIG5vdCBjb25uZWN0ZWQiLCAnR0VULUFMTC1QQVJBTVMtRVJST1InKQogICAgICAgIHJldHVybgogICAgCiAgICAjIElmIHBhcmFtZXRlciBkYXRhYmFzZSBoYXNuJ3QgYmVlbiBsb2FkZWQsIHRyeSB0byBmZXRjaCBpdAogICAgaWYgcGFyYW1fZGJfY2FjaGUgaXMgTm9uZToKICAgICAgICB0cnk6CiAgICAgICAgICAgIGZldGNoUGFyYW1ldGVyRGF0YWJhc2UoKQogICAgICAgIGV4Y2VwdCBFeGNlcHRpb246CiAgICAgICAgICAgICMgSWYgZmV0Y2ggZmFpbHMsIHJldHVybiBlcnJvcgogICAgICAgICAgICBfc2VuZF9lcnJvcigiRmFpbGVkIHRvIGZldGNoIHBhcmFtZXRlciBkYXRhYmFzZSIsICdHRVQtQUxMLVBBUkFNUy1FUlJPUicpCiAgICAgICAgICAgIHJldHVybgogICAgCiAgICBhbGxfcGFyYW1zID0ge30KICAgIAogICAgZm9yIGtleSwgaXRlbSBpbiBwYXJhbWV0ZXJzLml0ZW1zKCk6CiAgICAgICAgIyBPbmx5IGluY2x1ZGUgaXRlbXMgdGhhdCBoYXZlIGFuIElEIChyZXF1aXJlZCBmb3IgQ0FOIG1hcHBpbmcpCiAgICAgICAgaWYgaXRlbS5nZXQoJ2lkJykgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIGFsbF9wYXJhbXNba2V5XSA9IGl0ZW0KICAgIAogICAgX3NlbmRfcmVzcG9uc2UoJ0FMTC1QQVJBTVMtV0lUSC1JRFMnLCBhbGxfcGFyYW1zKQoKCmRlZiBnZXRQYXJhbWV0ZXJzRm9yRG93bmxvYWQoKToKICAgICIiIgogICAgR2V0IGFsbCBwYXJhbWV0ZXJzIGZvciBleHBvcnQvZG93bmxvYWQuCiAgICBTYW1lIGFzIGdldE9pUGFyYW1zKCkgYnV0IHdpdGggZGlmZmVyZW50IGNvbW1hbmQgbmFtZS4KICAgICIiIgogICAgcGFyYW1fbGlzdCA9IHt9CiAgICAKICAgIGZvciBrZXksIGl0ZW0gaW4gcGFyYW1ldGVycy5pdGVtcygpOgogICAgICAgIGlmIGl0ZW0uZ2V0KCdpc3BhcmFtJykgPT0gVHJ1ZToKICAgICAgICAgICAgcGFyYW1fbGlzdFtrZXldID0gaXRlbQogICAgCiAgICBfc2VuZF9yZXNwb25zZSgnUEFSQU1FVEVSUy1ET1dOTE9BRC1MSVNUJywgcGFyYW1fbGlzdCkKCgpkZWYgc2V0UGFyYW1ldGVyc0JhdGNoKHBhcmFtc190b19zZXQpOgogICAgIiIiCiAgICBTZXQgbXVsdGlwbGUgcGFyYW1ldGVycyBhdCBvbmNlLgogICAgCiAgICBBcmdzIChkaWN0KToKICAgICAgICB7cGFyYW1fbmFtZTogdmFsdWUsIC4uLn0KICAgIAogICAgU2VuZHMgYmF0Y2ggcmVzdWx0IHdpdGggc3VjY2VzcyBzdGF0dXMgYW5kIGRldGFpbHMgZm9yIGVhY2ggcGFyYW1ldGVyLgogICAgIiIiCiAgICB1cGRhdGVfcmVzdWx0cyA9IHt9CiAgICBzdWNjZXNzID0gVHJ1ZQogICAgCiAgICBpZiBub3QgaXNpbnN0YW5jZShwYXJhbXNfdG9fc2V0LCBkaWN0KToKICAgICAgICBfc2VuZF9lcnJvcigiSW52YWxpZCBhcmd1bWVudCBmb3JtYXQgZm9yIGJhdGNoIHNldCIsICdTRVQtUEFSQU1FVEVSUy1CQVRDSC1FUlJPUicpCiAgICAgICAgcmV0dXJuCiAgICAKICAgIGZvciBuYW1lLCB2YWx1ZSBpbiBwYXJhbXNfdG9fc2V0Lml0ZW1zKCk6CiAgICAgICAgaWYgbmFtZSBpbiBwYXJhbWV0ZXJzIGFuZCBwYXJhbWV0ZXJzW25hbWVdLmdldCgnaXNwYXJhbScpID09IFRydWU6CiAgICAgICAgICAgIHBhcmFtX2RlZiA9IHBhcmFtZXRlcnNbbmFtZV0KICAgICAgICAgICAgCiAgICAgICAgICAgICMgVmFsaWRhdGUgdmFsdWUKICAgICAgICAgICAgaWYgJ21pbmltdW0nIGluIHBhcmFtX2RlZiBhbmQgdmFsdWUgPCBwYXJhbV9kZWZbJ21pbmltdW0nXToKICAgICAgICAgICAgICAgIHVwZGF0ZV9yZXN1bHRzW25hbWVdID0geydzdGF0dXMnOiAnZXJyb3InLCAnbWVzc2FnZSc6IGYnQmVsb3cgbWluaW11bSB7cGFyYW1fZGVmWyJtaW5pbXVtIl19J30KICAgICAgICAgICAgICAgIHN1Y2Nlc3MgPSBGYWxzZQogICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmICdtYXhpbXVtJyBpbiBwYXJhbV9kZWYgYW5kIHZhbHVlID4gcGFyYW1fZGVmWydtYXhpbXVtJ106CiAgICAgICAgICAgICAgICB1cGRhdGVfcmVzdWx0c1tuYW1lXSA9IHsnc3RhdHVzJzogJ2Vycm9yJywgJ21lc3NhZ2UnOiBmJ0Fib3ZlIG1heGltdW0ge3BhcmFtX2RlZlsibWF4aW11bSJdfSd9CiAgICAgICAgICAgICAgICBzdWNjZXNzID0gRmFsc2UKICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgIAogICAgICAgICAgICBpZiAnZW51bXMnIGluIHBhcmFtX2RlZiBhbmQgdmFsdWUgbm90IGluIHBhcmFtX2RlZlsnZW51bXMnXToKICAgICAgICAgICAgICAgIHVwZGF0ZV9yZXN1bHRzW25hbWVdID0geydzdGF0dXMnOiAnZXJyb3InLCAnbWVzc2FnZSc6ICdJbnZhbGlkIGVudW0gdmFsdWUnfQogICAgICAgICAgICAgICAgc3VjY2VzcyA9IEZhbHNlCiAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICAKICAgICAgICAgICAgcGFyYW1ldGVyc1tuYW1lXVsndmFsdWUnXSA9IHZhbHVlCiAgICAgICAgICAgIHVwZGF0ZV9yZXN1bHRzW25hbWVdID0geydzdGF0dXMnOiAnc3VjY2VzcycsICd2YWx1ZSc6IHZhbHVlfQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHVwZGF0ZV9yZXN1bHRzW25hbWVdID0geydzdGF0dXMnOiAnZXJyb3InLCAnbWVzc2FnZSc6ICdJbnZhbGlkIG9yIG5vbi1wYXJhbWV0ZXInfQogICAgICAgICAgICBzdWNjZXNzID0gRmFsc2UKICAgIAogICAgX3NlbmRfcmVzcG9uc2UoJ1BBUkFNRVRFUlMtQkFUQ0gtUkVTVUxUJywgeydzdWNjZXNzJzogc3VjY2VzcywgJ2RldGFpbHMnOiB1cGRhdGVfcmVzdWx0c30pCgoKZGVmIGdldFNwb3RWYWx1ZXMoKToKICAgICIiIgogICAgR2V0IGxpc3Qgb2YgYWxsIHNwb3QgdmFsdWVzIChpc3BhcmFtPUZhbHNlKS4KICAgIFNlbmRzIHRoZSByZXN1bHQgZGlyZWN0bHkgdG8gdGhlIFdlYlJFUEwgY2xpZW50IGFzIEpTT04uCiAgICAKICAgIFJlYWRzIGN1cnJlbnQgdmFsdWVzIHZpYSBTRE8gZnJvbSBjb25uZWN0ZWQgZGV2aWNlLgogICAgIiIiCiAgICBpZiBub3QgZGV2aWNlX2Nvbm5lY3RlZCBvciBzZG9fY2xpZW50IGlzIE5vbmUgb3IgQ0FOIGlzIE5vbmU6CiAgICAgICAgX3NlbmRfZXJyb3IoIkRldmljZSBub3QgY29ubmVjdGVkIiwgJ0dFVC1TUE9ULVZBTFVFUy1FUlJPUicpCiAgICAgICAgcmV0dXJuCiAgICAKICAgIHNwb3RfbGlzdCA9IHt9CiAgICAKICAgIHRyeToKICAgICAgICBmb3Iga2V5LCBpdGVtIGluIHBhcmFtZXRlcnMuaXRlbXMoKToKICAgICAgICAgICAgaWYgaXRlbS5nZXQoJ2lzcGFyYW0nKSAhPSBUcnVlOgogICAgICAgICAgICAgICAgIyBSZWFkIGN1cnJlbnQgdmFsdWUgZnJvbSBkZXZpY2UKICAgICAgICAgICAgICAgIHBhcmFtX2lkID0gaXRlbS5nZXQoJ2lkJykKICAgICAgICAgICAgICAgIGlmIHBhcmFtX2lkIGlzIG5vdCBOb25lOgogICAgICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICAgICAgaW5kZXgsIHN1YmluZGV4ID0gcGFyYW1faWRfdG9fc2RvKHBhcmFtX2lkKQogICAgICAgICAgICAgICAgICAgICAgICByYXdfdmFsdWUgPSBzZG9fY2xpZW50LnJlYWQoaW5kZXgsIHN1YmluZGV4KQogICAgICAgICAgICAgICAgICAgICAgICBpdGVtWyd2YWx1ZSddID0gZml4ZWRfdG9fZmxvYXQocmF3X3ZhbHVlKQogICAgICAgICAgICAgICAgICAgIGV4Y2VwdCAoU0RPVGltZW91dEVycm9yLCBTRE9BYm9ydEVycm9yKSBhcyBlOgogICAgICAgICAgICAgICAgICAgICAgICAjIEtlZXAgZXhpc3RpbmcgdmFsdWUKICAgICAgICAgICAgICAgICAgICAgICAgcGFzcwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBzcG90X2xpc3Rba2V5XSA9IGl0ZW0KICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICBfc2VuZF9lcnJvcihzdHIoZSksICdHRVQtU1BPVC1WQUxVRVMtRVJST1InKQogICAgICAgIHJldHVybgogICAgCiAgICBfc2VuZF9yZXNwb25zZSgnU1BPVC1WQUxVRVMtTElTVCcsIHNwb3RfbGlzdCkKCgpkZWYgZ2V0UGxvdERhdGEoYXJncyk6CiAgICAiIiIKICAgIEdldCByZWFsLXRpbWUgdmFsdWVzIGZvciBwbG90dGluZy4KICAgIAogICAgQXJncyAobGlzdCk6CiAgICAgICAgTGlzdCBvZiB2YXJpYWJsZSBuYW1lcyB0byByZXRyaWV2ZQogICAgCiAgICBSZXR1cm5zIHZhbHVlcyB3aXRoIHRpbWVzdGFtcCBmb3IgcGxvdHRpbmcuCiAgICAKICAgIE5vdGU6IFRoaXMgb25seSB3b3JrcyBpbiBDb25maWd1cmF0aW9uIE1vZGUsIG5vdCBkdXJpbmcgc3RyZWFtaW5nLgogICAgRm9yIGhpZ2gtc3BlZWQgcGxvdHRpbmcsIHVzZSBDIHN0cmVhbWluZyBtb2RlIGluc3RlYWQuCiAgICAiIiIKICAgICMgTm90ZTogQXZvaWQgcHJpbnQoKSBoZXJlIGFzIGl0IGludGVyZmVyZXMgd2l0aCBKU09OIHJlc3BvbnNlIGluIFdlYlJFUEwKICAgIAogICAgaWYgc3RyZWFtaW5nX2FjdGl2ZToKICAgICAgICAjIENhbid0IHJlYWQgdmlhIFNETyB3aGlsZSBzdHJlYW1pbmcKICAgICAgICBfc2VuZF9lcnJvcigiQ2Fubm90IHJlYWQgcGxvdCBkYXRhIGluIHN0cmVhbWluZyBtb2RlIiwgJ1BMT1QtREFUQS1FUlJPUicpCiAgICAgICAgcmV0dXJuCiAgICAKICAgIHJlc3BvbnNlX3ZhbHVlcyA9IHt9CiAgICBjdXJyZW50X3RpbWUgPSBpbnQodGltZS50aW1lKCkpICAjIFVuaXggdGltZXN0YW1wCiAgICAKICAgIGlmIG5vdCBkZXZpY2VfY29ubmVjdGVkIG9yIHNkb19jbGllbnQgaXMgTm9uZSBvciBDQU4gaXMgTm9uZToKICAgICAgICBfc2VuZF9lcnJvcigiRGV2aWNlIG5vdCBjb25uZWN0ZWQiLCAnUExPVC1EQVRBLUVSUk9SJykKICAgICAgICByZXR1cm4KICAgIAogICAgaWYgaXNpbnN0YW5jZShhcmdzLCBsaXN0KSBhbmQgbGVuKGFyZ3MpID4gMDoKICAgICAgICBmb3IgdmFyX25hbWUgaW4gYXJnczoKICAgICAgICAgICAgaWYgdmFyX25hbWUgaW4gcGFyYW1ldGVyczoKICAgICAgICAgICAgICAgIGl0ZW0gPSBwYXJhbWV0ZXJzW3Zhcl9uYW1lXQogICAgICAgICAgICAgICAgcGFyYW1faWQgPSBpdGVtLmdldCgnaWQnKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiBwYXJhbV9pZCBpcyBub3QgTm9uZToKICAgICAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgICAgIGluZGV4LCBzdWJpbmRleCA9IHBhcmFtX2lkX3RvX3NkbyhwYXJhbV9pZCkKICAgICAgICAgICAgICAgICAgICAgICAgcmF3X3ZhbHVlID0gc2RvX2NsaWVudC5yZWFkKGluZGV4LCBzdWJpbmRleCkKICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSBmaXhlZF90b19mbG9hdChyYXdfdmFsdWUpCiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAjIFVwZGF0ZSBjYWNoZWQgdmFsdWUKICAgICAgICAgICAgICAgICAgICAgICAgaXRlbVsndmFsdWUnXSA9IHZhbHVlCiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlX3ZhbHVlc1t2YXJfbmFtZV0gPSB2YWx1ZQogICAgICAgICAgICAgICAgICAgIGV4Y2VwdCAoU0RPVGltZW91dEVycm9yLCBTRE9BYm9ydEVycm9yKToKICAgICAgICAgICAgICAgICAgICAgICAgIyBVc2UgY2FjaGVkIHZhbHVlIG9uIGVycm9yCiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlID0gaXRlbS5nZXQoJ3ZhbHVlJykKICAgICAgICAgICAgICAgICAgICAgICAgaWYgaXNpbnN0YW5jZSh2YWx1ZSwgKGludCwgZmxvYXQpKToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlX3ZhbHVlc1t2YXJfbmFtZV0gPSB2YWx1ZQogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAjIE5vIHBhcmFtIElELCB1c2UgY2FjaGVkIHZhbHVlCiAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSBpdGVtLmdldCgndmFsdWUnKQogICAgICAgICAgICAgICAgICAgIGlmIGlzaW5zdGFuY2UodmFsdWUsIChpbnQsIGZsb2F0KSk6CiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlX3ZhbHVlc1t2YXJfbmFtZV0gPSB2YWx1ZQogICAgICAgIAogICAgICAgICMgQ29uc3RydWN0IHRoZSByZXNwb25zZSBwYXlsb2FkCiAgICAgICAgcmVzcG9uc2VfcGF5bG9hZCA9IHsKICAgICAgICAgICAgJ3RzJzogY3VycmVudF90aW1lLAogICAgICAgICAgICAndmFsdWVzJzogcmVzcG9uc2VfdmFsdWVzCiAgICAgICAgfQogICAgICAgIAogICAgICAgIF9zZW5kX3Jlc3BvbnNlKCdQTE9ULURBVEEtVVBEQVRFJywgcmVzcG9uc2VfcGF5bG9hZCkKCgojID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KIyBDQU4gTWFwcGluZyBGdW5jdGlvbnMKIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CgpkZWYgZ2V0Q2FuTWFwKGFyZ3M9Tm9uZSk6CiAgICAiIiIKICAgIEdldCBDQU4gbWFwcGluZ3MgZnJvbSBkZXZpY2UgKFRYIG9yIFJYKS4KICAgIAogICAgQXJncyAoZGljdCwgb3B0aW9uYWwpOgogICAgICAgIGRpcmVjdGlvbjogJ3R4JyBvciAncngnIChkZWZhdWx0OiBib3RoKQogICAgCiAgICBDQU4gbWFwcGluZyB1c2VzIFNETyBpbmRleGVzOgogICAgLSBUWCBtYXAgbGlzdDogMHgzMDAwICsgbgogICAgLSBSWCBtYXAgbGlzdDogMHgzMTAwICsgbgogICAgIiIiCiAgICBpZiBub3QgZGV2aWNlX2Nvbm5lY3RlZCBvciBzZG9fY2xpZW50IGlzIE5vbmU6CiAgICAgICAgX3NlbmRfZXJyb3IoIkRldmljZSBub3QgY29ubmVjdGVkIiwgJ0dFVC1DQU4tTUFQLUVSUk9SJykKICAgICAgICByZXR1cm4KICAgIAogICAgZGlyZWN0aW9uID0gYXJncy5nZXQoJ2RpcmVjdGlvbicsICdib3RoJykgaWYgYXJncyBlbHNlICdib3RoJwogICAgCiAgICB0cnk6CiAgICAgICAgbWFwcGluZ3MgPSB7J3R4JzogW10sICdyeCc6IFtdfQogICAgICAgIAogICAgICAgIGlmIGRpcmVjdGlvbiBpbiBbJ3R4JywgJ2JvdGgnXToKICAgICAgICAgICAgIyBSZWFkIFRYIG1hcHBpbmdzIHN0YXJ0aW5nIGF0IDB4MzAwMAogICAgICAgICAgICBiYXNlX2luZGV4ID0gMHgzMDAwCiAgICAgICAgICAgIG1zZ19pbmRleCA9IDAKICAgICAgICAgICAgd2hpbGUgbXNnX2luZGV4IDwgMjU1OiAgIyBNYXggbWVzc2FnZXMKICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICAjIFJlYWQgQ0FOIElEIGF0IHN1YmluZGV4IDAKICAgICAgICAgICAgICAgICAgICBjYW5faWQgPSBzZG9fY2xpZW50LnJlYWQoYmFzZV9pbmRleCArIG1zZ19pbmRleCwgMCkKICAgICAgICAgICAgICAgICAgICBpZiBjYW5faWQgPT0gMDoKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsgICMgTm8gbW9yZSBtZXNzYWdlcwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICMgRXh0cmFjdCBleHRlbmRlZCBmcmFtZSBmbGFnIChiaXQgMzEpCiAgICAgICAgICAgICAgICAgICAgaXNfZXh0ZW5kZWQgPSAoY2FuX2lkICYgMHg4MDAwMDAwMCkgIT0gMAogICAgICAgICAgICAgICAgICAgIGNhbl9pZCA9IGNhbl9pZCAmIDB4MUZGRkZGRkYgICMgTWFzayBvdXQgZmxhZyBiaXQKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBtZXNzYWdlID0gewogICAgICAgICAgICAgICAgICAgICAgICAnY2FuSWQnOiBjYW5faWQsCiAgICAgICAgICAgICAgICAgICAgICAgICdpc0V4dGVuZGVkJzogaXNfZXh0ZW5kZWQsCiAgICAgICAgICAgICAgICAgICAgICAgICdwYXJhbXMnOiBbXQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAjIFJlYWQgcGFyYW1ldGVyIG1hcHBpbmdzIChzdWJpbmRleCAxLCAzLCA1LCAuLi4pCiAgICAgICAgICAgICAgICAgICAgcGFyYW1faW5kZXggPSAxCiAgICAgICAgICAgICAgICAgICAgd2hpbGUgcGFyYW1faW5kZXggPCAyNTU6CiAgICAgICAgICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgUmVhZCBwYXJhbSBJRCwgcG9zaXRpb24sIGxlbmd0aAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbWFwcGluZ19kYXRhID0gc2RvX2NsaWVudC5yZWFkKGJhc2VfaW5kZXggKyBtc2dfaW5kZXgsIHBhcmFtX2luZGV4KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgbWFwcGluZ19kYXRhID09IDA6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsgICMgTm8gbW9yZSBwYXJhbXMKICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFyYW1faWQgPSBtYXBwaW5nX2RhdGEgJiAweEZGRkYKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvc2l0aW9uID0gKG1hcHBpbmdfZGF0YSA+PiAxNikgJiAweEZGCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZW5ndGggPSAobWFwcGluZ19kYXRhID4+IDI0KSAmIDB4RkYKICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgQ29udmVydCB0byBzaWduZWQgaWYgbmVnYXRpdmUKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIGxlbmd0aCA+PSAxMjg6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGVuZ3RoID0gbGVuZ3RoIC0gMjU2CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgUmVhZCBnYWluIGFuZCBvZmZzZXQgKG5leHQgc3ViaW5kZXgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBnYWluX29mZnNldCA9IHNkb19jbGllbnQucmVhZChiYXNlX2luZGV4ICsgbXNnX2luZGV4LCBwYXJhbV9pbmRleCArIDEpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBnYWluID0gKGdhaW5fb2Zmc2V0ICYgMHhGRkZGRkYpIC8gMTAwMC4wICAjIDI0LWJpdCBmaXhlZCBwb2ludAogICAgICAgICAgICAgICAgICAgICAgICAgICAgb2Zmc2V0ID0gKGdhaW5fb2Zmc2V0ID4+IDI0KSAmIDB4RkYKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIG9mZnNldCA+PSAxMjg6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb2Zmc2V0ID0gb2Zmc2V0IC0gMjU2CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2VbJ3BhcmFtcyddLmFwcGVuZCh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3BhcmFtSWQnOiBwYXJhbV9pZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAncG9zaXRpb24nOiBwb3NpdGlvbiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnbGVuZ3RoJzogbGVuZ3RoLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdnYWluJzogZ2FpbiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnb2Zmc2V0Jzogb2Zmc2V0CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXJhbV9pbmRleCArPSAyICAjIFNraXAgdG8gbmV4dCBwYXJhbQogICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQgKFNET1RpbWVvdXRFcnJvciwgU0RPQWJvcnRFcnJvcik6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGlmIG1lc3NhZ2VbJ3BhcmFtcyddOiAgIyBPbmx5IGFkZCBpZiBoYXMgcGFyYW1zCiAgICAgICAgICAgICAgICAgICAgICAgIG1hcHBpbmdzWyd0eCddLmFwcGVuZChtZXNzYWdlKQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIG1zZ19pbmRleCArPSAxCiAgICAgICAgICAgICAgICBleGNlcHQgKFNET1RpbWVvdXRFcnJvciwgU0RPQWJvcnRFcnJvcik6CiAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAKICAgICAgICBpZiBkaXJlY3Rpb24gaW4gWydyeCcsICdib3RoJ106CiAgICAgICAgICAgICMgUmVhZCBSWCBtYXBwaW5ncyBzdGFydGluZyBhdCAweDMxMDAKICAgICAgICAgICAgYmFzZV9pbmRleCA9IDB4MzEwMAogICAgICAgICAgICBtc2dfaW5kZXggPSAwCiAgICAgICAgICAgIHdoaWxlIG1zZ19pbmRleCA8IDI1NToKICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICBjYW5faWQgPSBzZG9fY2xpZW50LnJlYWQoYmFzZV9pbmRleCArIG1zZ19pbmRleCwgMCkKICAgICAgICAgICAgICAgICAgICBpZiBjYW5faWQgPT0gMDoKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBpc19leHRlbmRlZCA9IChjYW5faWQgJiAweDgwMDAwMDAwKSAhPSAwCiAgICAgICAgICAgICAgICAgICAgY2FuX2lkID0gY2FuX2lkICYgMHgxRkZGRkZGRgogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIG1lc3NhZ2UgPSB7CiAgICAgICAgICAgICAgICAgICAgICAgICdjYW5JZCc6IGNhbl9pZCwKICAgICAgICAgICAgICAgICAgICAgICAgJ2lzRXh0ZW5kZWQnOiBpc19leHRlbmRlZCwKICAgICAgICAgICAgICAgICAgICAgICAgJ3BhcmFtcyc6IFtdCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIHBhcmFtX2luZGV4ID0gMQogICAgICAgICAgICAgICAgICAgIHdoaWxlIHBhcmFtX2luZGV4IDwgMjU1OgogICAgICAgICAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYXBwaW5nX2RhdGEgPSBzZG9fY2xpZW50LnJlYWQoYmFzZV9pbmRleCArIG1zZ19pbmRleCwgcGFyYW1faW5kZXgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBtYXBwaW5nX2RhdGEgPT0gMDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXJhbV9pZCA9IG1hcHBpbmdfZGF0YSAmIDB4RkZGRgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9zaXRpb24gPSAobWFwcGluZ19kYXRhID4+IDE2KSAmIDB4RkYKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxlbmd0aCA9IChtYXBwaW5nX2RhdGEgPj4gMjQpICYgMHhGRgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgbGVuZ3RoID49IDEyODoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZW5ndGggPSBsZW5ndGggLSAyNTYKICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2Fpbl9vZmZzZXQgPSBzZG9fY2xpZW50LnJlYWQoYmFzZV9pbmRleCArIG1zZ19pbmRleCwgcGFyYW1faW5kZXggKyAxKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2FpbiA9IChnYWluX29mZnNldCAmIDB4RkZGRkZGKSAvIDEwMDAuMAogICAgICAgICAgICAgICAgICAgICAgICAgICAgb2Zmc2V0ID0gKGdhaW5fb2Zmc2V0ID4+IDI0KSAmIDB4RkYKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIG9mZnNldCA+PSAxMjg6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb2Zmc2V0ID0gMjU2CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2VbJ3BhcmFtcyddLmFwcGVuZCh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3BhcmFtSWQnOiBwYXJhbV9pZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAncG9zaXRpb24nOiBwb3NpdGlvbiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnbGVuZ3RoJzogbGVuZ3RoLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdnYWluJzogZ2FpbiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnb2Zmc2V0Jzogb2Zmc2V0CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXJhbV9pbmRleCArPSAyCiAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdCAoU0RPVGltZW91dEVycm9yLCBTRE9BYm9ydEVycm9yKToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgaWYgbWVzc2FnZVsncGFyYW1zJ106CiAgICAgICAgICAgICAgICAgICAgICAgIG1hcHBpbmdzWydyeCddLmFwcGVuZChtZXNzYWdlKQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIG1zZ19pbmRleCArPSAxCiAgICAgICAgICAgICAgICBleGNlcHQgKFNET1RpbWVvdXRFcnJvciwgU0RPQWJvcnRFcnJvcik6CiAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAKICAgICAgICBfc2VuZF9yZXNwb25zZSgnQ0FOLU1BUC1MSVNUJywgbWFwcGluZ3MpCiAgICAgICAgCiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgIyBTaWxlbnQgLSBlcnJvcnMgc2VudCB2aWEgX3NlbmRfZXJyb3IoKQogICAgICAgIF9zZW5kX2Vycm9yKHN0cihlKSwgJ0NBTi1NQVAtRVJST1InKQoKCmRlZiBhZGRDYW5NYXBwaW5nKGFyZ3MpOgogICAgIiIiCiAgICBBZGQgYSBDQU4gbWFwcGluZyBlbnRyeS4KICAgIAogICAgQXJncyAoZGljdCk6CiAgICAgICAgY2FuX2lkOiBDQU4gbWVzc2FnZSBJRAogICAgICAgIHBhcmFtX25hbWU6IFBhcmFtZXRlci9zcG90IHZhbHVlIG5hbWUKICAgICAgICBwb3NpdGlvbjogQml0IHBvc2l0aW9uIGluIENBTiBtZXNzYWdlCiAgICAgICAgbGVuZ3RoOiBOdW1iZXIgb2YgYml0cyAobmVnYXRpdmUgZm9yIGJpZy1lbmRpYW4pCiAgICAgICAgZ2FpbjogU2NhbGluZyBmYWN0b3IKICAgICAgICBvZmZzZXQ6IE9mZnNldCB2YWx1ZQogICAgICAgIGlzX3R4OiBUcnVlIGZvciB0cmFuc21pdCwgRmFsc2UgZm9yIHJlY2VpdmUKICAgICAgICBpc19leHRlbmRlZDogVHJ1ZSBmb3IgMjktYml0IGV4dGVuZGVkIGZyYW1lCiAgICAiIiIKICAgICMgSGFuZGxlIEpTT04gc3RyaW5nIGZyb20gSmF2YVNjcmlwdCAoSlNPTiB1c2VzIGxvd2VyY2FzZSB0cnVlL2ZhbHNlLCBQeXRob24gbmVlZHMgVHJ1ZS9GYWxzZSkKICAgIGlmIGlzaW5zdGFuY2UoYXJncywgc3RyKToKICAgICAgICBhcmdzID0ganNvbi5sb2FkcyhhcmdzKQogICAgZWxpZiBhcmdzIGlzIE5vbmU6CiAgICAgICAgYXJncyA9IHt9CiAgICAKICAgIGNhbl9pZCA9IGFyZ3MuZ2V0KCdjYW5faWQnKQogICAgcGFyYW1fbmFtZSA9IGFyZ3MuZ2V0KCdwYXJhbV9uYW1lJykKICAgIHBvc2l0aW9uID0gYXJncy5nZXQoJ3Bvc2l0aW9uJywgMCkKICAgIGxlbmd0aCA9IGFyZ3MuZ2V0KCdsZW5ndGgnLCAxNikKICAgIGdhaW4gPSBhcmdzLmdldCgnZ2FpbicsIDEuMCkKICAgIG9mZnNldCA9IGFyZ3MuZ2V0KCdvZmZzZXQnLCAwKQogICAgaXNfdHggPSBhcmdzLmdldCgnaXNfdHgnLCBUcnVlKQogICAgaXNfZXh0ZW5kZWQgPSBhcmdzLmdldCgnaXNfZXh0ZW5kZWQnLCBGYWxzZSkKICAgIAogICAgaWYgY2FuX2lkIGlzIE5vbmUgb3IgcGFyYW1fbmFtZSBpcyBOb25lOgogICAgICAgIF9zZW5kX2Vycm9yKCJNaXNzaW5nIGNhbl9pZCBvciBwYXJhbV9uYW1lIiwgJ0NBTi1NQVAtQURELUVSUk9SJykKICAgICAgICByZXR1cm4KICAgIAogICAgIyBHZXQgcGFyYW0gSUQgZnJvbSBuYW1lCiAgICBpZiBwYXJhbV9uYW1lIG5vdCBpbiBwYXJhbWV0ZXJzOgogICAgICAgIF9zZW5kX2Vycm9yKGYiUGFyYW1ldGVyIHtwYXJhbV9uYW1lfSBub3QgZm91bmQiLCAnQ0FOLU1BUC1BREQtRVJST1InKQogICAgICAgIHJldHVybgogICAgCiAgICBwYXJhbV9pZCA9IHBhcmFtZXRlcnNbcGFyYW1fbmFtZV0uZ2V0KCdpZCcpCiAgICBpZiBwYXJhbV9pZCBpcyBOb25lOgogICAgICAgIF9zZW5kX2Vycm9yKGYiUGFyYW1ldGVyIHtwYXJhbV9uYW1lfSBoYXMgbm8gSUQiLCAnQ0FOLU1BUC1BREQtRVJST1InKQogICAgICAgIHJldHVybgogICAgCiAgICBpZiBub3QgZGV2aWNlX2Nvbm5lY3RlZCBvciBzZG9fY2xpZW50IGlzIE5vbmU6CiAgICAgICAgX3NlbmRfZXJyb3IoIkRldmljZSBub3QgY29ubmVjdGVkIiwgJ0NBTi1NQVAtQURELUVSUk9SJykKICAgICAgICByZXR1cm4KICAgIAogICAgdHJ5OgogICAgICAgICMgUmVhbCBkZXZpY2UgbW9kZSAtIHdyaXRlIHZpYSBTRE8KICAgICAgICAjIFVzZSBhcHByb3ByaWF0ZSBTRE8gaW5kZXggZm9yIFRYICgweDMyMDApIG9yIFJYICgweDMzMDApCiAgICAgICAgYmFzZV9pbmRleCA9IDB4MzIwMCBpZiBpc190eCBlbHNlIDB4MzMwMAogICAgICAgIAogICAgICAgICMgV3JpdGUgQ0FOIElEIHdpdGggZXh0ZW5kZWQgZnJhbWUgZmxhZyBpZiBuZWVkZWQKICAgICAgICBjYW5faWRfdmFsdWUgPSBjYW5faWQgfCAoMHg4MDAwMDAwMCBpZiBpc19leHRlbmRlZCBlbHNlIDApCiAgICAgICAgc2RvX2NsaWVudC53cml0ZShiYXNlX2luZGV4LCAwLCBjYW5faWRfdmFsdWUpCiAgICAgICAgCiAgICAgICAgIyBXcml0ZSBwYXJhbSBJRCwgcG9zaXRpb24sIGxlbmd0aAogICAgICAgIG1hcHBpbmdfZGF0YSA9IHBhcmFtX2lkIHwgKHBvc2l0aW9uIDw8IDE2KSB8ICgobGVuZ3RoICYgMHhGRikgPDwgMjQpCiAgICAgICAgc2RvX2NsaWVudC53cml0ZShiYXNlX2luZGV4LCAxLCBtYXBwaW5nX2RhdGEpCiAgICAgICAgCiAgICAgICAgIyBXcml0ZSBnYWluIGFuZCBvZmZzZXQKICAgICAgICBnYWluX2ZpeGVkID0gaW50KGdhaW4gKiAxMDAwKSAmIDB4RkZGRkZGICAjIDI0LWJpdCBmaXhlZCBwb2ludAogICAgICAgIGdhaW5fb2Zmc2V0X3ZhbHVlID0gZ2Fpbl9maXhlZCB8ICgob2Zmc2V0ICYgMHhGRikgPDwgMjQpCiAgICAgICAgc2RvX2NsaWVudC53cml0ZShiYXNlX2luZGV4LCAyLCBnYWluX29mZnNldF92YWx1ZSkKICAgICAgICAKICAgICAgICBfc2VuZF9yZXNwb25zZSgnQ0FOLU1BUC1BRERFRCcsIHsKICAgICAgICAgICAgJ3N1Y2Nlc3MnOiBUcnVlLAogICAgICAgICAgICAnY2FuX2lkJzogY2FuX2lkLAogICAgICAgICAgICAncGFyYW1fbmFtZSc6IHBhcmFtX25hbWUsCiAgICAgICAgICAgICdwYXJhbV9pZCc6IHBhcmFtX2lkCiAgICAgICAgfSkKICAgICAgICAKICAgIGV4Y2VwdCAoU0RPVGltZW91dEVycm9yLCBTRE9BYm9ydEVycm9yKSBhcyBlOgogICAgICAgIF9zZW5kX2Vycm9yKHN0cihlKSwgJ0NBTi1NQVAtQURELUVSUk9SJykKICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICBfc2VuZF9lcnJvcihzdHIoZSksICdDQU4tTUFQLUFERC1FUlJPUicpCgoKZGVmIHJlbW92ZUNhbk1hcHBpbmcoYXJncyk6CiAgICAiIiIKICAgIFJlbW92ZSBhIENBTiBtYXBwaW5nIGVudHJ5LgogICAgCiAgICBBcmdzIChkaWN0KToKICAgICAgICBkaXJlY3Rpb246ICd0eCcgb3IgJ3J4JwogICAgICAgIG1zZ19pbmRleDogTWVzc2FnZSBpbmRleAogICAgICAgIHBhcmFtX2luZGV4OiBQYXJhbWV0ZXIgaW5kZXggd2l0aGluIG1lc3NhZ2UKICAgICIiIgogICAgIyBIYW5kbGUgSlNPTiBzdHJpbmcgZnJvbSBKYXZhU2NyaXB0CiAgICBpZiBpc2luc3RhbmNlKGFyZ3MsIHN0cik6CiAgICAgICAgYXJncyA9IGpzb24ubG9hZHMoYXJncykKICAgIGVsaWYgYXJncyBpcyBOb25lOgogICAgICAgIGFyZ3MgPSB7fQogICAgCiAgICBkaXJlY3Rpb24gPSBhcmdzLmdldCgnZGlyZWN0aW9uJykKICAgIG1zZ19pbmRleCA9IGFyZ3MuZ2V0KCdtc2dfaW5kZXgnKQogICAgcGFyYW1faW5kZXggPSBhcmdzLmdldCgncGFyYW1faW5kZXgnKQogICAgCiAgICBpZiBkaXJlY3Rpb24gaXMgTm9uZSBvciBtc2dfaW5kZXggaXMgTm9uZSBvciBwYXJhbV9pbmRleCBpcyBOb25lOgogICAgICAgIF9zZW5kX2Vycm9yKCJNaXNzaW5nIGRpcmVjdGlvbiwgbXNnX2luZGV4LCBvciBwYXJhbV9pbmRleCIsICdDQU4tTUFQLVJFTU9WRS1FUlJPUicpCiAgICAgICAgcmV0dXJuCiAgICAKICAgIGlmIG5vdCBkZXZpY2VfY29ubmVjdGVkIG9yIHNkb19jbGllbnQgaXMgTm9uZToKICAgICAgICBfc2VuZF9lcnJvcigiRGV2aWNlIG5vdCBjb25uZWN0ZWQiLCAnQ0FOLU1BUC1SRU1PVkUtRVJST1InKQogICAgICAgIHJldHVybgogICAgCiAgICB0cnk6CiAgICAgICAgIyBSZWFsIGRldmljZSBtb2RlIC0gd3JpdGUgdmlhIFNETwogICAgICAgIGJhc2VfaW5kZXggPSAweDMwMDAgaWYgZGlyZWN0aW9uID09ICd0eCcgZWxzZSAweDMxMDAKICAgICAgICB0YXJnZXRfaW5kZXggPSBiYXNlX2luZGV4ICsgbXNnX2luZGV4CiAgICAgICAgIyBXcml0ZSAwIHRvIHRoZSBwYXJhbWV0ZXIgc3ViaW5kZXggdG8gcmVtb3ZlIGl0CiAgICAgICAgIyBEZXZpY2Ugd2lsbCBhdXRvbWF0aWNhbGx5IHNoaWZ0IHJlbWFpbmluZyBwYXJhbXMKICAgICAgICB0YXJnZXRfc3ViaW5kZXggPSAxICsgKHBhcmFtX2luZGV4ICogMikKICAgICAgICBzZG9fY2xpZW50LndyaXRlKHRhcmdldF9pbmRleCwgdGFyZ2V0X3N1YmluZGV4LCAwKQogICAgICAgIAogICAgICAgIF9zZW5kX3Jlc3BvbnNlKCdDQU4tTUFQLVJFTU9WRUQnLCB7J3N1Y2Nlc3MnOiBUcnVlfSkKICAgICAgICAKICAgIGV4Y2VwdCAoU0RPVGltZW91dEVycm9yLCBTRE9BYm9ydEVycm9yKSBhcyBlOgogICAgICAgIF9zZW5kX2Vycm9yKHN0cihlKSwgJ0NBTi1NQVAtUkVNT1ZFLUVSUk9SJykKICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICBfc2VuZF9lcnJvcihzdHIoZSksICdDQU4tTUFQLVJFTU9WRS1FUlJPUicpCgoKZGVmIGNsZWFyQ2FuTWFwKGFyZ3MpOgogICAgIiIiCiAgICBDbGVhciBhbGwgQ0FOIG1hcHBpbmdzIGZvciBhIGRpcmVjdGlvbi4KICAgIAogICAgQXJncyAoZGljdCk6CiAgICAgICAgZGlyZWN0aW9uOiAndHgnLCAncngnLCBvciAnYWxsJwogICAgIiIiCiAgICBpZiBub3QgZGV2aWNlX2Nvbm5lY3RlZCBvciBzZG9fY2xpZW50IGlzIE5vbmU6CiAgICAgICAgX3NlbmRfZXJyb3IoIkRldmljZSBub3QgY29ubmVjdGVkIiwgJ0NBTi1NQVAtQ0xFQVItRVJST1InKQogICAgICAgIHJldHVybgogICAgCiAgICBkaXJlY3Rpb24gPSBhcmdzLmdldCgnZGlyZWN0aW9uJywgJ2FsbCcpCiAgICAKICAgIHRyeToKICAgICAgICAjIFJlcGVhdGVkbHkgcmVtb3ZlIGZpcnN0IGVudHJ5IHVudGlsIG5vbmUgcmVtYWluCiAgICAgICAgaWYgZGlyZWN0aW9uIGluIFsndHgnLCAnYWxsJ106CiAgICAgICAgICAgIGJhc2VfaW5kZXggPSAweDMwMDAKICAgICAgICAgICAgd2hpbGUgVHJ1ZToKICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICAjIFRyeSB0byByZW1vdmUgZmlyc3QgcGFyYW0gb2YgZmlyc3QgbWVzc2FnZQogICAgICAgICAgICAgICAgICAgIHNkb19jbGllbnQud3JpdGUoYmFzZV9pbmRleCwgMSwgMCkKICAgICAgICAgICAgICAgIGV4Y2VwdCBTRE9BYm9ydEVycm9yOgogICAgICAgICAgICAgICAgICAgIGJyZWFrICAjIE5vIG1vcmUgbWFwcGluZ3MKICAgICAgICAKICAgICAgICBpZiBkaXJlY3Rpb24gaW4gWydyeCcsICdhbGwnXToKICAgICAgICAgICAgYmFzZV9pbmRleCA9IDB4MzEwMAogICAgICAgICAgICB3aGlsZSBUcnVlOgogICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgIHNkb19jbGllbnQud3JpdGUoYmFzZV9pbmRleCwgMSwgMCkKICAgICAgICAgICAgICAgIGV4Y2VwdCBTRE9BYm9ydEVycm9yOgogICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgCiAgICAgICAgCiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgX3NlbmRfZXJyb3Ioc3RyKGUpLCAnQ0FOLU1BUC1DTEVBUi1FUlJPUicpCgoKZGVmIGV4cG9ydENhbk1hcEpzb24oKToKICAgICIiIgogICAgRXhwb3J0IENBTiBtYXBwaW5ncyBhcyBKU09OIGZvciBkb3dubG9hZC4KICAgICIiIgogICAgaWYgbm90IGRldmljZV9jb25uZWN0ZWQgb3Igc2RvX2NsaWVudCBpcyBOb25lOgogICAgICAgIF9zZW5kX2Vycm9yKCJEZXZpY2Ugbm90IGNvbm5lY3RlZCIsICdDQU4tTUFQLUVYUE9SVC1FUlJPUicpCiAgICAgICAgcmV0dXJuCiAgICAKICAgICMgVXNlIGdldENhbk1hcCB0byByZWFkIG1hcHBpbmdzLCB0aGVuIGZvcm1hdCBmb3IgZXhwb3J0CiAgICB0cnk6CiAgICAgICAgIyBUaGlzIGlzIGEgc2ltcGxpZmllZCB2ZXJzaW9uIC0gcmVhbCBpbXBsZW1lbnRhdGlvbiB3b3VsZAogICAgICAgICMgY2FsbCBpbnRlcm5hbCBtYXBwaW5nIHJlYWQgbG9naWMKICAgICAgICBfc2VuZF9lcnJvcigiRXhwb3J0IG5vdCB5ZXQgaW1wbGVtZW50ZWQiLCAnQ0FOLU1BUC1FWFBPUlQtRVJST1InKQogICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgIF9zZW5kX2Vycm9yKHN0cihlKSwgJ0NBTi1NQVAtRVhQT1JULUVSUk9SJykKCgpkZWYgaW1wb3J0Q2FuTWFwSnNvbihhcmdzKToKICAgICIiIgogICAgSW1wb3J0IENBTiBtYXBwaW5ncyBmcm9tIEpTT04uCiAgICAKICAgIEFyZ3MgKGRpY3QpOgogICAgICAgIG1hcHBpbmdzOiBKU09OIHN0cnVjdHVyZSB3aXRoIFRYL1JYIG1hcHBpbmdzCiAgICAgICAgY2xlYXJfZXhpc3Rpbmc6IFdoZXRoZXIgdG8gY2xlYXIgZXhpc3RpbmcgbWFwcGluZ3MgZmlyc3QKICAgICIiIgogICAgaWYgbm90IGRldmljZV9jb25uZWN0ZWQgb3Igc2RvX2NsaWVudCBpcyBOb25lOgogICAgICAgIF9zZW5kX2Vycm9yKCJEZXZpY2Ugbm90IGNvbm5lY3RlZCIsICdDQU4tTUFQLUlNUE9SVC1FUlJPUicpCiAgICAgICAgcmV0dXJuCiAgICAKICAgIF9zZW5kX2Vycm9yKCJJbXBvcnQgbm90IHlldCBpbXBsZW1lbnRlZCIsICdDQU4tTUFQLUlNUE9SVC1FUlJPUicpCgoKIyBMZWdhY3kgZnVuY3Rpb25zIC0ga2VwdCBmb3IgYmFja3dhcmRzIGNvbXBhdGliaWxpdHkgYnV0IGRlcHJlY2F0ZWQKZGVmIG1hcENhblNwb3RWYWx1ZShhcmdzKToKICAgICIiIkRFUFJFQ0FURUQ6IFVzZSBhZGRDYW5NYXBwaW5nIGluc3RlYWQiIiIKICAgIGFkZENhbk1hcHBpbmcoYXJncykKCgpkZWYgdW5tYXBDYW5TcG90VmFsdWUoYXJncyk6CiAgICAiIiJERVBSRUNBVEVEOiBVc2UgcmVtb3ZlQ2FuTWFwcGluZyBpbnN0ZWFkIiIiCiAgICByZW1vdmVDYW5NYXBwaW5nKGFyZ3MpCgoKZGVmIGdldENhbk1hcHBpbmdEYXRhKCk6CiAgICAiIiJERVBSRUNBVEVEOiBVc2UgZ2V0Q2FuTWFwIGluc3RlYWQiIiIKICAgIGdldENhbk1hcCgpCgoKIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiMgRGV2aWNlIENvbW1hbmRzCiMgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQoKZGVmIGRldmljZVNhdmUoKToKICAgICIiIgogICAgU2F2ZSBwYXJhbWV0ZXJzIGFuZCBDQU4gbWFwcGluZ3MgdG8gZGV2aWNlIGZsYXNoLgogICAgCiAgICBDb21tYW5kcyB1c2UgU0RPIGluZGV4IDB4MzAwNC4KICAgICIiIgogICAgaWYgbm90IGRldmljZV9jb25uZWN0ZWQgb3Igc2RvX2NsaWVudCBpcyBOb25lOgogICAgICAgIF9zZW5kX2Vycm9yKCJEZXZpY2Ugbm90IGNvbm5lY3RlZCIsICdERVZJQ0UtU0FWRS1FUlJPUicpCiAgICAgICAgcmV0dXJuCiAgICAKICAgIHRyeToKICAgICAgICAjIFNlbmQgc2F2ZSBjb21tYW5kIChzdWJpbmRleCAxKQogICAgICAgIHNkb19jbGllbnQud3JpdGUoMHgzMDA0LCAxLCAwKQogICAgZXhjZXB0IChTRE9UaW1lb3V0RXJyb3IsIFNET0Fib3J0RXJyb3IpIGFzIGU6CiAgICAgICAgX3NlbmRfZXJyb3Ioc3RyKGUpLCAnREVWSUNFLVNBVkUtRVJST1InKQogICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgIF9zZW5kX2Vycm9yKHN0cihlKSwgJ0RFVklDRS1TQVZFLUVSUk9SJykKCgpkZWYgZGV2aWNlTG9hZCgpOgogICAgIiIiCiAgICBMb2FkIHBhcmFtZXRlcnMgYW5kIENBTiBtYXBwaW5ncyBmcm9tIGRldmljZSBmbGFzaC4KICAgICIiIgogICAgaWYgbm90IGRldmljZV9jb25uZWN0ZWQgb3Igc2RvX2NsaWVudCBpcyBOb25lOgogICAgICAgIF9zZW5kX2Vycm9yKCJEZXZpY2Ugbm90IGNvbm5lY3RlZCIsICdERVZJQ0UtTE9BRC1FUlJPUicpCiAgICAgICAgcmV0dXJuCiAgICAKICAgIHRyeToKICAgICAgICAjIFNlbmQgbG9hZCBjb21tYW5kIChzdWJpbmRleCAyKQogICAgICAgIHNkb19jbGllbnQud3JpdGUoMHgzMDA0LCAyLCAwKQogICAgZXhjZXB0IChTRE9UaW1lb3V0RXJyb3IsIFNET0Fib3J0RXJyb3IpIGFzIGU6CiAgICAgICAgX3NlbmRfZXJyb3Ioc3RyKGUpLCAnREVWSUNFLUxPQUQtRVJST1InKQogICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgIF9zZW5kX2Vycm9yKHN0cihlKSwgJ0RFVklDRS1MT0FELUVSUk9SJykKCgpkZWYgZGV2aWNlUmVzZXQoKToKICAgICIiIgogICAgUmVzZXQvcmVib290IHRoZSBkZXZpY2UuCiAgICAiIiIKICAgIGlmIG5vdCBkZXZpY2VfY29ubmVjdGVkIG9yIHNkb19jbGllbnQgaXMgTm9uZToKICAgICAgICBfc2VuZF9lcnJvcigiRGV2aWNlIG5vdCBjb25uZWN0ZWQiLCAnREVWSUNFLVJFU0VULUVSUk9SJykKICAgICAgICByZXR1cm4KICAgIAogICAgdHJ5OgogICAgICAgICMgU2VuZCByZXNldCBjb21tYW5kIChzdWJpbmRleCAzKQogICAgICAgIHNkb19jbGllbnQud3JpdGUoMHgzMDA0LCAzLCAwKQogICAgZXhjZXB0IChTRE9UaW1lb3V0RXJyb3IsIFNET0Fib3J0RXJyb3IpIGFzIGU6CiAgICAgICAgX3NlbmRfZXJyb3Ioc3RyKGUpLCAnREVWSUNFLVJFU0VULUVSUk9SJykKICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICBfc2VuZF9lcnJvcihzdHIoZSksICdERVZJQ0UtUkVTRVQtRVJST1InKQoKCmRlZiBkZXZpY2VMb2FkRGVmYXVsdHMoKToKICAgICIiIgogICAgTG9hZCBkZWZhdWx0IHBhcmFtZXRlcnMgKGZhY3RvcnkgcmVzZXQpLgogICAgIiIiCiAgICBpZiBub3QgZGV2aWNlX2Nvbm5lY3RlZCBvciBzZG9fY2xpZW50IGlzIE5vbmU6CiAgICAgICAgX3NlbmRfZXJyb3IoIkRldmljZSBub3QgY29ubmVjdGVkIiwgJ0RFVklDRS1ERUZBVUxUUy1FUlJPUicpCiAgICAgICAgcmV0dXJuCiAgICAKICAgIHRyeToKICAgICAgICAjIFNlbmQgbG9hZCBkZWZhdWx0cyBjb21tYW5kIChzdWJpbmRleCA0KQogICAgICAgIHNkb19jbGllbnQud3JpdGUoMHgzMDA0LCA0LCAwKQogICAgZXhjZXB0IChTRE9UaW1lb3V0RXJyb3IsIFNET0Fib3J0RXJyb3IpIGFzIGU6CiAgICAgICAgX3NlbmRfZXJyb3Ioc3RyKGUpLCAnREVWSUNFLURFRkFVTFRTLUVSUk9SJykKICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICBfc2VuZF9lcnJvcihzdHIoZSksICdERVZJQ0UtREVGQVVMVFMtRVJST1InKQoKCmRlZiBkZXZpY2VTdGFydChhcmdzPU5vbmUpOgogICAgIiIiCiAgICBTdGFydCBkZXZpY2Ugb3BlcmF0aW9uIGluIHNwZWNpZmllZCBtb2RlLgogICAgCiAgICBBcmdzIChkaWN0LCBvcHRpb25hbCk6CiAgICAgICAgbW9kZTogT3BlcmF0aW5nIG1vZGUgKDA9Tm9ybWFsLCAxPU1hbnVhbCwgMj1Cb29zdCwgMz1CdWNrLCA0PVNpbmUsIDU9QUNIZWF0KQogICAgIiIiCiAgICBpZiBub3QgZGV2aWNlX2Nvbm5lY3RlZCBvciBzZG9fY2xpZW50IGlzIE5vbmU6CiAgICAgICAgX3NlbmRfZXJyb3IoIkRldmljZSBub3QgY29ubmVjdGVkIiwgJ0RFVklDRS1TVEFSVC1FUlJPUicpCiAgICAgICAgcmV0dXJuCiAgICAKICAgIG1vZGUgPSBhcmdzLmdldCgnbW9kZScsIDApIGlmIGFyZ3MgZWxzZSAwCiAgICAKICAgIHRyeToKICAgICAgICAjIFNlbmQgc3RhcnQgY29tbWFuZCAoc3ViaW5kZXggNSkgd2l0aCBtb2RlCiAgICAgICAgc2RvX2NsaWVudC53cml0ZSgweDMwMDQsIDUsIG1vZGUpCiAgICAgICAgbW9kZV9uYW1lcyA9IHswOiAnTm9ybWFsJywgMTogJ01hbnVhbCcsIDI6ICdCb29zdCcsIDM6ICdCdWNrJywgNDogJ1NpbmUnLCA1OiAnQUNIZWF0J30KICAgICAgICBtb2RlX25hbWUgPSBtb2RlX25hbWVzLmdldChtb2RlLCBmJ01vZGUge21vZGV9JykKICAgIGV4Y2VwdCAoU0RPVGltZW91dEVycm9yLCBTRE9BYm9ydEVycm9yKSBhcyBlOgogICAgICAgIF9zZW5kX2Vycm9yKHN0cihlKSwgJ0RFVklDRS1TVEFSVC1FUlJPUicpCiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgX3NlbmRfZXJyb3Ioc3RyKGUpLCAnREVWSUNFLVNUQVJULUVSUk9SJykKCgpkZWYgZGV2aWNlU3RvcCgpOgogICAgIiIiCiAgICBTdG9wIGRldmljZSBvcGVyYXRpb24uCiAgICAiIiIKICAgIGlmIG5vdCBkZXZpY2VfY29ubmVjdGVkIG9yIHNkb19jbGllbnQgaXMgTm9uZToKICAgICAgICBfc2VuZF9lcnJvcigiRGV2aWNlIG5vdCBjb25uZWN0ZWQiLCAnREVWSUNFLVNUT1AtRVJST1InKQogICAgICAgIHJldHVybgogICAgCiAgICB0cnk6CiAgICAgICAgIyBTZW5kIHN0b3AgY29tbWFuZCAoc3ViaW5kZXggNikKICAgICAgICBzZG9fY2xpZW50LndyaXRlKDB4MzAwNCwgNiwgMCkKICAgIGV4Y2VwdCAoU0RPVGltZW91dEVycm9yLCBTRE9BYm9ydEVycm9yKSBhcyBlOgogICAgICAgIF9zZW5kX2Vycm9yKHN0cihlKSwgJ0RFVklDRS1TVE9QLUVSUk9SJykKICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICBfc2VuZF9lcnJvcihzdHIoZSksICdERVZJQ0UtU1RPUC1FUlJPUicpCgoKIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiMgRGV2aWNlIEluZm8gYW5kIEVycm9yIExvZwojID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KCmRlZiBnZXRTZXJpYWxOdW1iZXIoKToKICAgICIiIgogICAgUmVhZCBkZXZpY2Ugc2VyaWFsIG51bWJlci4KICAgIAogICAgU2VyaWFsIG51bWJlciBpcyBhdCBTRE8gMHg1MDAwLCBzdWJpbmRleCAwLTIgKDMgcGFydHMpLgogICAgIiIiCiAgICBpZiBub3QgZGV2aWNlX2Nvbm5lY3RlZCBvciBzZG9fY2xpZW50IGlzIE5vbmU6CiAgICAgICAgX3NlbmRfZXJyb3IoIkRldmljZSBub3QgY29ubmVjdGVkIiwgJ1NFUklBTC1OVU1CRVItRVJST1InKQogICAgICAgIHJldHVybgogICAgCiAgICB0cnk6CiAgICAgICAgIyBSZWFkIDMgcGFydHMgb2Ygc2VyaWFsIG51bWJlcgogICAgICAgIHNlcmlhbF9wYXJ0cyA9IFtdCiAgICAgICAgZm9yIGkgaW4gcmFuZ2UoMyk6CiAgICAgICAgICAgIHBhcnQgPSBzZG9fY2xpZW50LnJlYWQoMHg1MDAwLCBpKQogICAgICAgICAgICAjIEZvcm1hdCBhcyBoZXggc3RyaW5nCiAgICAgICAgICAgIHNlcmlhbF9wYXJ0cy5hcHBlbmQoZiJ7cGFydDowOFh9IikKICAgICAgICAKICAgICAgICBzZXJpYWxfbnVtYmVyID0gIjoiLmpvaW4oc2VyaWFsX3BhcnRzKQogICAgICAgIF9zZW5kX3Jlc3BvbnNlKCdTRVJJQUwtTlVNQkVSJywgeydzZXJpYWxOdW1iZXInOiBzZXJpYWxfbnVtYmVyfSkKICAgIGV4Y2VwdCAoU0RPVGltZW91dEVycm9yLCBTRE9BYm9ydEVycm9yKSBhcyBlOgogICAgICAgIF9zZW5kX2Vycm9yKHN0cihlKSwgJ1NFUklBTC1OVU1CRVItRVJST1InKQogICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgIF9zZW5kX2Vycm9yKHN0cihlKSwgJ1NFUklBTC1OVU1CRVItRVJST1InKQoKCmRlZiBnZXREZXZpY2VJbmZvKCk6CiAgICAiIiIKICAgIEdldCBkZXZpY2UgaW5mb3JtYXRpb24gKGZpcm13YXJlIHZlcnNpb24sIHVwdGltZSwgZXRjKS4KICAgICIiIgogICAgaWYgbm90IGRldmljZV9jb25uZWN0ZWQgb3Igc2RvX2NsaWVudCBpcyBOb25lOgogICAgICAgIF9zZW5kX2Vycm9yKCJEZXZpY2Ugbm90IGNvbm5lY3RlZCIsICdERVZJQ0UtSU5GTy1FUlJPUicpCiAgICAgICAgcmV0dXJuCiAgICAKICAgIHRyeToKICAgICAgICBpbmZvID0gewogICAgICAgICAgICAnY29ubmVjdGVkJzogVHJ1ZSwKICAgICAgICAgICAgJ25vZGVJZCc6IGRldmljZV9ub2RlX2lkLAogICAgICAgICAgICAnYml0cmF0ZSc6IGRldmljZV9iaXRyYXRlCiAgICAgICAgfQogICAgICAgIAogICAgICAgICMgVHJ5IHRvIHJlYWQgc2VyaWFsIG51bWJlcgogICAgICAgIHRyeToKICAgICAgICAgICAgc2VyaWFsX3BhcnRzID0gW10KICAgICAgICAgICAgZm9yIGkgaW4gcmFuZ2UoMyk6CiAgICAgICAgICAgICAgICBwYXJ0ID0gc2RvX2NsaWVudC5yZWFkKDB4NTAwMCwgaSkKICAgICAgICAgICAgICAgIHNlcmlhbF9wYXJ0cy5hcHBlbmQoZiJ7cGFydDowOFh9IikKICAgICAgICAgICAgaW5mb1snc2VyaWFsTnVtYmVyJ10gPSAiOiIuam9pbihzZXJpYWxfcGFydHMpCiAgICAgICAgZXhjZXB0OgogICAgICAgICAgICBpbmZvWydzZXJpYWxOdW1iZXInXSA9ICdVbmtub3duJwogICAgICAgIAogICAgICAgICMgVHJ5IHRvIHJlYWQgdXB0aW1lIChjb21tb24gc3BvdCB2YWx1ZSkKICAgICAgICB0cnk6CiAgICAgICAgICAgIGlmICd1cHRpbWUnIGluIHBhcmFtZXRlcnM6CiAgICAgICAgICAgICAgICBwYXJhbV9pZCA9IHBhcmFtZXRlcnNbJ3VwdGltZSddLmdldCgnaWQnKQogICAgICAgICAgICAgICAgaWYgcGFyYW1faWQ6CiAgICAgICAgICAgICAgICAgICAgaW5kZXgsIHN1YmluZGV4ID0gcGFyYW1faWRfdG9fc2RvKHBhcmFtX2lkKQogICAgICAgICAgICAgICAgICAgIHJhd192YWx1ZSA9IHNkb19jbGllbnQucmVhZChpbmRleCwgc3ViaW5kZXgpCiAgICAgICAgICAgICAgICAgICAgaW5mb1sndXB0aW1lJ10gPSBmaXhlZF90b19mbG9hdChyYXdfdmFsdWUpCiAgICAgICAgZXhjZXB0OgogICAgICAgICAgICBwYXNzCiAgICAgICAgCiAgICAgICAgX3NlbmRfcmVzcG9uc2UoJ0RFVklDRS1JTkZPJywgaW5mbykKICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICBfc2VuZF9lcnJvcihzdHIoZSksICdERVZJQ0UtSU5GTy1FUlJPUicpCgoKZGVmIGdldEVycm9yTG9nKCk6CiAgICAiIiIKICAgIEdldCBlcnJvciBsb2cgZnJvbSBkZXZpY2UuCiAgICAKICAgIEVycm9yIHRpbWVzIGF0IFNETyAweDIwMDEsIGVycm9yIGNvZGVzIGF0IDB4MjAwMi4KICAgICIiIgogICAgaWYgbm90IGRldmljZV9jb25uZWN0ZWQgb3Igc2RvX2NsaWVudCBpcyBOb25lOgogICAgICAgIF9zZW5kX2Vycm9yKCJEZXZpY2Ugbm90IGNvbm5lY3RlZCIsICdFUlJPUi1MT0ctRVJST1InKQogICAgICAgIHJldHVybgogICAgCiAgICB0cnk6CiAgICAgICAgZXJyb3JzID0gW10KICAgICAgICAKICAgICAgICAjIFJlYWQgZXJyb3IgbG9nICh1cCB0byAyNTUgZW50cmllcykKICAgICAgICBmb3IgaSBpbiByYW5nZSgyNTUpOgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAjIFJlYWQgZXJyb3IgdGltZQogICAgICAgICAgICAgICAgZXJyb3JfdGltZSA9IHNkb19jbGllbnQucmVhZCgweDIwMDEsIGkpCiAgICAgICAgICAgICAgICBpZiBlcnJvcl90aW1lID09IDA6CiAgICAgICAgICAgICAgICAgICAgYnJlYWsgICMgTm8gbW9yZSBlcnJvcnMKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBSZWFkIGVycm9yIGNvZGUKICAgICAgICAgICAgICAgIGVycm9yX2NvZGUgPSBzZG9fY2xpZW50LnJlYWQoMHgyMDAyLCBpKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBlcnJvcnMuYXBwZW5kKHsKICAgICAgICAgICAgICAgICAgICAndGltZXN0YW1wJzogZXJyb3JfdGltZSwKICAgICAgICAgICAgICAgICAgICAnY29kZSc6IGVycm9yX2NvZGUsCiAgICAgICAgICAgICAgICAgICAgJ2Rlc2NyaXB0aW9uJzogZiJFcnJvciBjb2RlIHtlcnJvcl9jb2RlfSIKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgIGV4Y2VwdCAoU0RPVGltZW91dEVycm9yLCBTRE9BYm9ydEVycm9yKToKICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgCiAgICAgICAgX3NlbmRfcmVzcG9uc2UoJ0VSUk9SLUxPRycsIGVycm9ycykKICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICBfc2VuZF9lcnJvcihzdHIoZSksICdFUlJPUi1MT0ctRVJST1InKQoKCiMgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQojIFN0cmVhbWluZyBNb2RlIENvbnRyb2wKIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CgpkZWYgc3RhcnRMaXZlU3RyZWFtaW5nKGNhbl9pZHMpOgogICAgIiIiCiAgICBTdGFydCBDIHN0cmVhbWluZyBtb2RlIGZvciBoaWdoLXNwZWVkIGRhdGEgYWNxdWlzaXRpb24uCiAgICAKICAgIEFyZ3M6CiAgICAgICAgY2FuX2lkczogTGlzdCBvZiBDQU4gSURzIHRvIHN0cmVhbQogICAgCiAgICBOT1RFOiBDYW5ub3QgZG8gU0RPIG9wZXJhdGlvbnMgd2hpbGUgc3RyZWFtaW5nIQogICAgIiIiCiAgICBnbG9iYWwgc3RyZWFtaW5nX2FjdGl2ZQogICAgCiAgICBpZiBDQU4gaXMgTm9uZSBvciBjYW5fZGV2IGlzIE5vbmU6CiAgICAgICAgX3NlbmRfZXJyb3IoIkNBTiBub3QgYXZhaWxhYmxlIiwgJ1NUUkVBTUlORy1TVEFSVC1FUlJPUicpCiAgICAgICAgcmV0dXJuCiAgICAKICAgIHRyeToKICAgICAgICAjIENvbmZpZ3VyZSBoYXJkd2FyZSBmaWx0ZXJzCiAgICAgICAgY2FuX2Rldi5zZXRfZmlsdGVyKGNhbl9pZHMpCiAgICAgICAgCiAgICAgICAgIyBTdGFydCBzdHJlYW1pbmcKICAgICAgICBjYW5fZGV2LnN0cmVhbV9zdGFydCgpCiAgICAgICAgCiAgICAgICAgc3RyZWFtaW5nX2FjdGl2ZSA9IFRydWUKICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICBfc2VuZF9lcnJvcihzdHIoZSksICdTVFJFQU1JTkctU1RBUlQtRVJST1InKQoKCmRlZiBzdG9wTGl2ZVN0cmVhbWluZygpOgogICAgIiIiCiAgICBTdG9wIEMgc3RyZWFtaW5nIG1vZGUgYW5kIHJldHVybiB0byBjb25maWd1cmF0aW9uIG1vZGUuCiAgICAiIiIKICAgIGdsb2JhbCBzdHJlYW1pbmdfYWN0aXZlCiAgICAKICAgIGlmIENBTiBpcyBOb25lIG9yIGNhbl9kZXYgaXMgTm9uZToKICAgICAgICBfc2VuZF9lcnJvcigiQ0FOIG5vdCBhdmFpbGFibGUiLCAnU1RSRUFNSU5HLVNUT1AtRVJST1InKQogICAgICAgIHJldHVybgogICAgCiAgICB0cnk6CiAgICAgICAgIyBTdG9wIHN0cmVhbWluZwogICAgICAgIGNhbl9kZXYuc3RyZWFtX3N0b3AoKQogICAgICAgIAogICAgICAgIHN0cmVhbWluZ19hY3RpdmUgPSBGYWxzZQogICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgIF9zZW5kX2Vycm9yKHN0cihlKSwgJ1NUUkVBTUlORy1TVE9QLUVSUk9SJykKCgojID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KIyBMZWdhY3kvRGVwcmVjYXRlZCBGdW5jdGlvbnMKIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CgpkZWYgZ2V0U3lzSW5mbygpOgogICAgIiIiREVQUkVDQVRFRDogVXNlIGdldERldmljZUluZm8gaW5zdGVhZCIiIgogICAgZ2V0RGV2aWNlSW5mbygpCgoKZGVmIGFjdGlvbkJ1dHRvbihhcmdzKToKICAgICIiIkRFUFJFQ0FURUQ6IFVzZSBkZXZpY2UgY29tbWFuZCBmdW5jdGlvbnMgaW5zdGVhZCIiIgogICAgX3NlbmRfZXJyb3IoIkFjdGlvbiBidXR0b24gbm90IGltcGxlbWVudGVkLCB1c2UgZGV2aWNlU3RhcnQvZGV2aWNlU3RvcCBpbnN0ZWFkIiwgIkFDVElPTl9CVVRUT05fRVJST1IiKQoKCmRlZiB0ZXJtQ21kKGFyZ3MpOgogICAgIiIiREVQUkVDQVRFRDogRGlyZWN0IHRlcm1pbmFsIGNvbW1hbmRzIG5vdCBzdXBwb3J0ZWQiIiIKICAgIF9zZW5kX2Vycm9yKCJUZXJtaW5hbCBjb21tYW5kIG5vdCBpbXBsZW1lbnRlZCIsICJURVJNX0NNRF9FUlJPUiIpCgoKIyBMZWdhY3kgc2F2ZVBhcmFtZXRlcnMgLSBub3cgdXNlcyBkZXZpY2VTYXZlCmRlZiBzYXZlUGFyYW1ldGVycygpOgogICAgIiIiREVQUkVDQVRFRDogVXNlIGRldmljZVNhdmUgaW5zdGVhZCIiIgogICAgZGV2aWNlU2F2ZSgpCgoKIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiMgRmlybXdhcmUgVXBncmFkZSBGdW5jdGlvbnMKIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CgojIEdsb2JhbCBmaXJtd2FyZSB1cGdyYWRlIHN0YXRlCmZpcm13YXJlX3VwZ3JhZGVfc3RhdGUgPSB7CiAgICAnYWN0aXZlJzogRmFsc2UsCiAgICAnZmlybXdhcmVfZGF0YSc6IE5vbmUsCiAgICAncGFnZXMnOiBbXSwKICAgICdjdXJyZW50X3BhZ2UnOiAwLAogICAgJ3Byb2dyZXNzJzogMC4wLAogICAgJ3N0YXRlJzogJ2lkbGUnLCAgIyBpZGxlLCB3YWl0aW5nX2hlbGxvLCB3YWl0aW5nX3N0YXJ0LCB1cGxvYWRpbmcsIGNoZWNraW5nX2NyYywgZG9uZSwgZXJyb3IKICAgICdtZXNzYWdlJzogJycsCiAgICAnZXJyb3InOiBOb25lLAogICAgJ3RhcmdldF9zZXJpYWwnOiBOb25lCn0KCiMgQ0FOIElEcyBmb3IgZmlybXdhcmUgdXBncmFkZSBwcm90b2NvbApERVZJQ0VfQ0FOX0lEID0gMHg3REUKVVBHUkFERVJfQ0FOX0lEID0gMHg3REQKUEFHRV9TSVpFID0gMTAyNAoKIyBEZXZpY2UgcGFja2V0IHR5cGVzClBBQ0tFVF9IRUxMTyA9IDB4MzMgICAjICczJwpQQUNLRVRfU1RBUlQgPSAweDUzICAgIyAnUycKUEFDS0VUX1BBR0UgPSAweDUwICAgICMgJ1AnClBBQ0tFVF9DUkMgPSAweDQzICAgICAjICdDJwpQQUNLRVRfRE9ORSA9IDB4NDQgICAgIyAnRCcKUEFDS0VUX0VSUk9SID0gMHg0NSAgICMgJ0UnCgoKZGVmIHN0bV9jcmMzMihkYXRhKToKICAgICIiIgogICAgQ29tcHV0ZSBDUkMtMzIvTVBFRy0yIGFzIGV4cGVjdGVkIGJ5IE9wZW5JbnZlcnRlciBib290bG9hZGVyLgogICAgCiAgICBVc2VzOgogICAgLSB3aWR0aD0zMgogICAgLSBwb2x5PTB4MDRjMTFkYjcKICAgIC0gaW5pdD0weGZmZmZmZmZmCiAgICAtIHJlZmluPWZhbHNlIChub3QgcmVmbGVjdGVkKQogICAgLSByZWZvdXQ9ZmFsc2UKICAgIC0geG9yb3V0PTAgKG5vIHBvc3QtY29tcGxlbWVudCkKICAgIAogICAgRGF0YSBpcyBwcm9jZXNzZWQgYXMgbGl0dGxlLWVuZGlhbiAzMi1iaXQgd29yZHMuCiAgICAiIiIKICAgIGNyYyA9IDB4ZmZmZmZmZmYKICAgIAogICAgIyBQcm9jZXNzIGRhdGEgaW4gNC1ieXRlICgzMi1iaXQpIGNodW5rcyBhcyBsaXR0bGUtZW5kaWFuIHdvcmRzCiAgICBmb3IgaSBpbiByYW5nZSgwLCBsZW4oZGF0YSksIDQpOgogICAgICAgICMgR2V0IDQgYnl0ZXMgYXMgbGl0dGxlLWVuZGlhbiB3b3JkCiAgICAgICAgd29yZCA9IChkYXRhW2ldIHwgCiAgICAgICAgICAgICAgICAoZGF0YVtpKzFdIDw8IDgpIHwgCiAgICAgICAgICAgICAgICAoZGF0YVtpKzJdIDw8IDE2KSB8IAogICAgICAgICAgICAgICAgKGRhdGFbaSszXSA8PCAyNCkpCiAgICAgICAgCiAgICAgICAgY3JjID0gY3JjIF4gd29yZAogICAgICAgIAogICAgICAgICMgUHJvY2VzcyAzMiBiaXRzCiAgICAgICAgZm9yIF8gaW4gcmFuZ2UoMzIpOgogICAgICAgICAgICBpZiBjcmMgJiAweDgwMDAwMDAwOgogICAgICAgICAgICAgICAgY3JjID0gKChjcmMgPDwgMSkgXiAweDA0QzExREI3KSAmIDB4ZmZmZmZmZmYKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIGNyYyA9IChjcmMgPDwgMSkgJiAweGZmZmZmZmZmCiAgICAKICAgIHJldHVybiBjcmMKCgpkZWYgdXBsb2FkRmlybXdhcmVDaHVuayhhcmdzKToKICAgICIiIgogICAgVXBsb2FkIGEgY2h1bmsgb2YgZmlybXdhcmUgZGF0YSB0byBkZXZpY2UgbWVtb3J5LgogICAgVGhpcyBpcyBjYWxsZWQgbXVsdGlwbGUgdGltZXMgdG8gdHJhbnNmZXIgdGhlIGVudGlyZSBmaXJtd2FyZSBmaWxlLgogICAgIiIiCiAgICBjaHVuayA9IGFyZ3MuZ2V0KCdjaHVuaycpCiAgICBvZmZzZXQgPSBhcmdzLmdldCgnb2Zmc2V0JywgMCkKICAgIAogICAgaWYgbm90IGNodW5rOgogICAgICAgIF9zZW5kX2Vycm9yKCJObyBjaHVuayBkYXRhIHByb3ZpZGVkIiwgJ0ZJUk1XQVJFLVVQTE9BRC1FUlJPUicpCiAgICAgICAgcmV0dXJuCiAgICAKICAgICMgU3RvcmUgY2h1bmsgaW4gZmlybXdhcmUgZGF0YSBidWZmZXIKICAgIGlmIGZpcm13YXJlX3VwZ3JhZGVfc3RhdGVbJ2Zpcm13YXJlX2RhdGEnXSBpcyBOb25lOgogICAgICAgIGZpcm13YXJlX3VwZ3JhZGVfc3RhdGVbJ2Zpcm13YXJlX2RhdGEnXSA9IGJ5dGVhcnJheSgpCiAgICAKICAgICMgRXh0ZW5kIGJ1ZmZlciBpZiBuZWVkZWQKICAgIHJlcXVpcmVkX3NpemUgPSBvZmZzZXQgKyBsZW4oY2h1bmspCiAgICBpZiBsZW4oZmlybXdhcmVfdXBncmFkZV9zdGF0ZVsnZmlybXdhcmVfZGF0YSddKSA8IHJlcXVpcmVkX3NpemU6CiAgICAgICAgZmlybXdhcmVfdXBncmFkZV9zdGF0ZVsnZmlybXdhcmVfZGF0YSddLmV4dGVuZChieXRlcyhyZXF1aXJlZF9zaXplIC0gbGVuKGZpcm13YXJlX3VwZ3JhZGVfc3RhdGVbJ2Zpcm13YXJlX2RhdGEnXSkpKQogICAgCiAgICAjIFdyaXRlIGNodW5rIGRhdGEKICAgIGZpcm13YXJlX3VwZ3JhZGVfc3RhdGVbJ2Zpcm13YXJlX2RhdGEnXVtvZmZzZXQ6b2Zmc2V0K2xlbihjaHVuayldID0gYnl0ZXMoY2h1bmspCgoKZGVmIHN0YXJ0RmlybXdhcmVVcGdyYWRlKGFyZ3MpOgogICAgIiIiCiAgICBTdGFydCB0aGUgZmlybXdhcmUgdXBncmFkZSBwcm9jZXNzLgogICAgCiAgICBBcmdzOgogICAgICAgIHJlY292ZXJ5X21vZGU6IGJvb2wgLSBJZiBUcnVlLCB3YWl0IGZvciBhbnkgZGV2aWNlIHRvIGJvb3QKICAgICAgICBzZXJpYWxfbnVtYmVyOiBzdHIgLSA4IGhleCBkaWdpdCBzZXJpYWwgKG9wdGlvbmFsLCBmb3IgcmVjb3ZlcnkgbW9kZSkKICAgICAgICBub2RlX2lkOiBpbnQgLSBOb2RlIElEIHRvIHVwZ3JhZGUgKGZvciBub3JtYWwgbW9kZSkKICAgICIiIgogICAgaWYgQ0FOIGlzIE5vbmUgb3IgY2FuX2RldiBpcyBOb25lOgogICAgICAgIF9zZW5kX2Vycm9yKCJDQU4gbm90IGF2YWlsYWJsZSIsICdGSVJNV0FSRS1VUEdSQURFLUVSUk9SJykKICAgICAgICByZXR1cm4KICAgIAogICAgcmVjb3ZlcnlfbW9kZSA9IGFyZ3MuZ2V0KCdyZWNvdmVyeV9tb2RlJywgRmFsc2UpCiAgICBzZXJpYWxfbnVtYmVyID0gYXJncy5nZXQoJ3NlcmlhbF9udW1iZXInKQogICAgbm9kZV9pZCA9IGFyZ3MuZ2V0KCdub2RlX2lkJywgZGV2aWNlX25vZGVfaWQpCiAgICAKICAgICMgVmFsaWRhdGUgZmlybXdhcmUgZGF0YQogICAgaWYgbm90IGZpcm13YXJlX3VwZ3JhZGVfc3RhdGVbJ2Zpcm13YXJlX2RhdGEnXToKICAgICAgICBfc2VuZF9lcnJvcigiTm8gZmlybXdhcmUgZGF0YSB1cGxvYWRlZCIsICdGSVJNV0FSRS1VUEdSQURFLUVSUk9SJykKICAgICAgICByZXR1cm4KICAgIAogICAgZmlybXdhcmVfZGF0YSA9IGZpcm13YXJlX3VwZ3JhZGVfc3RhdGVbJ2Zpcm13YXJlX2RhdGEnXQogICAgCiAgICAjIFZhbGlkYXRlIGZpcm13YXJlIGZvcm1hdAogICAgaWYgZmlybXdhcmVfZGF0YVswOjRdID09IGInXHg3ZkVMRic6CiAgICAgICAgX3NlbmRfZXJyb3IoIkVMRiBmaWxlcyBub3Qgc3VwcG9ydGVkLiBVc2UgLmJpbiBmaWxlIiwgJ0ZJUk1XQVJFLVVQR1JBREUtRVJST1InKQogICAgICAgIHJldHVybgogICAgCiAgICAjIERpdmlkZSBmaXJtd2FyZSBpbnRvIHBhZ2VzCiAgICBwYWdlcyA9IFtdCiAgICBmb3IgaSBpbiByYW5nZSgwLCBsZW4oZmlybXdhcmVfZGF0YSksIFBBR0VfU0laRSk6CiAgICAgICAgcGFnZV9kYXRhID0gZmlybXdhcmVfZGF0YVtpOmkrUEFHRV9TSVpFXQogICAgICAgICMgUGFkIGxhc3QgcGFnZSB0byBQQUdFX1NJWkUKICAgICAgICBpZiBsZW4ocGFnZV9kYXRhKSA8IFBBR0VfU0laRToKICAgICAgICAgICAgcGFnZV9kYXRhID0gcGFnZV9kYXRhICsgYnl0ZXMoUEFHRV9TSVpFIC0gbGVuKHBhZ2VfZGF0YSkpCiAgICAgICAgCiAgICAgICAgIyBDYWxjdWxhdGUgQ1JDIGZvciB0aGlzIHBhZ2UKICAgICAgICBwYWdlX2NyYyA9IHN0bV9jcmMzMihwYWdlX2RhdGEpCiAgICAgICAgcGFnZXMuYXBwZW5kKHsKICAgICAgICAgICAgJ2RhdGEnOiBwYWdlX2RhdGEsCiAgICAgICAgICAgICdjcmMnOiBwYWdlX2NyYwogICAgICAgIH0pCiAgICAKICAgIGlmIGxlbihwYWdlcykgPiAyNTU6CiAgICAgICAgX3NlbmRfZXJyb3IoIkZpcm13YXJlIHRvbyBsYXJnZSAobWF4IDI1NSBLaUIpIiwgJ0ZJUk1XQVJFLVVQR1JBREUtRVJST1InKQogICAgICAgIHJldHVybgogICAgCiAgICAjIFN0b3JlIHVwZ3JhZGUgc3RhdGUKICAgIGZpcm13YXJlX3VwZ3JhZGVfc3RhdGVbJ2FjdGl2ZSddID0gVHJ1ZQogICAgZmlybXdhcmVfdXBncmFkZV9zdGF0ZVsncGFnZXMnXSA9IHBhZ2VzCiAgICBmaXJtd2FyZV91cGdyYWRlX3N0YXRlWydjdXJyZW50X3BhZ2UnXSA9IDAKICAgIGZpcm13YXJlX3VwZ3JhZGVfc3RhdGVbJ3Byb2dyZXNzJ10gPSAwLjAKICAgIGZpcm13YXJlX3VwZ3JhZGVfc3RhdGVbJ3N0YXRlJ10gPSAnd2FpdGluZ19oZWxsbycKICAgIGZpcm13YXJlX3VwZ3JhZGVfc3RhdGVbJ21lc3NhZ2UnXSA9ICdXYWl0aW5nIGZvciBkZXZpY2UgdG8gYm9vdC4uLicKICAgIGZpcm13YXJlX3VwZ3JhZGVfc3RhdGVbJ2Vycm9yJ10gPSBOb25lCiAgICBmaXJtd2FyZV91cGdyYWRlX3N0YXRlWydwYWdlX3Bvc2l0aW9uJ10gPSAwCiAgICAKICAgICMgU2V0IHRhcmdldCBzZXJpYWwgaWYgcHJvdmlkZWQKICAgIGlmIHJlY292ZXJ5X21vZGUgYW5kIHNlcmlhbF9udW1iZXI6CiAgICAgICAgdHJ5OgogICAgICAgICAgICBmaXJtd2FyZV91cGdyYWRlX3N0YXRlWyd0YXJnZXRfc2VyaWFsJ10gPSBieXRlcy5mcm9taGV4KHNlcmlhbF9udW1iZXIpCiAgICAgICAgZXhjZXB0OgogICAgICAgICAgICBfc2VuZF9lcnJvcigiSW52YWxpZCBzZXJpYWwgbnVtYmVyIGZvcm1hdCIsICdGSVJNV0FSRS1VUEdSQURFLUVSUk9SJykKICAgICAgICAgICAgcmV0dXJuCiAgICBlbHNlOgogICAgICAgIGZpcm13YXJlX3VwZ3JhZGVfc3RhdGVbJ3RhcmdldF9zZXJpYWwnXSA9IE5vbmUKICAgIAogICAgIyBJZiBub3QgcmVjb3ZlcnkgbW9kZSwgcmVzZXQgdGhlIGRldmljZSB0byB0cmlnZ2VyIGJvb3Rsb2FkZXIKICAgIGlmIG5vdCByZWNvdmVyeV9tb2RlIGFuZCBzZG9fY2xpZW50OgogICAgICAgIHRyeToKICAgICAgICAgICAgIyBTZW5kIHJlc2V0IGNvbW1hbmQKICAgICAgICAgICAgc2RvX2NsaWVudC53cml0ZSgweDEwMDAsIDB4MDEsIDEpICAjIFJlc2V0IGNvbW1hbmQKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgICMgTG9nIGVycm9yIChwcmludCgpIG91dHB1dCBnb2VzIHRvIE0yTSBjaGFubmVsIGF1dG9tYXRpY2FsbHkpCiAgICAgICAgICAgIHByaW50KGYiW09JIEZpcm13YXJlXSBGYWlsZWQgdG8gcmVzZXQgZGV2aWNlOiB7ZX0iKQogICAgCiAgICAjIFNldCB1cCBDQU4gZmlsdGVyIGZvciB1cGdyYWRlIG1lc3NhZ2VzICgweDdERSkKICAgICMgVE9ETzogQ29uZmlndXJlIENBTiBmaWx0ZXIgZm9yIERFVklDRV9DQU5fSUQKICAgIAogICAgIyBSZXR1cm4gZGF0YSB2aWEgX3NlbmRfcmVzcG9uc2UgKHRoaXMgb25lIGFjdHVhbGx5IGhhcyBkYXRhIHRvIHJldHVybikKICAgIF9zZW5kX3Jlc3BvbnNlKCdGSVJNV0FSRS1VUEdSQURFLVNUQVJURUQnLCB7CiAgICAgICAgJ3N0YXJ0ZWQnOiBUcnVlLAogICAgICAgICdwYWdlcyc6IGxlbihwYWdlcyksCiAgICAgICAgJ3NpemUnOiBsZW4oZmlybXdhcmVfZGF0YSkKICAgIH0pCgoKZGVmIHByb2Nlc3NGaXJtd2FyZUNhbk1lc3NhZ2UoY2FuX2lkLCBkYXRhKToKICAgICIiIgogICAgUHJvY2VzcyBpbmNvbWluZyBDQU4gbWVzc2FnZXMgZHVyaW5nIGZpcm13YXJlIHVwZ3JhZGUuCiAgICBUaGlzIHNob3VsZCBiZSBjYWxsZWQgZnJvbSB0aGUgQ0FOIHJlY2VpdmUgaGFuZGxlci4KICAgICIiIgogICAgaWYgbm90IGZpcm13YXJlX3VwZ3JhZGVfc3RhdGVbJ2FjdGl2ZSddOgogICAgICAgIHJldHVybgogICAgCiAgICBpZiBjYW5faWQgIT0gREVWSUNFX0NBTl9JRDoKICAgICAgICByZXR1cm4KICAgIAogICAgc3RhdGUgPSBmaXJtd2FyZV91cGdyYWRlX3N0YXRlWydzdGF0ZSddCiAgICAKICAgICMgSGFuZGxlIEhFTExPIHBhY2tldCAoZGV2aWNlIGJvb3RpbmcpCiAgICBpZiBsZW4oZGF0YSkgPT0gOCBhbmQgZGF0YVswXSA9PSBQQUNLRVRfSEVMTE86CiAgICAgICAgaWYgc3RhdGUgIT0gJ3dhaXRpbmdfaGVsbG8nOgogICAgICAgICAgICByZXR1cm4KICAgICAgICAKICAgICAgICAjIEV4dHJhY3Qgc2VyaWFsIG51bWJlciAoYnl0ZXMgNC03LCBsaXR0bGUtZW5kaWFuKQogICAgICAgIGRldmljZV9zZXJpYWwgPSBkYXRhWzc6MzotMV0KICAgICAgICAKICAgICAgICAjIENoZWNrIGlmIHRoaXMgaXMgb3VyIHRhcmdldCBkZXZpY2UKICAgICAgICB0YXJnZXQgPSBmaXJtd2FyZV91cGdyYWRlX3N0YXRlWyd0YXJnZXRfc2VyaWFsJ10KICAgICAgICBpZiB0YXJnZXQgYW5kIGRldmljZV9zZXJpYWwgIT0gdGFyZ2V0OgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAKICAgICAgICAgICAgICAgIAogICAgICAgICMgUmVwbHkgd2l0aCBkZXZpY2UgaWRlbnRpZmllciAoc2VyaWFsIG51bWJlcikKICAgICAgICBjYW5fZGV2LnNlbmQobGlzdChkYXRhWzQ6OF0pLCBVUEdSQURFUl9DQU5fSUQpCiAgICAgICAgCiAgICAgICAgZmlybXdhcmVfdXBncmFkZV9zdGF0ZVsnc3RhdGUnXSA9ICd3YWl0aW5nX3N0YXJ0JwogICAgICAgIGZpcm13YXJlX3VwZ3JhZGVfc3RhdGVbJ21lc3NhZ2UnXSA9ICdEZXZpY2UgaWRlbnRpZmllZCwgd2FpdGluZyBmb3IgU1RBUlQuLi4nCiAgICAKICAgICMgSGFuZGxlIFNUQVJUIHBhY2tldAogICAgZWxpZiBsZW4oZGF0YSkgPT0gMSBhbmQgZGF0YVswXSA9PSBQQUNLRVRfU1RBUlQ6CiAgICAgICAgaWYgc3RhdGUgIT0gJ3dhaXRpbmdfc3RhcnQnOgogICAgICAgICAgICByZXR1cm4KICAgICAgICAKICAgICAgICAjIFJlcGx5IHdpdGggbnVtYmVyIG9mIHBhZ2VzCiAgICAgICAgbnVtX3BhZ2VzID0gbGVuKGZpcm13YXJlX3VwZ3JhZGVfc3RhdGVbJ3BhZ2VzJ10pCiAgICAgICAgY2FuX2Rldi5zZW5kKFtudW1fcGFnZXNdLCBVUEdSQURFUl9DQU5fSUQpCiAgICAgICAgCiAgICAgICAgZmlybXdhcmVfdXBncmFkZV9zdGF0ZVsnc3RhdGUnXSA9ICd1cGxvYWRpbmcnCiAgICAgICAgZmlybXdhcmVfdXBncmFkZV9zdGF0ZVsnY3VycmVudF9wYWdlJ10gPSAwCiAgICAgICAgZmlybXdhcmVfdXBncmFkZV9zdGF0ZVsncGFnZV9wb3NpdGlvbiddID0gMAogICAgICAgIGZpcm13YXJlX3VwZ3JhZGVfc3RhdGVbJ21lc3NhZ2UnXSA9ICdVcGxvYWRpbmcgZmlybXdhcmUuLi4nCiAgICAKICAgICMgSGFuZGxlIFBBR0UgcmVxdWVzdAogICAgZWxpZiBsZW4oZGF0YSkgPT0gMSBhbmQgZGF0YVswXSA9PSBQQUNLRVRfUEFHRToKICAgICAgICBpZiBzdGF0ZSAhPSAndXBsb2FkaW5nJzoKICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgCiAgICAgICAgcGFnZV9pZHggPSBmaXJtd2FyZV91cGdyYWRlX3N0YXRlWydjdXJyZW50X3BhZ2UnXQogICAgICAgIHBvcyA9IGZpcm13YXJlX3VwZ3JhZGVfc3RhdGVbJ3BhZ2VfcG9zaXRpb24nXQogICAgICAgIAogICAgICAgIGlmIHBhZ2VfaWR4ID49IGxlbihmaXJtd2FyZV91cGdyYWRlX3N0YXRlWydwYWdlcyddKToKICAgICAgICAgICAgIyBMb2cgZXJyb3IgKHByaW50KCkgb3V0cHV0IGdvZXMgdG8gTTJNIGNoYW5uZWwgYXV0b21hdGljYWxseSkKICAgICAgICAgICAgcHJpbnQoZiJbT0kgRmlybXdhcmVdIEVSUk9SOiBQYWdlIHJlcXVlc3QgYmV5b25kIGF2YWlsYWJsZSBwYWdlcyIpCiAgICAgICAgICAgIHJldHVybgogICAgICAgIAogICAgICAgIHBhZ2UgPSBmaXJtd2FyZV91cGdyYWRlX3N0YXRlWydwYWdlcyddW3BhZ2VfaWR4XQogICAgICAgIAogICAgICAgICMgU2VuZCA4IGJ5dGVzIG9mIHBhZ2UgZGF0YQogICAgICAgIGNodW5rID0gcGFnZVsnZGF0YSddW3Bvczpwb3MrOF0KICAgICAgICBjYW5fZGV2LnNlbmQobGlzdChjaHVuayksIFVQR1JBREVSX0NBTl9JRCkKICAgICAgICAKICAgICAgICBwb3MgKz0gOAogICAgICAgIGZpcm13YXJlX3VwZ3JhZGVfc3RhdGVbJ3BhZ2VfcG9zaXRpb24nXSA9IHBvcwogICAgICAgIAogICAgICAgICMgQ2hlY2sgaWYgcGFnZSBjb21wbGV0ZQogICAgICAgIGlmIHBvcyA+PSBQQUdFX1NJWkU6CiAgICAgICAgICAgIGZpcm13YXJlX3VwZ3JhZGVfc3RhdGVbJ3N0YXRlJ10gPSAnY2hlY2tpbmdfY3JjJwogICAgICAgICAgICBmaXJtd2FyZV91cGdyYWRlX3N0YXRlWydwYWdlX3Bvc2l0aW9uJ10gPSAwCiAgICAKICAgICMgSGFuZGxlIENSQyByZXF1ZXN0CiAgICBlbGlmIGxlbihkYXRhKSA9PSAxIGFuZCBkYXRhWzBdID09IFBBQ0tFVF9DUkM6CiAgICAgICAgaWYgc3RhdGUgIT0gJ2NoZWNraW5nX2NyYyc6CiAgICAgICAgICAgIHJldHVybgogICAgICAgIAogICAgICAgIHBhZ2VfaWR4ID0gZmlybXdhcmVfdXBncmFkZV9zdGF0ZVsnY3VycmVudF9wYWdlJ10KICAgICAgICBwYWdlID0gZmlybXdhcmVfdXBncmFkZV9zdGF0ZVsncGFnZXMnXVtwYWdlX2lkeF0KICAgICAgICAKICAgICAgICAjIFNlbmQgQ1JDIGFzIGxpdHRsZS1lbmRpYW4gMzItYml0IHZhbHVlCiAgICAgICAgY3JjID0gcGFnZVsnY3JjJ10KICAgICAgICBjcmNfYnl0ZXMgPSBbCiAgICAgICAgICAgIGNyYyAmIDB4RkYsCiAgICAgICAgICAgIChjcmMgPj4gOCkgJiAweEZGLAogICAgICAgICAgICAoY3JjID4+IDE2KSAmIDB4RkYsCiAgICAgICAgICAgIChjcmMgPj4gMjQpICYgMHhGRgogICAgICAgIF0KICAgICAgICBjYW5fZGV2LnNlbmQoY3JjX2J5dGVzLCBVUEdSQURFUl9DQU5fSUQpCiAgICAgICAgCiAgICAgICAgIyBNb3ZlIHRvIG5leHQgcGFnZQogICAgICAgIGZpcm13YXJlX3VwZ3JhZGVfc3RhdGVbJ2N1cnJlbnRfcGFnZSddICs9IDEKICAgICAgICBmaXJtd2FyZV91cGdyYWRlX3N0YXRlWydwcm9ncmVzcyddID0gKGZpcm13YXJlX3VwZ3JhZGVfc3RhdGVbJ2N1cnJlbnRfcGFnZSddICogMTAwLjApIC8gbGVuKGZpcm13YXJlX3VwZ3JhZGVfc3RhdGVbJ3BhZ2VzJ10pCiAgICAgICAgCiAgICAgICAgIyBDaGVjayBpZiBhbGwgcGFnZXMgZG9uZQogICAgICAgIGlmIGZpcm13YXJlX3VwZ3JhZGVfc3RhdGVbJ2N1cnJlbnRfcGFnZSddID49IGxlbihmaXJtd2FyZV91cGdyYWRlX3N0YXRlWydwYWdlcyddKToKICAgICAgICAgICAgZmlybXdhcmVfdXBncmFkZV9zdGF0ZVsnc3RhdGUnXSA9ICd3YWl0aW5nX2RvbmUnCiAgICAgICAgICAgIGZpcm13YXJlX3VwZ3JhZGVfc3RhdGVbJ21lc3NhZ2UnXSA9ICdXYWl0aW5nIGZvciBkZXZpY2UgdG8gZmluYWxpemUuLi4nCiAgICAgICAgZWxzZToKICAgICAgICAgICAgZmlybXdhcmVfdXBncmFkZV9zdGF0ZVsnc3RhdGUnXSA9ICd1cGxvYWRpbmcnCiAgICAKICAgICMgSGFuZGxlIERPTkUgcGFja2V0CiAgICBlbGlmIGxlbihkYXRhKSA9PSAxIGFuZCBkYXRhWzBdID09IFBBQ0tFVF9ET05FOgogICAgICAgIGlmIHN0YXRlICE9ICd3YWl0aW5nX2RvbmUnOgogICAgICAgICAgICByZXR1cm4KICAgICAgICAKICAgICAgICBmaXJtd2FyZV91cGdyYWRlX3N0YXRlWydhY3RpdmUnXSA9IEZhbHNlCiAgICAgICAgZmlybXdhcmVfdXBncmFkZV9zdGF0ZVsnc3RhdGUnXSA9ICdkb25lJwogICAgICAgIGZpcm13YXJlX3VwZ3JhZGVfc3RhdGVbJ3Byb2dyZXNzJ10gPSAxMDAuMAogICAgICAgIGZpcm13YXJlX3VwZ3JhZGVfc3RhdGVbJ21lc3NhZ2UnXSA9ICdVcGdyYWRlIGNvbXBsZXRlZCBzdWNjZXNzZnVsbHkhJwogICAgCiAgICAjIEhhbmRsZSBFUlJPUiBwYWNrZXQKICAgIGVsaWYgbGVuKGRhdGEpID09IDEgYW5kIGRhdGFbMF0gPT0gUEFDS0VUX0VSUk9SOgogICAgICAgICMgTG9nIGVycm9yIChwcmludCgpIG91dHB1dCBnb2VzIHRvIE0yTSBjaGFubmVsIGF1dG9tYXRpY2FsbHkpCiAgICAgICAgcHJpbnQoIltPSSBGaXJtd2FyZV0gRGV2aWNlIHJlcG9ydGVkIENSQyBFUlJPUiIpCiAgICAgICAgZmlybXdhcmVfdXBncmFkZV9zdGF0ZVsnYWN0aXZlJ10gPSBGYWxzZQogICAgICAgIGZpcm13YXJlX3VwZ3JhZGVfc3RhdGVbJ3N0YXRlJ10gPSAnZXJyb3InCiAgICAgICAgZmlybXdhcmVfdXBncmFkZV9zdGF0ZVsnZXJyb3InXSA9ICdDUkMgY2hlY2sgZmFpbGVkIG9uIGRldmljZScKICAgICAgICBmaXJtd2FyZV91cGdyYWRlX3N0YXRlWydtZXNzYWdlJ10gPSAnVXBncmFkZSBmYWlsZWQ6IENSQyBlcnJvcicKCgpkZWYgZ2V0RmlybXdhcmVVcGdyYWRlU3RhdHVzKCk6CiAgICAiIiIKICAgIEdldCBjdXJyZW50IHN0YXR1cyBvZiBmaXJtd2FyZSB1cGdyYWRlIHByb2Nlc3MuCiAgICAiIiIKICAgIHN0YXR1cyA9IHsKICAgICAgICAnYWN0aXZlJzogZmlybXdhcmVfdXBncmFkZV9zdGF0ZVsnYWN0aXZlJ10sCiAgICAgICAgJ3N0YXRlJzogZmlybXdhcmVfdXBncmFkZV9zdGF0ZVsnc3RhdGUnXSwKICAgICAgICAncHJvZ3Jlc3MnOiBmaXJtd2FyZV91cGdyYWRlX3N0YXRlWydwcm9ncmVzcyddLAogICAgICAgICdtZXNzYWdlJzogZmlybXdhcmVfdXBncmFkZV9zdGF0ZVsnbWVzc2FnZSddLAogICAgICAgICdlcnJvcic6IGZpcm13YXJlX3VwZ3JhZGVfc3RhdGVbJ2Vycm9yJ10sCiAgICAgICAgJ2NvbXBsZXRlJzogZmlybXdhcmVfdXBncmFkZV9zdGF0ZVsnc3RhdGUnXSA9PSAnZG9uZScKICAgIH0KICAgIAogICAgX3NlbmRfcmVzcG9uc2UoJ0ZJUk1XQVJFLVNUQVRVUycsIHN0YXR1cykKCgojID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KIyBDQU4gQnVzIFNjYW5uaW5nCiMgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQoKZGVmIHNjYW5DYW5CdXMoYXJncz1Ob25lKToKICAgICIiIgogICAgU2NhbiBDQU4gYnVzIGZvciBPcGVuSW52ZXJ0ZXIgZGV2aWNlcyB1c2luZyByb2J1c3QgU0RPIHNjYW5uaW5nLgogICAgCiAgICBBcmdzIChkaWN0IG9yIHN0ciwgb3B0aW9uYWwpOgogICAgICAgIElmIHN0cmluZywgd2lsbCBiZSBwYXJzZWQgYXMgSlNPTi4KICAgICAgICBxdWljazogSWYgVHJ1ZSwgb25seSBzY2FuIGNvbW1vbiBub2RlIElEcyAxLTEwIChkZWZhdWx0OiBUcnVlKQogICAgICAgIHRpbWVvdXRfbXM6IFRpbWVvdXQgcGVyIG5vZGUgaW4gbWlsbGlzZWNvbmRzIChkZWZhdWx0OiAxMDBtcykKICAgICAgICByYXRlX2xpbWl0X21zOiBEZWxheSBiZXR3ZWVuIHJlcXVlc3RzIGluIG1pbGxpc2Vjb25kcyAoZGVmYXVsdDogMTBtcykKICAgICAgICB0eF9waW46IENBTiBUWCBwaW4gKGRlZmF1bHQ6IDUpCiAgICAgICAgcnhfcGluOiBDQU4gUlggcGluIChkZWZhdWx0OiA0KQogICAgICAgIGJpdHJhdGU6IENBTiBiaXRyYXRlIChkZWZhdWx0OiA1MDAwMDApCiAgICAgICAgY2FuX21vZGU6IENBTiBtb2RlIC0gJ25vcm1hbCcgb3IgJ3NpbGVudCcgKGRlZmF1bHQ6ICdzaWxlbnQnIGZvciBzY2FubmluZykKICAgIAogICAgUmV0dXJucyBsaXN0IG9mIGRldGVjdGVkIG5vZGVzIHdpdGggdGhlaXIgZGV2aWNlIHR5cGVzIGFuZCBzZXJpYWwgbnVtYmVycy4KICAgICIiIgogICAgZ2xvYmFsIGNhbl9kZXYsIENBTgogICAgCiAgICAjIENoZWNrIGlmIENBTiBtb2R1bGUgaXMgYXZhaWxhYmxlCiAgICBpZiBDQU4gaXMgTm9uZToKICAgICAgICBfc2VuZF9lcnJvcigiQ0FOIG1vZHVsZSBub3QgYXZhaWxhYmxlIC0gY2hlY2sgaWYgQ0FOIG1vZHVsZSBpcyBpbnN0YWxsZWQiLCAnQ0FOLVNDQU4tRVJST1InKQogICAgICAgIHJldHVybgogICAgCiAgICAjIFBhcnNlIGFyZ3MgaWYgaXQncyBhIEpTT04gc3RyaW5nIChmcm9tIEphdmFTY3JpcHQgY2FsbHMpCiAgICBpZiBhcmdzIGlzIE5vbmU6CiAgICAgICAgYXJncyA9IHt9CiAgICBlbGlmIGlzaW5zdGFuY2UoYXJncywgc3RyKToKICAgICAgICB0cnk6CiAgICAgICAgICAgIGFyZ3MgPSBqc29uLmxvYWRzKGFyZ3MpCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBfc2VuZF9lcnJvcihmIkludmFsaWQgSlNPTiBhcmd1bWVudHM6IHtlfSIsICdDQU4tU0NBTi1FUlJPUicpCiAgICAgICAgICAgIHJldHVybgogICAgCiAgICAjIFBhcnNlIGFyZ3VtZW50cwogICAgcXVpY2tfc2NhbiA9IGFyZ3MuZ2V0KCdxdWljaycsIFRydWUpCiAgICB0aW1lb3V0X21zID0gYXJncy5nZXQoJ3RpbWVvdXRfbXMnLCAxMDApCiAgICByYXRlX2xpbWl0X21zID0gYXJncy5nZXQoJ3JhdGVfbGltaXRfbXMnLCAxMCkKICAgIGNhbl9tb2RlX3N0ciA9IGFyZ3MuZ2V0KCdjYW5fbW9kZScsICdzaWxlbnQnKSAgIyBEZWZhdWx0IHRvIFNJTEVOVCBmb3Igc2Nhbm5pbmcKICAgIAogICAgIyBSZWFkIENBTiBjb25maWd1cmF0aW9uIGZyb20gL2NvbmZpZy9jYW4uanNvbiAod2l0aCBmYWxsYmFjayB0byBtYWluLnB5KQogICAgdHhfcGluID0gYXJncy5nZXQoJ3R4X3BpbicpCiAgICByeF9waW4gPSBhcmdzLmdldCgncnhfcGluJykKICAgIGJpdHJhdGUgPSBhcmdzLmdldCgnYml0cmF0ZScpCiAgICAKICAgIGlmIHR4X3BpbiBpcyBOb25lIG9yIHJ4X3BpbiBpcyBOb25lIG9yIGJpdHJhdGUgaXMgTm9uZToKICAgICAgICAjIFRyeSB0byBsb2FkIGZyb20gL2NvbmZpZy9jYW4uanNvbgogICAgICAgIHRyeToKICAgICAgICAgICAgaW1wb3J0IG9zCiAgICAgICAgICAgIGNvbmZpZ19kaXIgPSAnL2NvbmZpZycKICAgICAgICAgICAgaWYgbm90IG9zLnBhdGguZXhpc3RzKGNvbmZpZ19kaXIpOgogICAgICAgICAgICAgICAgY29uZmlnX2RpciA9ICcvc3RvcmUvY29uZmlnJwogICAgICAgICAgICBjb25maWdfZmlsZSA9IGNvbmZpZ19kaXIgKyAnL2Nhbi5qc29uJwogICAgICAgICAgICAKICAgICAgICAgICAgaWYgb3MucGF0aC5leGlzdHMoY29uZmlnX2ZpbGUpOgogICAgICAgICAgICAgICAgd2l0aCBvcGVuKGNvbmZpZ19maWxlLCAncicpIGFzIGY6CiAgICAgICAgICAgICAgICAgICAgY2FuX2NvbmZpZyA9IGpzb24ubG9hZChmKQogICAgICAgICAgICAgICAgaWYgdHhfcGluIGlzIE5vbmU6CiAgICAgICAgICAgICAgICAgICAgdHhfcGluID0gY2FuX2NvbmZpZy5nZXQoJ3R4UGluJywgNSkKICAgICAgICAgICAgICAgIGlmIHJ4X3BpbiBpcyBOb25lOgogICAgICAgICAgICAgICAgICAgIHJ4X3BpbiA9IGNhbl9jb25maWcuZ2V0KCdyeFBpbicsIDQpCiAgICAgICAgICAgICAgICBpZiBiaXRyYXRlIGlzIE5vbmU6CiAgICAgICAgICAgICAgICAgICAgYml0cmF0ZSA9IGNhbl9jb25maWcuZ2V0KCdiaXRyYXRlJywgNTAwMDAwKQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgIyBGYWxsYmFjayB0byBtYWluLnB5CiAgICAgICAgICAgICAgICBpbXBvcnQgc3lzCiAgICAgICAgICAgICAgICBzeXMucGF0aC5pbnNlcnQoMCwgJy9kZXZpY2Ugc2NyaXB0cycpCiAgICAgICAgICAgICAgICBmcm9tIG1haW4gaW1wb3J0IENBTl9UWF9QSU4sIENBTl9SWF9QSU4sIENBTl9CSVRSQVRFCiAgICAgICAgICAgICAgICBpZiB0eF9waW4gaXMgTm9uZToKICAgICAgICAgICAgICAgICAgICB0eF9waW4gPSBDQU5fVFhfUElOCiAgICAgICAgICAgICAgICBpZiByeF9waW4gaXMgTm9uZToKICAgICAgICAgICAgICAgICAgICByeF9waW4gPSBDQU5fUlhfUElOCiAgICAgICAgICAgICAgICBpZiBiaXRyYXRlIGlzIE5vbmU6CiAgICAgICAgICAgICAgICAgICAgYml0cmF0ZSA9IENBTl9CSVRSQVRFCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBpZiB0eF9waW4gaXMgTm9uZToKICAgICAgICAgICAgICAgIHR4X3BpbiA9IDUKICAgICAgICAgICAgaWYgcnhfcGluIGlzIE5vbmU6CiAgICAgICAgICAgICAgICByeF9waW4gPSA0CiAgICAgICAgICAgIGlmIGJpdHJhdGUgaXMgTm9uZToKICAgICAgICAgICAgICAgIGJpdHJhdGUgPSA1MDAwMDAKICAgIAogICAgIyBEZXRlcm1pbmUgc2NhbiByYW5nZQogICAgaWYgcXVpY2tfc2NhbjoKICAgICAgICBzdGFydF9ub2RlID0gMQogICAgICAgIGVuZF9ub2RlID0gMTAKICAgIGVsc2U6CiAgICAgICAgc3RhcnRfbm9kZSA9IDEKICAgICAgICBlbmRfbm9kZSA9IDEyNwogICAgCiAgICAjIENvbnZlcnQgQ0FOIG1vZGUgc3RyaW5nIHRvIGNvbnN0YW50CiAgICBjYW5fbW9kZSA9IENBTi5TSUxFTlQgaWYgY2FuX21vZGVfc3RyID09ICdzaWxlbnQnIGVsc2UgQ0FOLk5PUk1BTAogICAgCiAgICAjIEluaXRpYWxpemUgQ0FOIGZvciBzY2FubmluZwogICAgIyBFU1AzMiBDQU4gdXNlcyBhIHNpbmdsZXRvbiBwYXR0ZXJuIC0gQ0FOKDAsIC4uLikgYWx3YXlzIHJldHVybnMgdGhlIHNhbWUgb2JqZWN0CiAgICAjIFRoZSBkcml2ZXIncyBtYWtlX25ldygpIHdpbGwgYXV0b21hdGljYWxseSBkZWluaXQvcmVpbml0IGlmIG5lZWRlZAogICAgc2Nhbl9jYW4gPSBOb25lCiAgICAKICAgICMgQ2hlY2sgaWYgd2UgY2FuIHJldXNlIGV4aXN0aW5nIENBTiBpbnN0YW5jZQogICAgcmV1c2VfZXhpc3RpbmcgPSBGYWxzZQogICAgaWYgY2FuX2RldiBpcyBub3QgTm9uZSBhbmQgZGV2aWNlX2Nvbm5lY3RlZDoKICAgICAgICAjIElmIGRldmljZSBpcyBjb25uZWN0ZWQsIHdlIGNhbid0IGNoYW5nZSBDQU4gc2V0dGluZ3MKICAgICAgICAjIFVzZSBleGlzdGluZyBpbnN0YW5jZSBidXQgc2Nhbm5pbmcgbWlnaHQgaW50ZXJmZXJlCiAgICAgICAgc2Nhbl9jYW4gPSBjYW5fZGV2CiAgICAgICAgcmV1c2VfZXhpc3RpbmcgPSBUcnVlCiAgICBlbHNlOgogICAgICAgICMgTm8gZGV2aWNlIGNvbm5lY3RlZCwgc2FmZSB0byByZWNvbmZpZ3VyZSBDQU4gZm9yIHNjYW5uaW5nCiAgICAgICAgIyBJZiBjYW5fZGV2IGV4aXN0cywgZGVpbml0IGl0IGZpcnN0IHRvIGVuc3VyZSBjbGVhbiBzdGF0ZQogICAgICAgICMgVGhlIGRyaXZlcidzIG1ha2VfbmV3KCkgd2lsbCBhbHNvIGNoZWNrLCBidXQgZXhwbGljaXQgZGVpbml0IGVuc3VyZXMgY2xlYW51cAogICAgICAgIGlmIGNhbl9kZXYgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIGNhbl9kZXYuZGVpbml0KCkKICAgICAgICAgICAgICAgICMgR2l2ZSBGcmVlUlRPUyB0aW1lIHRvIGFjdHVhbGx5IGRlbGV0ZSB0aGUgSVJRIHRhc2sKICAgICAgICAgICAgICAgICMgdlRhc2tEZWxldGUgaXMgYXN5bmNocm9ub3VzLCBzbyB3ZSBuZWVkIGEgc21hbGwgZGVsYXkKICAgICAgICAgICAgICAgIHRpbWUuc2xlZXBfbXMoNTApCiAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgIHBhc3MgICMgSWdub3JlIGRlaW5pdCBlcnJvcnMKICAgICAgICAgICAgY2FuX2RldiA9IE5vbmUKICAgICAgICAKICAgICAgICAjIExldCB0aGUgZHJpdmVyIGhhbmRsZSByZWluaXQgYXV0b21hdGljYWxseQogICAgICAgICMgVGhlIGRyaXZlcidzIG1ha2VfbmV3KCkgY2hlY2tzIGlmIGluaXRpYWxpemVkIGFuZCBjYWxscyBjYW5fZGVpbml0KCkgaWYgbmVlZGVkCiAgICAgICAgdHJ5OgogICAgICAgICAgICBzY2FuX2NhbiA9IENBTigwLCBleHRmcmFtZT1GYWxzZSwgdHg9dHhfcGluLCByeD1yeF9waW4sIG1vZGU9Y2FuX21vZGUsIGJpdHJhdGU9Yml0cmF0ZSwgYXV0b19yZXN0YXJ0PUZhbHNlKQogICAgICAgICAgICAjIFVwZGF0ZSBjYW5fZGV2IHJlZmVyZW5jZSBpZiB3ZSBjcmVhdGVkIGEgbmV3IGluc3RhbmNlCiAgICAgICAgICAgIGlmIG5vdCBkZXZpY2VfY29ubmVjdGVkOgogICAgICAgICAgICAgICAgY2FuX2RldiA9IHNjYW5fY2FuCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBlcnJvcl9tc2cgPSBzdHIoZSkKICAgICAgICAgICAgIyBTaWxlbnQgLSBlcnJvcnMgc2VudCB2aWEgX3NlbmRfZXJyb3IoKQogICAgICAgICAgICBfc2VuZF9lcnJvcihmIkZhaWxlZCB0byBpbml0aWFsaXplIENBTjoge2Vycm9yX21zZ30iLCAnQ0FOLVNDQU4tRVJST1InKQogICAgICAgICAgICByZXR1cm4KICAgIAogICAgIyBXcmFwIGVudGlyZSBzY2FuIGluIHRyeS9leGNlcHQgdG8gZW5zdXJlIHJlc3BvbnNlIGlzIGFsd2F5cyBzZW50CiAgICB0cnk6CiAgICAgICAgICAgICAgICAjIENsZWFyIGFueSBwZW5kaW5nIG1lc3NhZ2VzCiAgICAgICAgd2hpbGUgc2Nhbl9jYW4uYW55KCk6CiAgICAgICAgICAgIHNjYW5fY2FuLnJlY3YoKQogICAgICAgIAogICAgICAgICMgQ29sbGVjdCBmb3VuZCBub2RlcwogICAgICAgIGZvdW5kX25vZGVzID0gW10KICAgICAgICBzY2FuX2Vycm9ycyA9IDAKICAgICAgICBidXNfb2ZmX2RldGVjdGVkID0gRmFsc2UKICAgICAgICAKICAgICAgICAjIENvbnZlcnQgdGltZW91dCBmcm9tIG1zIHRvIHNlY29uZHMgZm9yIFNETyBjbGllbnQKICAgICAgICBzZG9fdGltZW91dCA9IHRpbWVvdXRfbXMgLyAxMDAwLjAgaWYgdGltZW91dF9tcyA+IDAgZWxzZSAwLjEKICAgICAgICAKICAgICAgICAjIFNETyBQcm90b2NvbCBDb25zdGFudHMKICAgICAgICBTRE9fSU5ERVhfREVWSUNFX1RZUEUgPSAweDEwMDAKICAgICAgICBTRE9fU1VCSU5ERVggPSAweDAwCiAgICAgICAgCiAgICAgICAgIyBTY2FuIGVhY2ggbm9kZQogICAgICAgIGZvciBub2RlX2lkIGluIHJhbmdlKHN0YXJ0X25vZGUsIGVuZF9ub2RlICsgMSk6CiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICMgQ3JlYXRlIFNETyBjbGllbnQgZm9yIHRoaXMgbm9kZQogICAgICAgICAgICAgICAgc2RvX2NsaWVudCA9IFNET0NsaWVudChzY2FuX2Nhbiwgbm9kZV9pZD1ub2RlX2lkLCB0aW1lb3V0PXNkb190aW1lb3V0KQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIFRyeSB0byByZWFkIGRldmljZSB0eXBlIChzdGFuZGFyZCBDQU5vcGVuIG9iamVjdCAweDEwMDApCiAgICAgICAgICAgICAgICBkZXZpY2VfdHlwZSA9IHNkb19jbGllbnQucmVhZChTRE9fSU5ERVhfREVWSUNFX1RZUEUsIFNET19TVUJJTkRFWCkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBOb2RlIHJlc3BvbmRlZCBzdWNjZXNzZnVsbHkgLSB0cnkgdG8gcmVhZCBzZXJpYWwgbnVtYmVyCiAgICAgICAgICAgICAgICBzZXJpYWxfbnVtYmVyID0gTm9uZQogICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgICMgU2VyaWFsIG51bWJlciBpcyBhdCAweDUwMDAsIHN1YmluZGV4IDAtMiAoMyBwYXJ0cykKICAgICAgICAgICAgICAgICAgICBzZXJpYWxfcGFydHMgPSBbXQogICAgICAgICAgICAgICAgICAgIGZvciBpIGluIHJhbmdlKDMpOgogICAgICAgICAgICAgICAgICAgICAgICBwYXJ0ID0gc2RvX2NsaWVudC5yZWFkKDB4NTAwMCwgaSkKICAgICAgICAgICAgICAgICAgICAgICAgc2VyaWFsX3BhcnRzLmFwcGVuZChmIntwYXJ0OjA4WH0iKQogICAgICAgICAgICAgICAgICAgIHNlcmlhbF9udW1iZXIgPSAiOiIuam9pbihzZXJpYWxfcGFydHMpCiAgICAgICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICAgICAgIyBTZXJpYWwgbnVtYmVyIHJlYWQgZmFpbGVkLCBidXQgZGV2aWNlIGlzIHN0aWxsIHByZXNlbnQKICAgICAgICAgICAgICAgICAgICBwYXNzCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgTm9kZSByZXNwb25kZWQgc3VjY2Vzc2Z1bGx5CiAgICAgICAgICAgICAgICBmb3VuZF9ub2Rlcy5hcHBlbmQoewogICAgICAgICAgICAgICAgICAgICdub2RlSWQnOiBub2RlX2lkLAogICAgICAgICAgICAgICAgICAgICdkZXZpY2VUeXBlJzogZGV2aWNlX3R5cGUsCiAgICAgICAgICAgICAgICAgICAgJ2RldmljZVR5cGVIZXgnOiBmIjB4e2RldmljZV90eXBlOjA4WH0iLAogICAgICAgICAgICAgICAgICAgICdzZXJpYWxOdW1iZXInOiBzZXJpYWxfbnVtYmVyCiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgYnVzX29mZl9kZXRlY3RlZCA9IEZhbHNlICAjIFJlc2V0IGZsYWcgb24gc3VjY2VzcwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgIGV4Y2VwdCBTRE9UaW1lb3V0RXJyb3I6CiAgICAgICAgICAgICAgICAjIE5vZGUgZGlkbid0IHJlc3BvbmQgLSB0aGlzIGlzIG5vcm1hbCBmb3Igbm9uLWV4aXN0ZW50IG5vZGVzCiAgICAgICAgICAgICAgICBwYXNzCiAgICAgICAgICAgIGV4Y2VwdCBTRE9BYm9ydEVycm9yIGFzIGU6CiAgICAgICAgICAgICAgICAjIE5vZGUgcmVzcG9uZGVkIGJ1dCBhYm9ydGVkIHRoZSByZXF1ZXN0CiAgICAgICAgICAgICAgICAjIFRoaXMgbWlnaHQgaW5kaWNhdGUgdGhlIG9iamVjdCBkb2Vzbid0IGV4aXN0LCBidXQgbm9kZSBpcyBwcmVzZW50CiAgICAgICAgICAgICAgICBzY2FuX2Vycm9ycyArPSAxCiAgICAgICAgICAgICAgICAjIERvbid0IGFkZCB0byBmb3VuZF9ub2RlcyBpZiBhYm9ydCBvY2N1cnJlZAogICAgICAgICAgICBleGNlcHQgT1NFcnJvciBhcyBlOgogICAgICAgICAgICAgICAgIyBDaGVjayBpZiB0aGlzIGlzIGEgQlVTX09GRiBlcnJvcgogICAgICAgICAgICAgICAgZXJyb3JfbXNnID0gc3RyKGUpCiAgICAgICAgICAgICAgICBpZiAnQlVTX09GRicgaW4gZXJyb3JfbXNnIG9yICdidXMgaXMgQlVTX09GRicgaW4gZXJyb3JfbXNnOgogICAgICAgICAgICAgICAgICAgIGlmIG5vdCBidXNfb2ZmX2RldGVjdGVkOgogICAgICAgICAgICAgICAgICAgICAgICBidXNfb2ZmX2RldGVjdGVkID0gVHJ1ZQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICMgV2FpdCBmb3IgYnVzIHJlY292ZXJ5IChkcml2ZXIgaGFuZGxlcyB0aGlzIGF1dG9tYXRpY2FsbHkpCiAgICAgICAgICAgICAgICAgICAgIyBUaGUgZHJpdmVyIHdhaXRzIDMgc2Vjb25kcyArIHJlY292ZXJ5IHRpbWUgKG5lZWRzIDEyOCBidXMtZnJlZSBzaWduYWxzKQogICAgICAgICAgICAgICAgICAgIHJlY292ZXJ5X3dhaXRfbXMgPSA1MDAwICAjIFdhaXQgNSBzZWNvbmRzIGZvciByZWNvdmVyeQogICAgICAgICAgICAgICAgICAgIGVsYXBzZWQgPSAwCiAgICAgICAgICAgICAgICAgICAgY2h1bmtfbXMgPSA1MDAKICAgICAgICAgICAgICAgICAgICB3aGlsZSBlbGFwc2VkIDwgcmVjb3Zlcnlfd2FpdF9tczoKICAgICAgICAgICAgICAgICAgICAgICAgdGltZS5zbGVlcF9tcyhjaHVua19tcykKICAgICAgICAgICAgICAgICAgICAgICAgZWxhcHNlZCArPSBjaHVua19tcwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICMgQWZ0ZXIgcmVjb3ZlcnksIGV4cGxpY2l0bHkgcmVzdGFydCB0aGUgZHJpdmVyIHRvIGVuc3VyZSBpdCdzIHJlYWR5CiAgICAgICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgICAgICBzY2FuX2Nhbi5yZXN0YXJ0KCkKICAgICAgICAgICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uOgogICAgICAgICAgICAgICAgICAgICAgICBwYXNzICAjIElnbm9yZSByZXN0YXJ0IGVycm9ycwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIHNjYW5fZXJyb3JzICs9IDEKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAjIFNraXAgcmVtYWluaW5nIG5vZGVzIGlmIGJ1cyBrZWVwcyBnb2luZyBCVVNfT0ZGCiAgICAgICAgICAgICAgICAgICAgaWYgc2Nhbl9lcnJvcnMgPiA1OgogICAgICAgICAgICAgICAgICAgICAgICBfc2VuZF9lcnJvcigiQnVzIGtlZXBzIGdvaW5nIEJVU19PRkYuIENoZWNrIGhhcmR3YXJlIGNvbm5lY3Rpb25zLiIsICdDQU4tU0NBTi1FUlJPUicpCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAjIE90aGVyIE9TRXJyb3IgKHRpbWVvdXQsIGV0Yy4pCiAgICAgICAgICAgICAgICAgICAgZXJyb3JfbXNnID0gc3RyKGUpCiAgICAgICAgICAgICAgICAgICAgaWYgJ0RldmljZSBpcyBub3QgcmVhZHknIGluIGVycm9yX21zZzoKICAgICAgICAgICAgICAgICAgICAgICAgIyBEcml2ZXIgbWlnaHQgYmUgaW4gd3Jvbmcgc3RhdGUgYWZ0ZXIgQlVTX09GRiByZWNvdmVyeQogICAgICAgICAgICAgICAgICAgICAgICBpZiBidXNfb2ZmX2RldGVjdGVkOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjYW5fY2FuLnJlc3RhcnQoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXNzCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY2FuX2Vycm9ycyArPSAxCiAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgc2Nhbl9lcnJvcnMgKz0gMQogICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgICAgICBlcnJvcl9tc2cgPSBzdHIoZSkKICAgICAgICAgICAgICAgIGlmICdEZXZpY2UgaXMgbm90IHJlYWR5JyBpbiBlcnJvcl9tc2c6CiAgICAgICAgICAgICAgICAgICAgIyBEcml2ZXIgbWlnaHQgYmUgaW4gd3Jvbmcgc3RhdGUgYWZ0ZXIgQlVTX09GRiByZWNvdmVyeQogICAgICAgICAgICAgICAgICAgIGlmIGJ1c19vZmZfZGV0ZWN0ZWQ6CiAgICAgICAgICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjYW5fY2FuLnJlc3RhcnQoKQogICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFzcwogICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgIHNjYW5fZXJyb3JzICs9IDEKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgc2Nhbl9lcnJvcnMgKz0gMQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIElmIHRvbyBtYW55IGVycm9ycywgbWlnaHQgYmUgYnVzIGlzc3VlcwogICAgICAgICAgICAgICAgaWYgc2Nhbl9lcnJvcnMgPiAxMDoKICAgICAgICAgICAgICAgICAgICBfc2VuZF9lcnJvcigiVG9vIG1hbnkgc2NhbiBlcnJvcnMuIENoZWNrIENBTiBidXMgaGFyZHdhcmUuIiwgJ0NBTi1TQ0FOLUVSUk9SJykKICAgICAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgCiAgICAgICAgICAgICMgUmF0ZSBsaW1pdGluZyBiZXR3ZWVuIHJlcXVlc3RzCiAgICAgICAgICAgIGlmIHJhdGVfbGltaXRfbXMgPiAwOgogICAgICAgICAgICAgICAgdGltZS5zbGVlcF9tcyhyYXRlX2xpbWl0X21zKQogICAgICAgIAogICAgICAgICMgU2VuZCBmaW5hbCByZXN1bHQKICAgICAgICBzY2FuX3R5cGUgPSAicXVpY2siIGlmIHF1aWNrX3NjYW4gZWxzZSAiZnVsbCIKICAgICAgICBfc2VuZF9yZXNwb25zZSgnQ0FOLVNDQU4tUkVTVUxUJywgewogICAgICAgICAgICAnZGV2aWNlcyc6IGZvdW5kX25vZGVzLAogICAgICAgICAgICAnc2Nhbm5lZCc6IGVuZF9ub2RlIC0gc3RhcnRfbm9kZSArIDEsCiAgICAgICAgICAgICdmb3VuZCc6IGxlbihmb3VuZF9ub2RlcyksCiAgICAgICAgICAgICdzY2FuVHlwZSc6IHNjYW5fdHlwZQogICAgICAgIH0pCiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgIyBFbnN1cmUgZXJyb3IgcmVzcG9uc2UgaXMgc2VudCBldmVuIGlmIHNjYW4gZmFpbHMKICAgICAgICBlcnJvcl9tc2cgPSBzdHIoZSkKICAgICAgICAjIFNpbGVudCAtIGVycm9ycyBzZW50IHZpYSBfc2VuZF9lcnJvcigpCiAgICAgICAgX3NlbmRfZXJyb3IoZiJTY2FuIGZhaWxlZDoge2Vycm9yX21zZ30iLCAnQ0FOLVNDQU4tRVJST1InKQogICAgZmluYWxseToKICAgICAgICAjIENsZWFuIHVwIHNjYW4gQ0FOIGluc3RhbmNlIGlmIHdlIGNyZWF0ZWQgYSBzZXBhcmF0ZSBvbmUKICAgICAgICAjIERvbid0IGRlaW5pdCBpZiBpdCdzIHRoZSBzYW1lIGFzIGNhbl9kZXYgYW5kIGRldmljZSBpcyBjb25uZWN0ZWQKICAgICAgICBpZiBzY2FuX2NhbiBpcyBub3QgTm9uZSBhbmQgc2Nhbl9jYW4gIT0gY2FuX2RldiBhbmQgbm90IGRldmljZV9jb25uZWN0ZWQ6CiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIHNjYW5fY2FuLmRlaW5pdCgpCiAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgIHBhc3MgICMgSWdub3JlIGNsZWFudXAgZXJyb3JzCgoKIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiMgQ0FOIE1lc3NhZ2UgU2VuZGluZwojID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KIyBOT1RFOiBUaGVzZSBmdW5jdGlvbnMgYXJlIERFUFJFQ0FURUQuIFRoZSBleHRlbnNpb24gbm93IHNlbmRzIFB5dGhvbiBjb2RlCiMgZGlyZWN0bHkgdmlhIGRldmljZS5leGVjdXRlKCkgZm9sbG93aW5nIHRoZSBTY3JpcHRPIHBhdHRlcm4uIFRoZXNlIGFyZSBrZXB0CiMgZm9yIGJhY2t3YXJkIGNvbXBhdGliaWxpdHkgb25seS4KCiMgR2xvYmFsIHN0b3JhZ2UgZm9yIHBlcmlvZGljIENBTiBtZXNzYWdlIGludGVydmFscwpjYW5faW50ZXJ2YWxzID0ge30gICMge2ludGVydmFsX2lkOiB7J3RpbWVyJzogdGltZXJfb2JqLCAnY2FuX2lkJzogaW50LCAnZGF0YSc6IGxpc3QsICdpbnRlcnZhbCc6IGludH19CgpkZWYgc2VuZENhbk1lc3NhZ2UoYXJncyk6CiAgICAiIiIKICAgIFNlbmQgYSBzaW5nbGUgQ0FOIG1lc3NhZ2UuCiAgICAKICAgIEFyZ3MgKGRpY3QpOgogICAgICAgIGNhbl9pZDogQ0FOIG1lc3NhZ2UgSUQgKDB4MDAwLTB4N0ZGKQogICAgICAgIGRhdGE6IExpc3Qgb2YgOCBieXRlcyAoMC0yNTUpCiAgICAKICAgIFJldHVybnM6CiAgICAgICAgeydzdWNjZXNzJzogVHJ1ZX0gb3IgeydlcnJvcic6ICdlcnJvciBtZXNzYWdlJ30KICAgICIiIgogICAgIyBIYW5kbGUgSlNPTiBzdHJpbmcgZnJvbSBKYXZhU2NyaXB0CiAgICBpZiBpc2luc3RhbmNlKGFyZ3MsIHN0cik6CiAgICAgICAgYXJncyA9IGpzb24ubG9hZHMoYXJncykKICAgIGVsaWYgYXJncyBpcyBOb25lOgogICAgICAgIGFyZ3MgPSB7fQogICAgCiAgICBjYW5faWQgPSBhcmdzLmdldCgnY2FuX2lkJykKICAgIGRhdGEgPSBhcmdzLmdldCgnZGF0YScpCiAgICAKICAgIGlmIGNhbl9pZCBpcyBOb25lIG9yIGRhdGEgaXMgTm9uZToKICAgICAgICBfc2VuZF9lcnJvcigiTWlzc2luZyBjYW5faWQgb3IgZGF0YSIsICdDQU4tU0VORC1FUlJPUicpCiAgICAgICAgcmV0dXJuCiAgICAKICAgIGlmIG5vdCBkZXZpY2VfY29ubmVjdGVkIG9yIGNhbl9kZXYgaXMgTm9uZToKICAgICAgICBfc2VuZF9lcnJvcigiRGV2aWNlIG5vdCBjb25uZWN0ZWQiLCAnQ0FOLVNFTkQtRVJST1InKQogICAgICAgIHJldHVybgogICAgCiAgICB0cnk6CiAgICAgICAgIyBWYWxpZGF0ZSBDQU4gSUQKICAgICAgICBpZiBjYW5faWQgPCAwIG9yIGNhbl9pZCA+IDB4N0ZGOgogICAgICAgICAgICBfc2VuZF9lcnJvcigiSW52YWxpZCBDQU4gSUQgKG11c3QgYmUgMHgwMDAtMHg3RkYpIiwgJ0NBTi1TRU5ELUVSUk9SJykKICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgCiAgICAgICAgIyBWYWxpZGF0ZSBkYXRhIChtdXN0IGJlIGxpc3Qgb2YgOCBieXRlcykKICAgICAgICBpZiBub3QgaXNpbnN0YW5jZShkYXRhLCBsaXN0KSBvciBsZW4oZGF0YSkgIT0gODoKICAgICAgICAgICAgX3NlbmRfZXJyb3IoIkRhdGEgbXVzdCBiZSBhIGxpc3Qgb2YgOCBieXRlcyIsICdDQU4tU0VORC1FUlJPUicpCiAgICAgICAgICAgIHJldHVybgogICAgICAgIAogICAgICAgICMgVmFsaWRhdGUgYnl0ZSB2YWx1ZXMKICAgICAgICBmb3IgYnl0ZSBpbiBkYXRhOgogICAgICAgICAgICBpZiBub3QgaXNpbnN0YW5jZShieXRlLCBpbnQpIG9yIGJ5dGUgPCAwIG9yIGJ5dGUgPiAyNTU6CiAgICAgICAgICAgICAgICBfc2VuZF9lcnJvcigiRGF0YSBieXRlcyBtdXN0IGJlIGludGVnZXJzIDAtMjU1IiwgJ0NBTi1TRU5ELUVSUk9SJykKICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgIAogICAgICAgICMgU2VuZCBDQU4gbWVzc2FnZQogICAgICAgIGNhbl9kZXYuc2VuZChkYXRhLCBjYW5faWQpCiAgICAgICAgCiAgICAgICAgX3NlbmRfcmVzcG9uc2UoJ0NBTi1NRVNTQUdFLVNFTlQnLCB7CiAgICAgICAgICAgICdzdWNjZXNzJzogVHJ1ZSwKICAgICAgICAgICAgJ2Nhbl9pZCc6IGNhbl9pZAogICAgICAgIH0pCiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgX3NlbmRfZXJyb3Ioc3RyKGUpLCAnQ0FOLVNFTkQtRVJST1InKQoKCmRlZiBzdGFydENhbkludGVydmFsKGFyZ3MpOgogICAgIiIiCiAgICBTdGFydCBzZW5kaW5nIGEgcGVyaW9kaWMgQ0FOIG1lc3NhZ2UuCiAgICAKICAgIEFyZ3MgKGRpY3QpOgogICAgICAgIGludGVydmFsX2lkOiBVbmlxdWUgaWRlbnRpZmllciBmb3IgdGhpcyBpbnRlcnZhbAogICAgICAgIGNhbl9pZDogQ0FOIG1lc3NhZ2UgSUQgKDB4MDAwLTB4N0ZGKQogICAgICAgIGRhdGE6IExpc3Qgb2YgOCBieXRlcyAoMC0yNTUpCiAgICAgICAgaW50ZXJ2YWw6IEludGVydmFsIGluIG1pbGxpc2Vjb25kcyAoMTAtMTAwMDApCiAgICAKICAgIFJldHVybnM6CiAgICAgICAgeydzdWNjZXNzJzogVHJ1ZX0gb3IgeydlcnJvcic6ICdlcnJvciBtZXNzYWdlJ30KICAgICIiIgogICAgIyBIYW5kbGUgSlNPTiBzdHJpbmcgZnJvbSBKYXZhU2NyaXB0CiAgICBpZiBpc2luc3RhbmNlKGFyZ3MsIHN0cik6CiAgICAgICAgYXJncyA9IGpzb24ubG9hZHMoYXJncykKICAgIGVsaWYgYXJncyBpcyBOb25lOgogICAgICAgIGFyZ3MgPSB7fQogICAgCiAgICBpbnRlcnZhbF9pZCA9IGFyZ3MuZ2V0KCdpbnRlcnZhbF9pZCcpCiAgICBjYW5faWQgPSBhcmdzLmdldCgnY2FuX2lkJykKICAgIGRhdGEgPSBhcmdzLmdldCgnZGF0YScpCiAgICBpbnRlcnZhbF9tcyA9IGFyZ3MuZ2V0KCdpbnRlcnZhbCcpCiAgICAKICAgIGlmIGludGVydmFsX2lkIGlzIE5vbmUgb3IgY2FuX2lkIGlzIE5vbmUgb3IgZGF0YSBpcyBOb25lIG9yIGludGVydmFsX21zIGlzIE5vbmU6CiAgICAgICAgX3NlbmRfZXJyb3IoIk1pc3NpbmcgcmVxdWlyZWQgcGFyYW1ldGVycyIsICdDQU4tSU5URVJWQUwtU1RBUlQtRVJST1InKQogICAgICAgIHJldHVybgogICAgCiAgICBpZiBub3QgZGV2aWNlX2Nvbm5lY3RlZCBvciBjYW5fZGV2IGlzIE5vbmU6CiAgICAgICAgX3NlbmRfZXJyb3IoIkRldmljZSBub3QgY29ubmVjdGVkIiwgJ0NBTi1JTlRFUlZBTC1TVEFSVC1FUlJPUicpCiAgICAgICAgcmV0dXJuCiAgICAKICAgIHRyeToKICAgICAgICAjIFZhbGlkYXRlIENBTiBJRAogICAgICAgIGlmIGNhbl9pZCA8IDAgb3IgY2FuX2lkID4gMHg3RkY6CiAgICAgICAgICAgIF9zZW5kX2Vycm9yKCJJbnZhbGlkIENBTiBJRCAobXVzdCBiZSAweDAwMC0weDdGRikiLCAnQ0FOLUlOVEVSVkFMLVNUQVJULUVSUk9SJykKICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgCiAgICAgICAgIyBWYWxpZGF0ZSBpbnRlcnZhbAogICAgICAgIGlmIGludGVydmFsX21zIDwgMTAgb3IgaW50ZXJ2YWxfbXMgPiAxMDAwMDoKICAgICAgICAgICAgX3NlbmRfZXJyb3IoIkludGVydmFsIG11c3QgYmUgYmV0d2VlbiAxMG1zIGFuZCAxMDAwMG1zIiwgJ0NBTi1JTlRFUlZBTC1TVEFSVC1FUlJPUicpCiAgICAgICAgICAgIHJldHVybgogICAgICAgIAogICAgICAgICMgVmFsaWRhdGUgZGF0YQogICAgICAgIGlmIG5vdCBpc2luc3RhbmNlKGRhdGEsIGxpc3QpIG9yIGxlbihkYXRhKSAhPSA4OgogICAgICAgICAgICBfc2VuZF9lcnJvcigiRGF0YSBtdXN0IGJlIGEgbGlzdCBvZiA4IGJ5dGVzIiwgJ0NBTi1JTlRFUlZBTC1TVEFSVC1FUlJPUicpCiAgICAgICAgICAgIHJldHVybgogICAgICAgIAogICAgICAgICMgU3RvcCBleGlzdGluZyBpbnRlcnZhbCBpZiBydW5uaW5nCiAgICAgICAgaWYgaW50ZXJ2YWxfaWQgaW4gY2FuX2ludGVydmFsczoKICAgICAgICAgICAgc3RvcENhbkludGVydmFsKHsnaW50ZXJ2YWxfaWQnOiBpbnRlcnZhbF9pZH0pCiAgICAgICAgCiAgICAgICAgIyBDcmVhdGUgcGVyaW9kaWMgdGltZXIKICAgICAgICAjIE5vdGU6IE1pY3JvUHl0aG9uIGRvZXNuJ3QgaGF2ZSB0aHJlYWRpbmcsIHNvIHdlIHVzZSBhIHNpbXBsZSBjYWxsYmFjayBhcHByb2FjaAogICAgICAgICMgRm9yIG5vdywgd2UnbGwganVzdCBzdG9yZSB0aGUgaW50ZXJ2YWwgaW5mbyAtIGFjdHVhbCBwZXJpb2RpYyBzZW5kaW5nCiAgICAgICAgIyB3b3VsZCBuZWVkIHRvIGJlIGhhbmRsZWQgYnkgYSBiYWNrZ3JvdW5kIHRhc2sgb3IgdGhlIG1haW4gbG9vcAogICAgICAgICMgVGhpcyBpcyBhIHNpbXBsaWZpZWQgaW1wbGVtZW50YXRpb24gdGhhdCBhY2tub3dsZWRnZXMgdGhlIHN0YXJ0CiAgICAgICAgCiAgICAgICAgY2FuX2ludGVydmFsc1tpbnRlcnZhbF9pZF0gPSB7CiAgICAgICAgICAgICdjYW5faWQnOiBjYW5faWQsCiAgICAgICAgICAgICdkYXRhJzogZGF0YSwKICAgICAgICAgICAgJ2ludGVydmFsJzogaW50ZXJ2YWxfbXMsCiAgICAgICAgICAgICdhY3RpdmUnOiBUcnVlCiAgICAgICAgfQogICAgICAgIAogICAgICAgIF9zZW5kX3Jlc3BvbnNlKCdDQU4tSU5URVJWQUwtU1RBUlRFRCcsIHsKICAgICAgICAgICAgJ3N1Y2Nlc3MnOiBUcnVlLAogICAgICAgICAgICAnaW50ZXJ2YWxfaWQnOiBpbnRlcnZhbF9pZAogICAgICAgIH0pCiAgICAgICAgCiAgICAgICAgIyBUT0RPOiBJbXBsZW1lbnQgYWN0dWFsIHBlcmlvZGljIHNlbmRpbmcgdXNpbmcgYSBiYWNrZ3JvdW5kIHRhc2sKICAgICAgICAjIEZvciBub3csIHRoaXMganVzdCBzdG9yZXMgdGhlIGNvbmZpZ3VyYXRpb24KICAgICAgICAKICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICBfc2VuZF9lcnJvcihzdHIoZSksICdDQU4tSU5URVJWQUwtU1RBUlQtRVJST1InKQoKCmRlZiBzdG9wQ2FuSW50ZXJ2YWwoYXJncyk6CiAgICAiIiIKICAgIFN0b3Agc2VuZGluZyBhIHBlcmlvZGljIENBTiBtZXNzYWdlLgogICAgCiAgICBBcmdzIChkaWN0KToKICAgICAgICBpbnRlcnZhbF9pZDogVW5pcXVlIGlkZW50aWZpZXIgZm9yIHRoaXMgaW50ZXJ2YWwKICAgIAogICAgUmV0dXJuczoKICAgICAgICB7J3N1Y2Nlc3MnOiBUcnVlfSBvciB7J2Vycm9yJzogJ2Vycm9yIG1lc3NhZ2UnfQogICAgIiIiCiAgICAjIEhhbmRsZSBKU09OIHN0cmluZyBmcm9tIEphdmFTY3JpcHQKICAgIGlmIGlzaW5zdGFuY2UoYXJncywgc3RyKToKICAgICAgICBhcmdzID0ganNvbi5sb2FkcyhhcmdzKQogICAgZWxpZiBhcmdzIGlzIE5vbmU6CiAgICAgICAgYXJncyA9IHt9CiAgICAKICAgIGludGVydmFsX2lkID0gYXJncy5nZXQoJ2ludGVydmFsX2lkJykKICAgIAogICAgaWYgaW50ZXJ2YWxfaWQgaXMgTm9uZToKICAgICAgICBfc2VuZF9lcnJvcigiTWlzc2luZyBpbnRlcnZhbF9pZCIsICdDQU4tSU5URVJWQUwtU1RPUC1FUlJPUicpCiAgICAgICAgcmV0dXJuCiAgICAKICAgIHRyeToKICAgICAgICBpZiBpbnRlcnZhbF9pZCBpbiBjYW5faW50ZXJ2YWxzOgogICAgICAgICAgICBjYW5faW50ZXJ2YWxzW2ludGVydmFsX2lkXVsnYWN0aXZlJ10gPSBGYWxzZQogICAgICAgICAgICBkZWwgY2FuX2ludGVydmFsc1tpbnRlcnZhbF9pZF0KICAgICAgICAKICAgICAgICBfc2VuZF9yZXNwb25zZSgnQ0FOLUlOVEVSVkFMLVNUT1BQRUQnLCB7CiAgICAgICAgICAgICdzdWNjZXNzJzogVHJ1ZSwKICAgICAgICAgICAgJ2ludGVydmFsX2lkJzogaW50ZXJ2YWxfaWQKICAgICAgICB9KQogICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgIF9zZW5kX2Vycm9yKHN0cihlKSwgJ0NBTi1JTlRFUlZBTC1TVE9QLUVSUk9SJykKCgojID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KIyBDQU4gSU8gQ29udHJvbCAoSW52ZXJ0ZXIgQ29udHJvbCkKIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiMgTk9URTogVGhlc2UgZnVuY3Rpb25zIGFyZSBERVBSRUNBVEVELiBUaGUgZXh0ZW5zaW9uIG5vdyBzZW5kcyBQeXRob24gY29kZQojIGRpcmVjdGx5IHZpYSBkZXZpY2UuZXhlY3V0ZSgpIGZvbGxvd2luZyB0aGUgU2NyaXB0TyBwYXR0ZXJuLiBUaGVzZSBhcmUga2VwdAojIGZvciBiYWNrd2FyZCBjb21wYXRpYmlsaXR5IG9ubHkuCgojIEdsb2JhbCBzdG9yYWdlIGZvciBDQU4gSU8gaW50ZXJ2YWwKY2FuX2lvX2ludGVydmFsID0gTm9uZSAgIyBUaW1lciBvYmplY3QgZm9yIENBTiBJTyBwZXJpb2RpYyBzZW5kaW5nCmNhbl9pb19jb25maWcgPSB7CiAgICAnYWN0aXZlJzogRmFsc2UsCiAgICAnY2FuX2lkJzogMHgzRiwKICAgICdwb3QnOiAwLAogICAgJ3BvdDInOiAwLAogICAgJ2NhbmlvJzogMCwKICAgICdjcnVpc2VzcGVlZCc6IDAsCiAgICAncmVnZW5wcmVzZXQnOiAwLAogICAgJ2ludGVydmFsJzogMTAwLAogICAgJ3VzZV9jcmMnOiBUcnVlCn0KCmRlZiBzdGFydENhbklvSW50ZXJ2YWwoYXJncyk6CiAgICAiIiIKICAgIFN0YXJ0IENBTiBJTyBjb250cm9sIGludGVydmFsIChzZW5kcyBwZXJpb2RpYyBjb250cm9sIG1lc3NhZ2VzIHRvIGludmVydGVyKS4KICAgIAogICAgQXJncyAoZGljdCk6CiAgICAgICAgY2FuX2lkOiBDQU4gbWVzc2FnZSBJRCAoZGVmYXVsdDogMHgzRikKICAgICAgICBwb3Q6IFRocm90dGxlIHBvdCB2YWx1ZSAoMC00MDk1KQogICAgICAgIHBvdDI6IFNlY29uZCBwb3QgdmFsdWUgKDAtNDA5NSkKICAgICAgICBjYW5pbzogQ29udHJvbCBmbGFncyBieXRlIChiaXQgZmxhZ3M6IGNydWlzZT0weDAxLCBzdGFydD0weDAyLCBicmFrZT0weDA0LCBmb3J3YXJkPTB4MDgsIHJldmVyc2U9MHgxMCwgYm1zPTB4MjApCiAgICAgICAgY3J1aXNlc3BlZWQ6IENydWlzZSBzcGVlZCB2YWx1ZSAoMC0xNjM4MykKICAgICAgICByZWdlbnByZXNldDogUmVnZW4gcHJlc2V0IHZhbHVlICgwLTI1NSkKICAgICAgICBpbnRlcnZhbDogSW50ZXJ2YWwgaW4gbWlsbGlzZWNvbmRzICgxMC01MDApCiAgICAgICAgdXNlX2NyYzogVXNlIENSQy0zMiBjaGVja3N1bSAoVHJ1ZS9GYWxzZSkKICAgIAogICAgUmV0dXJuczoKICAgICAgICB7J3N1Y2Nlc3MnOiBUcnVlfSBvciB7J2Vycm9yJzogJ2Vycm9yIG1lc3NhZ2UnfQogICAgIiIiCiAgICAjIEhhbmRsZSBKU09OIHN0cmluZyBmcm9tIEphdmFTY3JpcHQKICAgIGlmIGlzaW5zdGFuY2UoYXJncywgc3RyKToKICAgICAgICBhcmdzID0ganNvbi5sb2FkcyhhcmdzKQogICAgZWxpZiBhcmdzIGlzIE5vbmU6CiAgICAgICAgYXJncyA9IHt9CiAgICAKICAgIGlmIG5vdCBkZXZpY2VfY29ubmVjdGVkIG9yIGNhbl9kZXYgaXMgTm9uZToKICAgICAgICBfc2VuZF9lcnJvcigiRGV2aWNlIG5vdCBjb25uZWN0ZWQiLCAnQ0FOLUlPLVNUQVJULUVSUk9SJykKICAgICAgICByZXR1cm4KICAgIAogICAgdHJ5OgogICAgICAgICMgU3RvcCBleGlzdGluZyBpbnRlcnZhbCBpZiBydW5uaW5nCiAgICAgICAgaWYgY2FuX2lvX2NvbmZpZ1snYWN0aXZlJ106CiAgICAgICAgICAgIHN0b3BDYW5Jb0ludGVydmFsKCkKICAgICAgICAKICAgICAgICAjIFN0b3JlIGNvbmZpZ3VyYXRpb24KICAgICAgICBjYW5faW9fY29uZmlnLnVwZGF0ZSh7CiAgICAgICAgICAgICdhY3RpdmUnOiBUcnVlLAogICAgICAgICAgICAnY2FuX2lkJzogYXJncy5nZXQoJ2Nhbl9pZCcsIDB4M0YpLAogICAgICAgICAgICAncG90JzogYXJncy5nZXQoJ3BvdCcsIDApLAogICAgICAgICAgICAncG90Mic6IGFyZ3MuZ2V0KCdwb3QyJywgMCksCiAgICAgICAgICAgICdjYW5pbyc6IGFyZ3MuZ2V0KCdjYW5pbycsIDApLAogICAgICAgICAgICAnY3J1aXNlc3BlZWQnOiBhcmdzLmdldCgnY3J1aXNlc3BlZWQnLCAwKSwKICAgICAgICAgICAgJ3JlZ2VucHJlc2V0JzogYXJncy5nZXQoJ3JlZ2VucHJlc2V0JywgMCksCiAgICAgICAgICAgICdpbnRlcnZhbCc6IGFyZ3MuZ2V0KCdpbnRlcnZhbCcsIDEwMCksCiAgICAgICAgICAgICd1c2VfY3JjJzogYXJncy5nZXQoJ3VzZV9jcmMnLCBUcnVlKQogICAgICAgIH0pCiAgICAgICAgCiAgICAgICAgIyBWYWxpZGF0ZSBDQU4gSUQKICAgICAgICBpZiBjYW5faW9fY29uZmlnWydjYW5faWQnXSA8IDAgb3IgY2FuX2lvX2NvbmZpZ1snY2FuX2lkJ10gPiAweDdGRjoKICAgICAgICAgICAgX3NlbmRfZXJyb3IoIkludmFsaWQgQ0FOIElEIChtdXN0IGJlIDB4MDAwLTB4N0ZGKSIsICdDQU4tSU8tU1RBUlQtRVJST1InKQogICAgICAgICAgICByZXR1cm4KICAgICAgICAKICAgICAgICAjIFZhbGlkYXRlIGludGVydmFsCiAgICAgICAgaWYgY2FuX2lvX2NvbmZpZ1snaW50ZXJ2YWwnXSA8IDEwIG9yIGNhbl9pb19jb25maWdbJ2ludGVydmFsJ10gPiA1MDA6CiAgICAgICAgICAgIF9zZW5kX2Vycm9yKCJJbnRlcnZhbCBtdXN0IGJlIGJldHdlZW4gMTBtcyBhbmQgNTAwbXMiLCAnQ0FOLUlPLVNUQVJULUVSUk9SJykKICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgCiAgICAgICAgIyBTZW5kIGluaXRpYWwgbWVzc2FnZQogICAgICAgIF9zZW5kX2Nhbl9pb19tZXNzYWdlKCkKICAgICAgICAKICAgICAgICBfc2VuZF9yZXNwb25zZSgnQ0FOLUlPLVNUQVJURUQnLCB7CiAgICAgICAgICAgICdzdWNjZXNzJzogVHJ1ZSwKICAgICAgICAgICAgJ2ludGVydmFsX21zJzogY2FuX2lvX2NvbmZpZ1snaW50ZXJ2YWwnXQogICAgICAgIH0pCiAgICAgICAgCiAgICAgICAgIyBUT0RPOiBJbXBsZW1lbnQgYWN0dWFsIHBlcmlvZGljIHNlbmRpbmcgdXNpbmcgYSBiYWNrZ3JvdW5kIHRhc2sKICAgICAgICAjIEZvciBub3csIHRoaXMganVzdCBzdG9yZXMgdGhlIGNvbmZpZ3VyYXRpb24gYW5kIHNlbmRzIG9uY2UKICAgICAgICAKICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICBfc2VuZF9lcnJvcihzdHIoZSksICdDQU4tSU8tU1RBUlQtRVJST1InKQoKCmRlZiBzdG9wQ2FuSW9JbnRlcnZhbCgpOgogICAgIiIiCiAgICBTdG9wIENBTiBJTyBjb250cm9sIGludGVydmFsLgogICAgCiAgICBSZXR1cm5zOgogICAgICAgIHsnc3VjY2Vzcyc6IFRydWV9IG9yIHsnZXJyb3InOiAnZXJyb3IgbWVzc2FnZSd9CiAgICAiIiIKICAgIHRyeToKICAgICAgICBjYW5faW9fY29uZmlnWydhY3RpdmUnXSA9IEZhbHNlCiAgICAgICAgCiAgICAgICAgX3NlbmRfcmVzcG9uc2UoJ0NBTi1JTy1TVE9QUEVEJywgewogICAgICAgICAgICAnc3VjY2Vzcyc6IFRydWUKICAgICAgICB9KQogICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgIF9zZW5kX2Vycm9yKHN0cihlKSwgJ0NBTi1JTy1TVE9QLUVSUk9SJykKCgpkZWYgdXBkYXRlQ2FuSW9GbGFncyhhcmdzKToKICAgICIiIgogICAgVXBkYXRlIENBTiBJTyBmbGFncyB3aGlsZSBpbnRlcnZhbCBpcyBydW5uaW5nLgogICAgCiAgICBBcmdzIChkaWN0KToKICAgICAgICBwb3Q6IFRocm90dGxlIHBvdCB2YWx1ZSAoMC00MDk1KQogICAgICAgIHBvdDI6IFNlY29uZCBwb3QgdmFsdWUgKDAtNDA5NSkKICAgICAgICBjYW5pbzogQ29udHJvbCBmbGFncyBieXRlCiAgICAgICAgY3J1aXNlc3BlZWQ6IENydWlzZSBzcGVlZCB2YWx1ZSAoMC0xNjM4MykKICAgICAgICByZWdlbnByZXNldDogUmVnZW4gcHJlc2V0IHZhbHVlICgwLTI1NSkKICAgIAogICAgUmV0dXJuczoKICAgICAgICB7J3N1Y2Nlc3MnOiBUcnVlfSBvciB7J2Vycm9yJzogJ2Vycm9yIG1lc3NhZ2UnfQogICAgIiIiCiAgICAjIEhhbmRsZSBKU09OIHN0cmluZyBmcm9tIEphdmFTY3JpcHQKICAgIGlmIGlzaW5zdGFuY2UoYXJncywgc3RyKToKICAgICAgICBhcmdzID0ganNvbi5sb2FkcyhhcmdzKQogICAgZWxpZiBhcmdzIGlzIE5vbmU6CiAgICAgICAgYXJncyA9IHt9CiAgICAKICAgIGlmIG5vdCBjYW5faW9fY29uZmlnWydhY3RpdmUnXToKICAgICAgICBfc2VuZF9lcnJvcigiQ0FOIElPIGludGVydmFsIG5vdCBhY3RpdmUiLCAnQ0FOLUlPLVVQREFURS1FUlJPUicpCiAgICAgICAgcmV0dXJuCiAgICAKICAgIHRyeToKICAgICAgICAjIFVwZGF0ZSBjb25maWd1cmF0aW9uCiAgICAgICAgaWYgJ3BvdCcgaW4gYXJnczoKICAgICAgICAgICAgY2FuX2lvX2NvbmZpZ1sncG90J10gPSBhcmdzWydwb3QnXQogICAgICAgIGlmICdwb3QyJyBpbiBhcmdzOgogICAgICAgICAgICBjYW5faW9fY29uZmlnWydwb3QyJ10gPSBhcmdzWydwb3QyJ10KICAgICAgICBpZiAnY2FuaW8nIGluIGFyZ3M6CiAgICAgICAgICAgIGNhbl9pb19jb25maWdbJ2NhbmlvJ10gPSBhcmdzWydjYW5pbyddCiAgICAgICAgaWYgJ2NydWlzZXNwZWVkJyBpbiBhcmdzOgogICAgICAgICAgICBjYW5faW9fY29uZmlnWydjcnVpc2VzcGVlZCddID0gYXJnc1snY3J1aXNlc3BlZWQnXQogICAgICAgIGlmICdyZWdlbnByZXNldCcgaW4gYXJnczoKICAgICAgICAgICAgY2FuX2lvX2NvbmZpZ1sncmVnZW5wcmVzZXQnXSA9IGFyZ3NbJ3JlZ2VucHJlc2V0J10KICAgICAgICAKICAgICAgICAjIFNlbmQgdXBkYXRlZCBtZXNzYWdlIGltbWVkaWF0ZWx5CiAgICAgICAgX3NlbmRfY2FuX2lvX21lc3NhZ2UoKQogICAgICAgIAogICAgICAgIF9zZW5kX3Jlc3BvbnNlKCdDQU4tSU8tVVBEQVRFRCcsIHsKICAgICAgICAgICAgJ3N1Y2Nlc3MnOiBUcnVlCiAgICAgICAgfSkKICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICBfc2VuZF9lcnJvcihzdHIoZSksICdDQU4tSU8tVVBEQVRFLUVSUk9SJykKCgpkZWYgX3NlbmRfY2FuX2lvX21lc3NhZ2UoKToKICAgICIiIgogICAgSW50ZXJuYWwgaGVscGVyIHRvIHNlbmQgQ0FOIElPIGNvbnRyb2wgbWVzc2FnZS4KICAgIENvbnN0cnVjdHMgdGhlIDgtYnl0ZSBDQU4gbWVzc2FnZSBhY2NvcmRpbmcgdG8gT3BlbkludmVydGVyIHByb3RvY29sLgogICAgIiIiCiAgICBpZiBub3QgZGV2aWNlX2Nvbm5lY3RlZCBvciBjYW5fZGV2IGlzIE5vbmU6CiAgICAgICAgcmV0dXJuCiAgICAKICAgIGlmIG5vdCBjYW5faW9fY29uZmlnWydhY3RpdmUnXToKICAgICAgICByZXR1cm4KICAgIAogICAgIyBDb25zdHJ1Y3QgQ0FOIG1lc3NhZ2UgKDggYnl0ZXMpCiAgICAjIEJ5dGUgMDogcG90IGxvdyBieXRlCiAgICAjIEJ5dGUgMTogcG90IGhpZ2ggYnl0ZQogICAgIyBCeXRlIDI6IHBvdDIgbG93IGJ5dGUKICAgICMgQnl0ZSAzOiBwb3QyIGhpZ2ggYnl0ZQogICAgIyBCeXRlIDQ6IGNhbmlvIGZsYWdzCiAgICAjIEJ5dGUgNTogY3J1aXNlc3BlZWQgbG93IGJ5dGUKICAgICMgQnl0ZSA2OiBjcnVpc2VzcGVlZCBoaWdoIGJ5dGUKICAgICMgQnl0ZSA3OiByZWdlbnByZXNldCAob3IgQ1JDIGlmIHVzZV9jcmM9VHJ1ZSkKICAgIAogICAgcG90ID0gY2FuX2lvX2NvbmZpZ1sncG90J10gJiAweEZGRkYKICAgIHBvdDIgPSBjYW5faW9fY29uZmlnWydwb3QyJ10gJiAweEZGRkYKICAgIGNhbmlvID0gY2FuX2lvX2NvbmZpZ1snY2FuaW8nXSAmIDB4RkYKICAgIGNydWlzZXNwZWVkID0gY2FuX2lvX2NvbmZpZ1snY3J1aXNlc3BlZWQnXSAmIDB4M0ZGRiAgIyAxNCBiaXRzIG1heAogICAgcmVnZW5wcmVzZXQgPSBjYW5faW9fY29uZmlnWydyZWdlbnByZXNldCddICYgMHhGRgogICAgCiAgICBkYXRhID0gWwogICAgICAgIHBvdCAmIDB4RkYsICAgICAgICAgICAjIEJ5dGUgMDogcG90IGxvdwogICAgICAgIChwb3QgPj4gOCkgJiAweEZGLCAgICAjIEJ5dGUgMTogcG90IGhpZ2gKICAgICAgICBwb3QyICYgMHhGRiwgICAgICAgICAgIyBCeXRlIDI6IHBvdDIgbG93CiAgICAgICAgKHBvdDIgPj4gOCkgJiAweEZGLCAgICMgQnl0ZSAzOiBwb3QyIGhpZ2gKICAgICAgICBjYW5pbywgICAgICAgICAgICAgICAgIyBCeXRlIDQ6IGNvbnRyb2wgZmxhZ3MKICAgICAgICBjcnVpc2VzcGVlZCAmIDB4RkYsICAgIyBCeXRlIDU6IGNydWlzZXNwZWVkIGxvdwogICAgICAgIChjcnVpc2VzcGVlZCA+PiA4KSAmIDB4RkYsICAjIEJ5dGUgNjogY3J1aXNlc3BlZWQgaGlnaAogICAgICAgIHJlZ2VucHJlc2V0ICAgICAgICAgICAjIEJ5dGUgNzogcmVnZW4gcHJlc2V0IChvciBDUkMpCiAgICBdCiAgICAKICAgICMgSWYgQ1JDIGlzIGVuYWJsZWQsIGNhbGN1bGF0ZSBDUkMtMzIgYW5kIHB1dCBpbiBieXRlIDcKICAgIGlmIGNhbl9pb19jb25maWdbJ3VzZV9jcmMnXToKICAgICAgICAjIFNpbXBsZSBDUkMtMzIgY2FsY3VsYXRpb24gKHNpbXBsaWZpZWQgLSBhY3R1YWwgT3BlbkludmVydGVyIHVzZXMgcHJvcGVyIENSQy0zMikKICAgICAgICAjIEZvciBub3csIHVzZSBhIHNpbXBsZSBjaGVja3N1bQogICAgICAgIGNyYyA9IHN1bShkYXRhWzo3XSkgJiAweEZGCiAgICAgICAgZGF0YVs3XSA9IGNyYwogICAgCiAgICAjIFNlbmQgQ0FOIG1lc3NhZ2UKICAgIHRyeToKICAgICAgICBjYW5fZGV2LnNlbmQoZGF0YSwgY2FuX2lvX2NvbmZpZ1snY2FuX2lkJ10pCiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgIyBTaWxlbnRseSBmYWlsIC0gZXJyb3JzIHdpbGwgYmUgY2F1Z2h0IGJ5IGNhbGxlcgogICAgICAgIHBhc3MK"
};

// Bundled extension code
var c=Object.defineProperty;var h=(r,e,t)=>e in r?c(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var d=(r,e,t)=>(h(r,typeof e!="symbol"?e+"":e,t),t);var n=class n{constructor(e,t,s,i){this.device=e,this.emit=t,this.state=s,this.html=i,this.state.discoveredDevices||(this.state.discoveredDevices=[]),this.state.selectedDeviceSerial||(this.state.selectedDeviceSerial=null),this.state.mockCanMappings||(this.state.mockCanMappings={tx:[],rx:[]}),this.state.activeDeviceTab||(this.state.activeDeviceTab="telemetry"),this.state.spotValueHistory||(this.state.spotValueHistory={}),this.state.selectedChartParams||(this.state.selectedChartParams=new Set),(this.state.autoRefreshInterval===void 0||this.state.autoRefreshInterval===null)&&(this.state.autoRefreshInterval=1e3),this.state.isEditingInterval===void 0&&(this.state.isEditingInterval=!1),this.state.canMessages||(this.state.canMessages={canId:"3F",dataBytes:"00 00 00 00 00 00 00 00",periodicMessages:[],showAddPeriodicForm:!1,periodicFormData:{canId:"",data:"",interval:100}}),this.state.canIo||(this.state.canIo={active:!1,canId:"3F",interval:100,cruise:!1,start:!1,brake:!1,forward:!1,reverse:!1,bms:!1,throttlePercent:0,cruisespeed:0,regenpreset:0,useCrc:!0}),this.state.oiParameters||(this.state.oiParameters=null),this.state.isLoadingOiParameters===void 0&&(this.state.isLoadingOiParameters=!1),this.state.collapsedCategories||(this.state.collapsedCategories=new Set),this.state.nodeId===void 0&&(this.state.nodeId=this.state.selectedNodeId?.toString()||"1"),this.state.isImporting===void 0&&(this.state.isImporting=!1),this.state.importProgress||(this.state.importProgress={current:0,total:0}),this.state.canMappings||(this.state.canMappings=null),this.state.isLoadingCanMappings===void 0&&(this.state.isLoadingCanMappings=!1),this.state.canMappingError||(this.state.canMappingError=null),this.state.showCanMappingForm||(this.state.showCanMappingForm=!1),this.state.canMappingFormData||(this.state.canMappingFormData={isrx:!1,id:0,paramid:0,position:0,length:16,gain:1,offset:0}),this.state.allParamsWithIds||(this.state.allParamsWithIds=null),this.state.isLoadingAllParamsWithIds===void 0&&(this.state.isLoadingAllParamsWithIds=!1),this._setupDynamicDevicePanels()}async onInstall(){if(!this.state.isConnected)return!1;console.log("[OpenInverter] Installing device files...");try{await this.device.mkdir("/lib/ext/openinverter");for(let[e,t]of Object.entries(this.deviceFiles)){let s=e.split("/").pop();console.log(`[OpenInverter] Writing ${s}...`),await this.device.saveFile(e,t)}return console.log("[OpenInverter] Installation complete! Device may need restart to use extension."),!0}catch(e){return console.error("[OpenInverter] Installation failed:",e),!1}}_setupDynamicDevicePanels(){let e=this;this.state.discoveredDevices&&this.state.discoveredDevices.forEach(s=>{let i=`renderDevice-${s.serial}`;e[i]||(e[i]=function(){return e.state.selectedDeviceSerial=s.serial,renderDevicePanel.call(e)})});let t=this.state.discoveredDevices.push.bind(this.state.discoveredDevices);this.state.discoveredDevices.push=function(...s){let i=t(...s);return s.forEach(a=>{if(a&&a.serial){let l=`renderDevice-${a.serial}`;e[l]||(e[l]=function(){return e.state.selectedDeviceSerial=a.serial,renderDevicePanel.call(e)})}}),i}}getMenuItems(){let e=[{id:"deviceselector",label:"Device Manager"}];if(this.state.discoveredDevices&&this.state.discoveredDevices.length>0){e.push({id:"devices-header",label:"--- DEVICES ---",disabled:!0});let t=this.state.discoveredDevices.map(s=>({id:`device-${s.serial}`,label:s.name||`Device ${s.nodeId}`,icon:s.online?"device":"device-off"}));return[...e,...t]}return e}renderDeviceselector(){return renderDeviceSelectorTab.call(this)}render(e){if(e&&e.startsWith("device-")){let s=e.replace("device-","");return this.state.selectedDeviceSerial=s,renderDevicePanel.call(this)}let t=`render${e.charAt(0).toUpperCase()+e.slice(1)}`;return typeof this[t]=="function"?this[t]():this.html`<div class="panel-message">Panel not found: ${e}</div>`}renderParameters(){return renderParametersTab.call(this)}renderSpotvalues(){return renderSpotValuesTab.call(this)}renderCanmappings(){return renderCanMappingsTab.call(this)}renderCharts(){return renderSpotValuesTab.call(this)}renderCanmessages(){return renderCanMessagesTab.call(this)}icon(e,t=24,s="#333"){let i=n.ICONS[e];if(!i)return"";let a=i.replace(/width="24"/g,`width="${t}"`).replace(/height="24"/g,`height="${t}"`).replace(/stroke="currentColor"/g,`stroke="${s}"`);return`data:image/svg+xml,${encodeURIComponent(a)}`}renderSidebarDevices(){return!this.state.discoveredDevices||this.state.discoveredDevices.length===0?this.html`
        <div style="padding: 16px; text-align: center; color: var(--text-secondary); font-size: 12px;">
          <p style="margin: 0;">No devices found</p>
          <p style="margin: 8px 0 0; font-size: 11px;">Use Device Selector to scan</p>
        </div>
      `:this.html`
      <div style="padding: 4px 0;">
        ${this.state.discoveredDevices.map(e=>this.html`
          <div 
            onclick=${()=>this.selectDeviceFromSidebar(e)}
            style="
              padding: 12px 16px;
              cursor: pointer;
              transition: background 0.2s;
              border-left: 3px solid ${this.state.selectedDeviceSerial===e.serial?"var(--oi-blue)":"transparent"};
              background: ${this.state.selectedDeviceSerial===e.serial?"var(--oi-blue-light)":"transparent"};
            "
            onmouseover=${t=>{this.state.selectedDeviceSerial!==e.serial&&(t.currentTarget.style.background="var(--bg-tertiary)")}}
            onmouseout=${t=>{this.state.selectedDeviceSerial!==e.serial&&(t.currentTarget.style.background="transparent")}}>
            
            <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 4px;">
              <div style="width: 8px; height: 8px; border-radius: 50%; background: ${e.online?"#4caf50":"#999"};"></div>
              <div style="font-weight: 600; font-size: 13px; color: var(--text-primary); overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">
                ${e.name||`Device ${e.nodeId}`}
              </div>
            </div>
            <div style="font-size: 11px; color: var(--text-secondary); margin-left: 16px;">
              ${e.serial?e.serial.substring(0,12)+"...":`Node ${e.nodeId}`}
            </div>
          </div>
        `)}
      </div>
    `}selectDeviceFromSidebar(e){this.state.selectedDeviceSerial=e.serial,this.state.selectedNodeId=e.nodeId,this.state.activeDeviceTab="telemetry",(!this.state.oiDeviceConnected||this.state.currentDeviceSerial!==e.serial)&&e.nodeId>127&&(this.state.oiDeviceConnected=!0,this.state.currentDeviceSerial=e.serial),this.emit("render")}renderDevicePanel(){let e=this.state.discoveredDevices.find(t=>t.serial===this.state.selectedDeviceSerial);return e?this.html`
      <div style="display: flex; flex-direction: column; height: 100%;">
        <!-- Device Header -->
        <div style="border-bottom: 1px solid var(--border-color); padding: 20px;">
          <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 8px;">
            <div style="width: 12px; height: 12px; border-radius: 50%; background: ${e.online?"#4caf50":"#999"};"></div>
            <h1 style="margin: 0; font-size: 24px; color: var(--text-primary);">
              ${e.name||`Device ${e.nodeId}`}
            </h1>
            <span style="background: var(--oi-beige); padding: 4px 12px; border-radius: 12px; font-size: 12px; font-weight: 600; color: var(--text-secondary);">
              ${e.online?"Connected":"Offline"}
            </span>
          </div>
          <div style="display: flex; gap: 16px; color: var(--text-secondary); font-size: 13px;">
            <span>Serial: ${e.serial||"Unknown"}</span>
            <span>Node ID: ${e.nodeId}</span>
            <span>Firmware: ${e.firmware||"Unknown"}</span>
          </div>
        </div>

        <!-- Tab Navigation -->
        <div class="tabs-header">
          <div class="tabs-nav">
            <button 
              class="tab-button ${this.state.activeDeviceTab==="telemetry"?"active":""}"
              onclick=${()=>this.switchDeviceTab("telemetry")}>
              Telemetry
            </button>
            <button 
              class="tab-button ${this.state.activeDeviceTab==="parameters"?"active":""}"
              onclick=${()=>this.switchDeviceTab("parameters")}>
              Parameters
            </button>
            <button 
              class="tab-button ${this.state.activeDeviceTab==="canmapping"?"active":""}"
              onclick=${()=>this.switchDeviceTab("canmapping")}>
              CAN Mappings
            </button>
            <button 
              class="tab-button ${this.state.activeDeviceTab==="canmessages"?"active":""}"
              onclick=${()=>this.switchDeviceTab("canmessages")}>
              CAN Messages
            </button>
            <button 
              class="tab-button ${this.state.activeDeviceTab==="ota"?"active":""}"
              onclick=${()=>this.switchDeviceTab("ota")}>
              OTA Update
            </button>
          </div>
        </div>

        <!-- Tab Content -->
        <div class="tabs-content" style="flex: 1; overflow: auto; padding: 20px;">
          ${this.renderDeviceTabContent()}
        </div>
      </div>
    `:this.html`
        <div class="panel-message">
          <p>Device not found</p>
        </div>
      `}switchDeviceTab(e){this.state.activeDeviceTab=e,this.emit("render")}renderDeviceTabContent(){switch(this.state.activeDeviceTab){case"telemetry":return renderSpotValuesTab.call(this);case"parameters":return renderParametersTab.call(this);case"canmapping":return renderCanMappingsTab.call(this);case"canmessages":return renderCanMessagesTab.call(this);case"ota":return renderOtaUpdateTab.call(this);default:return this.html`<div class="panel-message">Unknown tab</div>`}}};d(n,"ICONS",{playerPlay:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M7 4v16l13 -8z" /></svg>',playerPause:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M6 5m0 1a1 1 0 0 1 1 -1h2a1 1 0 0 1 1 1v12a1 1 0 0 1 -1 1h-2a1 1 0 0 1 -1 -1z" /><path d="M14 5m0 1a1 1 0 0 1 1 -1h2a1 1 0 0 1 1 1v12a1 1 0 0 1 -1 1h-2a1 1 0 0 1 -1 -1z" /></svg>',playerStop:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M5 5m0 2a2 2 0 0 1 2 -2h10a2 2 0 0 1 2 2v10a2 2 0 0 1 -2 2h-10a2 2 0 0 1 -2 -2z" /></svg>',refresh:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M20 11a8.1 8.1 0 0 0 -15.5 -2m-.5 -4v4h4" /><path d="M4 13a8.1 8.1 0 0 0 15.5 2m.5 4v-4h-4" /></svg>',edit:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M7 7h-1a2 2 0 0 0 -2 2v9a2 2 0 0 0 2 2h9a2 2 0 0 0 2 -2v-1" /><path d="M20.385 6.585a2.1 2.1 0 0 0 -2.97 -2.97l-8.415 8.385v3h3l8.385 -8.415z" /><path d="M16 5l3 3" /></svg>',trash:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 7l16 0" /><path d="M10 11l0 6" /><path d="M14 11l0 6" /><path d="M5 7l1 12a2 2 0 0 0 2 2h8a2 2 0 0 0 2 -2l1 -12" /><path d="M9 7v-3a1 1 0 0 1 1 -1h4a1 1 0 0 1 1 1v3" /></svg>'});var o=n;export{o as default};

