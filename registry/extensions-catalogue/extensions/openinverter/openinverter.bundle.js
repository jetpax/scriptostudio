// === EXTENSION_BUNDLE ===
// Generated by bundle_extensions.js
// Do not edit - regenerated on each build
// BUILD_ID: 2026-02-04T16-49-27

console.log('%c[OpenInverter] BUILD 2026-02-04T16-49-27', 'color: #ff8c00; font-weight: bold');

export const __EXTENSION_META__ = {
  "name": "OpenInverter",
  "id": "openinverter",
  "version": [
    1,
    99,
    0
  ],
  "author": "JetPax",
  "description": "Complete OpenInverter suite. Configure parameters, map CAN messages, view spot values, and plot real-time signals from OpenInverter motor controllers.",
  "icon": "bolt",
  "iconSvg": "<svg xmlns=\"http://www.w3.org/2000/svg\" class=\"icon icon-tabler icon-tabler-bolt\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" stroke-width=\"2\" stroke=\"currentColor\" fill=\"none\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path stroke=\"none\" d=\"M0 0h24v24H0z\" fill=\"none\"/><path d=\"M13 3l0 7l6 0l-8 11l0 -7l-6 0l8 -11\" /></svg>",
  "menu": [
    {
      "id": "deviceselector",
      "label": "Device Manager"
    },
    {
      "id": "commands",
      "label": "Device Control",
      "icon": "zap"
    },
    {
      "id": "errors",
      "label": "Error Log",
      "icon": "alert-triangle"
    },
    {
      "id": "plot",
      "label": "Live Plot",
      "icon": "trending-up"
    }
  ],
  "devices": true,
  "styles": ":root { --oi-blue: #1e88e5; --oi-blue-dark: #1565c0; --oi-blue-light: #e3f2fd; --oi-orange: #ff8c00; --oi-orange-light: #ffa726; --oi-beige: #fef8f0; --oi-yellow: #ffd54f; --oi-status-success: #4caf50; --oi-status-warning: #ff9800; --oi-status-error: #f44336; --oi-status-info: #1e88e5; --text-muted: #999; } .oi-compact-header { padding: 16px 20px !important; min-height: auto !important; display: flex; justify-content: space-between; align-items: center; } .oi-compact-header h2 { font-size: 18px !important; margin: 0 !important; } .oi-button-row { display: flex; flex-direction: row; gap: 8px; flex-wrap: wrap; align-items: center; } .oi-button-row .secondary-button, .oi-button-row .primary-button { padding: 6px 12px !important; font-size: 12px !important; font-weight: 600; text-transform: none; letter-spacing: normal; display: flex; align-items: center; gap: 6px; } .oi-button-row .secondary-button svg, .oi-button-row .primary-button svg { width: 14px; height: 14px; flex-shrink: 0; } .oi-plot-controls { display: flex; gap: 20px; align-items: center; } .oi-plot-controls .button { display: flex; flex-direction: column; align-items: center; } .oi-plot-controls .codicon { font-size: 20px; } .oi-parameters-container { padding: 20px; } .oi-category-section { margin-bottom: 32px; } .oi-category-title { font-size: 18px; font-weight: 400; color: var(--scheme-primary); margin-bottom: 12px; padding-bottom: 8px; border-bottom: 2px solid var(--scheme-primary); } .oi-parameters-table { border: 1px solid var(--border-color); border-radius: 4px; overflow: hidden; } .oi-table-header, .oi-table-row { display: grid; grid-template-columns: 1.5fr 1fr 0.8fr 1.2fr 0.8fr; gap: 12px; padding: 6px 16px; align-items: center; } .oi-table-header { background: var(--scheme-primary); color: white; font-weight: 600; font-size: 13px; text-transform: uppercase; letter-spacing: 0.5px; } .oi-table-row { border-bottom: 1px solid var(--border-color); transition: background 0.2s; padding: 3px 16px; } .oi-table-row:hover { background: var(--bg-tertiary); } .oi-table-row:last-child { border-bottom: none; } .oi-value-input, .oi-enum-select { width: 100%; padding: 6px 0px; border: 1px solid #34495e; border-radius: 4px; background: #121212; color: #0fdb0f; font-size: 14px; font-family: 'Menlo', 'Monaco', 'Courier New', monospace; } .oi-value-input:focus, .oi-enum-select:focus { outline: none; border-color: var(--scheme-primary); box-shadow: 0 0 0 2px rgba(0, 129, 132, 0.2); } .oi-spotvalues-container { padding: 20px; } .oi-spotvalues-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 16px; } .oi-spotvalue-card { background: #121212; border: 1px solid var(--border-color); border-radius: 8px; padding: 16px; transition: all 0.2s; } .oi-spotvalue-card:hover { border-color: var(--scheme-primary); box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2); } .oi-spotvalue-name { font-weight: 600; color: var(--scheme-primary); font-size: 13px; margin-bottom: 8px; } .oi-spotvalue-value { font-size: 24px; font-weight: 700; font-family: 'Menlo', Monaco, 'Courier New', monospace; color: white; } .oi-plot-container { display: flex; height: 500px; max-height: calc(100vh - 260px); gap: 20px; padding: 20px; overflow: hidden; } .oi-plot-sidebar { width: 140px; flex-shrink: 0; border-right: 1px solid var(--border-color); padding-right: 20px; overflow-y: auto; } .oi-plot-section-title { font-size: 14px; font-weight: 600; color: var(--scheme-primary); margin: 16px 0 12px 0; text-transform: uppercase; letter-spacing: 0.5px; } .oi-plot-signal-list { display: flex; flex-direction: column; gap: 8px; margin-bottom: 24px; } .oi-plot-signal { padding: 8px; border-radius: 4px; transition: background 0.2s; } .oi-plot-signal:hover { background: var(--bg-tertiary); } .oi-plot-signal label { display: flex; align-items: center; gap: 8px; cursor: pointer; font-size: 13px; } .oi-plot-signal input[type=\"checkbox\"] { width: 16px; height: 16px; cursor: pointer; } .oi-plot-signal-name { font-weight: 600; color: var(--text-primary); } .oi-plot-signal-unit { color: var(--text-secondary); font-size: 12px; margin-left: auto; } .oi-plot-settings { display: flex; flex-direction: column; gap: 12px; } .oi-plot-settings label { display: flex; flex-direction: column; gap: 4px; font-size: 13px; color: var(--text-secondary); } .oi-plot-settings input[type=\"number\"] { padding: 6px 8px; border: 1px solid var(--border-color); border-radius: 4px; background: var(--bg-secondary); color: var(--text-primary); font-size: 13px; } .oi-plot-settings input[type=\"number\"]:focus { outline: none; border-color: var(--scheme-primary); box-shadow: 0 0 0 2px rgba(0, 129, 132, 0.2); } .oi-plot-chart-area { flex: 1; position: relative; background: var(--bg-secondary); border: 1px solid var(--border-color); border-radius: 8px; padding: 16px; min-height: 0; min-width: 0; display: flex; flex-direction: column; } .oi-plot-chart-area canvas { width: 100% !important; height: 100% !important; max-width: 100%; max-height: 100%; } .tabs-container { display: flex; flex-direction: column; height: 100%; } .tabs-header { border-bottom: 2px solid var(--border-color); background: var(--bg-secondary); } .tabs-nav { display: flex; gap: 0; overflow-x: auto; } .tab-button { background: transparent; border: none; border-radius: 0; padding: 16px 24px; font-size: 14px; font-weight: 600; color: var(--text-secondary); cursor: pointer; border-bottom: 3px solid transparent; transition: all 0.2s; white-space: nowrap; } .tab-button:hover:not(:disabled) { color: var(--oi-blue); background: var(--oi-blue-light); } .tab-button.active { border-bottom-color: var(--oi-blue); } .tab-button:disabled { opacity: 0.5; cursor: not-allowed; }",
  "devicePaths": {
    "lib/OI_helpers.py": "/lib/ext/openinverter/OI_helpers.py"
  }
};

export const __DEVICE_FILES__ = {
  "/lib/ext/openinverter/OI_helpers.py": "IiIiCk9wZW5JbnZlcnRlciBIZWxwZXIgRnVuY3Rpb25zCj09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQoKVGhpcyBtb2R1bGUgY29udGFpbnMgaGVscGVyIGZ1bmN0aW9ucyBmb3IgT3BlbkludmVydGVyIHBhcmFtZXRlciBtYW5hZ2VtZW50CmFuZCBDQU4gYnVzIG1hcHBpbmcuIFRoZXNlIGZ1bmN0aW9ucyBhcmUgY2FsbGFibGUgZnJvbSB0aGUgV2ViUkVQTCBjbGllbnQKYW5kIGF1dG9tYXRpY2FsbHkgc2VuZCB0aGVpciBKU09OIHJlc3BvbnNlcyBkaXJlY3RseSB0byB0aGUgY29ubmVjdGVkIGNsaWVudC4KCkNsaWVudC1jYWxsYWJsZSBmdW5jdGlvbnMgKGF1dG8tc2VuZCB0byBjbGllbnQpOgotIGdldE9pUGFyYW1zKCkgICAgICAgICAgIC0gR2V0IGxpc3Qgb2YgcGFyYW1ldGVycyAoaXNwYXJhbT1UcnVlKQotIHNldFBhcmFtZXRlcihhcmdzKSAgICAgIC0gU2V0IGEgc2luZ2xlIHBhcmFtZXRlciB2YWx1ZQotIHNhdmVQYXJhbWV0ZXJzKCkgICAgICAgIC0gU2F2ZSBwYXJhbWV0ZXJzIHRvIHBlcnNpc3RlbnQgc3RvcmFnZQotIGdldFBhcmFtZXRlcnNGb3JEb3dubG9hZCgpIC0gR2V0IHBhcmFtZXRlcnMgZm9yIGV4cG9ydC9kb3dubG9hZAotIHNldFBhcmFtZXRlcnNCYXRjaChhcmdzKSAtIFNldCBtdWx0aXBsZSBwYXJhbWV0ZXJzIGF0IG9uY2UKLSBnZXRTcG90VmFsdWVzKCkgICAgICAgICAtIEdldCBsaXN0IG9mIHNwb3QgdmFsdWVzIChpc3BhcmFtPUZhbHNlKQotIGdldFBsb3REYXRhKGFyZ3MpICAgICAgIC0gR2V0IHJlYWwtdGltZSB2YWx1ZXMgZm9yIHBsb3R0aW5nCi0gbWFwQ2FuU3BvdFZhbHVlKGFyZ3MpICAgLSBNYXAgYSBzcG90IHZhbHVlIHRvIENBTiBidXMKLSB1bm1hcENhblNwb3RWYWx1ZShhcmdzKSAtIFJlbW92ZSBDQU4gbWFwcGluZyBmcm9tIHNwb3QgdmFsdWUKLSBnZXRDYW5NYXBwaW5nRGF0YSgpICAgICAtIEdldCBhbGwgcGFyYW1ldGVycyB3aXRoIENBTiBtYXBwaW5nIGluZm8KLSBnZXRTeXNJbmZvKCkgICAgICAgICAgICAtIEdldCBPcGVuSW52ZXJ0ZXIgc3lzdGVtIGluZm8KLSBhY3Rpb25CdXR0b24oYXJncykgICAgICAtIEhhbmRsZSBhY3Rpb24gYnV0dG9uIHByZXNzCi0gdGVybUNtZChhcmdzKSAgICAgICAgICAgLSBIYW5kbGUgdGVybWluYWwgY29tbWFuZAoKR2xvYmFsIFBhcmFtZXRlcnMgU3RvcmU6Ci0gcGFyYW1ldGVyczogRGljdGlvbmFyeSBvZiBhbGwgcGFyYW1ldGVycyBhbmQgc3BvdCB2YWx1ZXMKICBTdHJ1Y3R1cmU6IHsKICAgICduYW1lJzogewogICAgICAndmFsdWUnOiA8bnVtYmVyPiwKICAgICAgJ3VuaXQnOiA8c3RyaW5nPiwKICAgICAgJ2lzcGFyYW0nOiA8Ym9vbD4sCiAgICAgICdjYXRlZ29yeSc6IDxzdHJpbmc+LAogICAgICAjIEZvciBwYXJhbWV0ZXIgb25seToKICAgICAgJ21pbmltdW0nOiA8bnVtYmVyPiwKICAgICAgJ21heGltdW0nOiA8bnVtYmVyPiwKICAgICAgJ2RlZmF1bHQnOiA8bnVtYmVyPiwKICAgICAgJ2VudW1zJzogezxpbnQ+OiA8c3RyaW5nPiwgLi4ufSwgICMgT3B0aW9uYWwgZm9yIGVudW0gcGFyYW1ldGVycwogICAgICAjIEZvciBDQU4tbWFwcGVkIHZhbHVlczoKICAgICAgJ2NhbklkJzogPGludD4sCiAgICAgICdjYW5Qb3NpdGlvbic6IDxpbnQ+LAogICAgICAnY2FuQml0cyc6IDxpbnQ+LAogICAgICAnY2FuR2Fpbic6IDxmbG9hdD4sCiAgICAgICdpc1R4JzogPGJvb2w+CiAgICB9CiAgfQoiIiIKCmltcG9ydCBqc29uCmltcG9ydCB0aW1lCgojIENBTiBtb2R1bGUgLSByZXF1aXJlZCBmb3IgT3BlbkludmVydGVyIGV4dGVuc2lvbgp0cnk6CiAgICBpbXBvcnQgQ0FOCmV4Y2VwdCBJbXBvcnRFcnJvcjoKICAgICMgQ0FOIG1vZHVsZSBub3QgYXZhaWxhYmxlIC0gZnVuY3Rpb25zIHdpbGwgZmFpbCBncmFjZWZ1bGx5CiAgICBDQU4gPSBOb25lCgojIFNETyBsaWJyYXJ5IGlzIGd1YXJhbnRlZWQgdG8gYmUgcHJlc2VudCBpbiBleHRlbnNpb24gKHNhbWUgcGFja2FnZSkKZnJvbSBsaWIuY2Fub3Blbl9zZG8gaW1wb3J0IFNET0NsaWVudCwgZml4ZWRfdG9fZmxvYXQsIGZsb2F0X3RvX2ZpeGVkLCBwYXJhbV9pZF90b19zZG8KZnJvbSBsaWIuY2Fub3Blbl9zZG8gaW1wb3J0IFNET1RpbWVvdXRFcnJvciwgU0RPQWJvcnRFcnJvcgoKIyAtLS0gR2xvYmFsIENBTiBhbmQgRGV2aWNlIFN0YXRlIC0tLQpjYW5fZGV2ID0gTm9uZQpzZG9fY2xpZW50ID0gTm9uZQpkZXZpY2VfY29ubmVjdGVkID0gRmFsc2UKZGV2aWNlX25vZGVfaWQgPSAxCmRldmljZV9iaXRyYXRlID0gNTAwMDAwCnBhcmFtX2RiX2NhY2hlID0gTm9uZQpzdHJlYW1pbmdfYWN0aXZlID0gRmFsc2UKCgojIC0tLSBHbG9iYWwgUGFyYW1ldGVycy9TcG90IFZhbHVlcyBTdG9yZSAtLS0KIyBQb3B1bGF0ZWQgZnJvbSBkZXZpY2Ugd2hlbiBjb25uZWN0ZWQKcGFyYW1ldGVycyA9IHt9CgoKZGVmIF9zZW5kX3Jlc3BvbnNlKGNtZCwgYXJnKToKICAgICIiIkludGVybmFsIGhlbHBlciB0byBzZW5kIEpTT04gcmVzcG9uc2UgdG8gV2ViUkVQTCBjbGllbnQgdmlhIFdlYlJFUEwgQmluYXJ5IFByb3RvY29sCiAgICAKICAgIFdpdGggV2ViUkVQTCBCaW5hcnkgUHJvdG9jb2wsIHJlc3BvbnNlcyBhcmUgdHJhY2tlZCBieSByZXF1ZXN0IElELCBzbyB3ZSBjYW4ganVzdAogICAgc2VuZCB0aGUgZGF0YSBkaXJlY3RseS4gRm9yIGJhY2t3YXJkIGNvbXBhdGliaWxpdHksIHdlIHN0aWxsIGFjY2VwdCBjbWQKICAgIHBhcmFtZXRlciBidXQgb25seSBwcmludCB0aGUgYXJnIGRhdGEuCiAgICAiIiIKICAgICMgV2ViUkVQTCBCaW5hcnkgUHJvdG9jb2w6IEp1c3Qgc2VuZCB0aGUgZGF0YSBkaXJlY3RseSAoY2xpZW50IHRyYWNrcyBieSByZXF1ZXN0IElEKQogICAgcHJpbnQoanNvbi5kdW1wcyhhcmcpKQoKCmRlZiBfc2VuZF9lcnJvcihtZXNzYWdlLCBjbWQpOgogICAgIiIiSW50ZXJuYWwgaGVscGVyIHRvIHNlbmQgZXJyb3IgcmVzcG9uc2UgdmlhIFdlYlJFUEwgQmluYXJ5IFByb3RvY29sIiIiCiAgICAjIFdlYlJFUEwgQmluYXJ5IFByb3RvY29sOiBTZW5kIGVycm9yIGFzIHNpbXBsZSBvYmplY3QKICAgIHByaW50KGpzb24uZHVtcHMoeydlcnJvcic6IG1lc3NhZ2V9KSkKCiMgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQojIENBTiBEZXZpY2UgSW5pdGlhbGl6YXRpb24gYW5kIE1hbmFnZW1lbnQKIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CgpkZWYgaW5pdGlhbGl6ZURldmljZShhcmdzPU5vbmUpOgogICAgIiIiCiAgICBJbml0aWFsaXplIENBTiBidXMgYW5kIGNvbm5lY3QgdG8gT3BlbkludmVydGVyIGRldmljZS4KICAgIAogICAgQXJncyAoZGljdCwgb3B0aW9uYWwpOgogICAgICAgIG5vZGVfaWQ6IENBTm9wZW4gbm9kZSBJRCAoZGVmYXVsdDogMSwgbXVzdCBiZSAxLTEyNykKICAgICAgICBiaXRyYXRlOiBDQU4gYnVzIGJpdHJhdGUgKGRlZmF1bHQ6IDUwMDAwMCkKICAgICAgICB0eF9waW46IFRYIEdQSU8gcGluIChkZWZhdWx0OiA1KQogICAgICAgIHJ4X3BpbjogUlggR1BJTyBwaW4gKGRlZmF1bHQ6IDQpCiAgICAgICAgbW9kZTogQ0FOIG1vZGUgKGRlZmF1bHQ6IENBTi5OT1JNQUwpCiAgICAKICAgIFJldHVybnM6CiAgICAgICAgQ29ubmVjdGlvbiBzdGF0dXMgYW5kIGRldmljZSBpbmZvCiAgICAiIiIKICAgIGdsb2JhbCBjYW5fZGV2LCBzZG9fY2xpZW50LCBkZXZpY2VfY29ubmVjdGVkLCBkZXZpY2Vfbm9kZV9pZCwgZGV2aWNlX2JpdHJhdGUKICAgIAogICAgIyBQYXJzZSBhcmd1bWVudHMKICAgIGlmIGFyZ3MgaXMgTm9uZToKICAgICAgICBhcmdzID0ge30KICAgIAogICAgbm9kZV9pZCA9IGFyZ3MuZ2V0KCdub2RlX2lkJywgMSkKICAgIAogICAgIyBSZWFsIGRldmljZSBtb2RlIC0gcmVxdWlyZXMgQ0FOIGhhcmR3YXJlCiAgICAjIENoZWNrIGlmIENBTiBtb2R1bGUgaXMgYXZhaWxhYmxlCiAgICBpZiBDQU4gaXMgTm9uZToKICAgICAgICBfc2VuZF9lcnJvcigiQ0FOIG1vZHVsZSBub3QgYXZhaWxhYmxlIG9uIHRoaXMgcGxhdGZvcm0iLCAnSU5JVC1ERVZJQ0UtRVJST1InKQogICAgICAgIHJldHVybgogICAgCiAgICBtb2RlID0gYXJncy5nZXQoJ21vZGUnLCBDQU4uTk9STUFMKQogICAgCiAgICAjIFJlYWQgQ0FOIGNvbmZpZ3VyYXRpb24gZnJvbSAvY29uZmlnL2Nhbi5qc29uICh3aXRoIGZhbGxiYWNrIHRvIG1haW4ucHkpCiAgICB0eF9waW4gPSBhcmdzLmdldCgndHhfcGluJykKICAgIHJ4X3BpbiA9IGFyZ3MuZ2V0KCdyeF9waW4nKQogICAgYml0cmF0ZSA9IGFyZ3MuZ2V0KCdiaXRyYXRlJykKICAgIAogICAgaWYgdHhfcGluIGlzIE5vbmUgb3IgcnhfcGluIGlzIE5vbmUgb3IgYml0cmF0ZSBpcyBOb25lOgogICAgICAgICMgVHJ5IHRvIGxvYWQgZnJvbSAvY29uZmlnL2Nhbi5qc29uCiAgICAgICAgdHJ5OgogICAgICAgICAgICBpbXBvcnQgb3MKICAgICAgICAgICAgY29uZmlnX2RpciA9ICcvY29uZmlnJwogICAgICAgICAgICBpZiBub3Qgb3MucGF0aC5leGlzdHMoY29uZmlnX2Rpcik6CiAgICAgICAgICAgICAgICBjb25maWdfZGlyID0gJy9zdG9yZS9jb25maWcnCiAgICAgICAgICAgIGNvbmZpZ19maWxlID0gY29uZmlnX2RpciArICcvY2FuLmpzb24nCiAgICAgICAgICAgIAogICAgICAgICAgICBpZiBvcy5wYXRoLmV4aXN0cyhjb25maWdfZmlsZSk6CiAgICAgICAgICAgICAgICBpbXBvcnQganNvbgogICAgICAgICAgICAgICAgd2l0aCBvcGVuKGNvbmZpZ19maWxlLCAncicpIGFzIGY6CiAgICAgICAgICAgICAgICAgICAgY2FuX2NvbmZpZyA9IGpzb24ubG9hZChmKQogICAgICAgICAgICAgICAgaWYgdHhfcGluIGlzIE5vbmU6CiAgICAgICAgICAgICAgICAgICAgdHhfcGluID0gY2FuX2NvbmZpZy5nZXQoJ3R4UGluJywgNSkKICAgICAgICAgICAgICAgIGlmIHJ4X3BpbiBpcyBOb25lOgogICAgICAgICAgICAgICAgICAgIHJ4X3BpbiA9IGNhbl9jb25maWcuZ2V0KCdyeFBpbicsIDQpCiAgICAgICAgICAgICAgICBpZiBiaXRyYXRlIGlzIE5vbmU6CiAgICAgICAgICAgICAgICAgICAgYml0cmF0ZSA9IGNhbl9jb25maWcuZ2V0KCdiaXRyYXRlJywgNTAwMDAwKQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgIyBGYWxsYmFjayB0byBtYWluLnB5CiAgICAgICAgICAgICAgICBpbXBvcnQgc3lzCiAgICAgICAgICAgICAgICBzeXMucGF0aC5pbnNlcnQoMCwgJy9kZXZpY2Ugc2NyaXB0cycpCiAgICAgICAgICAgICAgICBmcm9tIG1haW4gaW1wb3J0IENBTl9UWF9QSU4sIENBTl9SWF9QSU4sIENBTl9CSVRSQVRFCiAgICAgICAgICAgICAgICBpZiB0eF9waW4gaXMgTm9uZToKICAgICAgICAgICAgICAgICAgICB0eF9waW4gPSBDQU5fVFhfUElOCiAgICAgICAgICAgICAgICBpZiByeF9waW4gaXMgTm9uZToKICAgICAgICAgICAgICAgICAgICByeF9waW4gPSBDQU5fUlhfUElOCiAgICAgICAgICAgICAgICBpZiBiaXRyYXRlIGlzIE5vbmU6CiAgICAgICAgICAgICAgICAgICAgYml0cmF0ZSA9IENBTl9CSVRSQVRFCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBpZiB0eF9waW4gaXMgTm9uZToKICAgICAgICAgICAgICAgIHR4X3BpbiA9IDUKICAgICAgICAgICAgaWYgcnhfcGluIGlzIE5vbmU6CiAgICAgICAgICAgICAgICByeF9waW4gPSA0CiAgICAgICAgICAgIGlmIGJpdHJhdGUgaXMgTm9uZToKICAgICAgICAgICAgICAgIGJpdHJhdGUgPSA1MDAwMDAKICAgIAogICAgdHJ5OgogICAgICAgICMgSW5pdGlhbGl6ZSBDQU4gZGV2aWNlCiAgICAgICAgY2FuX2RldiA9IENBTigwLCBleHRmcmFtZT1GYWxzZSwgdHg9dHhfcGluLCByeD1yeF9waW4sIG1vZGU9bW9kZSwgYml0cmF0ZT1iaXRyYXRlLCBhdXRvX3Jlc3RhcnQ9RmFsc2UpCiAgICAgICAgCiAgICAgICAgIyBDcmVhdGUgU0RPIGNsaWVudAogICAgICAgIHNkb19jbGllbnQgPSBTRE9DbGllbnQoY2FuX2Rldiwgbm9kZV9pZD1ub2RlX2lkLCB0aW1lb3V0PTEuMCkKICAgICAgICAKICAgICAgICBkZXZpY2VfY29ubmVjdGVkID0gVHJ1ZQogICAgICAgIGRldmljZV9ub2RlX2lkID0gbm9kZV9pZAogICAgICAgIGRldmljZV9iaXRyYXRlID0gYml0cmF0ZQogICAgICAgIAogICAgICAgIAogICAgICAgICMgVHJ5IHRvIHJlYWQgYSBiYXNpYyBwYXJhbWV0ZXIgdG8gdmVyaWZ5IGNvbm5lY3Rpb24KICAgICAgICB0cnk6CiAgICAgICAgICAgICMgUmVhZCB1cHRpbWUgb3IgYW5vdGhlciBzYWZlIHNwb3QgdmFsdWUgdG8gdmVyaWZ5IGNvbm5lY3Rpb24KICAgICAgICAgICAgIyBGb3Igbm93LCBqdXN0IGNvbmZpcm0gaW5pdGlhbGl6YXRpb24KICAgICAgICAgICAgX3NlbmRfcmVzcG9uc2UoJ0RFVklDRS1JTklUSUFMSVpFRCcsIHsKICAgICAgICAgICAgICAgICdzdWNjZXNzJzogVHJ1ZSwKICAgICAgICAgICAgICAgICdub2RlX2lkJzogbm9kZV9pZCwKICAgICAgICAgICAgICAgICdiaXRyYXRlJzogYml0cmF0ZSwKICAgICAgICAgICAgICAgICdjb25uZWN0ZWQnOiBUcnVlCiAgICAgICAgICAgIH0pCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBfc2VuZF9yZXNwb25zZSgnREVWSUNFLUlOSVRJQUxJWkVEJywgewogICAgICAgICAgICAgICAgJ3N1Y2Nlc3MnOiBUcnVlLAogICAgICAgICAgICAgICAgJ25vZGVfaWQnOiBub2RlX2lkLAogICAgICAgICAgICAgICAgJ2JpdHJhdGUnOiBiaXRyYXRlLAogICAgICAgICAgICAgICAgJ2Nvbm5lY3RlZCc6IEZhbHNlLAogICAgICAgICAgICAgICAgJ3dhcm5pbmcnOiAnQ0FOIGluaXRpYWxpemVkIGJ1dCBkZXZpY2Ugbm90IHJlc3BvbmRpbmcnCiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIAogICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICMgTG9nIGVycm9yIChwcmludCgpIG91dHB1dCBnb2VzIHRvIE0yTSBjaGFubmVsIGF1dG9tYXRpY2FsbHkpCiAgICAgICAgcHJpbnQoZiJbT0ldIEVycm9yIGluaXRpYWxpemluZyBDQU46IHtlfSIpCiAgICAgICAgZGV2aWNlX2Nvbm5lY3RlZCA9IEZhbHNlCiAgICAgICAgZXJyb3JfbXNnID0gc3RyKGUpCiAgICAgICAgX3NlbmRfZXJyb3IoZiJGYWlsZWQgdG8gaW5pdGlhbGl6ZSBDQU46IHtlcnJvcl9tc2d9IiwgJ0lOSVQtREVWSUNFLUVSUk9SJykKCgpkZWYgZGlzY29ubmVjdERldmljZSgpOgogICAgIiIiCiAgICBEaXNjb25uZWN0IGZyb20gQ0FOIGJ1cyBhbmQgcmVsZWFzZSByZXNvdXJjZXMuCiAgICAiIiIKICAgIGdsb2JhbCBjYW5fZGV2LCBzZG9fY2xpZW50LCBkZXZpY2VfY29ubmVjdGVkLCBzdHJlYW1pbmdfYWN0aXZlCiAgICAKICAgIGlmIHN0cmVhbWluZ19hY3RpdmU6CiAgICAgICAgIyBTdG9wIHN0cmVhbWluZyBmaXJzdAogICAgICAgIHN0b3BMaXZlU3RyZWFtaW5nKCkKICAgIAogICAgZGV2aWNlX2Nvbm5lY3RlZCA9IEZhbHNlCiAgICBzZG9fY2xpZW50ID0gTm9uZQogICAgCiAgICAjIENBTiBkZXZpY2UgY2xlYW51cCB3b3VsZCBnbyBoZXJlIGlmIG5lZWRlZAogICAgIyBGb3Igbm93LCBqdXN0IG1hcmsgYXMgZGlzY29ubmVjdGVkCgoKZGVmIGdldERldmljZVN0YXR1cygpOgogICAgIiIiCiAgICBHZXQgY3VycmVudCBkZXZpY2UgY29ubmVjdGlvbiBzdGF0dXMuCiAgICAiIiIKICAgIHN0YXR1cyA9IHsKICAgICAgICAnY29ubmVjdGVkJzogZGV2aWNlX2Nvbm5lY3RlZCwKICAgICAgICAnY2FuX2F2YWlsYWJsZSc6IENBTiBpcyBub3QgTm9uZSwKICAgICAgICAnbm9kZV9pZCc6IGRldmljZV9ub2RlX2lkLAogICAgICAgICdiaXRyYXRlJzogZGV2aWNlX2JpdHJhdGUsCiAgICAgICAgJ3N0cmVhbWluZ19hY3RpdmUnOiBzdHJlYW1pbmdfYWN0aXZlCiAgICB9CiAgICAKICAgIF9zZW5kX3Jlc3BvbnNlKCdERVZJQ0UtU1RBVFVTJywgc3RhdHVzKQoKCmRlZiBmZXRjaFBhcmFtZXRlckRhdGFiYXNlKCk6CiAgICAiIiIKICAgIEZldGNoIHBhcmFtZXRlciBkYXRhYmFzZSBmcm9tIE9wZW5JbnZlcnRlciBkZXZpY2UuCiAgICAKICAgIFRoZSBwYXJhbWV0ZXIgZGF0YWJhc2UgaXMgc3RvcmVkIGFzIGEgSlNPTiBzdHJpbmcgaW4gdGhlIGRldmljZQogICAgYXQgU0RPIGluZGV4IDB4MTAyMS4gVGhpcyBjb250YWlucyBkZWZpbml0aW9ucyBmb3IgYWxsIHBhcmFtZXRlcnMKICAgIGFuZCBzcG90IHZhbHVlcyB3aXRoIHRoZWlyIHVuaXRzLCByYW5nZXMsIGNhdGVnb3JpZXMsIGV0Yy4KICAgIAogICAgUmV0dXJuczoKICAgICAgICBEaWN0aW9uYXJ5IG9mIHBhcmFtZXRlciBkZWZpbml0aW9ucwogICAgIiIiCiAgICBnbG9iYWwgcGFyYW1fZGJfY2FjaGUsIHBhcmFtZXRlcnMKICAgIAogICAgaWYgbm90IGRldmljZV9jb25uZWN0ZWQgb3Igc2RvX2NsaWVudCBpcyBOb25lOgogICAgICAgIF9zZW5kX2Vycm9yKCJEZXZpY2Ugbm90IGNvbm5lY3RlZCIsICdGRVRDSC1QQVJBTS1EQi1FUlJPUicpCiAgICAgICAgcmV0dXJuCiAgICAKICAgIHRyeToKICAgICAgICAjIFBhcmFtZXRlciBkYXRhYmFzZSBpcyBhdCBTRE8gMHgxMDIxLCBzdWJpbmRleCAwCiAgICAgICAgIyBJdCdzIHN0b3JlZCBhcyBhIGxhcmdlIEpTT04gc3RyaW5nLCBzbyB3ZSBuZWVkIHRvIHJlYWQgaXQgaW4gY2h1bmtzCiAgICAgICAgIyBGb3Igbm93LCB3ZSdsbCB1c2UgYSBzaW1wbGlmaWVkIGFwcHJvYWNoCiAgICAgICAgCiAgICAgICAgIyBOb3RlOiBPcGVuSW52ZXJ0ZXIgbWF5IHN0b3JlIHRoZSBEQiBkaWZmZXJlbnRseSwgdGhpcyBpcyBhIHBsYWNlaG9sZGVyCiAgICAgICAgIyBUaGUgYWN0dWFsIGltcGxlbWVudGF0aW9uIHdvdWxkIG5lZWQgdG8gcmVhZCB0aGUgSlNPTiBkYXRhYmFzZQogICAgICAgICMgd2hpY2ggbWlnaHQgYmUgbXVsdGlwbGUgU0RPIG9iamVjdHMgb3IgYSBmaWxlIHRyYW5zZmVyCiAgICAgICAgCiAgICAgICAgIyBGb3Igbm93LCByZXR1cm4gZXJyb3IgYXMgdGhpcyBuZWVkcyBkZXZpY2Utc3BlY2lmaWMgaW1wbGVtZW50YXRpb24KICAgICAgICBfc2VuZF9lcnJvcigiUGFyYW1ldGVyIGRhdGFiYXNlIGZldGNoaW5nIG5vdCB5ZXQgaW1wbGVtZW50ZWQgZm9yIHJlYWwgaGFyZHdhcmUiLCAnRkVUQ0gtUEFSQU0tREItRVJST1InKQogICAgICAgIAogICAgICAgICMgVE9ETzogSW1wbGVtZW50IGFjdHVhbCBEQiBmZXRjaGluZwogICAgICAgICMgVGhlIG9wZW5pbnZlcnRlci1jYW4tdG9vbCBkb2VzIHRoaXMgdmlhOgogICAgICAgICMgMS4gUmVhZGluZyBjaHVua3Mgb2YgZGF0YSBmcm9tIGRldmljZQogICAgICAgICMgMi4gQXNzZW1ibGluZyBKU09OIHN0cmluZwogICAgICAgICMgMy4gUGFyc2luZyB0byBnZXQgcGFyYW1ldGVyIGRlZmluaXRpb25zCiAgICAgICAgCiAgICBleGNlcHQgU0RPVGltZW91dEVycm9yIGFzIGU6CiAgICAgICAgIyBTaWxlbnQgLSBlcnJvcnMgc2VudCB2aWEgX3NlbmRfZXJyb3IoKQogICAgICAgIF9zZW5kX2Vycm9yKHN0cihlKSwgJ0ZFVENILVBBUkFNLURCLUVSUk9SJykKICAgIGV4Y2VwdCBTRE9BYm9ydEVycm9yIGFzIGU6CiAgICAgICAgIyBTaWxlbnQgLSBlcnJvcnMgc2VudCB2aWEgX3NlbmRfZXJyb3IoKQogICAgICAgIF9zZW5kX2Vycm9yKHN0cihlKSwgJ0ZFVENILVBBUkFNLURCLUVSUk9SJykKICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAjIFNpbGVudCAtIGVycm9ycyBzZW50IHZpYSBfc2VuZF9lcnJvcigpCiAgICAgICAgX3NlbmRfZXJyb3Ioc3RyKGUpLCAnRkVUQ0gtUEFSQU0tREItRVJST1InKQoKCmRlZiBsb2FkUGFyYW1ldGVyRGF0YWJhc2UoanNvbl9kYik6CiAgICAiIiIKICAgIExvYWQgcGFyYW1ldGVyIGRhdGFiYXNlIGZyb20gSlNPTiBzdHJ1Y3R1cmUuCiAgICAKICAgIEFyZ3M6CiAgICAgICAganNvbl9kYjogRGljdGlvbmFyeSBjb250YWluaW5nIHBhcmFtZXRlciBkZWZpbml0aW9ucwogICAgCiAgICBNZXJnZXMgcGFyYW1ldGVyIGRhdGFiYXNlIG1ldGFkYXRhIChJRHMsIHVuaXRzLCBjYXRlZ29yaWVzLCBldGMuKSBpbnRvIGV4aXN0aW5nIHBhcmFtZXRlcnMgZGljdGlvbmFyeS4KICAgIFByZXNlcnZlcyBleGlzdGluZyB2YWx1ZXMgYW5kIG90aGVyIGZpZWxkcy4KICAgICIiIgogICAgZ2xvYmFsIHBhcmFtZXRlcnMsIHBhcmFtX2RiX2NhY2hlCiAgICAKICAgIHRyeToKICAgICAgICAjIE1lcmdlIGRhdGFiYXNlIG1ldGFkYXRhIGludG8gZXhpc3RpbmcgcGFyYW1ldGVycyAoZG9uJ3QgcmVwbGFjZSBlbnRpcmVseSkKICAgICAgICBmb3IgcGFyYW1fbmFtZSwgcGFyYW1fZGVmIGluIGpzb25fZGIuaXRlbXMoKToKICAgICAgICAgICAgaWYgcGFyYW1fbmFtZSBpbiBwYXJhbWV0ZXJzOgogICAgICAgICAgICAgICAgIyBVcGRhdGUgZXhpc3RpbmcgcGFyYW1ldGVyIHdpdGggZGF0YWJhc2UgbWV0YWRhdGEKICAgICAgICAgICAgICAgIGlmICdpZCcgaW4gcGFyYW1fZGVmOgogICAgICAgICAgICAgICAgICAgIHBhcmFtZXRlcnNbcGFyYW1fbmFtZV1bJ2lkJ10gPSBwYXJhbV9kZWZbJ2lkJ10KICAgICAgICAgICAgICAgIGlmICd1bml0JyBpbiBwYXJhbV9kZWY6CiAgICAgICAgICAgICAgICAgICAgcGFyYW1ldGVyc1twYXJhbV9uYW1lXVsndW5pdCddID0gcGFyYW1fZGVmWyd1bml0J10KICAgICAgICAgICAgICAgIGlmICdjYXRlZ29yeScgaW4gcGFyYW1fZGVmOgogICAgICAgICAgICAgICAgICAgIHBhcmFtZXRlcnNbcGFyYW1fbmFtZV1bJ2NhdGVnb3J5J10gPSBwYXJhbV9kZWZbJ2NhdGVnb3J5J10KICAgICAgICAgICAgICAgIGlmICdpc3BhcmFtJyBpbiBwYXJhbV9kZWY6CiAgICAgICAgICAgICAgICAgICAgcGFyYW1ldGVyc1twYXJhbV9uYW1lXVsnaXNwYXJhbSddID0gcGFyYW1fZGVmWydpc3BhcmFtJ10KICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBGb3IgcGFyYW1ldGVycywgdXBkYXRlIG1pbi9tYXgvZGVmYXVsdCBpZiBwcm92aWRlZAogICAgICAgICAgICAgICAgaWYgcGFyYW1ldGVyc1twYXJhbV9uYW1lXS5nZXQoJ2lzcGFyYW0nKToKICAgICAgICAgICAgICAgICAgICBpZiAnbWluaW11bScgaW4gcGFyYW1fZGVmOgogICAgICAgICAgICAgICAgICAgICAgICBwYXJhbWV0ZXJzW3BhcmFtX25hbWVdWydtaW5pbXVtJ10gPSBwYXJhbV9kZWZbJ21pbmltdW0nXQogICAgICAgICAgICAgICAgICAgIGlmICdtYXhpbXVtJyBpbiBwYXJhbV9kZWY6CiAgICAgICAgICAgICAgICAgICAgICAgIHBhcmFtZXRlcnNbcGFyYW1fbmFtZV1bJ21heGltdW0nXSA9IHBhcmFtX2RlZlsnbWF4aW11bSddCiAgICAgICAgICAgICAgICAgICAgaWYgJ2RlZmF1bHQnIGluIHBhcmFtX2RlZjoKICAgICAgICAgICAgICAgICAgICAgICAgcGFyYW1ldGVyc1twYXJhbV9uYW1lXVsnZGVmYXVsdCddID0gcGFyYW1fZGVmWydkZWZhdWx0J10KICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBQYXJzZSBlbnVtZXJhdGlvbnMgZnJvbSB1bml0IHN0cmluZyBpZiBwcmVzZW50CiAgICAgICAgICAgICAgICAjIEZvcm1hdDogIjA9T2ZmIDE9T24gMj1BdXRvIgogICAgICAgICAgICAgICAgdW5pdCA9IHBhcmFtX2RlZi5nZXQoJ3VuaXQnLCAnJykKICAgICAgICAgICAgICAgIGlmICc9JyBpbiB1bml0OgogICAgICAgICAgICAgICAgICAgIGVudW1zID0ge30KICAgICAgICAgICAgICAgICAgICBmb3IgcGFydCBpbiB1bml0LnNwbGl0KCk6CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICc9JyBpbiBwYXJ0OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbCwgbmFtZSA9IHBhcnQuc3BsaXQoJz0nLCAxKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVudW1zW2ludCh2YWwpXSA9IG5hbWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXNzCiAgICAgICAgICAgICAgICAgICAgaWYgZW51bXM6CiAgICAgICAgICAgICAgICAgICAgICAgIHBhcmFtZXRlcnNbcGFyYW1fbmFtZV1bJ2VudW1zJ10gPSBlbnVtcwogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgIyBOZXcgcGFyYW1ldGVyIG5vdCBpbiBleGlzdGluZyBkaWN0aW9uYXJ5IC0gY3JlYXRlIGl0CiAgICAgICAgICAgICAgICBwYXJhbSA9IHsKICAgICAgICAgICAgICAgICAgICAndW5pdCc6IHBhcmFtX2RlZi5nZXQoJ3VuaXQnLCAnJyksCiAgICAgICAgICAgICAgICAgICAgJ2lzcGFyYW0nOiBwYXJhbV9kZWYuZ2V0KCdpc3BhcmFtJywgRmFsc2UpLAogICAgICAgICAgICAgICAgICAgICdjYXRlZ29yeSc6IHBhcmFtX2RlZi5nZXQoJ2NhdGVnb3J5JywgJ1VuY2F0ZWdvcml6ZWQnKSwKICAgICAgICAgICAgICAgICAgICAnaWQnOiBwYXJhbV9kZWYuZ2V0KCdpZCcpLAogICAgICAgICAgICAgICAgICAgICd2YWx1ZSc6IHBhcmFtX2RlZi5nZXQoJ2RlZmF1bHQnLCAwKSBpZiBwYXJhbV9kZWYuZ2V0KCdpc3BhcmFtJykgZWxzZSAwCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgRm9yIHBhcmFtZXRlcnMsIGFkZCBtaW4vbWF4L2RlZmF1bHQKICAgICAgICAgICAgICAgIGlmIHBhcmFtWydpc3BhcmFtJ106CiAgICAgICAgICAgICAgICAgICAgcGFyYW1bJ21pbmltdW0nXSA9IHBhcmFtX2RlZi5nZXQoJ21pbmltdW0nLCAwKQogICAgICAgICAgICAgICAgICAgIHBhcmFtWydtYXhpbXVtJ10gPSBwYXJhbV9kZWYuZ2V0KCdtYXhpbXVtJywgMCkKICAgICAgICAgICAgICAgICAgICBwYXJhbVsnZGVmYXVsdCddID0gcGFyYW1fZGVmLmdldCgnZGVmYXVsdCcsIDApCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgUGFyc2UgZW51bWVyYXRpb25zIGZyb20gdW5pdCBzdHJpbmcgaWYgcHJlc2VudAogICAgICAgICAgICAgICAgdW5pdCA9IHBhcmFtX2RlZi5nZXQoJ3VuaXQnLCAnJykKICAgICAgICAgICAgICAgIGlmICc9JyBpbiB1bml0OgogICAgICAgICAgICAgICAgICAgIGVudW1zID0ge30KICAgICAgICAgICAgICAgICAgICBmb3IgcGFydCBpbiB1bml0LnNwbGl0KCk6CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICc9JyBpbiBwYXJ0OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbCwgbmFtZSA9IHBhcnQuc3BsaXQoJz0nLCAxKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVudW1zW2ludCh2YWwpXSA9IG5hbWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXNzCiAgICAgICAgICAgICAgICAgICAgaWYgZW51bXM6CiAgICAgICAgICAgICAgICAgICAgICAgIHBhcmFtWydlbnVtcyddID0gZW51bXMKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgcGFyYW1ldGVyc1twYXJhbV9uYW1lXSA9IHBhcmFtCiAgICAgICAgCiAgICAgICAgcGFyYW1fZGJfY2FjaGUgPSBqc29uX2RiCiAgICAgICAgCiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgIyBTaWxlbnQgLSBlcnJvcnMgc2VudCB2aWEgX3NlbmRfZXJyb3IoKQogICAgICAgIF9zZW5kX2Vycm9yKHN0cihlKSwgJ1BBUkFNLURCLUxPQUQtRVJST1InKQoKCmRlZiBnZXRPaVBhcmFtcygpOgogICAgIiIiCiAgICBHZXQgbGlzdCBvZiBhbGwgcGFyYW1ldGVycyAoaXNwYXJhbT1UcnVlKS4KICAgIFNlbmRzIHRoZSByZXN1bHQgZGlyZWN0bHkgdG8gdGhlIFdlYlJFUEwgY2xpZW50IGFzIEpTT04uCiAgICAKICAgIFJlYWRzIGN1cnJlbnQgdmFsdWVzIHZpYSBTRE8gZnJvbSBjb25uZWN0ZWQgZGV2aWNlLgogICAgIiIiCiAgICBpZiBub3QgZGV2aWNlX2Nvbm5lY3RlZCBvciBzZG9fY2xpZW50IGlzIE5vbmUgb3IgQ0FOIGlzIE5vbmU6CiAgICAgICAgX3NlbmRfZXJyb3IoIkRldmljZSBub3QgY29ubmVjdGVkIiwgJ0dFVC1QQVJBTVMtRVJST1InKQogICAgICAgIHJldHVybgogICAgCiAgICBwYXJhbV9saXN0ID0ge30KICAgIAogICAgdHJ5OgogICAgICAgIGZvciBrZXksIGl0ZW0gaW4gcGFyYW1ldGVycy5pdGVtcygpOgogICAgICAgICAgICBpZiBpdGVtLmdldCgnaXNwYXJhbScpID09IFRydWU6CiAgICAgICAgICAgICAgICAjIFJlYWQgY3VycmVudCB2YWx1ZSBmcm9tIGRldmljZQogICAgICAgICAgICAgICAgcGFyYW1faWQgPSBpdGVtLmdldCgnaWQnKQogICAgICAgICAgICAgICAgaWYgcGFyYW1faWQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgICAgICBpbmRleCwgc3ViaW5kZXggPSBwYXJhbV9pZF90b19zZG8ocGFyYW1faWQpCiAgICAgICAgICAgICAgICAgICAgICAgIHJhd192YWx1ZSA9IHNkb19jbGllbnQucmVhZChpbmRleCwgc3ViaW5kZXgpCiAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW1bJ3ZhbHVlJ10gPSBmaXhlZF90b19mbG9hdChyYXdfdmFsdWUpCiAgICAgICAgICAgICAgICAgICAgZXhjZXB0IChTRE9UaW1lb3V0RXJyb3IsIFNET0Fib3J0RXJyb3IpIGFzIGU6CiAgICAgICAgICAgICAgICAgICAgICAgICMgS2VlcCBleGlzdGluZyB2YWx1ZQogICAgICAgICAgICAgICAgICAgICAgICBwYXNzCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIHBhcmFtX2xpc3Rba2V5XSA9IGl0ZW0KICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICBfc2VuZF9lcnJvcihzdHIoZSksICdHRVQtUEFSQU1TLUVSUk9SJykKICAgICAgICByZXR1cm4KICAgIAogICAgIyBBbHdheXMgc2VuZCByZXNwb25zZSwgZXZlbiBpZiBlbXB0eQogICAgdHJ5OgogICAgICAgIF9zZW5kX3Jlc3BvbnNlKCdQQVJBTUVURVJTLUxJU1QnLCBwYXJhbV9saXN0KQogICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICMgSWYgc2VuZGluZyBmYWlscywgdHJ5IHRvIHNlbmQgZXJyb3IgcmVzcG9uc2UKICAgICAgICB0cnk6CiAgICAgICAgICAgIF9zZW5kX2Vycm9yKGYiRmFpbGVkIHRvIHNlbmQgcGFyYW1ldGVycyBsaXN0OiB7c3RyKGUpfSIsICdQQVJBTUVURVJTLUxJU1QtRVJST1InKQogICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgcGFzcyAgIyBTaWxlbnQgZmFpbHVyZQoKCmRlZiBzZXRQYXJhbWV0ZXIoYXJncyk6CiAgICAiIiIKICAgIFNldCBhIHNpbmdsZSBwYXJhbWV0ZXIgdmFsdWUuCiAgICAKICAgIEFyZ3MgKGRpY3QpOgogICAgICAgIE5BTUU6IFBhcmFtZXRlciBuYW1lCiAgICAgICAgVkFMVUU6IE5ldyB2YWx1ZQogICAgCiAgICBTZW5kcyB0aGUgdXBkYXRlZCBwYXJhbWV0ZXIgb3IgZXJyb3IgdG8gV2ViUkVQTCBjbGllbnQuCiAgICAiIiIKICAgIHBhcmFtX25hbWUgPSBhcmdzLmdldCgnTkFNRScpCiAgICBwYXJhbV92YWx1ZSA9IGFyZ3MuZ2V0KCdWQUxVRScpCiAgICAKICAgIGlmIHBhcmFtX25hbWUgaXMgTm9uZSBvciBwYXJhbV92YWx1ZSBpcyBOb25lOgogICAgICAgIF9zZW5kX2Vycm9yKCJNaXNzaW5nIE5BTUUgb3IgVkFMVUUgZm9yIFNFVC1QQVJBTUVURVIiLCAnU0VULVBBUkFNRVRFUi1FUlJPUicpCiAgICAgICAgcmV0dXJuCiAgICAKICAgIGlmIHBhcmFtX25hbWUgaW4gcGFyYW1ldGVycyBhbmQgcGFyYW1ldGVyc1twYXJhbV9uYW1lXS5nZXQoJ2lzcGFyYW0nKSA9PSBUcnVlOgogICAgICAgICMgVmFsaWRhdGUgdmFsdWUgYWdhaW5zdCBtaW4vbWF4IGlmIHByZXNlbnQKICAgICAgICBwYXJhbV9kZWYgPSBwYXJhbWV0ZXJzW3BhcmFtX25hbWVdCiAgICAgICAgCiAgICAgICAgaWYgJ21pbmltdW0nIGluIHBhcmFtX2RlZiBhbmQgcGFyYW1fdmFsdWUgPCBwYXJhbV9kZWZbJ21pbmltdW0nXToKICAgICAgICAgICAgX3NlbmRfZXJyb3IoZiJWYWx1ZSB7cGFyYW1fdmFsdWV9IGJlbG93IG1pbmltdW0ge3BhcmFtX2RlZlsnbWluaW11bSddfSIsICdTRVQtUEFSQU1FVEVSLUVSUk9SJykKICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgCiAgICAgICAgaWYgJ21heGltdW0nIGluIHBhcmFtX2RlZiBhbmQgcGFyYW1fdmFsdWUgPiBwYXJhbV9kZWZbJ21heGltdW0nXToKICAgICAgICAgICAgX3NlbmRfZXJyb3IoZiJWYWx1ZSB7cGFyYW1fdmFsdWV9IGFib3ZlIG1heGltdW0ge3BhcmFtX2RlZlsnbWF4aW11bSddfSIsICdTRVQtUEFSQU1FVEVSLUVSUk9SJykKICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgCiAgICAgICAgIyBWYWxpZGF0ZSBlbnVtIGlmIHByZXNlbnQKICAgICAgICBpZiAnZW51bXMnIGluIHBhcmFtX2RlZiBhbmQgcGFyYW1fdmFsdWUgbm90IGluIHBhcmFtX2RlZlsnZW51bXMnXToKICAgICAgICAgICAgX3NlbmRfZXJyb3IoZiJWYWx1ZSB7cGFyYW1fdmFsdWV9IG5vdCBpbiB2YWxpZCBlbnVtcyIsICdTRVQtUEFSQU1FVEVSLUVSUk9SJykKICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgCiAgICAgICAgICAgICAgICAKICAgICAgICAjIFdyaXRlIHZpYSBTRE8KICAgICAgICBpZiBub3QgZGV2aWNlX2Nvbm5lY3RlZCBvciBzZG9fY2xpZW50IGlzIE5vbmUgb3IgQ0FOIGlzIE5vbmU6CiAgICAgICAgICAgIF9zZW5kX2Vycm9yKCJEZXZpY2Ugbm90IGNvbm5lY3RlZCIsICdTRVQtUEFSQU1FVEVSLUVSUk9SJykKICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgCiAgICAgICAgcGFyYW1faWQgPSBwYXJhbV9kZWYuZ2V0KCdpZCcpCiAgICAgICAgaWYgcGFyYW1faWQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIGluZGV4LCBzdWJpbmRleCA9IHBhcmFtX2lkX3RvX3NkbyhwYXJhbV9pZCkKICAgICAgICAgICAgICAgIGZpeGVkX3ZhbHVlID0gZmxvYXRfdG9fZml4ZWQocGFyYW1fdmFsdWUpCiAgICAgICAgICAgICAgICBzZG9fY2xpZW50LndyaXRlKGluZGV4LCBzdWJpbmRleCwgZml4ZWRfdmFsdWUpCiAgICAgICAgICAgIGV4Y2VwdCBTRE9UaW1lb3V0RXJyb3IgYXMgZToKICAgICAgICAgICAgICAgIF9zZW5kX2Vycm9yKGYiVGltZW91dCB3cml0aW5nIHBhcmFtZXRlcjoge3N0cihlKX0iLCAnU0VULVBBUkFNRVRFUi1FUlJPUicpCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgZXhjZXB0IFNET0Fib3J0RXJyb3IgYXMgZToKICAgICAgICAgICAgICAgIF9zZW5kX2Vycm9yKGYiRGV2aWNlIHJlamVjdGVkIHBhcmFtZXRlcjoge3N0cihlKX0iLCAnU0VULVBBUkFNRVRFUi1FUlJPUicpCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICAgICAgX3NlbmRfZXJyb3IoZiJFcnJvciB3cml0aW5nIHBhcmFtZXRlcjoge3N0cihlKX0iLCAnU0VULVBBUkFNRVRFUi1FUlJPUicpCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAKICAgICAgICAjIFVwZGF0ZSBjYWNoZWQgdmFsdWUKICAgICAgICBwYXJhbWV0ZXJzW3BhcmFtX25hbWVdWyd2YWx1ZSddID0gcGFyYW1fdmFsdWUKICAgICAgICAKICAgICAgICB1cGRhdGVkX3BhcmFtID0ge3BhcmFtX25hbWU6IHBhcmFtZXRlcnNbcGFyYW1fbmFtZV19CiAgICAgICAgX3NlbmRfcmVzcG9uc2UoJ1BBUkFNRVRFUi1VUERBVEVEJywgdXBkYXRlZF9wYXJhbSkKICAgIGVsc2U6CiAgICAgICAgX3NlbmRfZXJyb3IoZiJJbnZhbGlkIG9yIG5vbi1wYXJhbWV0ZXIgbmFtZToge3BhcmFtX25hbWV9IiwgJ1NFVC1QQVJBTUVURVItRVJST1InKQoKCmRlZiBzYXZlUGFyYW1ldGVycygpOgogICAgIiIiCiAgICBTYXZlIHBhcmFtZXRlcnMgdG8gcGVyc2lzdGVudCBzdG9yYWdlLgogICAgCiAgICBUT0RPOiBJbXBsZW1lbnQgYWN0dWFsIHNhdmluZyBsb2dpYyAoZS5nLiwgdG8gTlZTLCBKU09OIGZpbGUgb24gZmxhc2gpCiAgICBGb3Igbm93LCBqdXN0IGFja25vd2xlZGdlcyB0aGUgc2F2ZSByZXF1ZXN0LgogICAgIiIiCiAgICAgICAgIyBUT0RPOiBJbXBsZW1lbnQgYWN0dWFsIHNhdmluZyBsb2dpYwogICAgIyBFeGFtcGxlOgogICAgIyBpbXBvcnQganNvbgogICAgIyB3aXRoIG9wZW4oJy9mbGFzaC9vaV9wYXJhbXMuanNvbicsICd3JykgYXMgZjoKICAgICMgICAgIGpzb24uZHVtcCh7azogdiBmb3IgaywgdiBpbiBwYXJhbWV0ZXJzLml0ZW1zKCkgaWYgdi5nZXQoJ2lzcGFyYW0nKX0sIGYpCgoKZGVmIGdldEFsbFBhcmFtc1dpdGhJZHMoKToKICAgICIiIgogICAgR2V0IGFsbCBwYXJhbWV0ZXJzIGFuZCBzcG90IHZhbHVlcyB0aGF0IGhhdmUgSURzIChmb3IgQ0FOIG1hcHBpbmcpLgogICAgUmV0dXJucyBib3RoIHBhcmFtZXRlcnMgKGlzcGFyYW09VHJ1ZSkgYW5kIHNwb3QgdmFsdWVzIChpc3BhcmFtPUZhbHNlKSB0aGF0IGhhdmUgSURzLgogICAgCiAgICBJZiBwYXJhbWV0ZXIgZGF0YWJhc2UgaGFzbid0IGJlZW4gbG9hZGVkIHlldCwgdHJpZXMgdG8gZmV0Y2ggaXQgZmlyc3QuCiAgICAiIiIKICAgIGdsb2JhbCBwYXJhbWV0ZXJzCiAgICAKICAgIGlmIG5vdCBkZXZpY2VfY29ubmVjdGVkIG9yIHNkb19jbGllbnQgaXMgTm9uZToKICAgICAgICBfc2VuZF9lcnJvcigiRGV2aWNlIG5vdCBjb25uZWN0ZWQiLCAnR0VULUFMTC1QQVJBTVMtRVJST1InKQogICAgICAgIHJldHVybgogICAgCiAgICAjIElmIHBhcmFtZXRlciBkYXRhYmFzZSBoYXNuJ3QgYmVlbiBsb2FkZWQsIHRyeSB0byBmZXRjaCBpdAogICAgaWYgcGFyYW1fZGJfY2FjaGUgaXMgTm9uZToKICAgICAgICB0cnk6CiAgICAgICAgICAgIGZldGNoUGFyYW1ldGVyRGF0YWJhc2UoKQogICAgICAgIGV4Y2VwdCBFeGNlcHRpb246CiAgICAgICAgICAgICMgSWYgZmV0Y2ggZmFpbHMsIHJldHVybiBlcnJvcgogICAgICAgICAgICBfc2VuZF9lcnJvcigiRmFpbGVkIHRvIGZldGNoIHBhcmFtZXRlciBkYXRhYmFzZSIsICdHRVQtQUxMLVBBUkFNUy1FUlJPUicpCiAgICAgICAgICAgIHJldHVybgogICAgCiAgICBhbGxfcGFyYW1zID0ge30KICAgIAogICAgZm9yIGtleSwgaXRlbSBpbiBwYXJhbWV0ZXJzLml0ZW1zKCk6CiAgICAgICAgIyBPbmx5IGluY2x1ZGUgaXRlbXMgdGhhdCBoYXZlIGFuIElEIChyZXF1aXJlZCBmb3IgQ0FOIG1hcHBpbmcpCiAgICAgICAgaWYgaXRlbS5nZXQoJ2lkJykgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIGFsbF9wYXJhbXNba2V5XSA9IGl0ZW0KICAgIAogICAgX3NlbmRfcmVzcG9uc2UoJ0FMTC1QQVJBTVMtV0lUSC1JRFMnLCBhbGxfcGFyYW1zKQoKCmRlZiBnZXRQYXJhbWV0ZXJzRm9yRG93bmxvYWQoKToKICAgICIiIgogICAgR2V0IGFsbCBwYXJhbWV0ZXJzIGZvciBleHBvcnQvZG93bmxvYWQuCiAgICBTYW1lIGFzIGdldE9pUGFyYW1zKCkgYnV0IHdpdGggZGlmZmVyZW50IGNvbW1hbmQgbmFtZS4KICAgICIiIgogICAgcGFyYW1fbGlzdCA9IHt9CiAgICAKICAgIGZvciBrZXksIGl0ZW0gaW4gcGFyYW1ldGVycy5pdGVtcygpOgogICAgICAgIGlmIGl0ZW0uZ2V0KCdpc3BhcmFtJykgPT0gVHJ1ZToKICAgICAgICAgICAgcGFyYW1fbGlzdFtrZXldID0gaXRlbQogICAgCiAgICBfc2VuZF9yZXNwb25zZSgnUEFSQU1FVEVSUy1ET1dOTE9BRC1MSVNUJywgcGFyYW1fbGlzdCkKCgpkZWYgc2V0UGFyYW1ldGVyc0JhdGNoKHBhcmFtc190b19zZXQpOgogICAgIiIiCiAgICBTZXQgbXVsdGlwbGUgcGFyYW1ldGVycyBhdCBvbmNlLgogICAgCiAgICBBcmdzIChkaWN0KToKICAgICAgICB7cGFyYW1fbmFtZTogdmFsdWUsIC4uLn0KICAgIAogICAgU2VuZHMgYmF0Y2ggcmVzdWx0IHdpdGggc3VjY2VzcyBzdGF0dXMgYW5kIGRldGFpbHMgZm9yIGVhY2ggcGFyYW1ldGVyLgogICAgIiIiCiAgICB1cGRhdGVfcmVzdWx0cyA9IHt9CiAgICBzdWNjZXNzID0gVHJ1ZQogICAgCiAgICBpZiBub3QgaXNpbnN0YW5jZShwYXJhbXNfdG9fc2V0LCBkaWN0KToKICAgICAgICBfc2VuZF9lcnJvcigiSW52YWxpZCBhcmd1bWVudCBmb3JtYXQgZm9yIGJhdGNoIHNldCIsICdTRVQtUEFSQU1FVEVSUy1CQVRDSC1FUlJPUicpCiAgICAgICAgcmV0dXJuCiAgICAKICAgIGZvciBuYW1lLCB2YWx1ZSBpbiBwYXJhbXNfdG9fc2V0Lml0ZW1zKCk6CiAgICAgICAgaWYgbmFtZSBpbiBwYXJhbWV0ZXJzIGFuZCBwYXJhbWV0ZXJzW25hbWVdLmdldCgnaXNwYXJhbScpID09IFRydWU6CiAgICAgICAgICAgIHBhcmFtX2RlZiA9IHBhcmFtZXRlcnNbbmFtZV0KICAgICAgICAgICAgCiAgICAgICAgICAgICMgVmFsaWRhdGUgdmFsdWUKICAgICAgICAgICAgaWYgJ21pbmltdW0nIGluIHBhcmFtX2RlZiBhbmQgdmFsdWUgPCBwYXJhbV9kZWZbJ21pbmltdW0nXToKICAgICAgICAgICAgICAgIHVwZGF0ZV9yZXN1bHRzW25hbWVdID0geydzdGF0dXMnOiAnZXJyb3InLCAnbWVzc2FnZSc6IGYnQmVsb3cgbWluaW11bSB7cGFyYW1fZGVmWyJtaW5pbXVtIl19J30KICAgICAgICAgICAgICAgIHN1Y2Nlc3MgPSBGYWxzZQogICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmICdtYXhpbXVtJyBpbiBwYXJhbV9kZWYgYW5kIHZhbHVlID4gcGFyYW1fZGVmWydtYXhpbXVtJ106CiAgICAgICAgICAgICAgICB1cGRhdGVfcmVzdWx0c1tuYW1lXSA9IHsnc3RhdHVzJzogJ2Vycm9yJywgJ21lc3NhZ2UnOiBmJ0Fib3ZlIG1heGltdW0ge3BhcmFtX2RlZlsibWF4aW11bSJdfSd9CiAgICAgICAgICAgICAgICBzdWNjZXNzID0gRmFsc2UKICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgIAogICAgICAgICAgICBpZiAnZW51bXMnIGluIHBhcmFtX2RlZiBhbmQgdmFsdWUgbm90IGluIHBhcmFtX2RlZlsnZW51bXMnXToKICAgICAgICAgICAgICAgIHVwZGF0ZV9yZXN1bHRzW25hbWVdID0geydzdGF0dXMnOiAnZXJyb3InLCAnbWVzc2FnZSc6ICdJbnZhbGlkIGVudW0gdmFsdWUnfQogICAgICAgICAgICAgICAgc3VjY2VzcyA9IEZhbHNlCiAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICAKICAgICAgICAgICAgcGFyYW1ldGVyc1tuYW1lXVsndmFsdWUnXSA9IHZhbHVlCiAgICAgICAgICAgIHVwZGF0ZV9yZXN1bHRzW25hbWVdID0geydzdGF0dXMnOiAnc3VjY2VzcycsICd2YWx1ZSc6IHZhbHVlfQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHVwZGF0ZV9yZXN1bHRzW25hbWVdID0geydzdGF0dXMnOiAnZXJyb3InLCAnbWVzc2FnZSc6ICdJbnZhbGlkIG9yIG5vbi1wYXJhbWV0ZXInfQogICAgICAgICAgICBzdWNjZXNzID0gRmFsc2UKICAgIAogICAgX3NlbmRfcmVzcG9uc2UoJ1BBUkFNRVRFUlMtQkFUQ0gtUkVTVUxUJywgeydzdWNjZXNzJzogc3VjY2VzcywgJ2RldGFpbHMnOiB1cGRhdGVfcmVzdWx0c30pCgoKZGVmIGdldFNwb3RWYWx1ZXMoKToKICAgICIiIgogICAgR2V0IGxpc3Qgb2YgYWxsIHNwb3QgdmFsdWVzIChpc3BhcmFtPUZhbHNlKS4KICAgIFNlbmRzIHRoZSByZXN1bHQgZGlyZWN0bHkgdG8gdGhlIFdlYlJFUEwgY2xpZW50IGFzIEpTT04uCiAgICAKICAgIFJlYWRzIGN1cnJlbnQgdmFsdWVzIHZpYSBTRE8gZnJvbSBjb25uZWN0ZWQgZGV2aWNlLgogICAgIiIiCiAgICBpZiBub3QgZGV2aWNlX2Nvbm5lY3RlZCBvciBzZG9fY2xpZW50IGlzIE5vbmUgb3IgQ0FOIGlzIE5vbmU6CiAgICAgICAgX3NlbmRfZXJyb3IoIkRldmljZSBub3QgY29ubmVjdGVkIiwgJ0dFVC1TUE9ULVZBTFVFUy1FUlJPUicpCiAgICAgICAgcmV0dXJuCiAgICAKICAgIHNwb3RfbGlzdCA9IHt9CiAgICAKICAgIHRyeToKICAgICAgICBmb3Iga2V5LCBpdGVtIGluIHBhcmFtZXRlcnMuaXRlbXMoKToKICAgICAgICAgICAgaWYgaXRlbS5nZXQoJ2lzcGFyYW0nKSAhPSBUcnVlOgogICAgICAgICAgICAgICAgIyBSZWFkIGN1cnJlbnQgdmFsdWUgZnJvbSBkZXZpY2UKICAgICAgICAgICAgICAgIHBhcmFtX2lkID0gaXRlbS5nZXQoJ2lkJykKICAgICAgICAgICAgICAgIGlmIHBhcmFtX2lkIGlzIG5vdCBOb25lOgogICAgICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICAgICAgaW5kZXgsIHN1YmluZGV4ID0gcGFyYW1faWRfdG9fc2RvKHBhcmFtX2lkKQogICAgICAgICAgICAgICAgICAgICAgICByYXdfdmFsdWUgPSBzZG9fY2xpZW50LnJlYWQoaW5kZXgsIHN1YmluZGV4KQogICAgICAgICAgICAgICAgICAgICAgICBpdGVtWyd2YWx1ZSddID0gZml4ZWRfdG9fZmxvYXQocmF3X3ZhbHVlKQogICAgICAgICAgICAgICAgICAgIGV4Y2VwdCAoU0RPVGltZW91dEVycm9yLCBTRE9BYm9ydEVycm9yKSBhcyBlOgogICAgICAgICAgICAgICAgICAgICAgICAjIEtlZXAgZXhpc3RpbmcgdmFsdWUKICAgICAgICAgICAgICAgICAgICAgICAgcGFzcwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBzcG90X2xpc3Rba2V5XSA9IGl0ZW0KICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICBfc2VuZF9lcnJvcihzdHIoZSksICdHRVQtU1BPVC1WQUxVRVMtRVJST1InKQogICAgICAgIHJldHVybgogICAgCiAgICBfc2VuZF9yZXNwb25zZSgnU1BPVC1WQUxVRVMtTElTVCcsIHNwb3RfbGlzdCkKCgpkZWYgZ2V0UGxvdERhdGEoYXJncyk6CiAgICAiIiIKICAgIEdldCByZWFsLXRpbWUgdmFsdWVzIGZvciBwbG90dGluZy4KICAgIAogICAgQXJncyAobGlzdCk6CiAgICAgICAgTGlzdCBvZiB2YXJpYWJsZSBuYW1lcyB0byByZXRyaWV2ZQogICAgCiAgICBSZXR1cm5zIHZhbHVlcyB3aXRoIHRpbWVzdGFtcCBmb3IgcGxvdHRpbmcuCiAgICAKICAgIE5vdGU6IFRoaXMgb25seSB3b3JrcyBpbiBDb25maWd1cmF0aW9uIE1vZGUsIG5vdCBkdXJpbmcgc3RyZWFtaW5nLgogICAgRm9yIGhpZ2gtc3BlZWQgcGxvdHRpbmcsIHVzZSBDIHN0cmVhbWluZyBtb2RlIGluc3RlYWQuCiAgICAiIiIKICAgICMgTm90ZTogQXZvaWQgcHJpbnQoKSBoZXJlIGFzIGl0IGludGVyZmVyZXMgd2l0aCBKU09OIHJlc3BvbnNlIGluIFdlYlJFUEwKICAgIAogICAgaWYgc3RyZWFtaW5nX2FjdGl2ZToKICAgICAgICAjIENhbid0IHJlYWQgdmlhIFNETyB3aGlsZSBzdHJlYW1pbmcKICAgICAgICBfc2VuZF9lcnJvcigiQ2Fubm90IHJlYWQgcGxvdCBkYXRhIGluIHN0cmVhbWluZyBtb2RlIiwgJ1BMT1QtREFUQS1FUlJPUicpCiAgICAgICAgcmV0dXJuCiAgICAKICAgIHJlc3BvbnNlX3ZhbHVlcyA9IHt9CiAgICBjdXJyZW50X3RpbWUgPSBpbnQodGltZS50aW1lKCkpICAjIFVuaXggdGltZXN0YW1wCiAgICAKICAgIGlmIG5vdCBkZXZpY2VfY29ubmVjdGVkIG9yIHNkb19jbGllbnQgaXMgTm9uZSBvciBDQU4gaXMgTm9uZToKICAgICAgICBfc2VuZF9lcnJvcigiRGV2aWNlIG5vdCBjb25uZWN0ZWQiLCAnUExPVC1EQVRBLUVSUk9SJykKICAgICAgICByZXR1cm4KICAgIAogICAgaWYgaXNpbnN0YW5jZShhcmdzLCBsaXN0KSBhbmQgbGVuKGFyZ3MpID4gMDoKICAgICAgICBmb3IgdmFyX25hbWUgaW4gYXJnczoKICAgICAgICAgICAgaWYgdmFyX25hbWUgaW4gcGFyYW1ldGVyczoKICAgICAgICAgICAgICAgIGl0ZW0gPSBwYXJhbWV0ZXJzW3Zhcl9uYW1lXQogICAgICAgICAgICAgICAgcGFyYW1faWQgPSBpdGVtLmdldCgnaWQnKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiBwYXJhbV9pZCBpcyBub3QgTm9uZToKICAgICAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgICAgIGluZGV4LCBzdWJpbmRleCA9IHBhcmFtX2lkX3RvX3NkbyhwYXJhbV9pZCkKICAgICAgICAgICAgICAgICAgICAgICAgcmF3X3ZhbHVlID0gc2RvX2NsaWVudC5yZWFkKGluZGV4LCBzdWJpbmRleCkKICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSBmaXhlZF90b19mbG9hdChyYXdfdmFsdWUpCiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAjIFVwZGF0ZSBjYWNoZWQgdmFsdWUKICAgICAgICAgICAgICAgICAgICAgICAgaXRlbVsndmFsdWUnXSA9IHZhbHVlCiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlX3ZhbHVlc1t2YXJfbmFtZV0gPSB2YWx1ZQogICAgICAgICAgICAgICAgICAgIGV4Y2VwdCAoU0RPVGltZW91dEVycm9yLCBTRE9BYm9ydEVycm9yKToKICAgICAgICAgICAgICAgICAgICAgICAgIyBVc2UgY2FjaGVkIHZhbHVlIG9uIGVycm9yCiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlID0gaXRlbS5nZXQoJ3ZhbHVlJykKICAgICAgICAgICAgICAgICAgICAgICAgaWYgaXNpbnN0YW5jZSh2YWx1ZSwgKGludCwgZmxvYXQpKToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlX3ZhbHVlc1t2YXJfbmFtZV0gPSB2YWx1ZQogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAjIE5vIHBhcmFtIElELCB1c2UgY2FjaGVkIHZhbHVlCiAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSBpdGVtLmdldCgndmFsdWUnKQogICAgICAgICAgICAgICAgICAgIGlmIGlzaW5zdGFuY2UodmFsdWUsIChpbnQsIGZsb2F0KSk6CiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlX3ZhbHVlc1t2YXJfbmFtZV0gPSB2YWx1ZQogICAgICAgIAogICAgICAgICMgQ29uc3RydWN0IHRoZSByZXNwb25zZSBwYXlsb2FkCiAgICAgICAgcmVzcG9uc2VfcGF5bG9hZCA9IHsKICAgICAgICAgICAgJ3RzJzogY3VycmVudF90aW1lLAogICAgICAgICAgICAndmFsdWVzJzogcmVzcG9uc2VfdmFsdWVzCiAgICAgICAgfQogICAgICAgIAogICAgICAgIF9zZW5kX3Jlc3BvbnNlKCdQTE9ULURBVEEtVVBEQVRFJywgcmVzcG9uc2VfcGF5bG9hZCkKCgojID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KIyBDQU4gTWFwcGluZyBGdW5jdGlvbnMKIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CgpkZWYgZ2V0Q2FuTWFwKGFyZ3M9Tm9uZSk6CiAgICAiIiIKICAgIEdldCBDQU4gbWFwcGluZ3MgZnJvbSBkZXZpY2UgKFRYIG9yIFJYKS4KICAgIAogICAgQXJncyAoZGljdCwgb3B0aW9uYWwpOgogICAgICAgIGRpcmVjdGlvbjogJ3R4JyBvciAncngnIChkZWZhdWx0OiBib3RoKQogICAgCiAgICBDQU4gbWFwcGluZyB1c2VzIFNETyBpbmRleGVzOgogICAgLSBUWCBtYXAgbGlzdDogMHgzMDAwICsgbgogICAgLSBSWCBtYXAgbGlzdDogMHgzMTAwICsgbgogICAgIiIiCiAgICBpZiBub3QgZGV2aWNlX2Nvbm5lY3RlZCBvciBzZG9fY2xpZW50IGlzIE5vbmU6CiAgICAgICAgX3NlbmRfZXJyb3IoIkRldmljZSBub3QgY29ubmVjdGVkIiwgJ0dFVC1DQU4tTUFQLUVSUk9SJykKICAgICAgICByZXR1cm4KICAgIAogICAgZGlyZWN0aW9uID0gYXJncy5nZXQoJ2RpcmVjdGlvbicsICdib3RoJykgaWYgYXJncyBlbHNlICdib3RoJwogICAgCiAgICB0cnk6CiAgICAgICAgbWFwcGluZ3MgPSB7J3R4JzogW10sICdyeCc6IFtdfQogICAgICAgIAogICAgICAgIGlmIGRpcmVjdGlvbiBpbiBbJ3R4JywgJ2JvdGgnXToKICAgICAgICAgICAgIyBSZWFkIFRYIG1hcHBpbmdzIHN0YXJ0aW5nIGF0IDB4MzAwMAogICAgICAgICAgICBiYXNlX2luZGV4ID0gMHgzMDAwCiAgICAgICAgICAgIG1zZ19pbmRleCA9IDAKICAgICAgICAgICAgd2hpbGUgbXNnX2luZGV4IDwgMjU1OiAgIyBNYXggbWVzc2FnZXMKICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICAjIFJlYWQgQ0FOIElEIGF0IHN1YmluZGV4IDAKICAgICAgICAgICAgICAgICAgICBjYW5faWQgPSBzZG9fY2xpZW50LnJlYWQoYmFzZV9pbmRleCArIG1zZ19pbmRleCwgMCkKICAgICAgICAgICAgICAgICAgICBpZiBjYW5faWQgPT0gMDoKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsgICMgTm8gbW9yZSBtZXNzYWdlcwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICMgRXh0cmFjdCBleHRlbmRlZCBmcmFtZSBmbGFnIChiaXQgMzEpCiAgICAgICAgICAgICAgICAgICAgaXNfZXh0ZW5kZWQgPSAoY2FuX2lkICYgMHg4MDAwMDAwMCkgIT0gMAogICAgICAgICAgICAgICAgICAgIGNhbl9pZCA9IGNhbl9pZCAmIDB4MUZGRkZGRkYgICMgTWFzayBvdXQgZmxhZyBiaXQKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBtZXNzYWdlID0gewogICAgICAgICAgICAgICAgICAgICAgICAnY2FuSWQnOiBjYW5faWQsCiAgICAgICAgICAgICAgICAgICAgICAgICdpc0V4dGVuZGVkJzogaXNfZXh0ZW5kZWQsCiAgICAgICAgICAgICAgICAgICAgICAgICdwYXJhbXMnOiBbXQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAjIFJlYWQgcGFyYW1ldGVyIG1hcHBpbmdzIChzdWJpbmRleCAxLCAzLCA1LCAuLi4pCiAgICAgICAgICAgICAgICAgICAgcGFyYW1faW5kZXggPSAxCiAgICAgICAgICAgICAgICAgICAgd2hpbGUgcGFyYW1faW5kZXggPCAyNTU6CiAgICAgICAgICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgUmVhZCBwYXJhbSBJRCwgcG9zaXRpb24sIGxlbmd0aAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbWFwcGluZ19kYXRhID0gc2RvX2NsaWVudC5yZWFkKGJhc2VfaW5kZXggKyBtc2dfaW5kZXgsIHBhcmFtX2luZGV4KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgbWFwcGluZ19kYXRhID09IDA6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsgICMgTm8gbW9yZSBwYXJhbXMKICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFyYW1faWQgPSBtYXBwaW5nX2RhdGEgJiAweEZGRkYKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvc2l0aW9uID0gKG1hcHBpbmdfZGF0YSA+PiAxNikgJiAweEZGCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZW5ndGggPSAobWFwcGluZ19kYXRhID4+IDI0KSAmIDB4RkYKICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgQ29udmVydCB0byBzaWduZWQgaWYgbmVnYXRpdmUKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIGxlbmd0aCA+PSAxMjg6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGVuZ3RoID0gbGVuZ3RoIC0gMjU2CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgUmVhZCBnYWluIGFuZCBvZmZzZXQgKG5leHQgc3ViaW5kZXgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBnYWluX29mZnNldCA9IHNkb19jbGllbnQucmVhZChiYXNlX2luZGV4ICsgbXNnX2luZGV4LCBwYXJhbV9pbmRleCArIDEpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBnYWluID0gKGdhaW5fb2Zmc2V0ICYgMHhGRkZGRkYpIC8gMTAwMC4wICAjIDI0LWJpdCBmaXhlZCBwb2ludAogICAgICAgICAgICAgICAgICAgICAgICAgICAgb2Zmc2V0ID0gKGdhaW5fb2Zmc2V0ID4+IDI0KSAmIDB4RkYKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIG9mZnNldCA+PSAxMjg6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb2Zmc2V0ID0gb2Zmc2V0IC0gMjU2CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2VbJ3BhcmFtcyddLmFwcGVuZCh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3BhcmFtSWQnOiBwYXJhbV9pZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAncG9zaXRpb24nOiBwb3NpdGlvbiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnbGVuZ3RoJzogbGVuZ3RoLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdnYWluJzogZ2FpbiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnb2Zmc2V0Jzogb2Zmc2V0CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXJhbV9pbmRleCArPSAyICAjIFNraXAgdG8gbmV4dCBwYXJhbQogICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQgKFNET1RpbWVvdXRFcnJvciwgU0RPQWJvcnRFcnJvcik6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGlmIG1lc3NhZ2VbJ3BhcmFtcyddOiAgIyBPbmx5IGFkZCBpZiBoYXMgcGFyYW1zCiAgICAgICAgICAgICAgICAgICAgICAgIG1hcHBpbmdzWyd0eCddLmFwcGVuZChtZXNzYWdlKQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIG1zZ19pbmRleCArPSAxCiAgICAgICAgICAgICAgICBleGNlcHQgKFNET1RpbWVvdXRFcnJvciwgU0RPQWJvcnRFcnJvcik6CiAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAKICAgICAgICBpZiBkaXJlY3Rpb24gaW4gWydyeCcsICdib3RoJ106CiAgICAgICAgICAgICMgUmVhZCBSWCBtYXBwaW5ncyBzdGFydGluZyBhdCAweDMxMDAKICAgICAgICAgICAgYmFzZV9pbmRleCA9IDB4MzEwMAogICAgICAgICAgICBtc2dfaW5kZXggPSAwCiAgICAgICAgICAgIHdoaWxlIG1zZ19pbmRleCA8IDI1NToKICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICBjYW5faWQgPSBzZG9fY2xpZW50LnJlYWQoYmFzZV9pbmRleCArIG1zZ19pbmRleCwgMCkKICAgICAgICAgICAgICAgICAgICBpZiBjYW5faWQgPT0gMDoKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBpc19leHRlbmRlZCA9IChjYW5faWQgJiAweDgwMDAwMDAwKSAhPSAwCiAgICAgICAgICAgICAgICAgICAgY2FuX2lkID0gY2FuX2lkICYgMHgxRkZGRkZGRgogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIG1lc3NhZ2UgPSB7CiAgICAgICAgICAgICAgICAgICAgICAgICdjYW5JZCc6IGNhbl9pZCwKICAgICAgICAgICAgICAgICAgICAgICAgJ2lzRXh0ZW5kZWQnOiBpc19leHRlbmRlZCwKICAgICAgICAgICAgICAgICAgICAgICAgJ3BhcmFtcyc6IFtdCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIHBhcmFtX2luZGV4ID0gMQogICAgICAgICAgICAgICAgICAgIHdoaWxlIHBhcmFtX2luZGV4IDwgMjU1OgogICAgICAgICAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYXBwaW5nX2RhdGEgPSBzZG9fY2xpZW50LnJlYWQoYmFzZV9pbmRleCArIG1zZ19pbmRleCwgcGFyYW1faW5kZXgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBtYXBwaW5nX2RhdGEgPT0gMDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXJhbV9pZCA9IG1hcHBpbmdfZGF0YSAmIDB4RkZGRgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9zaXRpb24gPSAobWFwcGluZ19kYXRhID4+IDE2KSAmIDB4RkYKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxlbmd0aCA9IChtYXBwaW5nX2RhdGEgPj4gMjQpICYgMHhGRgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgbGVuZ3RoID49IDEyODoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZW5ndGggPSBsZW5ndGggLSAyNTYKICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2Fpbl9vZmZzZXQgPSBzZG9fY2xpZW50LnJlYWQoYmFzZV9pbmRleCArIG1zZ19pbmRleCwgcGFyYW1faW5kZXggKyAxKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2FpbiA9IChnYWluX29mZnNldCAmIDB4RkZGRkZGKSAvIDEwMDAuMAogICAgICAgICAgICAgICAgICAgICAgICAgICAgb2Zmc2V0ID0gKGdhaW5fb2Zmc2V0ID4+IDI0KSAmIDB4RkYKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIG9mZnNldCA+PSAxMjg6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb2Zmc2V0ID0gMjU2CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2VbJ3BhcmFtcyddLmFwcGVuZCh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3BhcmFtSWQnOiBwYXJhbV9pZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAncG9zaXRpb24nOiBwb3NpdGlvbiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnbGVuZ3RoJzogbGVuZ3RoLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdnYWluJzogZ2FpbiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnb2Zmc2V0Jzogb2Zmc2V0CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXJhbV9pbmRleCArPSAyCiAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdCAoU0RPVGltZW91dEVycm9yLCBTRE9BYm9ydEVycm9yKToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgaWYgbWVzc2FnZVsncGFyYW1zJ106CiAgICAgICAgICAgICAgICAgICAgICAgIG1hcHBpbmdzWydyeCddLmFwcGVuZChtZXNzYWdlKQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIG1zZ19pbmRleCArPSAxCiAgICAgICAgICAgICAgICBleGNlcHQgKFNET1RpbWVvdXRFcnJvciwgU0RPQWJvcnRFcnJvcik6CiAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAKICAgICAgICBfc2VuZF9yZXNwb25zZSgnQ0FOLU1BUC1MSVNUJywgbWFwcGluZ3MpCiAgICAgICAgCiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgIyBTaWxlbnQgLSBlcnJvcnMgc2VudCB2aWEgX3NlbmRfZXJyb3IoKQogICAgICAgIF9zZW5kX2Vycm9yKHN0cihlKSwgJ0NBTi1NQVAtRVJST1InKQoKCmRlZiBhZGRDYW5NYXBwaW5nKGFyZ3MpOgogICAgIiIiCiAgICBBZGQgYSBDQU4gbWFwcGluZyBlbnRyeS4KICAgIAogICAgQXJncyAoZGljdCk6CiAgICAgICAgY2FuX2lkOiBDQU4gbWVzc2FnZSBJRAogICAgICAgIHBhcmFtX25hbWU6IFBhcmFtZXRlci9zcG90IHZhbHVlIG5hbWUKICAgICAgICBwb3NpdGlvbjogQml0IHBvc2l0aW9uIGluIENBTiBtZXNzYWdlCiAgICAgICAgbGVuZ3RoOiBOdW1iZXIgb2YgYml0cyAobmVnYXRpdmUgZm9yIGJpZy1lbmRpYW4pCiAgICAgICAgZ2FpbjogU2NhbGluZyBmYWN0b3IKICAgICAgICBvZmZzZXQ6IE9mZnNldCB2YWx1ZQogICAgICAgIGlzX3R4OiBUcnVlIGZvciB0cmFuc21pdCwgRmFsc2UgZm9yIHJlY2VpdmUKICAgICAgICBpc19leHRlbmRlZDogVHJ1ZSBmb3IgMjktYml0IGV4dGVuZGVkIGZyYW1lCiAgICAiIiIKICAgICMgSGFuZGxlIEpTT04gc3RyaW5nIGZyb20gSmF2YVNjcmlwdCAoSlNPTiB1c2VzIGxvd2VyY2FzZSB0cnVlL2ZhbHNlLCBQeXRob24gbmVlZHMgVHJ1ZS9GYWxzZSkKICAgIGlmIGlzaW5zdGFuY2UoYXJncywgc3RyKToKICAgICAgICBhcmdzID0ganNvbi5sb2FkcyhhcmdzKQogICAgZWxpZiBhcmdzIGlzIE5vbmU6CiAgICAgICAgYXJncyA9IHt9CiAgICAKICAgIGNhbl9pZCA9IGFyZ3MuZ2V0KCdjYW5faWQnKQogICAgcGFyYW1fbmFtZSA9IGFyZ3MuZ2V0KCdwYXJhbV9uYW1lJykKICAgIHBvc2l0aW9uID0gYXJncy5nZXQoJ3Bvc2l0aW9uJywgMCkKICAgIGxlbmd0aCA9IGFyZ3MuZ2V0KCdsZW5ndGgnLCAxNikKICAgIGdhaW4gPSBhcmdzLmdldCgnZ2FpbicsIDEuMCkKICAgIG9mZnNldCA9IGFyZ3MuZ2V0KCdvZmZzZXQnLCAwKQogICAgaXNfdHggPSBhcmdzLmdldCgnaXNfdHgnLCBUcnVlKQogICAgaXNfZXh0ZW5kZWQgPSBhcmdzLmdldCgnaXNfZXh0ZW5kZWQnLCBGYWxzZSkKICAgIAogICAgaWYgY2FuX2lkIGlzIE5vbmUgb3IgcGFyYW1fbmFtZSBpcyBOb25lOgogICAgICAgIF9zZW5kX2Vycm9yKCJNaXNzaW5nIGNhbl9pZCBvciBwYXJhbV9uYW1lIiwgJ0NBTi1NQVAtQURELUVSUk9SJykKICAgICAgICByZXR1cm4KICAgIAogICAgIyBHZXQgcGFyYW0gSUQgZnJvbSBuYW1lCiAgICBpZiBwYXJhbV9uYW1lIG5vdCBpbiBwYXJhbWV0ZXJzOgogICAgICAgIF9zZW5kX2Vycm9yKGYiUGFyYW1ldGVyIHtwYXJhbV9uYW1lfSBub3QgZm91bmQiLCAnQ0FOLU1BUC1BREQtRVJST1InKQogICAgICAgIHJldHVybgogICAgCiAgICBwYXJhbV9pZCA9IHBhcmFtZXRlcnNbcGFyYW1fbmFtZV0uZ2V0KCdpZCcpCiAgICBpZiBwYXJhbV9pZCBpcyBOb25lOgogICAgICAgIF9zZW5kX2Vycm9yKGYiUGFyYW1ldGVyIHtwYXJhbV9uYW1lfSBoYXMgbm8gSUQiLCAnQ0FOLU1BUC1BREQtRVJST1InKQogICAgICAgIHJldHVybgogICAgCiAgICBpZiBub3QgZGV2aWNlX2Nvbm5lY3RlZCBvciBzZG9fY2xpZW50IGlzIE5vbmU6CiAgICAgICAgX3NlbmRfZXJyb3IoIkRldmljZSBub3QgY29ubmVjdGVkIiwgJ0NBTi1NQVAtQURELUVSUk9SJykKICAgICAgICByZXR1cm4KICAgIAogICAgdHJ5OgogICAgICAgICMgUmVhbCBkZXZpY2UgbW9kZSAtIHdyaXRlIHZpYSBTRE8KICAgICAgICAjIFVzZSBhcHByb3ByaWF0ZSBTRE8gaW5kZXggZm9yIFRYICgweDMyMDApIG9yIFJYICgweDMzMDApCiAgICAgICAgYmFzZV9pbmRleCA9IDB4MzIwMCBpZiBpc190eCBlbHNlIDB4MzMwMAogICAgICAgIAogICAgICAgICMgV3JpdGUgQ0FOIElEIHdpdGggZXh0ZW5kZWQgZnJhbWUgZmxhZyBpZiBuZWVkZWQKICAgICAgICBjYW5faWRfdmFsdWUgPSBjYW5faWQgfCAoMHg4MDAwMDAwMCBpZiBpc19leHRlbmRlZCBlbHNlIDApCiAgICAgICAgc2RvX2NsaWVudC53cml0ZShiYXNlX2luZGV4LCAwLCBjYW5faWRfdmFsdWUpCiAgICAgICAgCiAgICAgICAgIyBXcml0ZSBwYXJhbSBJRCwgcG9zaXRpb24sIGxlbmd0aAogICAgICAgIG1hcHBpbmdfZGF0YSA9IHBhcmFtX2lkIHwgKHBvc2l0aW9uIDw8IDE2KSB8ICgobGVuZ3RoICYgMHhGRikgPDwgMjQpCiAgICAgICAgc2RvX2NsaWVudC53cml0ZShiYXNlX2luZGV4LCAxLCBtYXBwaW5nX2RhdGEpCiAgICAgICAgCiAgICAgICAgIyBXcml0ZSBnYWluIGFuZCBvZmZzZXQKICAgICAgICBnYWluX2ZpeGVkID0gaW50KGdhaW4gKiAxMDAwKSAmIDB4RkZGRkZGICAjIDI0LWJpdCBmaXhlZCBwb2ludAogICAgICAgIGdhaW5fb2Zmc2V0X3ZhbHVlID0gZ2Fpbl9maXhlZCB8ICgob2Zmc2V0ICYgMHhGRikgPDwgMjQpCiAgICAgICAgc2RvX2NsaWVudC53cml0ZShiYXNlX2luZGV4LCAyLCBnYWluX29mZnNldF92YWx1ZSkKICAgICAgICAKICAgICAgICBfc2VuZF9yZXNwb25zZSgnQ0FOLU1BUC1BRERFRCcsIHsKICAgICAgICAgICAgJ3N1Y2Nlc3MnOiBUcnVlLAogICAgICAgICAgICAnY2FuX2lkJzogY2FuX2lkLAogICAgICAgICAgICAncGFyYW1fbmFtZSc6IHBhcmFtX25hbWUsCiAgICAgICAgICAgICdwYXJhbV9pZCc6IHBhcmFtX2lkCiAgICAgICAgfSkKICAgICAgICAKICAgIGV4Y2VwdCAoU0RPVGltZW91dEVycm9yLCBTRE9BYm9ydEVycm9yKSBhcyBlOgogICAgICAgIF9zZW5kX2Vycm9yKHN0cihlKSwgJ0NBTi1NQVAtQURELUVSUk9SJykKICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICBfc2VuZF9lcnJvcihzdHIoZSksICdDQU4tTUFQLUFERC1FUlJPUicpCgoKZGVmIHJlbW92ZUNhbk1hcHBpbmcoYXJncyk6CiAgICAiIiIKICAgIFJlbW92ZSBhIENBTiBtYXBwaW5nIGVudHJ5LgogICAgCiAgICBBcmdzIChkaWN0KToKICAgICAgICBkaXJlY3Rpb246ICd0eCcgb3IgJ3J4JwogICAgICAgIG1zZ19pbmRleDogTWVzc2FnZSBpbmRleAogICAgICAgIHBhcmFtX2luZGV4OiBQYXJhbWV0ZXIgaW5kZXggd2l0aGluIG1lc3NhZ2UKICAgICIiIgogICAgIyBIYW5kbGUgSlNPTiBzdHJpbmcgZnJvbSBKYXZhU2NyaXB0CiAgICBpZiBpc2luc3RhbmNlKGFyZ3MsIHN0cik6CiAgICAgICAgYXJncyA9IGpzb24ubG9hZHMoYXJncykKICAgIGVsaWYgYXJncyBpcyBOb25lOgogICAgICAgIGFyZ3MgPSB7fQogICAgCiAgICBkaXJlY3Rpb24gPSBhcmdzLmdldCgnZGlyZWN0aW9uJykKICAgIG1zZ19pbmRleCA9IGFyZ3MuZ2V0KCdtc2dfaW5kZXgnKQogICAgcGFyYW1faW5kZXggPSBhcmdzLmdldCgncGFyYW1faW5kZXgnKQogICAgCiAgICBpZiBkaXJlY3Rpb24gaXMgTm9uZSBvciBtc2dfaW5kZXggaXMgTm9uZSBvciBwYXJhbV9pbmRleCBpcyBOb25lOgogICAgICAgIF9zZW5kX2Vycm9yKCJNaXNzaW5nIGRpcmVjdGlvbiwgbXNnX2luZGV4LCBvciBwYXJhbV9pbmRleCIsICdDQU4tTUFQLVJFTU9WRS1FUlJPUicpCiAgICAgICAgcmV0dXJuCiAgICAKICAgIGlmIG5vdCBkZXZpY2VfY29ubmVjdGVkIG9yIHNkb19jbGllbnQgaXMgTm9uZToKICAgICAgICBfc2VuZF9lcnJvcigiRGV2aWNlIG5vdCBjb25uZWN0ZWQiLCAnQ0FOLU1BUC1SRU1PVkUtRVJST1InKQogICAgICAgIHJldHVybgogICAgCiAgICB0cnk6CiAgICAgICAgIyBSZWFsIGRldmljZSBtb2RlIC0gd3JpdGUgdmlhIFNETwogICAgICAgIGJhc2VfaW5kZXggPSAweDMwMDAgaWYgZGlyZWN0aW9uID09ICd0eCcgZWxzZSAweDMxMDAKICAgICAgICB0YXJnZXRfaW5kZXggPSBiYXNlX2luZGV4ICsgbXNnX2luZGV4CiAgICAgICAgIyBXcml0ZSAwIHRvIHRoZSBwYXJhbWV0ZXIgc3ViaW5kZXggdG8gcmVtb3ZlIGl0CiAgICAgICAgIyBEZXZpY2Ugd2lsbCBhdXRvbWF0aWNhbGx5IHNoaWZ0IHJlbWFpbmluZyBwYXJhbXMKICAgICAgICB0YXJnZXRfc3ViaW5kZXggPSAxICsgKHBhcmFtX2luZGV4ICogMikKICAgICAgICBzZG9fY2xpZW50LndyaXRlKHRhcmdldF9pbmRleCwgdGFyZ2V0X3N1YmluZGV4LCAwKQogICAgICAgIAogICAgICAgIF9zZW5kX3Jlc3BvbnNlKCdDQU4tTUFQLVJFTU9WRUQnLCB7J3N1Y2Nlc3MnOiBUcnVlfSkKICAgICAgICAKICAgIGV4Y2VwdCAoU0RPVGltZW91dEVycm9yLCBTRE9BYm9ydEVycm9yKSBhcyBlOgogICAgICAgIF9zZW5kX2Vycm9yKHN0cihlKSwgJ0NBTi1NQVAtUkVNT1ZFLUVSUk9SJykKICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICBfc2VuZF9lcnJvcihzdHIoZSksICdDQU4tTUFQLVJFTU9WRS1FUlJPUicpCgoKZGVmIGNsZWFyQ2FuTWFwKGFyZ3MpOgogICAgIiIiCiAgICBDbGVhciBhbGwgQ0FOIG1hcHBpbmdzIGZvciBhIGRpcmVjdGlvbi4KICAgIAogICAgQXJncyAoZGljdCk6CiAgICAgICAgZGlyZWN0aW9uOiAndHgnLCAncngnLCBvciAnYWxsJwogICAgIiIiCiAgICBpZiBub3QgZGV2aWNlX2Nvbm5lY3RlZCBvciBzZG9fY2xpZW50IGlzIE5vbmU6CiAgICAgICAgX3NlbmRfZXJyb3IoIkRldmljZSBub3QgY29ubmVjdGVkIiwgJ0NBTi1NQVAtQ0xFQVItRVJST1InKQogICAgICAgIHJldHVybgogICAgCiAgICBkaXJlY3Rpb24gPSBhcmdzLmdldCgnZGlyZWN0aW9uJywgJ2FsbCcpCiAgICAKICAgIHRyeToKICAgICAgICAjIFJlcGVhdGVkbHkgcmVtb3ZlIGZpcnN0IGVudHJ5IHVudGlsIG5vbmUgcmVtYWluCiAgICAgICAgaWYgZGlyZWN0aW9uIGluIFsndHgnLCAnYWxsJ106CiAgICAgICAgICAgIGJhc2VfaW5kZXggPSAweDMwMDAKICAgICAgICAgICAgd2hpbGUgVHJ1ZToKICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICAjIFRyeSB0byByZW1vdmUgZmlyc3QgcGFyYW0gb2YgZmlyc3QgbWVzc2FnZQogICAgICAgICAgICAgICAgICAgIHNkb19jbGllbnQud3JpdGUoYmFzZV9pbmRleCwgMSwgMCkKICAgICAgICAgICAgICAgIGV4Y2VwdCBTRE9BYm9ydEVycm9yOgogICAgICAgICAgICAgICAgICAgIGJyZWFrICAjIE5vIG1vcmUgbWFwcGluZ3MKICAgICAgICAKICAgICAgICBpZiBkaXJlY3Rpb24gaW4gWydyeCcsICdhbGwnXToKICAgICAgICAgICAgYmFzZV9pbmRleCA9IDB4MzEwMAogICAgICAgICAgICB3aGlsZSBUcnVlOgogICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgIHNkb19jbGllbnQud3JpdGUoYmFzZV9pbmRleCwgMSwgMCkKICAgICAgICAgICAgICAgIGV4Y2VwdCBTRE9BYm9ydEVycm9yOgogICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgCiAgICAgICAgCiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgX3NlbmRfZXJyb3Ioc3RyKGUpLCAnQ0FOLU1BUC1DTEVBUi1FUlJPUicpCgoKZGVmIGV4cG9ydENhbk1hcEpzb24oKToKICAgICIiIgogICAgRXhwb3J0IENBTiBtYXBwaW5ncyBhcyBKU09OIGZvciBkb3dubG9hZC4KICAgICIiIgogICAgaWYgbm90IGRldmljZV9jb25uZWN0ZWQgb3Igc2RvX2NsaWVudCBpcyBOb25lOgogICAgICAgIF9zZW5kX2Vycm9yKCJEZXZpY2Ugbm90IGNvbm5lY3RlZCIsICdDQU4tTUFQLUVYUE9SVC1FUlJPUicpCiAgICAgICAgcmV0dXJuCiAgICAKICAgICMgVXNlIGdldENhbk1hcCB0byByZWFkIG1hcHBpbmdzLCB0aGVuIGZvcm1hdCBmb3IgZXhwb3J0CiAgICB0cnk6CiAgICAgICAgIyBUaGlzIGlzIGEgc2ltcGxpZmllZCB2ZXJzaW9uIC0gcmVhbCBpbXBsZW1lbnRhdGlvbiB3b3VsZAogICAgICAgICMgY2FsbCBpbnRlcm5hbCBtYXBwaW5nIHJlYWQgbG9naWMKICAgICAgICBfc2VuZF9lcnJvcigiRXhwb3J0IG5vdCB5ZXQgaW1wbGVtZW50ZWQiLCAnQ0FOLU1BUC1FWFBPUlQtRVJST1InKQogICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgIF9zZW5kX2Vycm9yKHN0cihlKSwgJ0NBTi1NQVAtRVhQT1JULUVSUk9SJykKCgpkZWYgaW1wb3J0Q2FuTWFwSnNvbihhcmdzKToKICAgICIiIgogICAgSW1wb3J0IENBTiBtYXBwaW5ncyBmcm9tIEpTT04uCiAgICAKICAgIEFyZ3MgKGRpY3QpOgogICAgICAgIG1hcHBpbmdzOiBKU09OIHN0cnVjdHVyZSB3aXRoIFRYL1JYIG1hcHBpbmdzCiAgICAgICAgY2xlYXJfZXhpc3Rpbmc6IFdoZXRoZXIgdG8gY2xlYXIgZXhpc3RpbmcgbWFwcGluZ3MgZmlyc3QKICAgICIiIgogICAgaWYgbm90IGRldmljZV9jb25uZWN0ZWQgb3Igc2RvX2NsaWVudCBpcyBOb25lOgogICAgICAgIF9zZW5kX2Vycm9yKCJEZXZpY2Ugbm90IGNvbm5lY3RlZCIsICdDQU4tTUFQLUlNUE9SVC1FUlJPUicpCiAgICAgICAgcmV0dXJuCiAgICAKICAgIF9zZW5kX2Vycm9yKCJJbXBvcnQgbm90IHlldCBpbXBsZW1lbnRlZCIsICdDQU4tTUFQLUlNUE9SVC1FUlJPUicpCgoKIyBMZWdhY3kgZnVuY3Rpb25zIC0ga2VwdCBmb3IgYmFja3dhcmRzIGNvbXBhdGliaWxpdHkgYnV0IGRlcHJlY2F0ZWQKZGVmIG1hcENhblNwb3RWYWx1ZShhcmdzKToKICAgICIiIkRFUFJFQ0FURUQ6IFVzZSBhZGRDYW5NYXBwaW5nIGluc3RlYWQiIiIKICAgIGFkZENhbk1hcHBpbmcoYXJncykKCgpkZWYgdW5tYXBDYW5TcG90VmFsdWUoYXJncyk6CiAgICAiIiJERVBSRUNBVEVEOiBVc2UgcmVtb3ZlQ2FuTWFwcGluZyBpbnN0ZWFkIiIiCiAgICByZW1vdmVDYW5NYXBwaW5nKGFyZ3MpCgoKZGVmIGdldENhbk1hcHBpbmdEYXRhKCk6CiAgICAiIiJERVBSRUNBVEVEOiBVc2UgZ2V0Q2FuTWFwIGluc3RlYWQiIiIKICAgIGdldENhbk1hcCgpCgoKIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiMgRGV2aWNlIENvbW1hbmRzCiMgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQoKZGVmIGRldmljZVNhdmUoKToKICAgICIiIgogICAgU2F2ZSBwYXJhbWV0ZXJzIGFuZCBDQU4gbWFwcGluZ3MgdG8gZGV2aWNlIGZsYXNoLgogICAgCiAgICBDb21tYW5kcyB1c2UgU0RPIGluZGV4IDB4MzAwNC4KICAgICIiIgogICAgaWYgbm90IGRldmljZV9jb25uZWN0ZWQgb3Igc2RvX2NsaWVudCBpcyBOb25lOgogICAgICAgIF9zZW5kX2Vycm9yKCJEZXZpY2Ugbm90IGNvbm5lY3RlZCIsICdERVZJQ0UtU0FWRS1FUlJPUicpCiAgICAgICAgcmV0dXJuCiAgICAKICAgIHRyeToKICAgICAgICAjIFNlbmQgc2F2ZSBjb21tYW5kIChzdWJpbmRleCAxKQogICAgICAgIHNkb19jbGllbnQud3JpdGUoMHgzMDA0LCAxLCAwKQogICAgZXhjZXB0IChTRE9UaW1lb3V0RXJyb3IsIFNET0Fib3J0RXJyb3IpIGFzIGU6CiAgICAgICAgX3NlbmRfZXJyb3Ioc3RyKGUpLCAnREVWSUNFLVNBVkUtRVJST1InKQogICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgIF9zZW5kX2Vycm9yKHN0cihlKSwgJ0RFVklDRS1TQVZFLUVSUk9SJykKCgpkZWYgZGV2aWNlTG9hZCgpOgogICAgIiIiCiAgICBMb2FkIHBhcmFtZXRlcnMgYW5kIENBTiBtYXBwaW5ncyBmcm9tIGRldmljZSBmbGFzaC4KICAgICIiIgogICAgaWYgbm90IGRldmljZV9jb25uZWN0ZWQgb3Igc2RvX2NsaWVudCBpcyBOb25lOgogICAgICAgIF9zZW5kX2Vycm9yKCJEZXZpY2Ugbm90IGNvbm5lY3RlZCIsICdERVZJQ0UtTE9BRC1FUlJPUicpCiAgICAgICAgcmV0dXJuCiAgICAKICAgIHRyeToKICAgICAgICAjIFNlbmQgbG9hZCBjb21tYW5kIChzdWJpbmRleCAyKQogICAgICAgIHNkb19jbGllbnQud3JpdGUoMHgzMDA0LCAyLCAwKQogICAgZXhjZXB0IChTRE9UaW1lb3V0RXJyb3IsIFNET0Fib3J0RXJyb3IpIGFzIGU6CiAgICAgICAgX3NlbmRfZXJyb3Ioc3RyKGUpLCAnREVWSUNFLUxPQUQtRVJST1InKQogICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgIF9zZW5kX2Vycm9yKHN0cihlKSwgJ0RFVklDRS1MT0FELUVSUk9SJykKCgpkZWYgZGV2aWNlUmVzZXQoKToKICAgICIiIgogICAgUmVzZXQvcmVib290IHRoZSBkZXZpY2UuCiAgICAiIiIKICAgIGlmIG5vdCBkZXZpY2VfY29ubmVjdGVkIG9yIHNkb19jbGllbnQgaXMgTm9uZToKICAgICAgICBfc2VuZF9lcnJvcigiRGV2aWNlIG5vdCBjb25uZWN0ZWQiLCAnREVWSUNFLVJFU0VULUVSUk9SJykKICAgICAgICByZXR1cm4KICAgIAogICAgdHJ5OgogICAgICAgICMgU2VuZCByZXNldCBjb21tYW5kIChzdWJpbmRleCAzKQogICAgICAgIHNkb19jbGllbnQud3JpdGUoMHgzMDA0LCAzLCAwKQogICAgZXhjZXB0IChTRE9UaW1lb3V0RXJyb3IsIFNET0Fib3J0RXJyb3IpIGFzIGU6CiAgICAgICAgX3NlbmRfZXJyb3Ioc3RyKGUpLCAnREVWSUNFLVJFU0VULUVSUk9SJykKICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICBfc2VuZF9lcnJvcihzdHIoZSksICdERVZJQ0UtUkVTRVQtRVJST1InKQoKCmRlZiBkZXZpY2VMb2FkRGVmYXVsdHMoKToKICAgICIiIgogICAgTG9hZCBkZWZhdWx0IHBhcmFtZXRlcnMgKGZhY3RvcnkgcmVzZXQpLgogICAgIiIiCiAgICBpZiBub3QgZGV2aWNlX2Nvbm5lY3RlZCBvciBzZG9fY2xpZW50IGlzIE5vbmU6CiAgICAgICAgX3NlbmRfZXJyb3IoIkRldmljZSBub3QgY29ubmVjdGVkIiwgJ0RFVklDRS1ERUZBVUxUUy1FUlJPUicpCiAgICAgICAgcmV0dXJuCiAgICAKICAgIHRyeToKICAgICAgICAjIFNlbmQgbG9hZCBkZWZhdWx0cyBjb21tYW5kIChzdWJpbmRleCA0KQogICAgICAgIHNkb19jbGllbnQud3JpdGUoMHgzMDA0LCA0LCAwKQogICAgZXhjZXB0IChTRE9UaW1lb3V0RXJyb3IsIFNET0Fib3J0RXJyb3IpIGFzIGU6CiAgICAgICAgX3NlbmRfZXJyb3Ioc3RyKGUpLCAnREVWSUNFLURFRkFVTFRTLUVSUk9SJykKICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICBfc2VuZF9lcnJvcihzdHIoZSksICdERVZJQ0UtREVGQVVMVFMtRVJST1InKQoKCmRlZiBkZXZpY2VTdGFydChhcmdzPU5vbmUpOgogICAgIiIiCiAgICBTdGFydCBkZXZpY2Ugb3BlcmF0aW9uIGluIHNwZWNpZmllZCBtb2RlLgogICAgCiAgICBBcmdzIChkaWN0LCBvcHRpb25hbCk6CiAgICAgICAgbW9kZTogT3BlcmF0aW5nIG1vZGUgKDA9Tm9ybWFsLCAxPU1hbnVhbCwgMj1Cb29zdCwgMz1CdWNrLCA0PVNpbmUsIDU9QUNIZWF0KQogICAgIiIiCiAgICBpZiBub3QgZGV2aWNlX2Nvbm5lY3RlZCBvciBzZG9fY2xpZW50IGlzIE5vbmU6CiAgICAgICAgX3NlbmRfZXJyb3IoIkRldmljZSBub3QgY29ubmVjdGVkIiwgJ0RFVklDRS1TVEFSVC1FUlJPUicpCiAgICAgICAgcmV0dXJuCiAgICAKICAgIG1vZGUgPSBhcmdzLmdldCgnbW9kZScsIDApIGlmIGFyZ3MgZWxzZSAwCiAgICAKICAgIHRyeToKICAgICAgICAjIFNlbmQgc3RhcnQgY29tbWFuZCAoc3ViaW5kZXggNSkgd2l0aCBtb2RlCiAgICAgICAgc2RvX2NsaWVudC53cml0ZSgweDMwMDQsIDUsIG1vZGUpCiAgICAgICAgbW9kZV9uYW1lcyA9IHswOiAnTm9ybWFsJywgMTogJ01hbnVhbCcsIDI6ICdCb29zdCcsIDM6ICdCdWNrJywgNDogJ1NpbmUnLCA1OiAnQUNIZWF0J30KICAgICAgICBtb2RlX25hbWUgPSBtb2RlX25hbWVzLmdldChtb2RlLCBmJ01vZGUge21vZGV9JykKICAgIGV4Y2VwdCAoU0RPVGltZW91dEVycm9yLCBTRE9BYm9ydEVycm9yKSBhcyBlOgogICAgICAgIF9zZW5kX2Vycm9yKHN0cihlKSwgJ0RFVklDRS1TVEFSVC1FUlJPUicpCiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgX3NlbmRfZXJyb3Ioc3RyKGUpLCAnREVWSUNFLVNUQVJULUVSUk9SJykKCgpkZWYgZGV2aWNlU3RvcCgpOgogICAgIiIiCiAgICBTdG9wIGRldmljZSBvcGVyYXRpb24uCiAgICAiIiIKICAgIGlmIG5vdCBkZXZpY2VfY29ubmVjdGVkIG9yIHNkb19jbGllbnQgaXMgTm9uZToKICAgICAgICBfc2VuZF9lcnJvcigiRGV2aWNlIG5vdCBjb25uZWN0ZWQiLCAnREVWSUNFLVNUT1AtRVJST1InKQogICAgICAgIHJldHVybgogICAgCiAgICB0cnk6CiAgICAgICAgIyBTZW5kIHN0b3AgY29tbWFuZCAoc3ViaW5kZXggNikKICAgICAgICBzZG9fY2xpZW50LndyaXRlKDB4MzAwNCwgNiwgMCkKICAgIGV4Y2VwdCAoU0RPVGltZW91dEVycm9yLCBTRE9BYm9ydEVycm9yKSBhcyBlOgogICAgICAgIF9zZW5kX2Vycm9yKHN0cihlKSwgJ0RFVklDRS1TVE9QLUVSUk9SJykKICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICBfc2VuZF9lcnJvcihzdHIoZSksICdERVZJQ0UtU1RPUC1FUlJPUicpCgoKIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiMgRGV2aWNlIEluZm8gYW5kIEVycm9yIExvZwojID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KCmRlZiBnZXRTZXJpYWxOdW1iZXIoKToKICAgICIiIgogICAgUmVhZCBkZXZpY2Ugc2VyaWFsIG51bWJlci4KICAgIAogICAgU2VyaWFsIG51bWJlciBpcyBhdCBTRE8gMHg1MDAwLCBzdWJpbmRleCAwLTIgKDMgcGFydHMpLgogICAgIiIiCiAgICBpZiBub3QgZGV2aWNlX2Nvbm5lY3RlZCBvciBzZG9fY2xpZW50IGlzIE5vbmU6CiAgICAgICAgX3NlbmRfZXJyb3IoIkRldmljZSBub3QgY29ubmVjdGVkIiwgJ1NFUklBTC1OVU1CRVItRVJST1InKQogICAgICAgIHJldHVybgogICAgCiAgICB0cnk6CiAgICAgICAgIyBSZWFkIDMgcGFydHMgb2Ygc2VyaWFsIG51bWJlcgogICAgICAgIHNlcmlhbF9wYXJ0cyA9IFtdCiAgICAgICAgZm9yIGkgaW4gcmFuZ2UoMyk6CiAgICAgICAgICAgIHBhcnQgPSBzZG9fY2xpZW50LnJlYWQoMHg1MDAwLCBpKQogICAgICAgICAgICAjIEZvcm1hdCBhcyBoZXggc3RyaW5nCiAgICAgICAgICAgIHNlcmlhbF9wYXJ0cy5hcHBlbmQoZiJ7cGFydDowOFh9IikKICAgICAgICAKICAgICAgICBzZXJpYWxfbnVtYmVyID0gIjoiLmpvaW4oc2VyaWFsX3BhcnRzKQogICAgICAgIF9zZW5kX3Jlc3BvbnNlKCdTRVJJQUwtTlVNQkVSJywgeydzZXJpYWxOdW1iZXInOiBzZXJpYWxfbnVtYmVyfSkKICAgIGV4Y2VwdCAoU0RPVGltZW91dEVycm9yLCBTRE9BYm9ydEVycm9yKSBhcyBlOgogICAgICAgIF9zZW5kX2Vycm9yKHN0cihlKSwgJ1NFUklBTC1OVU1CRVItRVJST1InKQogICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgIF9zZW5kX2Vycm9yKHN0cihlKSwgJ1NFUklBTC1OVU1CRVItRVJST1InKQoKCmRlZiBnZXREZXZpY2VJbmZvKCk6CiAgICAiIiIKICAgIEdldCBkZXZpY2UgaW5mb3JtYXRpb24gKGZpcm13YXJlIHZlcnNpb24sIHVwdGltZSwgZXRjKS4KICAgICIiIgogICAgaWYgbm90IGRldmljZV9jb25uZWN0ZWQgb3Igc2RvX2NsaWVudCBpcyBOb25lOgogICAgICAgIF9zZW5kX2Vycm9yKCJEZXZpY2Ugbm90IGNvbm5lY3RlZCIsICdERVZJQ0UtSU5GTy1FUlJPUicpCiAgICAgICAgcmV0dXJuCiAgICAKICAgIHRyeToKICAgICAgICBpbmZvID0gewogICAgICAgICAgICAnY29ubmVjdGVkJzogVHJ1ZSwKICAgICAgICAgICAgJ25vZGVJZCc6IGRldmljZV9ub2RlX2lkLAogICAgICAgICAgICAnYml0cmF0ZSc6IGRldmljZV9iaXRyYXRlCiAgICAgICAgfQogICAgICAgIAogICAgICAgICMgVHJ5IHRvIHJlYWQgc2VyaWFsIG51bWJlcgogICAgICAgIHRyeToKICAgICAgICAgICAgc2VyaWFsX3BhcnRzID0gW10KICAgICAgICAgICAgZm9yIGkgaW4gcmFuZ2UoMyk6CiAgICAgICAgICAgICAgICBwYXJ0ID0gc2RvX2NsaWVudC5yZWFkKDB4NTAwMCwgaSkKICAgICAgICAgICAgICAgIHNlcmlhbF9wYXJ0cy5hcHBlbmQoZiJ7cGFydDowOFh9IikKICAgICAgICAgICAgaW5mb1snc2VyaWFsTnVtYmVyJ10gPSAiOiIuam9pbihzZXJpYWxfcGFydHMpCiAgICAgICAgZXhjZXB0OgogICAgICAgICAgICBpbmZvWydzZXJpYWxOdW1iZXInXSA9ICdVbmtub3duJwogICAgICAgIAogICAgICAgICMgVHJ5IHRvIHJlYWQgdXB0aW1lIChjb21tb24gc3BvdCB2YWx1ZSkKICAgICAgICB0cnk6CiAgICAgICAgICAgIGlmICd1cHRpbWUnIGluIHBhcmFtZXRlcnM6CiAgICAgICAgICAgICAgICBwYXJhbV9pZCA9IHBhcmFtZXRlcnNbJ3VwdGltZSddLmdldCgnaWQnKQogICAgICAgICAgICAgICAgaWYgcGFyYW1faWQ6CiAgICAgICAgICAgICAgICAgICAgaW5kZXgsIHN1YmluZGV4ID0gcGFyYW1faWRfdG9fc2RvKHBhcmFtX2lkKQogICAgICAgICAgICAgICAgICAgIHJhd192YWx1ZSA9IHNkb19jbGllbnQucmVhZChpbmRleCwgc3ViaW5kZXgpCiAgICAgICAgICAgICAgICAgICAgaW5mb1sndXB0aW1lJ10gPSBmaXhlZF90b19mbG9hdChyYXdfdmFsdWUpCiAgICAgICAgZXhjZXB0OgogICAgICAgICAgICBwYXNzCiAgICAgICAgCiAgICAgICAgX3NlbmRfcmVzcG9uc2UoJ0RFVklDRS1JTkZPJywgaW5mbykKICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICBfc2VuZF9lcnJvcihzdHIoZSksICdERVZJQ0UtSU5GTy1FUlJPUicpCgoKZGVmIGdldEVycm9yTG9nKCk6CiAgICAiIiIKICAgIEdldCBlcnJvciBsb2cgZnJvbSBkZXZpY2UuCiAgICAKICAgIEVycm9yIHRpbWVzIGF0IFNETyAweDIwMDEsIGVycm9yIGNvZGVzIGF0IDB4MjAwMi4KICAgICIiIgogICAgaWYgbm90IGRldmljZV9jb25uZWN0ZWQgb3Igc2RvX2NsaWVudCBpcyBOb25lOgogICAgICAgIF9zZW5kX2Vycm9yKCJEZXZpY2Ugbm90IGNvbm5lY3RlZCIsICdFUlJPUi1MT0ctRVJST1InKQogICAgICAgIHJldHVybgogICAgCiAgICB0cnk6CiAgICAgICAgZXJyb3JzID0gW10KICAgICAgICAKICAgICAgICAjIFJlYWQgZXJyb3IgbG9nICh1cCB0byAyNTUgZW50cmllcykKICAgICAgICBmb3IgaSBpbiByYW5nZSgyNTUpOgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAjIFJlYWQgZXJyb3IgdGltZQogICAgICAgICAgICAgICAgZXJyb3JfdGltZSA9IHNkb19jbGllbnQucmVhZCgweDIwMDEsIGkpCiAgICAgICAgICAgICAgICBpZiBlcnJvcl90aW1lID09IDA6CiAgICAgICAgICAgICAgICAgICAgYnJlYWsgICMgTm8gbW9yZSBlcnJvcnMKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBSZWFkIGVycm9yIGNvZGUKICAgICAgICAgICAgICAgIGVycm9yX2NvZGUgPSBzZG9fY2xpZW50LnJlYWQoMHgyMDAyLCBpKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBlcnJvcnMuYXBwZW5kKHsKICAgICAgICAgICAgICAgICAgICAndGltZXN0YW1wJzogZXJyb3JfdGltZSwKICAgICAgICAgICAgICAgICAgICAnY29kZSc6IGVycm9yX2NvZGUsCiAgICAgICAgICAgICAgICAgICAgJ2Rlc2NyaXB0aW9uJzogZiJFcnJvciBjb2RlIHtlcnJvcl9jb2RlfSIKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgIGV4Y2VwdCAoU0RPVGltZW91dEVycm9yLCBTRE9BYm9ydEVycm9yKToKICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgCiAgICAgICAgX3NlbmRfcmVzcG9uc2UoJ0VSUk9SLUxPRycsIGVycm9ycykKICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICBfc2VuZF9lcnJvcihzdHIoZSksICdFUlJPUi1MT0ctRVJST1InKQoKCiMgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQojIFN0cmVhbWluZyBNb2RlIENvbnRyb2wKIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CgpkZWYgc3RhcnRMaXZlU3RyZWFtaW5nKGNhbl9pZHMpOgogICAgIiIiCiAgICBTdGFydCBDIHN0cmVhbWluZyBtb2RlIGZvciBoaWdoLXNwZWVkIGRhdGEgYWNxdWlzaXRpb24uCiAgICAKICAgIEFyZ3M6CiAgICAgICAgY2FuX2lkczogTGlzdCBvZiBDQU4gSURzIHRvIHN0cmVhbQogICAgCiAgICBOT1RFOiBDYW5ub3QgZG8gU0RPIG9wZXJhdGlvbnMgd2hpbGUgc3RyZWFtaW5nIQogICAgIiIiCiAgICBnbG9iYWwgc3RyZWFtaW5nX2FjdGl2ZQogICAgCiAgICBpZiBDQU4gaXMgTm9uZSBvciBjYW5fZGV2IGlzIE5vbmU6CiAgICAgICAgX3NlbmRfZXJyb3IoIkNBTiBub3QgYXZhaWxhYmxlIiwgJ1NUUkVBTUlORy1TVEFSVC1FUlJPUicpCiAgICAgICAgcmV0dXJuCiAgICAKICAgIHRyeToKICAgICAgICAjIENvbmZpZ3VyZSBoYXJkd2FyZSBmaWx0ZXJzCiAgICAgICAgY2FuX2Rldi5zZXRfZmlsdGVyKGNhbl9pZHMpCiAgICAgICAgCiAgICAgICAgIyBTdGFydCBzdHJlYW1pbmcKICAgICAgICBjYW5fZGV2LnN0cmVhbV9zdGFydCgpCiAgICAgICAgCiAgICAgICAgc3RyZWFtaW5nX2FjdGl2ZSA9IFRydWUKICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICBfc2VuZF9lcnJvcihzdHIoZSksICdTVFJFQU1JTkctU1RBUlQtRVJST1InKQoKCmRlZiBzdG9wTGl2ZVN0cmVhbWluZygpOgogICAgIiIiCiAgICBTdG9wIEMgc3RyZWFtaW5nIG1vZGUgYW5kIHJldHVybiB0byBjb25maWd1cmF0aW9uIG1vZGUuCiAgICAiIiIKICAgIGdsb2JhbCBzdHJlYW1pbmdfYWN0aXZlCiAgICAKICAgIGlmIENBTiBpcyBOb25lIG9yIGNhbl9kZXYgaXMgTm9uZToKICAgICAgICBfc2VuZF9lcnJvcigiQ0FOIG5vdCBhdmFpbGFibGUiLCAnU1RSRUFNSU5HLVNUT1AtRVJST1InKQogICAgICAgIHJldHVybgogICAgCiAgICB0cnk6CiAgICAgICAgIyBTdG9wIHN0cmVhbWluZwogICAgICAgIGNhbl9kZXYuc3RyZWFtX3N0b3AoKQogICAgICAgIAogICAgICAgIHN0cmVhbWluZ19hY3RpdmUgPSBGYWxzZQogICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgIF9zZW5kX2Vycm9yKHN0cihlKSwgJ1NUUkVBTUlORy1TVE9QLUVSUk9SJykKCgojID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KIyBMZWdhY3kvRGVwcmVjYXRlZCBGdW5jdGlvbnMKIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CgpkZWYgZ2V0U3lzSW5mbygpOgogICAgIiIiREVQUkVDQVRFRDogVXNlIGdldERldmljZUluZm8gaW5zdGVhZCIiIgogICAgZ2V0RGV2aWNlSW5mbygpCgoKZGVmIGFjdGlvbkJ1dHRvbihhcmdzKToKICAgICIiIkRFUFJFQ0FURUQ6IFVzZSBkZXZpY2UgY29tbWFuZCBmdW5jdGlvbnMgaW5zdGVhZCIiIgogICAgX3NlbmRfZXJyb3IoIkFjdGlvbiBidXR0b24gbm90IGltcGxlbWVudGVkLCB1c2UgZGV2aWNlU3RhcnQvZGV2aWNlU3RvcCBpbnN0ZWFkIiwgIkFDVElPTl9CVVRUT05fRVJST1IiKQoKCmRlZiB0ZXJtQ21kKGFyZ3MpOgogICAgIiIiREVQUkVDQVRFRDogRGlyZWN0IHRlcm1pbmFsIGNvbW1hbmRzIG5vdCBzdXBwb3J0ZWQiIiIKICAgIF9zZW5kX2Vycm9yKCJUZXJtaW5hbCBjb21tYW5kIG5vdCBpbXBsZW1lbnRlZCIsICJURVJNX0NNRF9FUlJPUiIpCgoKIyBMZWdhY3kgc2F2ZVBhcmFtZXRlcnMgLSBub3cgdXNlcyBkZXZpY2VTYXZlCmRlZiBzYXZlUGFyYW1ldGVycygpOgogICAgIiIiREVQUkVDQVRFRDogVXNlIGRldmljZVNhdmUgaW5zdGVhZCIiIgogICAgZGV2aWNlU2F2ZSgpCgoKIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiMgRmlybXdhcmUgVXBncmFkZSBGdW5jdGlvbnMKIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CgojIEdsb2JhbCBmaXJtd2FyZSB1cGdyYWRlIHN0YXRlCmZpcm13YXJlX3VwZ3JhZGVfc3RhdGUgPSB7CiAgICAnYWN0aXZlJzogRmFsc2UsCiAgICAnZmlybXdhcmVfZGF0YSc6IE5vbmUsCiAgICAncGFnZXMnOiBbXSwKICAgICdjdXJyZW50X3BhZ2UnOiAwLAogICAgJ3Byb2dyZXNzJzogMC4wLAogICAgJ3N0YXRlJzogJ2lkbGUnLCAgIyBpZGxlLCB3YWl0aW5nX2hlbGxvLCB3YWl0aW5nX3N0YXJ0LCB1cGxvYWRpbmcsIGNoZWNraW5nX2NyYywgZG9uZSwgZXJyb3IKICAgICdtZXNzYWdlJzogJycsCiAgICAnZXJyb3InOiBOb25lLAogICAgJ3RhcmdldF9zZXJpYWwnOiBOb25lCn0KCiMgQ0FOIElEcyBmb3IgZmlybXdhcmUgdXBncmFkZSBwcm90b2NvbApERVZJQ0VfQ0FOX0lEID0gMHg3REUKVVBHUkFERVJfQ0FOX0lEID0gMHg3REQKUEFHRV9TSVpFID0gMTAyNAoKIyBEZXZpY2UgcGFja2V0IHR5cGVzClBBQ0tFVF9IRUxMTyA9IDB4MzMgICAjICczJwpQQUNLRVRfU1RBUlQgPSAweDUzICAgIyAnUycKUEFDS0VUX1BBR0UgPSAweDUwICAgICMgJ1AnClBBQ0tFVF9DUkMgPSAweDQzICAgICAjICdDJwpQQUNLRVRfRE9ORSA9IDB4NDQgICAgIyAnRCcKUEFDS0VUX0VSUk9SID0gMHg0NSAgICMgJ0UnCgoKZGVmIHN0bV9jcmMzMihkYXRhKToKICAgICIiIgogICAgQ29tcHV0ZSBDUkMtMzIvTVBFRy0yIGFzIGV4cGVjdGVkIGJ5IE9wZW5JbnZlcnRlciBib290bG9hZGVyLgogICAgCiAgICBVc2VzOgogICAgLSB3aWR0aD0zMgogICAgLSBwb2x5PTB4MDRjMTFkYjcKICAgIC0gaW5pdD0weGZmZmZmZmZmCiAgICAtIHJlZmluPWZhbHNlIChub3QgcmVmbGVjdGVkKQogICAgLSByZWZvdXQ9ZmFsc2UKICAgIC0geG9yb3V0PTAgKG5vIHBvc3QtY29tcGxlbWVudCkKICAgIAogICAgRGF0YSBpcyBwcm9jZXNzZWQgYXMgbGl0dGxlLWVuZGlhbiAzMi1iaXQgd29yZHMuCiAgICAiIiIKICAgIGNyYyA9IDB4ZmZmZmZmZmYKICAgIAogICAgIyBQcm9jZXNzIGRhdGEgaW4gNC1ieXRlICgzMi1iaXQpIGNodW5rcyBhcyBsaXR0bGUtZW5kaWFuIHdvcmRzCiAgICBmb3IgaSBpbiByYW5nZSgwLCBsZW4oZGF0YSksIDQpOgogICAgICAgICMgR2V0IDQgYnl0ZXMgYXMgbGl0dGxlLWVuZGlhbiB3b3JkCiAgICAgICAgd29yZCA9IChkYXRhW2ldIHwgCiAgICAgICAgICAgICAgICAoZGF0YVtpKzFdIDw8IDgpIHwgCiAgICAgICAgICAgICAgICAoZGF0YVtpKzJdIDw8IDE2KSB8IAogICAgICAgICAgICAgICAgKGRhdGFbaSszXSA8PCAyNCkpCiAgICAgICAgCiAgICAgICAgY3JjID0gY3JjIF4gd29yZAogICAgICAgIAogICAgICAgICMgUHJvY2VzcyAzMiBiaXRzCiAgICAgICAgZm9yIF8gaW4gcmFuZ2UoMzIpOgogICAgICAgICAgICBpZiBjcmMgJiAweDgwMDAwMDAwOgogICAgICAgICAgICAgICAgY3JjID0gKChjcmMgPDwgMSkgXiAweDA0QzExREI3KSAmIDB4ZmZmZmZmZmYKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIGNyYyA9IChjcmMgPDwgMSkgJiAweGZmZmZmZmZmCiAgICAKICAgIHJldHVybiBjcmMKCgpkZWYgdXBsb2FkRmlybXdhcmVDaHVuayhhcmdzKToKICAgICIiIgogICAgVXBsb2FkIGEgY2h1bmsgb2YgZmlybXdhcmUgZGF0YSB0byBkZXZpY2UgbWVtb3J5LgogICAgVGhpcyBpcyBjYWxsZWQgbXVsdGlwbGUgdGltZXMgdG8gdHJhbnNmZXIgdGhlIGVudGlyZSBmaXJtd2FyZSBmaWxlLgogICAgIiIiCiAgICBjaHVuayA9IGFyZ3MuZ2V0KCdjaHVuaycpCiAgICBvZmZzZXQgPSBhcmdzLmdldCgnb2Zmc2V0JywgMCkKICAgIAogICAgaWYgbm90IGNodW5rOgogICAgICAgIF9zZW5kX2Vycm9yKCJObyBjaHVuayBkYXRhIHByb3ZpZGVkIiwgJ0ZJUk1XQVJFLVVQTE9BRC1FUlJPUicpCiAgICAgICAgcmV0dXJuCiAgICAKICAgICMgU3RvcmUgY2h1bmsgaW4gZmlybXdhcmUgZGF0YSBidWZmZXIKICAgIGlmIGZpcm13YXJlX3VwZ3JhZGVfc3RhdGVbJ2Zpcm13YXJlX2RhdGEnXSBpcyBOb25lOgogICAgICAgIGZpcm13YXJlX3VwZ3JhZGVfc3RhdGVbJ2Zpcm13YXJlX2RhdGEnXSA9IGJ5dGVhcnJheSgpCiAgICAKICAgICMgRXh0ZW5kIGJ1ZmZlciBpZiBuZWVkZWQKICAgIHJlcXVpcmVkX3NpemUgPSBvZmZzZXQgKyBsZW4oY2h1bmspCiAgICBpZiBsZW4oZmlybXdhcmVfdXBncmFkZV9zdGF0ZVsnZmlybXdhcmVfZGF0YSddKSA8IHJlcXVpcmVkX3NpemU6CiAgICAgICAgZmlybXdhcmVfdXBncmFkZV9zdGF0ZVsnZmlybXdhcmVfZGF0YSddLmV4dGVuZChieXRlcyhyZXF1aXJlZF9zaXplIC0gbGVuKGZpcm13YXJlX3VwZ3JhZGVfc3RhdGVbJ2Zpcm13YXJlX2RhdGEnXSkpKQogICAgCiAgICAjIFdyaXRlIGNodW5rIGRhdGEKICAgIGZpcm13YXJlX3VwZ3JhZGVfc3RhdGVbJ2Zpcm13YXJlX2RhdGEnXVtvZmZzZXQ6b2Zmc2V0K2xlbihjaHVuayldID0gYnl0ZXMoY2h1bmspCgoKZGVmIHN0YXJ0RmlybXdhcmVVcGdyYWRlKGFyZ3MpOgogICAgIiIiCiAgICBTdGFydCB0aGUgZmlybXdhcmUgdXBncmFkZSBwcm9jZXNzLgogICAgCiAgICBBcmdzOgogICAgICAgIHJlY292ZXJ5X21vZGU6IGJvb2wgLSBJZiBUcnVlLCB3YWl0IGZvciBhbnkgZGV2aWNlIHRvIGJvb3QKICAgICAgICBzZXJpYWxfbnVtYmVyOiBzdHIgLSA4IGhleCBkaWdpdCBzZXJpYWwgKG9wdGlvbmFsLCBmb3IgcmVjb3ZlcnkgbW9kZSkKICAgICAgICBub2RlX2lkOiBpbnQgLSBOb2RlIElEIHRvIHVwZ3JhZGUgKGZvciBub3JtYWwgbW9kZSkKICAgICIiIgogICAgaWYgQ0FOIGlzIE5vbmUgb3IgY2FuX2RldiBpcyBOb25lOgogICAgICAgIF9zZW5kX2Vycm9yKCJDQU4gbm90IGF2YWlsYWJsZSIsICdGSVJNV0FSRS1VUEdSQURFLUVSUk9SJykKICAgICAgICByZXR1cm4KICAgIAogICAgcmVjb3ZlcnlfbW9kZSA9IGFyZ3MuZ2V0KCdyZWNvdmVyeV9tb2RlJywgRmFsc2UpCiAgICBzZXJpYWxfbnVtYmVyID0gYXJncy5nZXQoJ3NlcmlhbF9udW1iZXInKQogICAgbm9kZV9pZCA9IGFyZ3MuZ2V0KCdub2RlX2lkJywgZGV2aWNlX25vZGVfaWQpCiAgICAKICAgICMgVmFsaWRhdGUgZmlybXdhcmUgZGF0YQogICAgaWYgbm90IGZpcm13YXJlX3VwZ3JhZGVfc3RhdGVbJ2Zpcm13YXJlX2RhdGEnXToKICAgICAgICBfc2VuZF9lcnJvcigiTm8gZmlybXdhcmUgZGF0YSB1cGxvYWRlZCIsICdGSVJNV0FSRS1VUEdSQURFLUVSUk9SJykKICAgICAgICByZXR1cm4KICAgIAogICAgZmlybXdhcmVfZGF0YSA9IGZpcm13YXJlX3VwZ3JhZGVfc3RhdGVbJ2Zpcm13YXJlX2RhdGEnXQogICAgCiAgICAjIFZhbGlkYXRlIGZpcm13YXJlIGZvcm1hdAogICAgaWYgZmlybXdhcmVfZGF0YVswOjRdID09IGInXHg3ZkVMRic6CiAgICAgICAgX3NlbmRfZXJyb3IoIkVMRiBmaWxlcyBub3Qgc3VwcG9ydGVkLiBVc2UgLmJpbiBmaWxlIiwgJ0ZJUk1XQVJFLVVQR1JBREUtRVJST1InKQogICAgICAgIHJldHVybgogICAgCiAgICAjIERpdmlkZSBmaXJtd2FyZSBpbnRvIHBhZ2VzCiAgICBwYWdlcyA9IFtdCiAgICBmb3IgaSBpbiByYW5nZSgwLCBsZW4oZmlybXdhcmVfZGF0YSksIFBBR0VfU0laRSk6CiAgICAgICAgcGFnZV9kYXRhID0gZmlybXdhcmVfZGF0YVtpOmkrUEFHRV9TSVpFXQogICAgICAgICMgUGFkIGxhc3QgcGFnZSB0byBQQUdFX1NJWkUKICAgICAgICBpZiBsZW4ocGFnZV9kYXRhKSA8IFBBR0VfU0laRToKICAgICAgICAgICAgcGFnZV9kYXRhID0gcGFnZV9kYXRhICsgYnl0ZXMoUEFHRV9TSVpFIC0gbGVuKHBhZ2VfZGF0YSkpCiAgICAgICAgCiAgICAgICAgIyBDYWxjdWxhdGUgQ1JDIGZvciB0aGlzIHBhZ2UKICAgICAgICBwYWdlX2NyYyA9IHN0bV9jcmMzMihwYWdlX2RhdGEpCiAgICAgICAgcGFnZXMuYXBwZW5kKHsKICAgICAgICAgICAgJ2RhdGEnOiBwYWdlX2RhdGEsCiAgICAgICAgICAgICdjcmMnOiBwYWdlX2NyYwogICAgICAgIH0pCiAgICAKICAgIGlmIGxlbihwYWdlcykgPiAyNTU6CiAgICAgICAgX3NlbmRfZXJyb3IoIkZpcm13YXJlIHRvbyBsYXJnZSAobWF4IDI1NSBLaUIpIiwgJ0ZJUk1XQVJFLVVQR1JBREUtRVJST1InKQogICAgICAgIHJldHVybgogICAgCiAgICAjIFN0b3JlIHVwZ3JhZGUgc3RhdGUKICAgIGZpcm13YXJlX3VwZ3JhZGVfc3RhdGVbJ2FjdGl2ZSddID0gVHJ1ZQogICAgZmlybXdhcmVfdXBncmFkZV9zdGF0ZVsncGFnZXMnXSA9IHBhZ2VzCiAgICBmaXJtd2FyZV91cGdyYWRlX3N0YXRlWydjdXJyZW50X3BhZ2UnXSA9IDAKICAgIGZpcm13YXJlX3VwZ3JhZGVfc3RhdGVbJ3Byb2dyZXNzJ10gPSAwLjAKICAgIGZpcm13YXJlX3VwZ3JhZGVfc3RhdGVbJ3N0YXRlJ10gPSAnd2FpdGluZ19oZWxsbycKICAgIGZpcm13YXJlX3VwZ3JhZGVfc3RhdGVbJ21lc3NhZ2UnXSA9ICdXYWl0aW5nIGZvciBkZXZpY2UgdG8gYm9vdC4uLicKICAgIGZpcm13YXJlX3VwZ3JhZGVfc3RhdGVbJ2Vycm9yJ10gPSBOb25lCiAgICBmaXJtd2FyZV91cGdyYWRlX3N0YXRlWydwYWdlX3Bvc2l0aW9uJ10gPSAwCiAgICAKICAgICMgU2V0IHRhcmdldCBzZXJpYWwgaWYgcHJvdmlkZWQKICAgIGlmIHJlY292ZXJ5X21vZGUgYW5kIHNlcmlhbF9udW1iZXI6CiAgICAgICAgdHJ5OgogICAgICAgICAgICBmaXJtd2FyZV91cGdyYWRlX3N0YXRlWyd0YXJnZXRfc2VyaWFsJ10gPSBieXRlcy5mcm9taGV4KHNlcmlhbF9udW1iZXIpCiAgICAgICAgZXhjZXB0OgogICAgICAgICAgICBfc2VuZF9lcnJvcigiSW52YWxpZCBzZXJpYWwgbnVtYmVyIGZvcm1hdCIsICdGSVJNV0FSRS1VUEdSQURFLUVSUk9SJykKICAgICAgICAgICAgcmV0dXJuCiAgICBlbHNlOgogICAgICAgIGZpcm13YXJlX3VwZ3JhZGVfc3RhdGVbJ3RhcmdldF9zZXJpYWwnXSA9IE5vbmUKICAgIAogICAgIyBJZiBub3QgcmVjb3ZlcnkgbW9kZSwgcmVzZXQgdGhlIGRldmljZSB0byB0cmlnZ2VyIGJvb3Rsb2FkZXIKICAgIGlmIG5vdCByZWNvdmVyeV9tb2RlIGFuZCBzZG9fY2xpZW50OgogICAgICAgIHRyeToKICAgICAgICAgICAgIyBTZW5kIHJlc2V0IGNvbW1hbmQKICAgICAgICAgICAgc2RvX2NsaWVudC53cml0ZSgweDEwMDAsIDB4MDEsIDEpICAjIFJlc2V0IGNvbW1hbmQKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgICMgTG9nIGVycm9yIChwcmludCgpIG91dHB1dCBnb2VzIHRvIE0yTSBjaGFubmVsIGF1dG9tYXRpY2FsbHkpCiAgICAgICAgICAgIHByaW50KGYiW09JIEZpcm13YXJlXSBGYWlsZWQgdG8gcmVzZXQgZGV2aWNlOiB7ZX0iKQogICAgCiAgICAjIFNldCB1cCBDQU4gZmlsdGVyIGZvciB1cGdyYWRlIG1lc3NhZ2VzICgweDdERSkKICAgICMgVE9ETzogQ29uZmlndXJlIENBTiBmaWx0ZXIgZm9yIERFVklDRV9DQU5fSUQKICAgIAogICAgIyBSZXR1cm4gZGF0YSB2aWEgX3NlbmRfcmVzcG9uc2UgKHRoaXMgb25lIGFjdHVhbGx5IGhhcyBkYXRhIHRvIHJldHVybikKICAgIF9zZW5kX3Jlc3BvbnNlKCdGSVJNV0FSRS1VUEdSQURFLVNUQVJURUQnLCB7CiAgICAgICAgJ3N0YXJ0ZWQnOiBUcnVlLAogICAgICAgICdwYWdlcyc6IGxlbihwYWdlcyksCiAgICAgICAgJ3NpemUnOiBsZW4oZmlybXdhcmVfZGF0YSkKICAgIH0pCgoKZGVmIHByb2Nlc3NGaXJtd2FyZUNhbk1lc3NhZ2UoY2FuX2lkLCBkYXRhKToKICAgICIiIgogICAgUHJvY2VzcyBpbmNvbWluZyBDQU4gbWVzc2FnZXMgZHVyaW5nIGZpcm13YXJlIHVwZ3JhZGUuCiAgICBUaGlzIHNob3VsZCBiZSBjYWxsZWQgZnJvbSB0aGUgQ0FOIHJlY2VpdmUgaGFuZGxlci4KICAgICIiIgogICAgaWYgbm90IGZpcm13YXJlX3VwZ3JhZGVfc3RhdGVbJ2FjdGl2ZSddOgogICAgICAgIHJldHVybgogICAgCiAgICBpZiBjYW5faWQgIT0gREVWSUNFX0NBTl9JRDoKICAgICAgICByZXR1cm4KICAgIAogICAgc3RhdGUgPSBmaXJtd2FyZV91cGdyYWRlX3N0YXRlWydzdGF0ZSddCiAgICAKICAgICMgSGFuZGxlIEhFTExPIHBhY2tldCAoZGV2aWNlIGJvb3RpbmcpCiAgICBpZiBsZW4oZGF0YSkgPT0gOCBhbmQgZGF0YVswXSA9PSBQQUNLRVRfSEVMTE86CiAgICAgICAgaWYgc3RhdGUgIT0gJ3dhaXRpbmdfaGVsbG8nOgogICAgICAgICAgICByZXR1cm4KICAgICAgICAKICAgICAgICAjIEV4dHJhY3Qgc2VyaWFsIG51bWJlciAoYnl0ZXMgNC03LCBsaXR0bGUtZW5kaWFuKQogICAgICAgIGRldmljZV9zZXJpYWwgPSBkYXRhWzc6MzotMV0KICAgICAgICAKICAgICAgICAjIENoZWNrIGlmIHRoaXMgaXMgb3VyIHRhcmdldCBkZXZpY2UKICAgICAgICB0YXJnZXQgPSBmaXJtd2FyZV91cGdyYWRlX3N0YXRlWyd0YXJnZXRfc2VyaWFsJ10KICAgICAgICBpZiB0YXJnZXQgYW5kIGRldmljZV9zZXJpYWwgIT0gdGFyZ2V0OgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAKICAgICAgICAgICAgICAgIAogICAgICAgICMgUmVwbHkgd2l0aCBkZXZpY2UgaWRlbnRpZmllciAoc2VyaWFsIG51bWJlcikKICAgICAgICBjYW5fZGV2LnNlbmQobGlzdChkYXRhWzQ6OF0pLCBVUEdSQURFUl9DQU5fSUQpCiAgICAgICAgCiAgICAgICAgZmlybXdhcmVfdXBncmFkZV9zdGF0ZVsnc3RhdGUnXSA9ICd3YWl0aW5nX3N0YXJ0JwogICAgICAgIGZpcm13YXJlX3VwZ3JhZGVfc3RhdGVbJ21lc3NhZ2UnXSA9ICdEZXZpY2UgaWRlbnRpZmllZCwgd2FpdGluZyBmb3IgU1RBUlQuLi4nCiAgICAKICAgICMgSGFuZGxlIFNUQVJUIHBhY2tldAogICAgZWxpZiBsZW4oZGF0YSkgPT0gMSBhbmQgZGF0YVswXSA9PSBQQUNLRVRfU1RBUlQ6CiAgICAgICAgaWYgc3RhdGUgIT0gJ3dhaXRpbmdfc3RhcnQnOgogICAgICAgICAgICByZXR1cm4KICAgICAgICAKICAgICAgICAjIFJlcGx5IHdpdGggbnVtYmVyIG9mIHBhZ2VzCiAgICAgICAgbnVtX3BhZ2VzID0gbGVuKGZpcm13YXJlX3VwZ3JhZGVfc3RhdGVbJ3BhZ2VzJ10pCiAgICAgICAgY2FuX2Rldi5zZW5kKFtudW1fcGFnZXNdLCBVUEdSQURFUl9DQU5fSUQpCiAgICAgICAgCiAgICAgICAgZmlybXdhcmVfdXBncmFkZV9zdGF0ZVsnc3RhdGUnXSA9ICd1cGxvYWRpbmcnCiAgICAgICAgZmlybXdhcmVfdXBncmFkZV9zdGF0ZVsnY3VycmVudF9wYWdlJ10gPSAwCiAgICAgICAgZmlybXdhcmVfdXBncmFkZV9zdGF0ZVsncGFnZV9wb3NpdGlvbiddID0gMAogICAgICAgIGZpcm13YXJlX3VwZ3JhZGVfc3RhdGVbJ21lc3NhZ2UnXSA9ICdVcGxvYWRpbmcgZmlybXdhcmUuLi4nCiAgICAKICAgICMgSGFuZGxlIFBBR0UgcmVxdWVzdAogICAgZWxpZiBsZW4oZGF0YSkgPT0gMSBhbmQgZGF0YVswXSA9PSBQQUNLRVRfUEFHRToKICAgICAgICBpZiBzdGF0ZSAhPSAndXBsb2FkaW5nJzoKICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgCiAgICAgICAgcGFnZV9pZHggPSBmaXJtd2FyZV91cGdyYWRlX3N0YXRlWydjdXJyZW50X3BhZ2UnXQogICAgICAgIHBvcyA9IGZpcm13YXJlX3VwZ3JhZGVfc3RhdGVbJ3BhZ2VfcG9zaXRpb24nXQogICAgICAgIAogICAgICAgIGlmIHBhZ2VfaWR4ID49IGxlbihmaXJtd2FyZV91cGdyYWRlX3N0YXRlWydwYWdlcyddKToKICAgICAgICAgICAgIyBMb2cgZXJyb3IgKHByaW50KCkgb3V0cHV0IGdvZXMgdG8gTTJNIGNoYW5uZWwgYXV0b21hdGljYWxseSkKICAgICAgICAgICAgcHJpbnQoZiJbT0kgRmlybXdhcmVdIEVSUk9SOiBQYWdlIHJlcXVlc3QgYmV5b25kIGF2YWlsYWJsZSBwYWdlcyIpCiAgICAgICAgICAgIHJldHVybgogICAgICAgIAogICAgICAgIHBhZ2UgPSBmaXJtd2FyZV91cGdyYWRlX3N0YXRlWydwYWdlcyddW3BhZ2VfaWR4XQogICAgICAgIAogICAgICAgICMgU2VuZCA4IGJ5dGVzIG9mIHBhZ2UgZGF0YQogICAgICAgIGNodW5rID0gcGFnZVsnZGF0YSddW3Bvczpwb3MrOF0KICAgICAgICBjYW5fZGV2LnNlbmQobGlzdChjaHVuayksIFVQR1JBREVSX0NBTl9JRCkKICAgICAgICAKICAgICAgICBwb3MgKz0gOAogICAgICAgIGZpcm13YXJlX3VwZ3JhZGVfc3RhdGVbJ3BhZ2VfcG9zaXRpb24nXSA9IHBvcwogICAgICAgIAogICAgICAgICMgQ2hlY2sgaWYgcGFnZSBjb21wbGV0ZQogICAgICAgIGlmIHBvcyA+PSBQQUdFX1NJWkU6CiAgICAgICAgICAgIGZpcm13YXJlX3VwZ3JhZGVfc3RhdGVbJ3N0YXRlJ10gPSAnY2hlY2tpbmdfY3JjJwogICAgICAgICAgICBmaXJtd2FyZV91cGdyYWRlX3N0YXRlWydwYWdlX3Bvc2l0aW9uJ10gPSAwCiAgICAKICAgICMgSGFuZGxlIENSQyByZXF1ZXN0CiAgICBlbGlmIGxlbihkYXRhKSA9PSAxIGFuZCBkYXRhWzBdID09IFBBQ0tFVF9DUkM6CiAgICAgICAgaWYgc3RhdGUgIT0gJ2NoZWNraW5nX2NyYyc6CiAgICAgICAgICAgIHJldHVybgogICAgICAgIAogICAgICAgIHBhZ2VfaWR4ID0gZmlybXdhcmVfdXBncmFkZV9zdGF0ZVsnY3VycmVudF9wYWdlJ10KICAgICAgICBwYWdlID0gZmlybXdhcmVfdXBncmFkZV9zdGF0ZVsncGFnZXMnXVtwYWdlX2lkeF0KICAgICAgICAKICAgICAgICAjIFNlbmQgQ1JDIGFzIGxpdHRsZS1lbmRpYW4gMzItYml0IHZhbHVlCiAgICAgICAgY3JjID0gcGFnZVsnY3JjJ10KICAgICAgICBjcmNfYnl0ZXMgPSBbCiAgICAgICAgICAgIGNyYyAmIDB4RkYsCiAgICAgICAgICAgIChjcmMgPj4gOCkgJiAweEZGLAogICAgICAgICAgICAoY3JjID4+IDE2KSAmIDB4RkYsCiAgICAgICAgICAgIChjcmMgPj4gMjQpICYgMHhGRgogICAgICAgIF0KICAgICAgICBjYW5fZGV2LnNlbmQoY3JjX2J5dGVzLCBVUEdSQURFUl9DQU5fSUQpCiAgICAgICAgCiAgICAgICAgIyBNb3ZlIHRvIG5leHQgcGFnZQogICAgICAgIGZpcm13YXJlX3VwZ3JhZGVfc3RhdGVbJ2N1cnJlbnRfcGFnZSddICs9IDEKICAgICAgICBmaXJtd2FyZV91cGdyYWRlX3N0YXRlWydwcm9ncmVzcyddID0gKGZpcm13YXJlX3VwZ3JhZGVfc3RhdGVbJ2N1cnJlbnRfcGFnZSddICogMTAwLjApIC8gbGVuKGZpcm13YXJlX3VwZ3JhZGVfc3RhdGVbJ3BhZ2VzJ10pCiAgICAgICAgCiAgICAgICAgIyBDaGVjayBpZiBhbGwgcGFnZXMgZG9uZQogICAgICAgIGlmIGZpcm13YXJlX3VwZ3JhZGVfc3RhdGVbJ2N1cnJlbnRfcGFnZSddID49IGxlbihmaXJtd2FyZV91cGdyYWRlX3N0YXRlWydwYWdlcyddKToKICAgICAgICAgICAgZmlybXdhcmVfdXBncmFkZV9zdGF0ZVsnc3RhdGUnXSA9ICd3YWl0aW5nX2RvbmUnCiAgICAgICAgICAgIGZpcm13YXJlX3VwZ3JhZGVfc3RhdGVbJ21lc3NhZ2UnXSA9ICdXYWl0aW5nIGZvciBkZXZpY2UgdG8gZmluYWxpemUuLi4nCiAgICAgICAgZWxzZToKICAgICAgICAgICAgZmlybXdhcmVfdXBncmFkZV9zdGF0ZVsnc3RhdGUnXSA9ICd1cGxvYWRpbmcnCiAgICAKICAgICMgSGFuZGxlIERPTkUgcGFja2V0CiAgICBlbGlmIGxlbihkYXRhKSA9PSAxIGFuZCBkYXRhWzBdID09IFBBQ0tFVF9ET05FOgogICAgICAgIGlmIHN0YXRlICE9ICd3YWl0aW5nX2RvbmUnOgogICAgICAgICAgICByZXR1cm4KICAgICAgICAKICAgICAgICBmaXJtd2FyZV91cGdyYWRlX3N0YXRlWydhY3RpdmUnXSA9IEZhbHNlCiAgICAgICAgZmlybXdhcmVfdXBncmFkZV9zdGF0ZVsnc3RhdGUnXSA9ICdkb25lJwogICAgICAgIGZpcm13YXJlX3VwZ3JhZGVfc3RhdGVbJ3Byb2dyZXNzJ10gPSAxMDAuMAogICAgICAgIGZpcm13YXJlX3VwZ3JhZGVfc3RhdGVbJ21lc3NhZ2UnXSA9ICdVcGdyYWRlIGNvbXBsZXRlZCBzdWNjZXNzZnVsbHkhJwogICAgCiAgICAjIEhhbmRsZSBFUlJPUiBwYWNrZXQKICAgIGVsaWYgbGVuKGRhdGEpID09IDEgYW5kIGRhdGFbMF0gPT0gUEFDS0VUX0VSUk9SOgogICAgICAgICMgTG9nIGVycm9yIChwcmludCgpIG91dHB1dCBnb2VzIHRvIE0yTSBjaGFubmVsIGF1dG9tYXRpY2FsbHkpCiAgICAgICAgcHJpbnQoIltPSSBGaXJtd2FyZV0gRGV2aWNlIHJlcG9ydGVkIENSQyBFUlJPUiIpCiAgICAgICAgZmlybXdhcmVfdXBncmFkZV9zdGF0ZVsnYWN0aXZlJ10gPSBGYWxzZQogICAgICAgIGZpcm13YXJlX3VwZ3JhZGVfc3RhdGVbJ3N0YXRlJ10gPSAnZXJyb3InCiAgICAgICAgZmlybXdhcmVfdXBncmFkZV9zdGF0ZVsnZXJyb3InXSA9ICdDUkMgY2hlY2sgZmFpbGVkIG9uIGRldmljZScKICAgICAgICBmaXJtd2FyZV91cGdyYWRlX3N0YXRlWydtZXNzYWdlJ10gPSAnVXBncmFkZSBmYWlsZWQ6IENSQyBlcnJvcicKCgpkZWYgZ2V0RmlybXdhcmVVcGdyYWRlU3RhdHVzKCk6CiAgICAiIiIKICAgIEdldCBjdXJyZW50IHN0YXR1cyBvZiBmaXJtd2FyZSB1cGdyYWRlIHByb2Nlc3MuCiAgICAiIiIKICAgIHN0YXR1cyA9IHsKICAgICAgICAnYWN0aXZlJzogZmlybXdhcmVfdXBncmFkZV9zdGF0ZVsnYWN0aXZlJ10sCiAgICAgICAgJ3N0YXRlJzogZmlybXdhcmVfdXBncmFkZV9zdGF0ZVsnc3RhdGUnXSwKICAgICAgICAncHJvZ3Jlc3MnOiBmaXJtd2FyZV91cGdyYWRlX3N0YXRlWydwcm9ncmVzcyddLAogICAgICAgICdtZXNzYWdlJzogZmlybXdhcmVfdXBncmFkZV9zdGF0ZVsnbWVzc2FnZSddLAogICAgICAgICdlcnJvcic6IGZpcm13YXJlX3VwZ3JhZGVfc3RhdGVbJ2Vycm9yJ10sCiAgICAgICAgJ2NvbXBsZXRlJzogZmlybXdhcmVfdXBncmFkZV9zdGF0ZVsnc3RhdGUnXSA9PSAnZG9uZScKICAgIH0KICAgIAogICAgX3NlbmRfcmVzcG9uc2UoJ0ZJUk1XQVJFLVNUQVRVUycsIHN0YXR1cykKCgojID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KIyBDQU4gQnVzIFNjYW5uaW5nCiMgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQoKZGVmIHNjYW5DYW5CdXMoYXJncz1Ob25lKToKICAgICIiIgogICAgU2NhbiBDQU4gYnVzIGZvciBPcGVuSW52ZXJ0ZXIgZGV2aWNlcyB1c2luZyByb2J1c3QgU0RPIHNjYW5uaW5nLgogICAgCiAgICBBcmdzIChkaWN0IG9yIHN0ciwgb3B0aW9uYWwpOgogICAgICAgIElmIHN0cmluZywgd2lsbCBiZSBwYXJzZWQgYXMgSlNPTi4KICAgICAgICBxdWljazogSWYgVHJ1ZSwgb25seSBzY2FuIGNvbW1vbiBub2RlIElEcyAxLTEwIChkZWZhdWx0OiBUcnVlKQogICAgICAgIHRpbWVvdXRfbXM6IFRpbWVvdXQgcGVyIG5vZGUgaW4gbWlsbGlzZWNvbmRzIChkZWZhdWx0OiAxMDBtcykKICAgICAgICByYXRlX2xpbWl0X21zOiBEZWxheSBiZXR3ZWVuIHJlcXVlc3RzIGluIG1pbGxpc2Vjb25kcyAoZGVmYXVsdDogMTBtcykKICAgICAgICB0eF9waW46IENBTiBUWCBwaW4gKGRlZmF1bHQ6IDUpCiAgICAgICAgcnhfcGluOiBDQU4gUlggcGluIChkZWZhdWx0OiA0KQogICAgICAgIGJpdHJhdGU6IENBTiBiaXRyYXRlIChkZWZhdWx0OiA1MDAwMDApCiAgICAgICAgY2FuX21vZGU6IENBTiBtb2RlIC0gJ25vcm1hbCcgb3IgJ3NpbGVudCcgKGRlZmF1bHQ6ICdzaWxlbnQnIGZvciBzY2FubmluZykKICAgIAogICAgUmV0dXJucyBsaXN0IG9mIGRldGVjdGVkIG5vZGVzIHdpdGggdGhlaXIgZGV2aWNlIHR5cGVzIGFuZCBzZXJpYWwgbnVtYmVycy4KICAgICIiIgogICAgZ2xvYmFsIGNhbl9kZXYsIENBTgogICAgCiAgICAjIENoZWNrIGlmIENBTiBtb2R1bGUgaXMgYXZhaWxhYmxlCiAgICBpZiBDQU4gaXMgTm9uZToKICAgICAgICBfc2VuZF9lcnJvcigiQ0FOIG1vZHVsZSBub3QgYXZhaWxhYmxlIC0gY2hlY2sgaWYgQ0FOIG1vZHVsZSBpcyBpbnN0YWxsZWQiLCAnQ0FOLVNDQU4tRVJST1InKQogICAgICAgIHJldHVybgogICAgCiAgICAjIFBhcnNlIGFyZ3MgaWYgaXQncyBhIEpTT04gc3RyaW5nIChmcm9tIEphdmFTY3JpcHQgY2FsbHMpCiAgICBpZiBhcmdzIGlzIE5vbmU6CiAgICAgICAgYXJncyA9IHt9CiAgICBlbGlmIGlzaW5zdGFuY2UoYXJncywgc3RyKToKICAgICAgICB0cnk6CiAgICAgICAgICAgIGFyZ3MgPSBqc29uLmxvYWRzKGFyZ3MpCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBfc2VuZF9lcnJvcihmIkludmFsaWQgSlNPTiBhcmd1bWVudHM6IHtlfSIsICdDQU4tU0NBTi1FUlJPUicpCiAgICAgICAgICAgIHJldHVybgogICAgCiAgICAjIFBhcnNlIGFyZ3VtZW50cwogICAgcXVpY2tfc2NhbiA9IGFyZ3MuZ2V0KCdxdWljaycsIFRydWUpCiAgICB0aW1lb3V0X21zID0gYXJncy5nZXQoJ3RpbWVvdXRfbXMnLCAxMDApCiAgICByYXRlX2xpbWl0X21zID0gYXJncy5nZXQoJ3JhdGVfbGltaXRfbXMnLCAxMCkKICAgIGNhbl9tb2RlX3N0ciA9IGFyZ3MuZ2V0KCdjYW5fbW9kZScsICdzaWxlbnQnKSAgIyBEZWZhdWx0IHRvIFNJTEVOVCBmb3Igc2Nhbm5pbmcKICAgIAogICAgIyBSZWFkIENBTiBjb25maWd1cmF0aW9uIGZyb20gL2NvbmZpZy9jYW4uanNvbiAod2l0aCBmYWxsYmFjayB0byBtYWluLnB5KQogICAgdHhfcGluID0gYXJncy5nZXQoJ3R4X3BpbicpCiAgICByeF9waW4gPSBhcmdzLmdldCgncnhfcGluJykKICAgIGJpdHJhdGUgPSBhcmdzLmdldCgnYml0cmF0ZScpCiAgICAKICAgIGlmIHR4X3BpbiBpcyBOb25lIG9yIHJ4X3BpbiBpcyBOb25lIG9yIGJpdHJhdGUgaXMgTm9uZToKICAgICAgICAjIFRyeSB0byBsb2FkIGZyb20gL2NvbmZpZy9jYW4uanNvbgogICAgICAgIHRyeToKICAgICAgICAgICAgaW1wb3J0IG9zCiAgICAgICAgICAgIGNvbmZpZ19kaXIgPSAnL2NvbmZpZycKICAgICAgICAgICAgaWYgbm90IG9zLnBhdGguZXhpc3RzKGNvbmZpZ19kaXIpOgogICAgICAgICAgICAgICAgY29uZmlnX2RpciA9ICcvc3RvcmUvY29uZmlnJwogICAgICAgICAgICBjb25maWdfZmlsZSA9IGNvbmZpZ19kaXIgKyAnL2Nhbi5qc29uJwogICAgICAgICAgICAKICAgICAgICAgICAgaWYgb3MucGF0aC5leGlzdHMoY29uZmlnX2ZpbGUpOgogICAgICAgICAgICAgICAgd2l0aCBvcGVuKGNvbmZpZ19maWxlLCAncicpIGFzIGY6CiAgICAgICAgICAgICAgICAgICAgY2FuX2NvbmZpZyA9IGpzb24ubG9hZChmKQogICAgICAgICAgICAgICAgaWYgdHhfcGluIGlzIE5vbmU6CiAgICAgICAgICAgICAgICAgICAgdHhfcGluID0gY2FuX2NvbmZpZy5nZXQoJ3R4UGluJywgNSkKICAgICAgICAgICAgICAgIGlmIHJ4X3BpbiBpcyBOb25lOgogICAgICAgICAgICAgICAgICAgIHJ4X3BpbiA9IGNhbl9jb25maWcuZ2V0KCdyeFBpbicsIDQpCiAgICAgICAgICAgICAgICBpZiBiaXRyYXRlIGlzIE5vbmU6CiAgICAgICAgICAgICAgICAgICAgYml0cmF0ZSA9IGNhbl9jb25maWcuZ2V0KCdiaXRyYXRlJywgNTAwMDAwKQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgIyBGYWxsYmFjayB0byBtYWluLnB5CiAgICAgICAgICAgICAgICBpbXBvcnQgc3lzCiAgICAgICAgICAgICAgICBzeXMucGF0aC5pbnNlcnQoMCwgJy9kZXZpY2Ugc2NyaXB0cycpCiAgICAgICAgICAgICAgICBmcm9tIG1haW4gaW1wb3J0IENBTl9UWF9QSU4sIENBTl9SWF9QSU4sIENBTl9CSVRSQVRFCiAgICAgICAgICAgICAgICBpZiB0eF9waW4gaXMgTm9uZToKICAgICAgICAgICAgICAgICAgICB0eF9waW4gPSBDQU5fVFhfUElOCiAgICAgICAgICAgICAgICBpZiByeF9waW4gaXMgTm9uZToKICAgICAgICAgICAgICAgICAgICByeF9waW4gPSBDQU5fUlhfUElOCiAgICAgICAgICAgICAgICBpZiBiaXRyYXRlIGlzIE5vbmU6CiAgICAgICAgICAgICAgICAgICAgYml0cmF0ZSA9IENBTl9CSVRSQVRFCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBpZiB0eF9waW4gaXMgTm9uZToKICAgICAgICAgICAgICAgIHR4X3BpbiA9IDUKICAgICAgICAgICAgaWYgcnhfcGluIGlzIE5vbmU6CiAgICAgICAgICAgICAgICByeF9waW4gPSA0CiAgICAgICAgICAgIGlmIGJpdHJhdGUgaXMgTm9uZToKICAgICAgICAgICAgICAgIGJpdHJhdGUgPSA1MDAwMDAKICAgIAogICAgIyBEZXRlcm1pbmUgc2NhbiByYW5nZQogICAgaWYgcXVpY2tfc2NhbjoKICAgICAgICBzdGFydF9ub2RlID0gMQogICAgICAgIGVuZF9ub2RlID0gMTAKICAgIGVsc2U6CiAgICAgICAgc3RhcnRfbm9kZSA9IDEKICAgICAgICBlbmRfbm9kZSA9IDEyNwogICAgCiAgICAjIENvbnZlcnQgQ0FOIG1vZGUgc3RyaW5nIHRvIGNvbnN0YW50CiAgICBjYW5fbW9kZSA9IENBTi5TSUxFTlQgaWYgY2FuX21vZGVfc3RyID09ICdzaWxlbnQnIGVsc2UgQ0FOLk5PUk1BTAogICAgCiAgICAjIEluaXRpYWxpemUgQ0FOIGZvciBzY2FubmluZwogICAgIyBFU1AzMiBDQU4gdXNlcyBhIHNpbmdsZXRvbiBwYXR0ZXJuIC0gQ0FOKDAsIC4uLikgYWx3YXlzIHJldHVybnMgdGhlIHNhbWUgb2JqZWN0CiAgICAjIFRoZSBkcml2ZXIncyBtYWtlX25ldygpIHdpbGwgYXV0b21hdGljYWxseSBkZWluaXQvcmVpbml0IGlmIG5lZWRlZAogICAgc2Nhbl9jYW4gPSBOb25lCiAgICAKICAgICMgQ2hlY2sgaWYgd2UgY2FuIHJldXNlIGV4aXN0aW5nIENBTiBpbnN0YW5jZQogICAgcmV1c2VfZXhpc3RpbmcgPSBGYWxzZQogICAgaWYgY2FuX2RldiBpcyBub3QgTm9uZSBhbmQgZGV2aWNlX2Nvbm5lY3RlZDoKICAgICAgICAjIElmIGRldmljZSBpcyBjb25uZWN0ZWQsIHdlIGNhbid0IGNoYW5nZSBDQU4gc2V0dGluZ3MKICAgICAgICAjIFVzZSBleGlzdGluZyBpbnN0YW5jZSBidXQgc2Nhbm5pbmcgbWlnaHQgaW50ZXJmZXJlCiAgICAgICAgc2Nhbl9jYW4gPSBjYW5fZGV2CiAgICAgICAgcmV1c2VfZXhpc3RpbmcgPSBUcnVlCiAgICBlbHNlOgogICAgICAgICMgTm8gZGV2aWNlIGNvbm5lY3RlZCwgc2FmZSB0byByZWNvbmZpZ3VyZSBDQU4gZm9yIHNjYW5uaW5nCiAgICAgICAgIyBJZiBjYW5fZGV2IGV4aXN0cywgZGVpbml0IGl0IGZpcnN0IHRvIGVuc3VyZSBjbGVhbiBzdGF0ZQogICAgICAgICMgVGhlIGRyaXZlcidzIG1ha2VfbmV3KCkgd2lsbCBhbHNvIGNoZWNrLCBidXQgZXhwbGljaXQgZGVpbml0IGVuc3VyZXMgY2xlYW51cAogICAgICAgIGlmIGNhbl9kZXYgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIGNhbl9kZXYuZGVpbml0KCkKICAgICAgICAgICAgICAgICMgR2l2ZSBGcmVlUlRPUyB0aW1lIHRvIGFjdHVhbGx5IGRlbGV0ZSB0aGUgSVJRIHRhc2sKICAgICAgICAgICAgICAgICMgdlRhc2tEZWxldGUgaXMgYXN5bmNocm9ub3VzLCBzbyB3ZSBuZWVkIGEgc21hbGwgZGVsYXkKICAgICAgICAgICAgICAgIHRpbWUuc2xlZXBfbXMoNTApCiAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgIHBhc3MgICMgSWdub3JlIGRlaW5pdCBlcnJvcnMKICAgICAgICAgICAgY2FuX2RldiA9IE5vbmUKICAgICAgICAKICAgICAgICAjIExldCB0aGUgZHJpdmVyIGhhbmRsZSByZWluaXQgYXV0b21hdGljYWxseQogICAgICAgICMgVGhlIGRyaXZlcidzIG1ha2VfbmV3KCkgY2hlY2tzIGlmIGluaXRpYWxpemVkIGFuZCBjYWxscyBjYW5fZGVpbml0KCkgaWYgbmVlZGVkCiAgICAgICAgdHJ5OgogICAgICAgICAgICBzY2FuX2NhbiA9IENBTigwLCBleHRmcmFtZT1GYWxzZSwgdHg9dHhfcGluLCByeD1yeF9waW4sIG1vZGU9Y2FuX21vZGUsIGJpdHJhdGU9Yml0cmF0ZSwgYXV0b19yZXN0YXJ0PUZhbHNlKQogICAgICAgICAgICAjIFVwZGF0ZSBjYW5fZGV2IHJlZmVyZW5jZSBpZiB3ZSBjcmVhdGVkIGEgbmV3IGluc3RhbmNlCiAgICAgICAgICAgIGlmIG5vdCBkZXZpY2VfY29ubmVjdGVkOgogICAgICAgICAgICAgICAgY2FuX2RldiA9IHNjYW5fY2FuCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBlcnJvcl9tc2cgPSBzdHIoZSkKICAgICAgICAgICAgIyBTaWxlbnQgLSBlcnJvcnMgc2VudCB2aWEgX3NlbmRfZXJyb3IoKQogICAgICAgICAgICBfc2VuZF9lcnJvcihmIkZhaWxlZCB0byBpbml0aWFsaXplIENBTjoge2Vycm9yX21zZ30iLCAnQ0FOLVNDQU4tRVJST1InKQogICAgICAgICAgICByZXR1cm4KICAgIAogICAgIyBXcmFwIGVudGlyZSBzY2FuIGluIHRyeS9leGNlcHQgdG8gZW5zdXJlIHJlc3BvbnNlIGlzIGFsd2F5cyBzZW50CiAgICB0cnk6CiAgICAgICAgICAgICAgICAjIENsZWFyIGFueSBwZW5kaW5nIG1lc3NhZ2VzCiAgICAgICAgd2hpbGUgc2Nhbl9jYW4uYW55KCk6CiAgICAgICAgICAgIHNjYW5fY2FuLnJlY3YoKQogICAgICAgIAogICAgICAgICMgQ29sbGVjdCBmb3VuZCBub2RlcwogICAgICAgIGZvdW5kX25vZGVzID0gW10KICAgICAgICBzY2FuX2Vycm9ycyA9IDAKICAgICAgICBidXNfb2ZmX2RldGVjdGVkID0gRmFsc2UKICAgICAgICAKICAgICAgICAjIENvbnZlcnQgdGltZW91dCBmcm9tIG1zIHRvIHNlY29uZHMgZm9yIFNETyBjbGllbnQKICAgICAgICBzZG9fdGltZW91dCA9IHRpbWVvdXRfbXMgLyAxMDAwLjAgaWYgdGltZW91dF9tcyA+IDAgZWxzZSAwLjEKICAgICAgICAKICAgICAgICAjIFNETyBQcm90b2NvbCBDb25zdGFudHMKICAgICAgICBTRE9fSU5ERVhfREVWSUNFX1RZUEUgPSAweDEwMDAKICAgICAgICBTRE9fU1VCSU5ERVggPSAweDAwCiAgICAgICAgCiAgICAgICAgIyBTY2FuIGVhY2ggbm9kZQogICAgICAgIGZvciBub2RlX2lkIGluIHJhbmdlKHN0YXJ0X25vZGUsIGVuZF9ub2RlICsgMSk6CiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICMgQ3JlYXRlIFNETyBjbGllbnQgZm9yIHRoaXMgbm9kZQogICAgICAgICAgICAgICAgc2RvX2NsaWVudCA9IFNET0NsaWVudChzY2FuX2Nhbiwgbm9kZV9pZD1ub2RlX2lkLCB0aW1lb3V0PXNkb190aW1lb3V0KQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIFRyeSB0byByZWFkIGRldmljZSB0eXBlIChzdGFuZGFyZCBDQU5vcGVuIG9iamVjdCAweDEwMDApCiAgICAgICAgICAgICAgICBkZXZpY2VfdHlwZSA9IHNkb19jbGllbnQucmVhZChTRE9fSU5ERVhfREVWSUNFX1RZUEUsIFNET19TVUJJTkRFWCkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBOb2RlIHJlc3BvbmRlZCBzdWNjZXNzZnVsbHkgLSB0cnkgdG8gcmVhZCBzZXJpYWwgbnVtYmVyCiAgICAgICAgICAgICAgICBzZXJpYWxfbnVtYmVyID0gTm9uZQogICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgICMgU2VyaWFsIG51bWJlciBpcyBhdCAweDUwMDAsIHN1YmluZGV4IDAtMiAoMyBwYXJ0cykKICAgICAgICAgICAgICAgICAgICBzZXJpYWxfcGFydHMgPSBbXQogICAgICAgICAgICAgICAgICAgIGZvciBpIGluIHJhbmdlKDMpOgogICAgICAgICAgICAgICAgICAgICAgICBwYXJ0ID0gc2RvX2NsaWVudC5yZWFkKDB4NTAwMCwgaSkKICAgICAgICAgICAgICAgICAgICAgICAgc2VyaWFsX3BhcnRzLmFwcGVuZChmIntwYXJ0OjA4WH0iKQogICAgICAgICAgICAgICAgICAgIHNlcmlhbF9udW1iZXIgPSAiOiIuam9pbihzZXJpYWxfcGFydHMpCiAgICAgICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICAgICAgIyBTZXJpYWwgbnVtYmVyIHJlYWQgZmFpbGVkLCBidXQgZGV2aWNlIGlzIHN0aWxsIHByZXNlbnQKICAgICAgICAgICAgICAgICAgICBwYXNzCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgTm9kZSByZXNwb25kZWQgc3VjY2Vzc2Z1bGx5CiAgICAgICAgICAgICAgICBmb3VuZF9ub2Rlcy5hcHBlbmQoewogICAgICAgICAgICAgICAgICAgICdub2RlSWQnOiBub2RlX2lkLAogICAgICAgICAgICAgICAgICAgICdkZXZpY2VUeXBlJzogZGV2aWNlX3R5cGUsCiAgICAgICAgICAgICAgICAgICAgJ2RldmljZVR5cGVIZXgnOiBmIjB4e2RldmljZV90eXBlOjA4WH0iLAogICAgICAgICAgICAgICAgICAgICdzZXJpYWxOdW1iZXInOiBzZXJpYWxfbnVtYmVyCiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgYnVzX29mZl9kZXRlY3RlZCA9IEZhbHNlICAjIFJlc2V0IGZsYWcgb24gc3VjY2VzcwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgIGV4Y2VwdCBTRE9UaW1lb3V0RXJyb3I6CiAgICAgICAgICAgICAgICAjIE5vZGUgZGlkbid0IHJlc3BvbmQgLSB0aGlzIGlzIG5vcm1hbCBmb3Igbm9uLWV4aXN0ZW50IG5vZGVzCiAgICAgICAgICAgICAgICBwYXNzCiAgICAgICAgICAgIGV4Y2VwdCBTRE9BYm9ydEVycm9yIGFzIGU6CiAgICAgICAgICAgICAgICAjIE5vZGUgcmVzcG9uZGVkIGJ1dCBhYm9ydGVkIHRoZSByZXF1ZXN0CiAgICAgICAgICAgICAgICAjIFRoaXMgbWlnaHQgaW5kaWNhdGUgdGhlIG9iamVjdCBkb2Vzbid0IGV4aXN0LCBidXQgbm9kZSBpcyBwcmVzZW50CiAgICAgICAgICAgICAgICBzY2FuX2Vycm9ycyArPSAxCiAgICAgICAgICAgICAgICAjIERvbid0IGFkZCB0byBmb3VuZF9ub2RlcyBpZiBhYm9ydCBvY2N1cnJlZAogICAgICAgICAgICBleGNlcHQgT1NFcnJvciBhcyBlOgogICAgICAgICAgICAgICAgIyBDaGVjayBpZiB0aGlzIGlzIGEgQlVTX09GRiBlcnJvcgogICAgICAgICAgICAgICAgZXJyb3JfbXNnID0gc3RyKGUpCiAgICAgICAgICAgICAgICBpZiAnQlVTX09GRicgaW4gZXJyb3JfbXNnIG9yICdidXMgaXMgQlVTX09GRicgaW4gZXJyb3JfbXNnOgogICAgICAgICAgICAgICAgICAgIGlmIG5vdCBidXNfb2ZmX2RldGVjdGVkOgogICAgICAgICAgICAgICAgICAgICAgICBidXNfb2ZmX2RldGVjdGVkID0gVHJ1ZQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICMgV2FpdCBmb3IgYnVzIHJlY292ZXJ5IChkcml2ZXIgaGFuZGxlcyB0aGlzIGF1dG9tYXRpY2FsbHkpCiAgICAgICAgICAgICAgICAgICAgIyBUaGUgZHJpdmVyIHdhaXRzIDMgc2Vjb25kcyArIHJlY292ZXJ5IHRpbWUgKG5lZWRzIDEyOCBidXMtZnJlZSBzaWduYWxzKQogICAgICAgICAgICAgICAgICAgIHJlY292ZXJ5X3dhaXRfbXMgPSA1MDAwICAjIFdhaXQgNSBzZWNvbmRzIGZvciByZWNvdmVyeQogICAgICAgICAgICAgICAgICAgIGVsYXBzZWQgPSAwCiAgICAgICAgICAgICAgICAgICAgY2h1bmtfbXMgPSA1MDAKICAgICAgICAgICAgICAgICAgICB3aGlsZSBlbGFwc2VkIDwgcmVjb3Zlcnlfd2FpdF9tczoKICAgICAgICAgICAgICAgICAgICAgICAgdGltZS5zbGVlcF9tcyhjaHVua19tcykKICAgICAgICAgICAgICAgICAgICAgICAgZWxhcHNlZCArPSBjaHVua19tcwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICMgQWZ0ZXIgcmVjb3ZlcnksIGV4cGxpY2l0bHkgcmVzdGFydCB0aGUgZHJpdmVyIHRvIGVuc3VyZSBpdCdzIHJlYWR5CiAgICAgICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgICAgICBzY2FuX2Nhbi5yZXN0YXJ0KCkKICAgICAgICAgICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uOgogICAgICAgICAgICAgICAgICAgICAgICBwYXNzICAjIElnbm9yZSByZXN0YXJ0IGVycm9ycwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIHNjYW5fZXJyb3JzICs9IDEKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAjIFNraXAgcmVtYWluaW5nIG5vZGVzIGlmIGJ1cyBrZWVwcyBnb2luZyBCVVNfT0ZGCiAgICAgICAgICAgICAgICAgICAgaWYgc2Nhbl9lcnJvcnMgPiA1OgogICAgICAgICAgICAgICAgICAgICAgICBfc2VuZF9lcnJvcigiQnVzIGtlZXBzIGdvaW5nIEJVU19PRkYuIENoZWNrIGhhcmR3YXJlIGNvbm5lY3Rpb25zLiIsICdDQU4tU0NBTi1FUlJPUicpCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAjIE90aGVyIE9TRXJyb3IgKHRpbWVvdXQsIGV0Yy4pCiAgICAgICAgICAgICAgICAgICAgZXJyb3JfbXNnID0gc3RyKGUpCiAgICAgICAgICAgICAgICAgICAgaWYgJ0RldmljZSBpcyBub3QgcmVhZHknIGluIGVycm9yX21zZzoKICAgICAgICAgICAgICAgICAgICAgICAgIyBEcml2ZXIgbWlnaHQgYmUgaW4gd3Jvbmcgc3RhdGUgYWZ0ZXIgQlVTX09GRiByZWNvdmVyeQogICAgICAgICAgICAgICAgICAgICAgICBpZiBidXNfb2ZmX2RldGVjdGVkOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjYW5fY2FuLnJlc3RhcnQoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXNzCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY2FuX2Vycm9ycyArPSAxCiAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgc2Nhbl9lcnJvcnMgKz0gMQogICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgICAgICBlcnJvcl9tc2cgPSBzdHIoZSkKICAgICAgICAgICAgICAgIGlmICdEZXZpY2UgaXMgbm90IHJlYWR5JyBpbiBlcnJvcl9tc2c6CiAgICAgICAgICAgICAgICAgICAgIyBEcml2ZXIgbWlnaHQgYmUgaW4gd3Jvbmcgc3RhdGUgYWZ0ZXIgQlVTX09GRiByZWNvdmVyeQogICAgICAgICAgICAgICAgICAgIGlmIGJ1c19vZmZfZGV0ZWN0ZWQ6CiAgICAgICAgICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjYW5fY2FuLnJlc3RhcnQoKQogICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFzcwogICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgIHNjYW5fZXJyb3JzICs9IDEKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgc2Nhbl9lcnJvcnMgKz0gMQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIElmIHRvbyBtYW55IGVycm9ycywgbWlnaHQgYmUgYnVzIGlzc3VlcwogICAgICAgICAgICAgICAgaWYgc2Nhbl9lcnJvcnMgPiAxMDoKICAgICAgICAgICAgICAgICAgICBfc2VuZF9lcnJvcigiVG9vIG1hbnkgc2NhbiBlcnJvcnMuIENoZWNrIENBTiBidXMgaGFyZHdhcmUuIiwgJ0NBTi1TQ0FOLUVSUk9SJykKICAgICAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgCiAgICAgICAgICAgICMgUmF0ZSBsaW1pdGluZyBiZXR3ZWVuIHJlcXVlc3RzCiAgICAgICAgICAgIGlmIHJhdGVfbGltaXRfbXMgPiAwOgogICAgICAgICAgICAgICAgdGltZS5zbGVlcF9tcyhyYXRlX2xpbWl0X21zKQogICAgICAgIAogICAgICAgICMgU2VuZCBmaW5hbCByZXN1bHQKICAgICAgICBzY2FuX3R5cGUgPSAicXVpY2siIGlmIHF1aWNrX3NjYW4gZWxzZSAiZnVsbCIKICAgICAgICBfc2VuZF9yZXNwb25zZSgnQ0FOLVNDQU4tUkVTVUxUJywgewogICAgICAgICAgICAnZGV2aWNlcyc6IGZvdW5kX25vZGVzLAogICAgICAgICAgICAnc2Nhbm5lZCc6IGVuZF9ub2RlIC0gc3RhcnRfbm9kZSArIDEsCiAgICAgICAgICAgICdmb3VuZCc6IGxlbihmb3VuZF9ub2RlcyksCiAgICAgICAgICAgICdzY2FuVHlwZSc6IHNjYW5fdHlwZQogICAgICAgIH0pCiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgIyBFbnN1cmUgZXJyb3IgcmVzcG9uc2UgaXMgc2VudCBldmVuIGlmIHNjYW4gZmFpbHMKICAgICAgICBlcnJvcl9tc2cgPSBzdHIoZSkKICAgICAgICAjIFNpbGVudCAtIGVycm9ycyBzZW50IHZpYSBfc2VuZF9lcnJvcigpCiAgICAgICAgX3NlbmRfZXJyb3IoZiJTY2FuIGZhaWxlZDoge2Vycm9yX21zZ30iLCAnQ0FOLVNDQU4tRVJST1InKQogICAgZmluYWxseToKICAgICAgICAjIENsZWFuIHVwIHNjYW4gQ0FOIGluc3RhbmNlIGlmIHdlIGNyZWF0ZWQgYSBzZXBhcmF0ZSBvbmUKICAgICAgICAjIERvbid0IGRlaW5pdCBpZiBpdCdzIHRoZSBzYW1lIGFzIGNhbl9kZXYgYW5kIGRldmljZSBpcyBjb25uZWN0ZWQKICAgICAgICBpZiBzY2FuX2NhbiBpcyBub3QgTm9uZSBhbmQgc2Nhbl9jYW4gIT0gY2FuX2RldiBhbmQgbm90IGRldmljZV9jb25uZWN0ZWQ6CiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIHNjYW5fY2FuLmRlaW5pdCgpCiAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgIHBhc3MgICMgSWdub3JlIGNsZWFudXAgZXJyb3JzCgoKIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiMgQ0FOIE1lc3NhZ2UgU2VuZGluZwojID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KIyBOT1RFOiBUaGVzZSBmdW5jdGlvbnMgYXJlIERFUFJFQ0FURUQuIFRoZSBleHRlbnNpb24gbm93IHNlbmRzIFB5dGhvbiBjb2RlCiMgZGlyZWN0bHkgdmlhIGRldmljZS5leGVjdXRlKCkgZm9sbG93aW5nIHRoZSBTY3JpcHRPIHBhdHRlcm4uIFRoZXNlIGFyZSBrZXB0CiMgZm9yIGJhY2t3YXJkIGNvbXBhdGliaWxpdHkgb25seS4KCiMgR2xvYmFsIHN0b3JhZ2UgZm9yIHBlcmlvZGljIENBTiBtZXNzYWdlIGludGVydmFscwpjYW5faW50ZXJ2YWxzID0ge30gICMge2ludGVydmFsX2lkOiB7J3RpbWVyJzogdGltZXJfb2JqLCAnY2FuX2lkJzogaW50LCAnZGF0YSc6IGxpc3QsICdpbnRlcnZhbCc6IGludH19CgpkZWYgc2VuZENhbk1lc3NhZ2UoYXJncyk6CiAgICAiIiIKICAgIFNlbmQgYSBzaW5nbGUgQ0FOIG1lc3NhZ2UuCiAgICAKICAgIEFyZ3MgKGRpY3QpOgogICAgICAgIGNhbl9pZDogQ0FOIG1lc3NhZ2UgSUQgKDB4MDAwLTB4N0ZGKQogICAgICAgIGRhdGE6IExpc3Qgb2YgOCBieXRlcyAoMC0yNTUpCiAgICAKICAgIFJldHVybnM6CiAgICAgICAgeydzdWNjZXNzJzogVHJ1ZX0gb3IgeydlcnJvcic6ICdlcnJvciBtZXNzYWdlJ30KICAgICIiIgogICAgIyBIYW5kbGUgSlNPTiBzdHJpbmcgZnJvbSBKYXZhU2NyaXB0CiAgICBpZiBpc2luc3RhbmNlKGFyZ3MsIHN0cik6CiAgICAgICAgYXJncyA9IGpzb24ubG9hZHMoYXJncykKICAgIGVsaWYgYXJncyBpcyBOb25lOgogICAgICAgIGFyZ3MgPSB7fQogICAgCiAgICBjYW5faWQgPSBhcmdzLmdldCgnY2FuX2lkJykKICAgIGRhdGEgPSBhcmdzLmdldCgnZGF0YScpCiAgICAKICAgIGlmIGNhbl9pZCBpcyBOb25lIG9yIGRhdGEgaXMgTm9uZToKICAgICAgICBfc2VuZF9lcnJvcigiTWlzc2luZyBjYW5faWQgb3IgZGF0YSIsICdDQU4tU0VORC1FUlJPUicpCiAgICAgICAgcmV0dXJuCiAgICAKICAgIGlmIG5vdCBkZXZpY2VfY29ubmVjdGVkIG9yIGNhbl9kZXYgaXMgTm9uZToKICAgICAgICBfc2VuZF9lcnJvcigiRGV2aWNlIG5vdCBjb25uZWN0ZWQiLCAnQ0FOLVNFTkQtRVJST1InKQogICAgICAgIHJldHVybgogICAgCiAgICB0cnk6CiAgICAgICAgIyBWYWxpZGF0ZSBDQU4gSUQKICAgICAgICBpZiBjYW5faWQgPCAwIG9yIGNhbl9pZCA+IDB4N0ZGOgogICAgICAgICAgICBfc2VuZF9lcnJvcigiSW52YWxpZCBDQU4gSUQgKG11c3QgYmUgMHgwMDAtMHg3RkYpIiwgJ0NBTi1TRU5ELUVSUk9SJykKICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgCiAgICAgICAgIyBWYWxpZGF0ZSBkYXRhIChtdXN0IGJlIGxpc3Qgb2YgOCBieXRlcykKICAgICAgICBpZiBub3QgaXNpbnN0YW5jZShkYXRhLCBsaXN0KSBvciBsZW4oZGF0YSkgIT0gODoKICAgICAgICAgICAgX3NlbmRfZXJyb3IoIkRhdGEgbXVzdCBiZSBhIGxpc3Qgb2YgOCBieXRlcyIsICdDQU4tU0VORC1FUlJPUicpCiAgICAgICAgICAgIHJldHVybgogICAgICAgIAogICAgICAgICMgVmFsaWRhdGUgYnl0ZSB2YWx1ZXMKICAgICAgICBmb3IgYnl0ZSBpbiBkYXRhOgogICAgICAgICAgICBpZiBub3QgaXNpbnN0YW5jZShieXRlLCBpbnQpIG9yIGJ5dGUgPCAwIG9yIGJ5dGUgPiAyNTU6CiAgICAgICAgICAgICAgICBfc2VuZF9lcnJvcigiRGF0YSBieXRlcyBtdXN0IGJlIGludGVnZXJzIDAtMjU1IiwgJ0NBTi1TRU5ELUVSUk9SJykKICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgIAogICAgICAgICMgU2VuZCBDQU4gbWVzc2FnZQogICAgICAgIGNhbl9kZXYuc2VuZChkYXRhLCBjYW5faWQpCiAgICAgICAgCiAgICAgICAgX3NlbmRfcmVzcG9uc2UoJ0NBTi1NRVNTQUdFLVNFTlQnLCB7CiAgICAgICAgICAgICdzdWNjZXNzJzogVHJ1ZSwKICAgICAgICAgICAgJ2Nhbl9pZCc6IGNhbl9pZAogICAgICAgIH0pCiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgX3NlbmRfZXJyb3Ioc3RyKGUpLCAnQ0FOLVNFTkQtRVJST1InKQoKCmRlZiBzdGFydENhbkludGVydmFsKGFyZ3MpOgogICAgIiIiCiAgICBTdGFydCBzZW5kaW5nIGEgcGVyaW9kaWMgQ0FOIG1lc3NhZ2UuCiAgICAKICAgIEFyZ3MgKGRpY3QpOgogICAgICAgIGludGVydmFsX2lkOiBVbmlxdWUgaWRlbnRpZmllciBmb3IgdGhpcyBpbnRlcnZhbAogICAgICAgIGNhbl9pZDogQ0FOIG1lc3NhZ2UgSUQgKDB4MDAwLTB4N0ZGKQogICAgICAgIGRhdGE6IExpc3Qgb2YgOCBieXRlcyAoMC0yNTUpCiAgICAgICAgaW50ZXJ2YWw6IEludGVydmFsIGluIG1pbGxpc2Vjb25kcyAoMTAtMTAwMDApCiAgICAKICAgIFJldHVybnM6CiAgICAgICAgeydzdWNjZXNzJzogVHJ1ZX0gb3IgeydlcnJvcic6ICdlcnJvciBtZXNzYWdlJ30KICAgICIiIgogICAgIyBIYW5kbGUgSlNPTiBzdHJpbmcgZnJvbSBKYXZhU2NyaXB0CiAgICBpZiBpc2luc3RhbmNlKGFyZ3MsIHN0cik6CiAgICAgICAgYXJncyA9IGpzb24ubG9hZHMoYXJncykKICAgIGVsaWYgYXJncyBpcyBOb25lOgogICAgICAgIGFyZ3MgPSB7fQogICAgCiAgICBpbnRlcnZhbF9pZCA9IGFyZ3MuZ2V0KCdpbnRlcnZhbF9pZCcpCiAgICBjYW5faWQgPSBhcmdzLmdldCgnY2FuX2lkJykKICAgIGRhdGEgPSBhcmdzLmdldCgnZGF0YScpCiAgICBpbnRlcnZhbF9tcyA9IGFyZ3MuZ2V0KCdpbnRlcnZhbCcpCiAgICAKICAgIGlmIGludGVydmFsX2lkIGlzIE5vbmUgb3IgY2FuX2lkIGlzIE5vbmUgb3IgZGF0YSBpcyBOb25lIG9yIGludGVydmFsX21zIGlzIE5vbmU6CiAgICAgICAgX3NlbmRfZXJyb3IoIk1pc3NpbmcgcmVxdWlyZWQgcGFyYW1ldGVycyIsICdDQU4tSU5URVJWQUwtU1RBUlQtRVJST1InKQogICAgICAgIHJldHVybgogICAgCiAgICBpZiBub3QgZGV2aWNlX2Nvbm5lY3RlZCBvciBjYW5fZGV2IGlzIE5vbmU6CiAgICAgICAgX3NlbmRfZXJyb3IoIkRldmljZSBub3QgY29ubmVjdGVkIiwgJ0NBTi1JTlRFUlZBTC1TVEFSVC1FUlJPUicpCiAgICAgICAgcmV0dXJuCiAgICAKICAgIHRyeToKICAgICAgICAjIFZhbGlkYXRlIENBTiBJRAogICAgICAgIGlmIGNhbl9pZCA8IDAgb3IgY2FuX2lkID4gMHg3RkY6CiAgICAgICAgICAgIF9zZW5kX2Vycm9yKCJJbnZhbGlkIENBTiBJRCAobXVzdCBiZSAweDAwMC0weDdGRikiLCAnQ0FOLUlOVEVSVkFMLVNUQVJULUVSUk9SJykKICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgCiAgICAgICAgIyBWYWxpZGF0ZSBpbnRlcnZhbAogICAgICAgIGlmIGludGVydmFsX21zIDwgMTAgb3IgaW50ZXJ2YWxfbXMgPiAxMDAwMDoKICAgICAgICAgICAgX3NlbmRfZXJyb3IoIkludGVydmFsIG11c3QgYmUgYmV0d2VlbiAxMG1zIGFuZCAxMDAwMG1zIiwgJ0NBTi1JTlRFUlZBTC1TVEFSVC1FUlJPUicpCiAgICAgICAgICAgIHJldHVybgogICAgICAgIAogICAgICAgICMgVmFsaWRhdGUgZGF0YQogICAgICAgIGlmIG5vdCBpc2luc3RhbmNlKGRhdGEsIGxpc3QpIG9yIGxlbihkYXRhKSAhPSA4OgogICAgICAgICAgICBfc2VuZF9lcnJvcigiRGF0YSBtdXN0IGJlIGEgbGlzdCBvZiA4IGJ5dGVzIiwgJ0NBTi1JTlRFUlZBTC1TVEFSVC1FUlJPUicpCiAgICAgICAgICAgIHJldHVybgogICAgICAgIAogICAgICAgICMgU3RvcCBleGlzdGluZyBpbnRlcnZhbCBpZiBydW5uaW5nCiAgICAgICAgaWYgaW50ZXJ2YWxfaWQgaW4gY2FuX2ludGVydmFsczoKICAgICAgICAgICAgc3RvcENhbkludGVydmFsKHsnaW50ZXJ2YWxfaWQnOiBpbnRlcnZhbF9pZH0pCiAgICAgICAgCiAgICAgICAgIyBDcmVhdGUgcGVyaW9kaWMgdGltZXIKICAgICAgICAjIE5vdGU6IE1pY3JvUHl0aG9uIGRvZXNuJ3QgaGF2ZSB0aHJlYWRpbmcsIHNvIHdlIHVzZSBhIHNpbXBsZSBjYWxsYmFjayBhcHByb2FjaAogICAgICAgICMgRm9yIG5vdywgd2UnbGwganVzdCBzdG9yZSB0aGUgaW50ZXJ2YWwgaW5mbyAtIGFjdHVhbCBwZXJpb2RpYyBzZW5kaW5nCiAgICAgICAgIyB3b3VsZCBuZWVkIHRvIGJlIGhhbmRsZWQgYnkgYSBiYWNrZ3JvdW5kIHRhc2sgb3IgdGhlIG1haW4gbG9vcAogICAgICAgICMgVGhpcyBpcyBhIHNpbXBsaWZpZWQgaW1wbGVtZW50YXRpb24gdGhhdCBhY2tub3dsZWRnZXMgdGhlIHN0YXJ0CiAgICAgICAgCiAgICAgICAgY2FuX2ludGVydmFsc1tpbnRlcnZhbF9pZF0gPSB7CiAgICAgICAgICAgICdjYW5faWQnOiBjYW5faWQsCiAgICAgICAgICAgICdkYXRhJzogZGF0YSwKICAgICAgICAgICAgJ2ludGVydmFsJzogaW50ZXJ2YWxfbXMsCiAgICAgICAgICAgICdhY3RpdmUnOiBUcnVlCiAgICAgICAgfQogICAgICAgIAogICAgICAgIF9zZW5kX3Jlc3BvbnNlKCdDQU4tSU5URVJWQUwtU1RBUlRFRCcsIHsKICAgICAgICAgICAgJ3N1Y2Nlc3MnOiBUcnVlLAogICAgICAgICAgICAnaW50ZXJ2YWxfaWQnOiBpbnRlcnZhbF9pZAogICAgICAgIH0pCiAgICAgICAgCiAgICAgICAgIyBUT0RPOiBJbXBsZW1lbnQgYWN0dWFsIHBlcmlvZGljIHNlbmRpbmcgdXNpbmcgYSBiYWNrZ3JvdW5kIHRhc2sKICAgICAgICAjIEZvciBub3csIHRoaXMganVzdCBzdG9yZXMgdGhlIGNvbmZpZ3VyYXRpb24KICAgICAgICAKICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICBfc2VuZF9lcnJvcihzdHIoZSksICdDQU4tSU5URVJWQUwtU1RBUlQtRVJST1InKQoKCmRlZiBzdG9wQ2FuSW50ZXJ2YWwoYXJncyk6CiAgICAiIiIKICAgIFN0b3Agc2VuZGluZyBhIHBlcmlvZGljIENBTiBtZXNzYWdlLgogICAgCiAgICBBcmdzIChkaWN0KToKICAgICAgICBpbnRlcnZhbF9pZDogVW5pcXVlIGlkZW50aWZpZXIgZm9yIHRoaXMgaW50ZXJ2YWwKICAgIAogICAgUmV0dXJuczoKICAgICAgICB7J3N1Y2Nlc3MnOiBUcnVlfSBvciB7J2Vycm9yJzogJ2Vycm9yIG1lc3NhZ2UnfQogICAgIiIiCiAgICAjIEhhbmRsZSBKU09OIHN0cmluZyBmcm9tIEphdmFTY3JpcHQKICAgIGlmIGlzaW5zdGFuY2UoYXJncywgc3RyKToKICAgICAgICBhcmdzID0ganNvbi5sb2FkcyhhcmdzKQogICAgZWxpZiBhcmdzIGlzIE5vbmU6CiAgICAgICAgYXJncyA9IHt9CiAgICAKICAgIGludGVydmFsX2lkID0gYXJncy5nZXQoJ2ludGVydmFsX2lkJykKICAgIAogICAgaWYgaW50ZXJ2YWxfaWQgaXMgTm9uZToKICAgICAgICBfc2VuZF9lcnJvcigiTWlzc2luZyBpbnRlcnZhbF9pZCIsICdDQU4tSU5URVJWQUwtU1RPUC1FUlJPUicpCiAgICAgICAgcmV0dXJuCiAgICAKICAgIHRyeToKICAgICAgICBpZiBpbnRlcnZhbF9pZCBpbiBjYW5faW50ZXJ2YWxzOgogICAgICAgICAgICBjYW5faW50ZXJ2YWxzW2ludGVydmFsX2lkXVsnYWN0aXZlJ10gPSBGYWxzZQogICAgICAgICAgICBkZWwgY2FuX2ludGVydmFsc1tpbnRlcnZhbF9pZF0KICAgICAgICAKICAgICAgICBfc2VuZF9yZXNwb25zZSgnQ0FOLUlOVEVSVkFMLVNUT1BQRUQnLCB7CiAgICAgICAgICAgICdzdWNjZXNzJzogVHJ1ZSwKICAgICAgICAgICAgJ2ludGVydmFsX2lkJzogaW50ZXJ2YWxfaWQKICAgICAgICB9KQogICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgIF9zZW5kX2Vycm9yKHN0cihlKSwgJ0NBTi1JTlRFUlZBTC1TVE9QLUVSUk9SJykKCgojID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KIyBDQU4gSU8gQ29udHJvbCAoSW52ZXJ0ZXIgQ29udHJvbCkKIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiMgTk9URTogVGhlc2UgZnVuY3Rpb25zIGFyZSBERVBSRUNBVEVELiBUaGUgZXh0ZW5zaW9uIG5vdyBzZW5kcyBQeXRob24gY29kZQojIGRpcmVjdGx5IHZpYSBkZXZpY2UuZXhlY3V0ZSgpIGZvbGxvd2luZyB0aGUgU2NyaXB0TyBwYXR0ZXJuLiBUaGVzZSBhcmUga2VwdAojIGZvciBiYWNrd2FyZCBjb21wYXRpYmlsaXR5IG9ubHkuCgojIEdsb2JhbCBzdG9yYWdlIGZvciBDQU4gSU8gaW50ZXJ2YWwKY2FuX2lvX2ludGVydmFsID0gTm9uZSAgIyBUaW1lciBvYmplY3QgZm9yIENBTiBJTyBwZXJpb2RpYyBzZW5kaW5nCmNhbl9pb19jb25maWcgPSB7CiAgICAnYWN0aXZlJzogRmFsc2UsCiAgICAnY2FuX2lkJzogMHgzRiwKICAgICdwb3QnOiAwLAogICAgJ3BvdDInOiAwLAogICAgJ2NhbmlvJzogMCwKICAgICdjcnVpc2VzcGVlZCc6IDAsCiAgICAncmVnZW5wcmVzZXQnOiAwLAogICAgJ2ludGVydmFsJzogMTAwLAogICAgJ3VzZV9jcmMnOiBUcnVlCn0KCmRlZiBzdGFydENhbklvSW50ZXJ2YWwoYXJncyk6CiAgICAiIiIKICAgIFN0YXJ0IENBTiBJTyBjb250cm9sIGludGVydmFsIChzZW5kcyBwZXJpb2RpYyBjb250cm9sIG1lc3NhZ2VzIHRvIGludmVydGVyKS4KICAgIAogICAgQXJncyAoZGljdCk6CiAgICAgICAgY2FuX2lkOiBDQU4gbWVzc2FnZSBJRCAoZGVmYXVsdDogMHgzRikKICAgICAgICBwb3Q6IFRocm90dGxlIHBvdCB2YWx1ZSAoMC00MDk1KQogICAgICAgIHBvdDI6IFNlY29uZCBwb3QgdmFsdWUgKDAtNDA5NSkKICAgICAgICBjYW5pbzogQ29udHJvbCBmbGFncyBieXRlIChiaXQgZmxhZ3M6IGNydWlzZT0weDAxLCBzdGFydD0weDAyLCBicmFrZT0weDA0LCBmb3J3YXJkPTB4MDgsIHJldmVyc2U9MHgxMCwgYm1zPTB4MjApCiAgICAgICAgY3J1aXNlc3BlZWQ6IENydWlzZSBzcGVlZCB2YWx1ZSAoMC0xNjM4MykKICAgICAgICByZWdlbnByZXNldDogUmVnZW4gcHJlc2V0IHZhbHVlICgwLTI1NSkKICAgICAgICBpbnRlcnZhbDogSW50ZXJ2YWwgaW4gbWlsbGlzZWNvbmRzICgxMC01MDApCiAgICAgICAgdXNlX2NyYzogVXNlIENSQy0zMiBjaGVja3N1bSAoVHJ1ZS9GYWxzZSkKICAgIAogICAgUmV0dXJuczoKICAgICAgICB7J3N1Y2Nlc3MnOiBUcnVlfSBvciB7J2Vycm9yJzogJ2Vycm9yIG1lc3NhZ2UnfQogICAgIiIiCiAgICAjIEhhbmRsZSBKU09OIHN0cmluZyBmcm9tIEphdmFTY3JpcHQKICAgIGlmIGlzaW5zdGFuY2UoYXJncywgc3RyKToKICAgICAgICBhcmdzID0ganNvbi5sb2FkcyhhcmdzKQogICAgZWxpZiBhcmdzIGlzIE5vbmU6CiAgICAgICAgYXJncyA9IHt9CiAgICAKICAgIGlmIG5vdCBkZXZpY2VfY29ubmVjdGVkIG9yIGNhbl9kZXYgaXMgTm9uZToKICAgICAgICBfc2VuZF9lcnJvcigiRGV2aWNlIG5vdCBjb25uZWN0ZWQiLCAnQ0FOLUlPLVNUQVJULUVSUk9SJykKICAgICAgICByZXR1cm4KICAgIAogICAgdHJ5OgogICAgICAgICMgU3RvcCBleGlzdGluZyBpbnRlcnZhbCBpZiBydW5uaW5nCiAgICAgICAgaWYgY2FuX2lvX2NvbmZpZ1snYWN0aXZlJ106CiAgICAgICAgICAgIHN0b3BDYW5Jb0ludGVydmFsKCkKICAgICAgICAKICAgICAgICAjIFN0b3JlIGNvbmZpZ3VyYXRpb24KICAgICAgICBjYW5faW9fY29uZmlnLnVwZGF0ZSh7CiAgICAgICAgICAgICdhY3RpdmUnOiBUcnVlLAogICAgICAgICAgICAnY2FuX2lkJzogYXJncy5nZXQoJ2Nhbl9pZCcsIDB4M0YpLAogICAgICAgICAgICAncG90JzogYXJncy5nZXQoJ3BvdCcsIDApLAogICAgICAgICAgICAncG90Mic6IGFyZ3MuZ2V0KCdwb3QyJywgMCksCiAgICAgICAgICAgICdjYW5pbyc6IGFyZ3MuZ2V0KCdjYW5pbycsIDApLAogICAgICAgICAgICAnY3J1aXNlc3BlZWQnOiBhcmdzLmdldCgnY3J1aXNlc3BlZWQnLCAwKSwKICAgICAgICAgICAgJ3JlZ2VucHJlc2V0JzogYXJncy5nZXQoJ3JlZ2VucHJlc2V0JywgMCksCiAgICAgICAgICAgICdpbnRlcnZhbCc6IGFyZ3MuZ2V0KCdpbnRlcnZhbCcsIDEwMCksCiAgICAgICAgICAgICd1c2VfY3JjJzogYXJncy5nZXQoJ3VzZV9jcmMnLCBUcnVlKQogICAgICAgIH0pCiAgICAgICAgCiAgICAgICAgIyBWYWxpZGF0ZSBDQU4gSUQKICAgICAgICBpZiBjYW5faW9fY29uZmlnWydjYW5faWQnXSA8IDAgb3IgY2FuX2lvX2NvbmZpZ1snY2FuX2lkJ10gPiAweDdGRjoKICAgICAgICAgICAgX3NlbmRfZXJyb3IoIkludmFsaWQgQ0FOIElEIChtdXN0IGJlIDB4MDAwLTB4N0ZGKSIsICdDQU4tSU8tU1RBUlQtRVJST1InKQogICAgICAgICAgICByZXR1cm4KICAgICAgICAKICAgICAgICAjIFZhbGlkYXRlIGludGVydmFsCiAgICAgICAgaWYgY2FuX2lvX2NvbmZpZ1snaW50ZXJ2YWwnXSA8IDEwIG9yIGNhbl9pb19jb25maWdbJ2ludGVydmFsJ10gPiA1MDA6CiAgICAgICAgICAgIF9zZW5kX2Vycm9yKCJJbnRlcnZhbCBtdXN0IGJlIGJldHdlZW4gMTBtcyBhbmQgNTAwbXMiLCAnQ0FOLUlPLVNUQVJULUVSUk9SJykKICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgCiAgICAgICAgIyBTZW5kIGluaXRpYWwgbWVzc2FnZQogICAgICAgIF9zZW5kX2Nhbl9pb19tZXNzYWdlKCkKICAgICAgICAKICAgICAgICBfc2VuZF9yZXNwb25zZSgnQ0FOLUlPLVNUQVJURUQnLCB7CiAgICAgICAgICAgICdzdWNjZXNzJzogVHJ1ZSwKICAgICAgICAgICAgJ2ludGVydmFsX21zJzogY2FuX2lvX2NvbmZpZ1snaW50ZXJ2YWwnXQogICAgICAgIH0pCiAgICAgICAgCiAgICAgICAgIyBUT0RPOiBJbXBsZW1lbnQgYWN0dWFsIHBlcmlvZGljIHNlbmRpbmcgdXNpbmcgYSBiYWNrZ3JvdW5kIHRhc2sKICAgICAgICAjIEZvciBub3csIHRoaXMganVzdCBzdG9yZXMgdGhlIGNvbmZpZ3VyYXRpb24gYW5kIHNlbmRzIG9uY2UKICAgICAgICAKICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICBfc2VuZF9lcnJvcihzdHIoZSksICdDQU4tSU8tU1RBUlQtRVJST1InKQoKCmRlZiBzdG9wQ2FuSW9JbnRlcnZhbCgpOgogICAgIiIiCiAgICBTdG9wIENBTiBJTyBjb250cm9sIGludGVydmFsLgogICAgCiAgICBSZXR1cm5zOgogICAgICAgIHsnc3VjY2Vzcyc6IFRydWV9IG9yIHsnZXJyb3InOiAnZXJyb3IgbWVzc2FnZSd9CiAgICAiIiIKICAgIHRyeToKICAgICAgICBjYW5faW9fY29uZmlnWydhY3RpdmUnXSA9IEZhbHNlCiAgICAgICAgCiAgICAgICAgX3NlbmRfcmVzcG9uc2UoJ0NBTi1JTy1TVE9QUEVEJywgewogICAgICAgICAgICAnc3VjY2Vzcyc6IFRydWUKICAgICAgICB9KQogICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgIF9zZW5kX2Vycm9yKHN0cihlKSwgJ0NBTi1JTy1TVE9QLUVSUk9SJykKCgpkZWYgdXBkYXRlQ2FuSW9GbGFncyhhcmdzKToKICAgICIiIgogICAgVXBkYXRlIENBTiBJTyBmbGFncyB3aGlsZSBpbnRlcnZhbCBpcyBydW5uaW5nLgogICAgCiAgICBBcmdzIChkaWN0KToKICAgICAgICBwb3Q6IFRocm90dGxlIHBvdCB2YWx1ZSAoMC00MDk1KQogICAgICAgIHBvdDI6IFNlY29uZCBwb3QgdmFsdWUgKDAtNDA5NSkKICAgICAgICBjYW5pbzogQ29udHJvbCBmbGFncyBieXRlCiAgICAgICAgY3J1aXNlc3BlZWQ6IENydWlzZSBzcGVlZCB2YWx1ZSAoMC0xNjM4MykKICAgICAgICByZWdlbnByZXNldDogUmVnZW4gcHJlc2V0IHZhbHVlICgwLTI1NSkKICAgIAogICAgUmV0dXJuczoKICAgICAgICB7J3N1Y2Nlc3MnOiBUcnVlfSBvciB7J2Vycm9yJzogJ2Vycm9yIG1lc3NhZ2UnfQogICAgIiIiCiAgICAjIEhhbmRsZSBKU09OIHN0cmluZyBmcm9tIEphdmFTY3JpcHQKICAgIGlmIGlzaW5zdGFuY2UoYXJncywgc3RyKToKICAgICAgICBhcmdzID0ganNvbi5sb2FkcyhhcmdzKQogICAgZWxpZiBhcmdzIGlzIE5vbmU6CiAgICAgICAgYXJncyA9IHt9CiAgICAKICAgIGlmIG5vdCBjYW5faW9fY29uZmlnWydhY3RpdmUnXToKICAgICAgICBfc2VuZF9lcnJvcigiQ0FOIElPIGludGVydmFsIG5vdCBhY3RpdmUiLCAnQ0FOLUlPLVVQREFURS1FUlJPUicpCiAgICAgICAgcmV0dXJuCiAgICAKICAgIHRyeToKICAgICAgICAjIFVwZGF0ZSBjb25maWd1cmF0aW9uCiAgICAgICAgaWYgJ3BvdCcgaW4gYXJnczoKICAgICAgICAgICAgY2FuX2lvX2NvbmZpZ1sncG90J10gPSBhcmdzWydwb3QnXQogICAgICAgIGlmICdwb3QyJyBpbiBhcmdzOgogICAgICAgICAgICBjYW5faW9fY29uZmlnWydwb3QyJ10gPSBhcmdzWydwb3QyJ10KICAgICAgICBpZiAnY2FuaW8nIGluIGFyZ3M6CiAgICAgICAgICAgIGNhbl9pb19jb25maWdbJ2NhbmlvJ10gPSBhcmdzWydjYW5pbyddCiAgICAgICAgaWYgJ2NydWlzZXNwZWVkJyBpbiBhcmdzOgogICAgICAgICAgICBjYW5faW9fY29uZmlnWydjcnVpc2VzcGVlZCddID0gYXJnc1snY3J1aXNlc3BlZWQnXQogICAgICAgIGlmICdyZWdlbnByZXNldCcgaW4gYXJnczoKICAgICAgICAgICAgY2FuX2lvX2NvbmZpZ1sncmVnZW5wcmVzZXQnXSA9IGFyZ3NbJ3JlZ2VucHJlc2V0J10KICAgICAgICAKICAgICAgICAjIFNlbmQgdXBkYXRlZCBtZXNzYWdlIGltbWVkaWF0ZWx5CiAgICAgICAgX3NlbmRfY2FuX2lvX21lc3NhZ2UoKQogICAgICAgIAogICAgICAgIF9zZW5kX3Jlc3BvbnNlKCdDQU4tSU8tVVBEQVRFRCcsIHsKICAgICAgICAgICAgJ3N1Y2Nlc3MnOiBUcnVlCiAgICAgICAgfSkKICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICBfc2VuZF9lcnJvcihzdHIoZSksICdDQU4tSU8tVVBEQVRFLUVSUk9SJykKCgpkZWYgX3NlbmRfY2FuX2lvX21lc3NhZ2UoKToKICAgICIiIgogICAgSW50ZXJuYWwgaGVscGVyIHRvIHNlbmQgQ0FOIElPIGNvbnRyb2wgbWVzc2FnZS4KICAgIENvbnN0cnVjdHMgdGhlIDgtYnl0ZSBDQU4gbWVzc2FnZSBhY2NvcmRpbmcgdG8gT3BlbkludmVydGVyIHByb3RvY29sLgogICAgIiIiCiAgICBpZiBub3QgZGV2aWNlX2Nvbm5lY3RlZCBvciBjYW5fZGV2IGlzIE5vbmU6CiAgICAgICAgcmV0dXJuCiAgICAKICAgIGlmIG5vdCBjYW5faW9fY29uZmlnWydhY3RpdmUnXToKICAgICAgICByZXR1cm4KICAgIAogICAgIyBDb25zdHJ1Y3QgQ0FOIG1lc3NhZ2UgKDggYnl0ZXMpCiAgICAjIEJ5dGUgMDogcG90IGxvdyBieXRlCiAgICAjIEJ5dGUgMTogcG90IGhpZ2ggYnl0ZQogICAgIyBCeXRlIDI6IHBvdDIgbG93IGJ5dGUKICAgICMgQnl0ZSAzOiBwb3QyIGhpZ2ggYnl0ZQogICAgIyBCeXRlIDQ6IGNhbmlvIGZsYWdzCiAgICAjIEJ5dGUgNTogY3J1aXNlc3BlZWQgbG93IGJ5dGUKICAgICMgQnl0ZSA2OiBjcnVpc2VzcGVlZCBoaWdoIGJ5dGUKICAgICMgQnl0ZSA3OiByZWdlbnByZXNldCAob3IgQ1JDIGlmIHVzZV9jcmM9VHJ1ZSkKICAgIAogICAgcG90ID0gY2FuX2lvX2NvbmZpZ1sncG90J10gJiAweEZGRkYKICAgIHBvdDIgPSBjYW5faW9fY29uZmlnWydwb3QyJ10gJiAweEZGRkYKICAgIGNhbmlvID0gY2FuX2lvX2NvbmZpZ1snY2FuaW8nXSAmIDB4RkYKICAgIGNydWlzZXNwZWVkID0gY2FuX2lvX2NvbmZpZ1snY3J1aXNlc3BlZWQnXSAmIDB4M0ZGRiAgIyAxNCBiaXRzIG1heAogICAgcmVnZW5wcmVzZXQgPSBjYW5faW9fY29uZmlnWydyZWdlbnByZXNldCddICYgMHhGRgogICAgCiAgICBkYXRhID0gWwogICAgICAgIHBvdCAmIDB4RkYsICAgICAgICAgICAjIEJ5dGUgMDogcG90IGxvdwogICAgICAgIChwb3QgPj4gOCkgJiAweEZGLCAgICAjIEJ5dGUgMTogcG90IGhpZ2gKICAgICAgICBwb3QyICYgMHhGRiwgICAgICAgICAgIyBCeXRlIDI6IHBvdDIgbG93CiAgICAgICAgKHBvdDIgPj4gOCkgJiAweEZGLCAgICMgQnl0ZSAzOiBwb3QyIGhpZ2gKICAgICAgICBjYW5pbywgICAgICAgICAgICAgICAgIyBCeXRlIDQ6IGNvbnRyb2wgZmxhZ3MKICAgICAgICBjcnVpc2VzcGVlZCAmIDB4RkYsICAgIyBCeXRlIDU6IGNydWlzZXNwZWVkIGxvdwogICAgICAgIChjcnVpc2VzcGVlZCA+PiA4KSAmIDB4RkYsICAjIEJ5dGUgNjogY3J1aXNlc3BlZWQgaGlnaAogICAgICAgIHJlZ2VucHJlc2V0ICAgICAgICAgICAjIEJ5dGUgNzogcmVnZW4gcHJlc2V0IChvciBDUkMpCiAgICBdCiAgICAKICAgICMgSWYgQ1JDIGlzIGVuYWJsZWQsIGNhbGN1bGF0ZSBDUkMtMzIgYW5kIHB1dCBpbiBieXRlIDcKICAgIGlmIGNhbl9pb19jb25maWdbJ3VzZV9jcmMnXToKICAgICAgICAjIFNpbXBsZSBDUkMtMzIgY2FsY3VsYXRpb24gKHNpbXBsaWZpZWQgLSBhY3R1YWwgT3BlbkludmVydGVyIHVzZXMgcHJvcGVyIENSQy0zMikKICAgICAgICAjIEZvciBub3csIHVzZSBhIHNpbXBsZSBjaGVja3N1bQogICAgICAgIGNyYyA9IHN1bShkYXRhWzo3XSkgJiAweEZGCiAgICAgICAgZGF0YVs3XSA9IGNyYwogICAgCiAgICAjIFNlbmQgQ0FOIG1lc3NhZ2UKICAgIHRyeToKICAgICAgICBjYW5fZGV2LnNlbmQoZGF0YSwgY2FuX2lvX2NvbmZpZ1snY2FuX2lkJ10pCiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgIyBTaWxlbnRseSBmYWlsIC0gZXJyb3JzIHdpbGwgYmUgY2F1Z2h0IGJ5IGNhbGxlcgogICAgICAgIHBhc3MK"
};

// Bundled extension code
var fe=Object.defineProperty;var xe=(e,t,s)=>t in e?fe(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s;var W=(e,t,s)=>(xe(e,typeof t!="symbol"?t+"":t,s),s);var be={version:"Firmware version.",hwver:"Hardware version",opmode:"Operating mode. 0=Off, 1=Run, 2=Manual_run, 3=Boost, 4=Buck, 5=Sine, 6=2 Phase sine",lasterr:"Last error message",udc:"Voltage on the DC side of the inverter. a.k.a, battery voltage.",idc:"Current passing through the DC side of the inverter (calculated).",il1:"Current passing through the first current sensor on the AC side.",il2:"Current passing through the second current sensor on the AC side.",fstat:"Stator frequency",speed:"The speed (rpm) of the motor.",cruisespeed:"",turns:"Number of turns the motor has completed since startup.",amp:"Sine amplitude, 37813=max",angle:"Motor rotor angle, 0-360\xB0. When using the SINE software, the slip is added to the rotor position.",pot:"Pot value, 4095=max",pot2:"Regen Pot value, 4095=max",potnom:"Scaled pot value, 0 accel",dir:"Rotation direction. -1=REV, 0=Neutral, 1=FWD",tmphs:"Inverter heatsink temperature",tmpm:"Motor temperature",uaux:"Auxiliary voltage (i.e. 12V system). Measured on pin 11 (mprot)",pwmio:"Raw state of PWM outputs at power up",canio:"Digital IO bits received via CAN",din_cruise:"Cruise Control. This pin activates the cruise control with the current speed. Pressing again updates the speed set point.",din_start:'State of digital input "start". This pin starts inverter operation',din_brake:'State of digital input "brake". This pin sets maximum regen torque (brknompedal). Cruise control is disabled.',din_mprot:'State of digital input "motor protection switch". Shuts down the inverter when = 0',din_forward:"Direction forward.",din_reverse:"Direction backward.",din_emcystop:'State of digital input "emergency stop". Shuts down the inverter when = 0',din_ocur:"Over current detected.",din_bms:"BMS over voltage/under voltage.",cpuload:"CPU load for everything except communication",curkp:"Current controller proportional gain",curki:"Current controller integral gain",curkifrqgain:"Current controllers integral gain frequency coefficient",fwkp:"Cross comparison field weakening controller gain",dmargin:"Margin for residual torque producing current (so field weakening current doesn't use up the entire amplitude)",syncadv:'Shifts "syncofs" downwards/upwards with frequency',boost:"0 Hz Boost in digit. 1000 digit ~ 2.5%",fweak:"Frequency where V/Hz reaches its peak",fconst:"Frequency where slip frequency is derated to form a constant power region. Only has an effect when < fweak",udcnom:"Nominal voltage for fweak and boost. fweak and boost are scaled to the actual dc voltage. 0=don't scale",fslipmin:"Slip frequency at minimum throttle",fslipmax:"Slip frequency at maximum throttle",fslipconstmax:"Slip frequency at maximum throttle and fconst",fmin:"Below this frequency no voltage is generated",polepairs:"Pole pairs of motor (e.g. 4-pole motor: 2 pole pairs)",respolepairs:"Pole pairs of resolver (normally same as polepairs of motor, but sometimes 1)",encflt:"Filter constant between pulse encoder and speed calculation. Makes up for slightly uneven pulse distribution",encmode:"0=single channel encoder, 1=quadrature encoder, 2=quadrature /w index pulse, 3=SPI (deprecated), 4=Resolver, 5=sin/cos chip",fmax:"At this frequency rev limiting kicks in",numimp:"Pulse encoder pulses per turn",dirchrpm:"Motor speed at which direction change is allowed",dirmode:"0=button (momentary pulse selects forward/reverse), 1=switch (forward or reverse signal must be constantly high)",syncofs:"Phase shift of sine wave after receiving index pulse",snsm:"Motor temperature sensor. 12=KTY83, 13=KTY84, 14=Leaf, 15=KTY81",pwmfrq:"PWM frequency. 0=17.6kHz, 1=8.8kHz, 2=4.4kHz, 3=2.2kHz. Needs PWM restart",pwmpol:"PWM polarity. 0=active high, 1=active low. DO NOT PLAY WITH THIS! Needs PWM restart",deadtime:"Deadtime between highside and lowside pulse. 28=800ns, 56=1.5\xB5s. Not always linear, consult STM32 manual. Needs PWM restart",ocurlim:"Hardware over current limit. RMS-current times sqrt(2) + some slack. Set negative if il1gain and il2gain are negative.",minpulse:"Narrowest or widest pulse, all other mapped to full off or full on, respectively",il1gain:"Digits per A of current sensor L1",il2gain:"Digits per A of current sensor L2",udcgain:"Digits per V of DC link",udcofs:"DC link 0V offset",udclim:"High voltage at which the PWM is shut down",snshs:"Heatsink temperature sensor. 0=JCurve, 1=Semikron, 2=MBB600, 3=KTY81, 4=PT1000, 5=NTCK45+2k2, 6=Leaf",pinswap:`Swap pins (only "FOC" software). Multiple bits can be set. 1=Swap Current Inputs, 2=Swap Resolver sin/cos, 4=Swap PWM output 1/3
001 = 1 Swap Currents only
010 = 2 Swap Resolver only
011 = 3 Swap Resolver and Currents
100 = 4 Swap PWM only
101 = 5 Swap PWM and Currents
110 = 6 Swap PWM and Resolve
111 = 7 Swap PWM and Resolver and Currents`,bmslimhigh:"Positive throttle limit on BMS under voltage",bmslimlow:"Regen limit on BMS over voltage",udcmin:"Minimum battery voltage",udcmax:"Maximum battery voltage",iacmax:"Maximum peak AC current",idcmax:"Maximum DC input current",idcmin:"Maximum DC output current (regen)",throtmax:"Throttle limit",throtmin:"Throttle regen limit",ifltrise:"Controls how quickly slip and amplitude recover. The greater the value, the slower",ifltfall:"Controls how quickly slip and amplitude are reduced on over current. The greater the value, the slower",chargemode:"0=Off, 3=Boost, 4=Buck",chargecur:"Charge current setpoint. Boost mode: charger INPUT current. Buck mode: charger output current",chargekp:"Charge controller gain. Lower if you have oscillation, raise if current set point is not met",chargeflt:"Charge current filtering. Raise if you have oscillations",chargemax:"Charge mode duty cycle limit. Especially in boost mode this makes sure you don't overvolt you IGBTs if there is no battery connected.",potmin:`Value of "pot" when pot isn't pressed at all`,potmax:'Value of "pot" when pot is pushed all the way in',pot2min:'Value of "pot2" when regen pot is in 0 position',pot2max:'Value of "pot2" when regen pot is in full on position',potmode:"0=Pot 1 is throttle and pot 2 is regen strength preset. 1=Pot 2 is proportional to pot 1 (redundancy) 2=Throttle controlled via CAN",throtramp:"Max positive throttle slew rate",throtramprpm:"No throttle ramping above this speed",ampmin:'Minimum relative sine amplitude (only "sine" software)',slipstart:'% positive throttle travel at which slip is increased (only "sine" software)',throtcur:'Motor current per % of throttle travel (only "FOC" software)',brknompedal:"Foot on brake pedal regen torque",brkpedalramp:"Ramp speed when entering regen. E.g. when you set brkmax to 20% and brknompedal to -60% and brkpedalramp to 1, it will take 400ms to arrive at brake force of -60%",brknom:"Range of throttle pedal travel allocated to regen",brkmax:"Foot-off throttle regen torque",brkrampstr:"Below this frequency the regen torque is reduced linearly with the frequency",brkout:"Activate brake light output at this amount of braking force",idlespeed:"Motor idle speed. Set to -100 to disable idle function. When idle speed controller is enabled, brake pedal must be pressed on start.",idlethrotlim:"Throttle limit of idle speed controller",idlemode:"Motor idle speed mode. 0=always run idle speed controller, 1=only run it when brake pedal is released, 2=like 1 but only when cruise switch is on",speedkp:"Speed controller gain (Cruise and idle speed). Decrease if speed oscillates. Increase for faster load regulation",speedflt:"Filter before cruise controller",cruisemode:"0=button (set when button pressed, reset with brake pedal), 1=switch (set when switched on, reset when switched off or brake pedal)",cruisethrotlim:"Throttle limit when cruise control is active",hillholdkp:"Hill hold controller proportional gain",udcsw:"Voltage at which the DC contactor is allowed to close",udcswbuck:"Voltage at which the DC contactor is allowed to close in buck charge mode",tripmode:"What to do with relays at a shutdown event. 0=All off, 1=Keep DC switch closed, 2=close precharge relay",pwmfunc:"Quantity that controls the PWM output. 0=tmpm, 1=tmphs, 2=speed",pwmgain:"Gain of PWM output",pwmofs:"Offset of PWM output, 4096=full on",canspeed:"Baud rate of CAN interface 0=250k, 1=500k, 2=800k, 3=1M",canperiod:"0=send configured CAN messages every 100ms, 1=every 10ms",fslipspnt:"Slip setpoint in mode 2. Written by software in mode 1",ampnom:"Nominal amplitude in mode 2. Written by software in mode 1"};function m(e){return be[e]||""}function T(e){if(!e||typeof e!="object")return e;let t={};for(let[s,i]of Object.entries(e))if(t[s]={...i},!t[s].description){let r=m(s);r&&(t[s].description=r)}return t}var F={voltage:{value:350.5,unit:"V",isparam:!1,category:"Electrical",id:4097,canId:500,canPosition:0,canBits:16,canGain:.1,isTx:!0},current:{value:45.2,unit:"A",isparam:!1,category:"Electrical",id:4098},power:{value:15850,unit:"W",isparam:!1,category:"Electrical",id:4099},rpm:{value:3e3,unit:"rpm",isparam:!1,category:"Motor",id:4100},temp:{value:65,unit:"\xB0C",isparam:!1,category:"Thermal",id:4101,canId:500,canPosition:16,canBits:8,canGain:1,isTx:!0},cruisemode:{value:0,unit:"",isparam:!0,category:"Automation",id:8193,enums:{0:"Button",1:"Switch"},default:0,description:m("cruisemode")},cruisethrotlim:{value:50,unit:"%",isparam:!0,category:"Automation",id:8194,minimum:0,maximum:100,default:50,description:m("cruisethrotlim")||"Throttle limit when cruise control is active"},hillholdkp:{value:-.25,unit:"",isparam:!0,category:"Automation",id:8195,minimum:-100,maximum:0,default:-.25,description:m("hillholdkp")||"Hill hold controller proportional gain"},idlemode:{value:0,unit:"",isparam:!0,category:"Automation",id:8196,enums:{0:"Always",1:"Brake released",2:"With cruise"},default:0,description:m("idlemode")},idlespeed:{value:-100,unit:"rpm",isparam:!0,category:"Automation",id:8197,minimum:-100,maximum:1e4,default:-100,description:m("idlespeed")},idlethrotlim:{value:50,unit:"%",isparam:!0,category:"Automation",id:8198,minimum:0,maximum:100,default:50,description:m("idlethrotlim")},speedflt:{value:5,unit:"",isparam:!0,category:"Automation",id:8199,minimum:0,maximum:16,default:5,description:m("speedflt")},speedkp:{value:.25,unit:"",isparam:!0,category:"Automation",id:8200,minimum:0,maximum:100,default:.25,description:m("speedkp")},pwmfunc:{value:0,unit:"",isparam:!0,category:"Aux PWM",id:8201,enums:{0:"tmpm",1:"tmphs",2:"speed"},default:0,description:m("pwmfunc")},pwmgain:{value:100,unit:"",isparam:!0,category:"Aux PWM",id:8202,minimum:-1e5,maximum:1e5,default:100,description:m("pwmgain")},pwmofs:{value:0,unit:"dig",isparam:!0,category:"Aux PWM",id:8203,minimum:-65535,maximum:65535,default:0,description:m("pwmofs")},fslipspnt:{value:2,unit:"Hz",isparam:!0,category:"Motor",id:8208,minimum:0,maximum:10,default:1.5,description:m("fslipspnt")},opmode:{value:1,unit:"",isparam:!0,category:"Control",id:8209,enums:{0:"Off",1:"Manual",2:"Auto"},default:0,description:m("opmode")},kp:{value:100,unit:"",isparam:!0,category:"Control",id:8210,minimum:0,maximum:1e3,default:150,description:"Current controller proportional gain"},ki:{value:50,unit:"",isparam:!0,category:"Control",id:8211,minimum:0,maximum:500,default:80,description:"Current controller integral gain"}};function ye(){let e={};return Object.entries(F).forEach(([t,s])=>{s.isparam&&(e[t]={...s})}),e}function $e(){let e={};return Object.entries(F).forEach(([t,s])=>{if(!s.isparam){let i=s.value,r=i*.02,a=i+(Math.random()*2-1)*r;e[t]={...s,value:Math.round(a*100)/100}}}),e}function we(){let e={};return Object.entries(F).forEach(([t,s])=>{s.id!==void 0&&(e[t]={...s})}),e}function f(){return this.state.selectedNodeId>127}async function H(){if(f.call(this))return ye();let e=await this.device.execute("from lib.ext.openinverter.OI_helpers import getOiParams; getOiParams()"),t=this.device.parseJSON(e);return T(t)}async function z(e,t){let s=typeof e=="object"?e:{NAME:e,VALUE:t};if(f.call(this)){let n=s.NAME,o=s.VALUE;return this.state.oiParameters&&this.state.oiParameters[n]&&(this.state.oiParameters[n].value=o,this.emit("render")),{success:!0}}let i=JSON.stringify(s),r=await this.device.execute(`from lib.ext.openinverter.OI_helpers import setParameter; setParameter(${i})`);return this.device.parseJSON(r)}async function J(){if(f.call(this))return $e();let e=await this.device.execute("from lib.ext.openinverter.OI_helpers import getSpotValues; getSpotValues()"),t=this.device.parseJSON(e);return T(t)}async function q(){if(f.call(this))return{tx:[],rx:[]};let e=await this.device.execute("from lib.ext.openinverter.OI_helpers import getCanMap; getCanMap()");console.log("[OI] getCanMappings raw result:",e);let t=this.device.parseJSON(e);return console.log("[OI] getCanMappings parsed:",t),t}async function G(){if(f.call(this))return we();let e=await this.device.execute("from lib.ext.openinverter.OI_helpers import getAllParamsWithIds; getAllParamsWithIds()"),t=this.device.parseJSON(e);return T(t)}async function Y(e){if(f.call(this))return{success:!0};let t=JSON.stringify(e),s=await this.device.execute(`from lib.ext.openinverter.OI_helpers import addCanMapping; import json; addCanMapping(json.loads('${t.replace(/'/g,"\\'")}'))`);return this.device.parseJSON(s)}async function K(e,t,s){if(f.call(this))return{success:!0};let r=JSON.stringify({direction:e,msg_index:t,param_index:s}),a=await this.device.execute(`from lib.ext.openinverter.OI_helpers import removeCanMapping; import json; removeCanMapping(json.loads('${r.replace(/'/g,"\\'")}'))`);return this.device.parseJSON(a)}function $(){return!this.state.oiParameters&&!this.state.isLoadingOiParameters&&this.state.oiDeviceConnected&&setTimeout(()=>V.call(this),0),this.html`
    <div class="system-panel">      
      ${Ce.call(this)}
    </div>
  `}function Ce(){if(this.state.oiDeviceConnected&&!this.state.oiParameters&&!this.state.isLoadingOiParameters&&setTimeout(()=>V.call(this),0),!this.state.oiDeviceConnected)return this.html`
      <section id="device-parameters" class="card">
        <h2 class="section-header">Device Parameters</h2>
        <div style="padding: 60px 20px; text-align: center;">
          <div style="font-size: 48px; margin-bottom: 16px; opacity: 0.3;"></div>
          <p style="font-size: 16px; color: var(--text-secondary); margin: 0;">
            Connect to a device to view parameters
          </p>
          <p style="font-size: 13px; color: var(--text-secondary); margin: 8px 0 0;">
            Use the Device Selector to scan and connect
          </p>
        </div>
      </section>
    `;if(this.state.isLoadingOiParameters)return this.html`
      <section id="device-parameters" class="card">
        <h2 class="section-header">Device Parameters</h2>
        <div style="padding: 60px 20px; text-align: center;">
          <p style="font-size: 16px; color: var(--text-secondary);">Loading parameters...</p>
        </div>
      </section>
    `;if(!this.state.oiParameters||Object.keys(this.state.oiParameters).length===0)return this.html`
      <section id="device-parameters" class="card">
        <h2 class="section-header">Device Parameters</h2>
        <div style="padding: 60px 20px; text-align: center;">
          <p style="font-size: 16px; color: var(--text-secondary); margin: 0;">
            No parameters available
          </p>
          <p style="font-size: 13px; color: var(--text-secondary); margin: 8px 0 0;">
            Parameters will load automatically when connected
          </p>
        </div>
      </section>
    `;this.state.collapsedCategories||(this.state.collapsedCategories=new Set),this.state.nodeId===void 0&&(this.state.nodeId=this.state.selectedNodeId?.toString()||"1");let e={};Object.entries(this.state.oiParameters).forEach(([s,i])=>{if(i.isparam){let r=i.category||"Spot Values";e[r]||(e[r]=[]),e[r].push([s,i])}});let t=Object.entries(e).sort((s,i)=>s[0].localeCompare(i[0]));return t.forEach(([s,i])=>{i.sort((r,a)=>r[0].localeCompare(a[0]))}),this.html`
    <section id="device-parameters" class="card">
      <h2 class="section-header" onclick=${s=>{let i=s.currentTarget.parentElement;i&&i.scrollIntoView({behavior:"smooth",block:"start"})}}>
        Device Parameters
      </h2>

      <div class="parameters-grid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 1rem;">
        ${t.map(([s,i])=>{let r=this.state.collapsedCategories.has(s);return this.html`
            <div class="parameter-category ${r?"collapsed":""}" style="grid-column: 1 / -1;">
              <h3 class="category-title" onclick=${()=>De.call(this,s)}>
                <span class="collapse-icon">${r?"\u25B6":"\u25BC"}</span>
                ${s}
                <span class="param-count">(${i.length})</span>
              </h3>
              ${r?"":this.html`
                <div class="parameters-list" style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 1rem; margin-top: 0.5rem;">
                  ${i.map(([a,n])=>Se.call(this,a,n))}
                </div>
              `}
            </div>
          `})}
      </div>

      <div class="form-group" style="margin-top: 2rem; padding-top: 1rem; border-top: 1px solid var(--border-color);">
        <label>Node ID</label>
        <input
          type="text"
          value="${this.state.nodeId||"1"}"
          oninput=${s=>{this.state.nodeId=s.target.value,this.emit("render")}}
          placeholder="Enter Node ID"
        />
        <small class="hint">CAN Node ID for this device (typically 1)</small>
      </div>

      <div class="button-group">
        <button class="btn-primary" onclick=${()=>Ne.call(this)} disabled=${!this.state.oiDeviceConnected}>
          Save Node ID
        </button>
        <button class="btn-secondary" onclick=${()=>Oe.call(this)} disabled=${!this.state.oiDeviceConnected}>
          Save All to Flash
        </button>
      </div>

      <div class="form-group" style="margin-top: 1.5rem; padding-top: 1.5rem; border-top: 1px solid var(--border-color);">
        <label style="margin-bottom: 1rem;">Import/Export Parameters</label>
        <div class="button-group" style="margin-top: 0;">
          <button class="btn-secondary" onclick=${()=>Pe.call(this)} disabled=${!this.state.oiParameters||this.state.isImporting}>
            Export to JSON
          </button>
          <button class="btn-secondary" onclick=${()=>Me.call(this)} disabled=${!this.state.oiParameters||this.state.isImporting}>
            ${this.state.isImporting?`Importing... (${this.state.importProgress?.current||0}/${this.state.importProgress?.total||0})`:"Import from JSON"}
          </button>
        </div>
        <small class="hint" style="display: block; margin-top: 0.5rem;">
          Export parameters to a JSON file or import from a previously exported file
        </small>
        <input
          ref=${s=>{this.fileInputRef=s}}
          type="file"
          accept=".json"
          style="display: none;"
          onchange=${s=>Q.call(this,s)}
        />
      </div>
    </section>
  `}function Se(e,t){let s=t.enums&&Object.keys(t.enums).length>0,i=Ae.call(this,e),r=s?Te.call(this,t.value):t.value;return this.html`
    <div class="parameter-item" style="display: flex; flex-direction: column; gap: 0.25rem;">
      <div class="parameter-header">
        <label class="parameter-label" title="${t.description||""}" style="cursor: ${t.description?"help":"default"}; display: block; margin-bottom: 0.25rem;">
          ${i}
          ${t.unit?this.html`<span class="parameter-unit"> (${t.unit})</span>`:""}
          ${t.description?this.html`<span style="margin-left: 4px; opacity: 0.6; font-size: 0.9em;" title="${t.description}"></span>`:""}
        </label>
      </div>

      <div class="parameter-input-group" style="display: flex; flex-direction: column; gap: 0.25rem;">
        ${s?this.html`
          <select
            value="${r}"
            onchange=${a=>Ie.call(this,e,t,parseFloat(a.target.value))}
            disabled=${!this.state.oiDeviceConnected}
            style="width: 100%; max-width: 200px;"
          >
            ${Object.entries(t.enums).map(([a,n])=>this.html`
              <option value="${a}" ${r===a?"selected":""}>
                ${String(n)}
              </option>
            `)}
          </select>
        `:this.html`
          <input
            type="number"
            value="${t.value}"
            min="${t.minimum!==void 0?t.minimum:""}"
            max="${t.maximum!==void 0?t.maximum:""}"
            step="${t.unit==="Hz"||t.unit==="A"?"0.1":"1"}"
            onblur=${a=>ke.call(this,e,t,a)}
            disabled=${!this.state.oiDeviceConnected}
            style="width: 100%; max-width: 150px;"
          />
        `}

        ${t.minimum!==void 0&&t.maximum!==void 0&&!s?this.html`
          <small class="parameter-hint">
            Range: ${t.minimum} - ${t.maximum}
            ${t.default!==void 0?` (Default: ${t.default})`:""}
          </small>
        `:""}
      </div>
    </div>
  `}function Ie(e,t,s){X.call(this,e,s)}function ke(e,t,s){let i=s.target,r=parseFloat(i.value);if(isNaN(r)){i.value=t.value;return}if(t.minimum!==void 0&&r<t.minimum){alert(`Value must be at least ${t.minimum}`),i.value=t.value;return}if(t.maximum!==void 0&&r>t.maximum){alert(`Value must be at most ${t.maximum}`),i.value=t.value;return}r!==t.value&&X.call(this,e,r)}function De(e){this.state.collapsedCategories||(this.state.collapsedCategories=new Set),this.state.collapsedCategories.has(e)?this.state.collapsedCategories.delete(e):this.state.collapsedCategories.add(e),this.emit("render")}async function X(e,t){try{await z.call(this,{NAME:e,VALUE:t}),this.state.oiParameters&&this.state.oiParameters[e]&&(this.state.oiParameters[e].value=t,this.emit("render"))}catch(s){console.error("[OI Parameters] Failed to update parameter:",s),alert(`Failed to update parameter: ${s.message}`),await V.call(this)}}async function V(){if(this.state.isLoadingOiParameters){console.log("[OI Parameters] Already loading parameters, skipping");return}this.state.isLoadingOiParameters=!0,this.emit("render");try{let e=await H.call(this);this.state.oiParameters=e,this.state.isLoadingOiParameters=!1,this.emit("render")}catch(e){console.error("[OI Parameters] Failed to load parameters:",e),this.state.isLoadingOiParameters=!1,this.emit("render"),alert(`Failed to load parameters: ${e.message}`)}}function Pe(){if(!this.state.oiParameters){alert("No parameters to export");return}let e={};Object.entries(this.state.oiParameters).forEach(([n,o])=>{o.isparam&&(e[n]=o.value)});let t=this.state.selectedDeviceSerial||this.state.currentDeviceSerial||"device",s=new Date().toISOString().split("T")[0],i=new Blob([JSON.stringify(e,null,2)],{type:"application/json"}),r=URL.createObjectURL(i),a=document.createElement("a");a.href=r,a.download=`parameters_${t}_${s}.json`,document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(r),console.log("[OI Parameters] Exported",Object.keys(e).length,"parameters"),alert(`Exported ${Object.keys(e).length} parameters`)}function Me(){if(this.fileInputRef)this.fileInputRef.click();else{let e=document.createElement("input");e.type="file",e.accept=".json",e.onchange=t=>Q.call(this,t),e.click()}}async function Q(e){let t=e.target,s=t.files?.[0];if(s)try{let i=await s.text(),r=JSON.parse(i);if(!this.state.oiParameters){alert("No parameter definitions loaded");return}let a=0,n=0,o=[],h=[];for(let[d,p]of Object.entries(r)){if(typeof p!="number"){n++,o.push(`${d}: value must be a number`);continue}let l=this.state.oiParameters[d];if(!l){n++,o.push(`${d}: parameter not found`);continue}if(!l.isparam){n++,o.push(`${d}: not a settable parameter`);continue}if(l.id===void 0){n++,o.push(`${d}: parameter ID not defined`);continue}if(l.minimum!==void 0&&p<l.minimum){n++,o.push(`${d}: value ${p} below minimum ${l.minimum}`);continue}if(l.maximum!==void 0&&p>l.maximum){n++,o.push(`${d}: value ${p} above maximum ${l.maximum}`);continue}a++,h.push({key:d,value:p,paramId:l.id})}if(t.value="",h.length>0){this.state.isImporting=!0,this.state.importProgress={current:0,total:h.length},this.emit("render"),h.forEach(({key:l,value:g})=>{this.state.oiParameters&&this.state.oiParameters[l]&&(this.state.oiParameters[l].value=g)});let d=l=>new Promise(g=>setTimeout(g,l));for(let l=0;l<h.length;l++){let{key:g,value:M,paramId:N}=h[l];try{await z.call(this,{NAME:g,VALUE:M}),this.state.importProgress.current=l+1,this.emit("render"),await d(50)}catch(b){console.error(`[OI Parameters] Failed to update ${g}:`,b),o.push(`${g}: ${b.message}`)}}this.state.isImporting=!1,this.emit("render");let p=`Import complete: ${a} parameter${a===1?"":"s"} updated`;if(n>0){let l=o.slice(0,5).join(`
`)+(o.length>5?`
...and ${o.length-5} more`:"");p+=`

${n} error${n===1?"":"s"}:
${l}`}alert(p)}if(n>0&&a===0){let d=o.slice(0,5).join(`
`)+(o.length>5?`
...and ${o.length-5} more`:"");alert(`Import failed: ${n} error${n===1?"":"s"}:
${d}`)}a===0&&n===0&&alert("No valid parameters found in file")}catch(i){console.error("[OI Parameters] Import error:",i),alert(`Failed to import: ${i.message}`),t.value="",this.state.isImporting=!1,this.emit("render")}}async function Ne(){if(!this.state.oiDeviceConnected){alert("Not connected to device");return}let e=parseInt(this.state.nodeId);if(isNaN(e)||e<1||e>127){alert("Node ID must be a number between 1 and 127");return}try{let t=this.state.discoveredDevices?.find(s=>s.serial===this.state.selectedDeviceSerial);t&&(t.nodeId=e,this.state.selectedNodeId=e),alert(`Node ID set to ${e}`),this.emit("render")}catch(t){console.error("[OI Parameters] Save Node ID error:",t),alert(`Failed to save Node ID: ${t.message}`)}}async function Oe(){if(!this.state.oiDeviceConnected){alert("Not connected to device");return}try{let e=await this.device.execute("from lib.ext.openinverter.OI_helpers import saveToFlash; saveToFlash()"),t=this.device.parseJSON(e);t&&t.success?alert("Parameters saved to flash successfully"):alert("Failed to save parameters to flash")}catch(e){console.error("[OI Parameters] Save to flash error:",e),alert(`Failed to save to flash: ${e.message}`)}}function Ae(e){return e?e.split("_").map(t=>t.charAt(0).toUpperCase()+t.slice(1).toLowerCase()).join(" "):""}function Te(e){return e==null?"0":String(Math.round(Number(e)))}function x(){if(!this.state.oiDeviceConnected)return this.html`
      <div style="padding: 60px 20px; text-align: center;">
        <p style="font-size: 18px; color: var(--text-primary); margin: 0 0 8px 0; font-weight: 600;">
          No Device Connected
        </p>
        <p style="font-size: 14px; color: var(--text-secondary); margin: 0;">
          Use the Device Manager to scan and connect
        </p>
      </div>
    `;if(!this.state.spotValueRefreshTimer&&!this.state.isEditingInterval&&te.call(this),this.state.isLoadingOiSpotValues)return this.html`
      <div style="padding: 60px 20px; text-align: center;">
        <p style="font-size: 16px; color: var(--text-secondary);">Loading spot values...</p>
      </div>
    `;if(!this.state.oiSpotValues||Object.keys(this.state.oiSpotValues).length===0)return this.html`
      <div style="padding: 60px 20px; text-align: center;">
        <p style="font-size: 16px; color: var(--text-secondary); margin: 0;">
          No spot values available
        </p>
        <p style="font-size: 13px; color: var(--text-secondary); margin: 8px 0 0;">
          Refreshing automatically every ${this.state.autoRefreshInterval}ms...
        </p>
      </div>
    `;let e={};return Object.entries(this.state.oiSpotValues).forEach(([t,s])=>{let i=s.category||"Uncategorized";e[i]||(e[i]=[]),e[i].push({name:t,...s})}),this.html`
    <section id="spot-values" class="card">
      <h2 class="section-header" onclick=${t=>{let s=t.currentTarget.parentElement;s&&s.scrollIntoView({behavior:"smooth",block:"start"})}}>
        Spot Values
      </h2>

      <div style="background: var(--bg-secondary); border-bottom: 1px solid var(--border-color); padding: 16px 20px; margin-bottom: 1rem;">
        <div style="display: flex; align-items: center; gap: 16px; flex-wrap: wrap;">
          <!-- Update interval input -->
          <div style="display: flex; align-items: center; gap: 8px;">
            <label style="font-size: 14px; color: var(--text-secondary); white-space: nowrap;">
              Update Interval:
            </label>
            <input 
              type="number"
              value=${this.state.isEditingInterval?this.state.editingIntervalValue||this.state.autoRefreshInterval:this.state.autoRefreshInterval}
              onfocus=${t=>{this.state.isEditingInterval=!0,this.state.editingIntervalValue=t.target.value,this.state.spotValueRefreshTimer&&R.call(this)}}
              oninput=${t=>{this.state.editingIntervalValue=t.target.value}}
              onchange=${t=>{let s=t.target.value;ee.call(this,s)}}
              onblur=${t=>{let s=t.target.value;ee.call(this,s)}}
              min="100"
              max="10000"
              step="100"
              style="
                width: 80px;
                padding: 8px;
                border: 1px solid var(--border-color);
                border-radius: 4px;
                font-size: 14px;
                font-family: 'Monaco', 'Courier New', monospace;
              "
            />
            <span style="font-size: 14px; color: var(--text-secondary);">ms</span>
          </div>
          
          <!-- Clear data button -->
          <button 
            class="secondary-button"
            onclick=${()=>Ve.call(this)}
            style="background: var(--oi-orange); padding: 8px 16px; margin-left: auto;">
            Clear Data
          </button>
        </div>
      </div>

      <div style="padding: 0 20px 20px;">
        <div class="spot-values-categories">
          ${Object.entries(e).map(([t,s])=>this.html`
            <div class="parameter-category">
              <h3 class="category-title">
                ${t}
                <span class="param-count">(${s.length})</span>
              </h3>
              <div class="parameters-list" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 1rem;">
                ${s.map(i=>Fe.call(this,i))}
              </div>
            </div>
          `)}
        </div>
      </div>
    </section>
  `}function Fe(e){this.state.selectedChartParams||(this.state.selectedChartParams=new Set);let t=this.state.selectedChartParams.has(e.name),s=I(e.value,e.unit),i=Le.call(this,e,s.value),r=this.state.spotValueHistory[e.name]||[],a=`spot-card-${e.name.replace(/[^a-zA-Z0-9]/g,"-")}`,n=()=>{console.log("[OI] Clicked spot value card:",e.name),Re.call(this,e.name)};return this.html`
    <div 
      id="${a}"
      data-param-name="${e.name}"
      role="button"
      tabindex="0"
      onclick=${n}
      onkeydown=${o=>{(o.key==="Enter"||o.key===" ")&&(o.preventDefault(),n())}}
      style="
        background: ${t?"var(--bg-tertiary)":"var(--bg-secondary)"};
        border: 2px solid ${t?"var(--scheme-primary)":"var(--border-color)"};
        border-radius: 8px;
        padding: 16px;
        cursor: pointer;
        user-select: none;
        transition: all 0.2s;
        display: flex;
        flex-direction: column;
        gap: 12px;
      "
      onmouseover=${o=>{o.currentTarget.style.cursor="pointer",t||(o.currentTarget.style.borderColor="var(--scheme-primary)")}}
      onmouseout=${o=>{o.currentTarget.style.cursor="pointer",t||(o.currentTarget.style.borderColor="var(--border-color)")}}>
      
      <!-- Spot Value Header -->
      <div style="pointer-events: none;">
        <div style="font-size: 13px; font-weight: 600; color: var(--scheme-primary); margin-bottom: 8px;">
          ${e.name}
        </div>
        <div class="spot-value-display" style="
          font-size: 20px; 
          font-weight: 600; 
          font-family: 'Press Start 2P', 'Monaco', 'Courier New', monospace; 
          background-color: #c8e4b7;
          color: #3b5e2b;
          padding: 10px 15px;
          border: 2px solid #5a7d4a;
          border-radius: 5px;
          box-shadow: inset 0 0 5px rgba(0, 0, 0, 0.3);
          text-shadow: 1px 1px 2px rgba(255, 255, 255, 0.3);
          line-height: 1.2;
          image-rendering: pixelated;
          background-image: repeating-linear-gradient(to bottom, rgba(0, 0, 0, 0.05) 0px, rgba(0, 0, 0, 0.05) 1px, transparent 1px, transparent 3px);
          text-align: right;
          letter-spacing: 0.05em;
        ">
          ${i}
        </div>
      </div>
      
      <div class="mini-chart-container" style="pointer-events: none;">
        ${t?ze.call(this,e.name,r,s.unit):""}
      </div>
      
      <!-- Click hint -->
      <div style="font-size: 11px; color: var(--text-secondary); text-align: center; opacity: 0.7; pointer-events: none;">
        ${t?"Click to hide chart":"Click to show chart"}
      </div>
    </div>
  `}function ze(e,t,s){let a={top:10,right:10,bottom:40,left:50},n=500-a.left-a.right,o=150-a.top-a.bottom;if(t.length<2)return this.html`
      <div style="width: 100%; height: ${150}px; display: flex; align-items: center; justify-content: center; color: var(--text-secondary); font-size: 12px;">
        Collecting data...
      </div>
    `;let h=t.map(c=>c.value),d=t.map(c=>c.timestamp),p=Math.min(...h),l=Math.max(...h),g=Math.min(...d),M=Math.max(...d),N=l-p||1,b=M-g||1,O=c=>a.left+(c-g)/b*n,A=c=>a.top+o-(c-p)/N*o,B=5,ue=Array.from({length:B},(c,v)=>p+N*v/(B-1)),j=6,me=Array.from({length:j},(c,v)=>g+b*v/(j-1)),ge=t.map((c,v)=>{let u=O(c.timestamp),y=A(c.value);return`${v===0?"M":"L"} ${u} ${y}`}).join(" "),_=Ee(e);return this.html`
    <svg width="100%" height="${150}" viewBox="0 0 ${500} ${150}" preserveAspectRatio="none" style="display: block; width: 100%;">
      <!-- Y-axis line -->
      <line
        x1="${a.left}"
        y1="${a.top}"
        x2="${a.left}"
        y2="${150-a.bottom}"
        stroke="#ccc"
        stroke-width="1"
      />

      <!-- X-axis line -->
      <line
        x1="${a.left}"
        y1="${150-a.bottom}"
        x2="${500-a.right}"
        y2="${150-a.bottom}"
        stroke="#ccc"
        stroke-width="1"
      />

      <!-- Y-axis ticks, labels, and grid lines -->
      ${ue.map((c,v)=>{let u=A(c);return this.html`
          <g>
            <!-- Tick mark -->
            <line
              x1="${a.left-5}"
              y1="${u}"
              x2="${a.left}"
              y2="${u}"
              stroke="#ccc"
              stroke-width="1"
            />
            <!-- Grid line -->
            <line
              x1="${a.left}"
              y1="${u}"
              x2="${500-a.right}"
              y2="${u}"
              stroke="#e0e0e0"
              stroke-width="1"
              stroke-dasharray="2,2"
            />
            <!-- Y-axis label -->
            <text
              x="${a.left-8}"
              y="${u}"
              text-anchor="end"
              dominant-baseline="middle"
              style="font-size: 10px; fill: #666; font-family: 'Monaco', 'Courier New', monospace;">
              ${c.toFixed(1)}
            </text>
          </g>
        `})}

      <!-- X-axis ticks, labels, and grid lines -->
      ${me.map((c,v)=>{let u=O(c),y=new Date(c),ve=`${String(y.getHours()).padStart(2,"0")}:${String(y.getMinutes()).padStart(2,"0")}:${String(y.getSeconds()).padStart(2,"0")}`;return this.html`
          <g>
            <!-- Tick mark -->
            <line
              x1="${u}"
              y1="${150-a.bottom}"
              x2="${u}"
              y2="${150-a.bottom+5}"
              stroke="#ccc"
              stroke-width="1"
            />
            <!-- Grid line -->
            <line
              x1="${u}"
              y1="${a.top}"
              x2="${u}"
              y2="${150-a.bottom}"
              stroke="#e0e0e0"
              stroke-width="1"
              stroke-dasharray="2,2"
            />
            <!-- X-axis label -->
            <text
              x="${u}"
              y="${150-a.bottom+15}"
              text-anchor="middle"
              style="font-size: 9px; fill: #666; font-family: 'Monaco', 'Courier New', monospace;">
              ${ve}
            </text>
          </g>
        `})}

      <!-- Data line -->
      <path
        d="${ge}"
        fill="none"
        stroke="${_}"
        stroke-width="2"
        stroke-linecap="round"
        stroke-linejoin="round"
      />

      <!-- Data points -->
      ${t.map(c=>{let v=O(c.timestamp),u=A(c.value);return this.html`
          <circle
            cx="${v}"
            cy="${u}"
            r="3"
            fill="${_}"
            stroke="white"
            stroke-width="1"
          />
        `})}

      <!-- Unit label (top right) -->
      <text
        x="${500-a.right-5}"
        y="${a.top+10}"
        text-anchor="end"
        style="font-size: 11px; fill: #666; font-weight: 600;">
        ${s}
      </text>
    </svg>
  `}function te(){this.state.spotValueRefreshTimer&&clearInterval(this.state.spotValueRefreshTimer),Z.call(this),this.state.spotValueRefreshTimer=setInterval(()=>{Z.call(this)},this.state.autoRefreshInterval)}function R(){this.state.spotValueRefreshTimer&&(clearInterval(this.state.spotValueRefreshTimer),this.state.spotValueRefreshTimer=null)}async function Z(){if(!this.state.oiDeviceConnected){R.call(this);return}try{this.state.isLoadingOiSpotValues=!0;let e=await J.call(this);if(e){this.state.oiSpotValues=e;let t=Date.now();Object.entries(e).forEach(([s,i])=>{if(this.state.selectedChartParams&&this.state.selectedChartParams.has(s)){this.state.spotValueHistory[s]||(this.state.spotValueHistory[s]=[]);let r=I(i.value,i.unit);this.state.spotValueHistory[s].push({timestamp:t,value:r.value}),this.state.spotValueHistory[s].length>100&&this.state.spotValueHistory[s].shift()}})}this.state.isLoadingOiSpotValues=!1,this.state.activeDeviceTab==="telemetry"&&!this.state.isEditingInterval&&this.emit("render")}catch(e){console.error("[OI] Failed to refresh spot values:",e),this.state.isLoadingOiSpotValues=!1}}function ee(e){let t=parseInt(e,10);if(!isNaN(t)&&t>=100&&t<=1e4){let s=this.state.isEditingInterval;this.state.isEditingInterval=!1,delete this.state.editingIntervalValue,this.state.autoRefreshInterval=t,R.call(this),te.call(this),s||this.emit("render")}}function Ve(){this.state.spotValueHistory={},this.emit("render")}function Re(e){if(this.state.selectedChartParams||(this.state.selectedChartParams=new Set),this.state.selectedChartParams.has(e))this.state.selectedChartParams.delete(e),delete this.state.spotValueHistory[e];else if(this.state.selectedChartParams.add(e),this.state.spotValueHistory[e]||(this.state.spotValueHistory[e]=[]),this.state.oiSpotValues&&this.state.oiSpotValues[e]){let t=this.state.oiSpotValues[e],s=I(t.value,t.unit);this.state.spotValueHistory[e].push({timestamp:Date.now(),value:s.value})}this.emit("render")}function Ee(e){let t=0;for(let i=0;i<e.length;i++)t=e.charCodeAt(i)+((t<<5)-t);let s=["var(--oi-blue)","var(--oi-orange)","var(--oi-green)","#9333ea","#ec4899","#14b8a6","#f59e0b","#ef4444"];return s[Math.abs(t)%s.length]}function I(e,t){if(!t)return{value:e,unit:""};let s=t.match(/^(\d+)(.*)$/);if(s){let i=parseInt(s[1],10),r=s[2];return{value:e*i,unit:r}}return{value:e,unit:t}}function Le(e,t){let s=I(t,e.unit),i;return s.value===0?i="0":Math.abs(s.value)<.01?i=s.value.toExponential(2):Math.abs(s.value)<100?i=s.value.toFixed(2):i=s.value.toFixed(0),s.unit?`${i} ${s.unit}`:i}function w(){if(!this.state.canMappings&&!this.state.isLoadingCanMappings&&this.state.oiDeviceConnected&&setTimeout(()=>E.call(this),0),!this.state.allParamsWithIds&&!this.state.isLoadingAllParamsWithIds&&this.state.oiDeviceConnected&&setTimeout(()=>_e.call(this),0),!this.state.oiDeviceConnected)return this.html`
      <div class="system-panel">
        <div class="panel-message">
          <p>Please connect to a device first</p>
        </div>
      </div>
    `;if(this.state.isLoadingCanMappings)return this.html`
      <div class="system-panel">
        <div class="panel-message">
          <p>Loading CAN mappings...</p>
        </div>
      </div>
    `;let e=this.state.canMappings||{tx:[],rx:[]},t=ie.call(this,e.tx||[],!1),s=ie.call(this,e.rx||[],!0),i=this.state.showCanMappingForm||!1,r=this.state.canMappingFormData||{isrx:!1,id:0,paramid:0,position:0,length:16,gain:1,offset:0},a={},n=this.state.oiParameters||{};Object.entries(n).forEach(([p,l])=>{l&&(a[p]=l)});let o=this.state.oiSpotValues||{};Object.entries(o).forEach(([p,l])=>{l&&(a[p]=l)});let h=Object.keys(this.state.allParamsWithIds||{}).length>0?this.state.allParamsWithIds:a,d=a;return this.html`
    <div class="can-mappings-container system-panel" style="padding: 20px;">
      <h2 class="section-header">CAN Mappings</h2>
      
      ${this.state.canMappingError?this.html`
        <div class="error-message" style="margin-bottom: 1.5rem;">
          <p>Error: ${this.state.canMappingError}</p>
        </div>
      `:""}
      
      ${se.call(this,"TX Mappings","tx",t,d)}
      ${se.call(this,"RX Mappings","rx",s,d)}
      
      ${i?Ue.call(this,r,h):this.html`
        <button class="btn-add" onclick=${()=>{this.state.showCanMappingForm=!0,this.state.canMappingFormData={isrx:!1,id:0,paramid:0,position:0,length:16,gain:1,offset:0},this.emit("render")}}>
          Add CAN Mapping
        </button>
      `}
    </div>
  `}function se(e,t,s,i){return this.html`
    <div class="mapping-section">
      <h3 style="margin-bottom: 1rem; font-size: 1.1rem; color: var(--text-primary);">
        ${e} ${t==="tx"?"(Transmit)":"(Receive)"}
      </h3>
      ${s.length===0?this.html`
        <p class="no-mappings">No ${t.toUpperCase()} mappings configured</p>
      `:this.html`
        <table class="mappings-table">
          <thead>
            <tr>
              <th>CAN ID</th>
              <th>Parameter</th>
              <th>Position</th>
              <th>Length</th>
              <th>Gain</th>
              <th>Offset</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            ${s.map((r,a)=>this.html`
              <tr>
                <td>0x${r.id.toString(16).toUpperCase()}</td>
                <td>${re.call(this,r.paramid,i)}</td>
                <td>${r.position}</td>
                <td>${r.length} bits</td>
                <td>${r.gain}</td>
                <td>${r.offset}</td>
                <td>
                  <button
                    class="btn-remove"
                    onclick=${()=>je.call(this,r)}
                  >
                    Remove
                  </button>
                </td>
              </tr>
            `)}
          </tbody>
        </table>
      `}
    </div>
  `}function Ue(e,t){return this.html`
    <div class="add-mapping-form">
      <h3 style="margin-top: 0; margin-bottom: 1.5rem; color: var(--text-primary);">
        Add New CAN Mapping
      </h3>
      <div class="form-row">
        <label>
          Direction:
          <select
            onchange=${s=>{this.state.canMappingFormData={...e,isrx:s.target.value==="rx"},this.emit("render")}}
          >
            <option value="tx" ${e.isrx?"":"selected"}>TX (Transmit)</option>
            <option value="rx" ${e.isrx?"selected":""}>RX (Receive)</option>
          </select>
        </label>

        <label>
          CAN ID (hex):
          <input
            type="text"
            placeholder="0x180"
            value=${`0x${e.id.toString(16).toUpperCase()}`}
            onchange=${s=>{let i=s.target.value,r=parseInt(i,16);isNaN(r)||(this.state.canMappingFormData={...e,id:r},this.emit("render"))}}
          />
        </label>
      </div>

      <div class="form-row">
        <label>
          Parameter:
          <select
            onchange=${s=>{this.state.canMappingFormData={...e,paramid:parseInt(s.target.value)||0},this.emit("render")}}
          >
            <option value="0" ${e.paramid===0?"selected":""}>Select parameter...</option>
            ${(()=>{let s=new Set,i=Object.entries(t).filter(([r,a])=>!a||!a.id||s.has(a.id)?!1:(s.add(a.id),!0)).sort(([r,a],[n,o])=>(a.id||0)-(o.id||0));return i.length===0?this.html`
                  <option value="0" disabled>No parameters with IDs available</option>
                `:i.map(([r,a])=>this.html`
                <option value="${a.id}" ${e.paramid===a.id?"selected":""}>
                  ${ae.call(this,r,a)} (ID: ${a.id})
                </option>
              `)})()}
          </select>
        </label>

        <label>
          Bit Position:
          <input
            type="number"
            min="0"
            max="63"
            value=${e.position}
            onchange=${s=>{this.state.canMappingFormData={...e,position:parseInt(s.target.value)||0},this.emit("render")}}
          />
        </label>

        <label>
          Bit Length:
          <input
            type="number"
            min="1"
            max="32"
            value=${e.length}
            onchange=${s=>{this.state.canMappingFormData={...e,length:parseInt(s.target.value)||16},this.emit("render")}}
          />
        </label>
      </div>

      <div class="form-row">
        <label>
          Gain:
          <input
            type="number"
            step="0.001"
            value=${e.gain}
            onchange=${s=>{this.state.canMappingFormData={...e,gain:parseFloat(s.target.value)||1},this.emit("render")}}
          />
        </label>

        <label>
          Offset:
          <input
            type="number"
            value=${e.offset}
            onchange=${s=>{this.state.canMappingFormData={...e,offset:parseInt(s.target.value)||0},this.emit("render")}}
          />
        </label>
      </div>

      <div class="form-actions">
        <button class="btn-cancel" onclick=${()=>{this.state.showCanMappingForm=!1,this.state.canMappingFormData={isrx:!1,id:0,paramid:0,position:0,length:16,gain:1,offset:0},this.emit("render")}}>Cancel</button>
        <button class="btn-save" onclick=${()=>Be.call(this)}>Save</button>
      </div>
    </div>
  `}async function Be(){let e=this.state.canMappingFormData||{};if(e.paramid===0){alert("Please select a parameter");return}let t=null,s=this.state.allParamsWithIds||{};for(let[i,r]of Object.entries(s))if(r&&r.id===e.paramid){t=i;break}if(!t){let i=this.state.oiParameters||{};for(let[r,a]of Object.entries(i))if(a&&a.id===e.paramid){t=r;break}}if(!t){let i=this.state.oiSpotValues||{};for(let[r,a]of Object.entries(i))if(a&&a.id===e.paramid){t=r;break}}if(!t){alert("Parameter not found");return}this.state.canMappingError=null;try{if(this.state.selectedNodeId>127){let r=e.isrx?"rx":"tx";this.state.mockCanMappings||(this.state.mockCanMappings={tx:[],rx:[]});let a=this.state.mockCanMappings[r]||[],n=null;for(let o=0;o<a.length;o++)if(a[o].canId===e.id){n=o;break}n===null&&(a.push({canId:e.id,isExtended:!1,params:[]}),n=a.length-1),a[n].params.push({paramId:e.paramid,position:e.position,length:e.length,gain:e.gain,offset:e.offset}),this.state.mockCanMappings[r]=a}else this.state.isLoadingCanMappings=!0,this.emit("render"),await Y.call(this,{can_id:e.id,param_name:t,position:e.position,length:e.length,gain:e.gain,offset:e.offset,is_tx:!e.isrx,is_extended:!1}),this.state.isLoadingCanMappings=!1;this.state.showCanMappingForm=!1,this.state.canMappingFormData={isrx:!1,id:0,paramid:0,position:0,length:16,gain:1,offset:0},await E.call(this),alert("CAN mapping added successfully")}catch(i){console.error("[OI] Failed to add CAN mapping:",i),this.state.isLoadingCanMappings=!1,this.state.canMappingError=i.message||"Failed to add CAN mapping",this.emit("render"),alert(`Failed to add CAN mapping: ${i.message}`)}}async function je(e){let t=e.isrx?"rx":"tx",s={};Object.assign(s,this.state.oiParameters||{}),Object.assign(s,this.state.oiSpotValues||{});let i=re.call(this,e.paramid,s),r=`0x${e.id.toString(16).toUpperCase()}`;if(confirm(`Remove ${t.toUpperCase()} mapping for ${i} (CAN ID ${r})?`)){this.state.canMappingError=null;try{if(this.state.selectedNodeId>127){let n=this.state.mockCanMappings[t]||[];if(e.msgIndex<n.length){let o=n[e.msgIndex];e.paramIndex<o.params.length&&(o.params.splice(e.paramIndex,1),o.params.length===0&&n.splice(e.msgIndex,1))}}else this.state.isLoadingCanMappings=!0,this.emit("render"),await K.call(this,t,e.msgIndex,e.paramIndex),this.state.isLoadingCanMappings=!1;await E.call(this),alert("CAN mapping removed successfully")}catch(a){console.error("[OI] Failed to remove CAN mapping:",a),this.state.isLoadingCanMappings=!1,this.state.canMappingError=a.message||"Failed to remove CAN mapping",this.emit("render"),alert(`Failed to remove CAN mapping: ${a.message}`)}}}function ie(e,t){if(!Array.isArray(e))return[];let s=[];return e.forEach((i,r)=>{!i||!Array.isArray(i.params)||i.params.forEach((a,n)=>{a&&a.paramId!==void 0&&s.push({id:i.canId,paramid:a.paramId,position:a.position,length:a.length,gain:a.gain,offset:a.offset,isrx:t,msgIndex:r,paramIndex:n})})}),s}function ae(e,t){return t?t.name||e:e||"Unknown"}function re(e,t){if(!t||e===0)return`Param ${e}`;for(let[s,i]of Object.entries(t))if(i.id===e)return ae.call(this,s,i);return`Param ${e}`}async function _e(){if(this.state.isLoadingAllParamsWithIds){console.log("[OI] Already loading all params with IDs, skipping");return}this.state.isLoadingAllParamsWithIds=!0,this.emit("render");try{let e=await G.call(this);this.state.allParamsWithIds=e,this.state.isLoadingAllParamsWithIds=!1,this.emit("render")}catch(e){console.error("[OI] Failed to load all params with IDs:",e),this.state.isLoadingAllParamsWithIds=!1,this.emit("render")}}async function E(){if(this.state.isLoadingCanMappings){console.log("[OI] Already loading CAN mappings, skipping");return}this.state.isLoadingCanMappings=!0,this.state.canMappingError=null,this.emit("render");try{if(this.state.selectedNodeId>127){this.state.canMappings={tx:[...this.state.mockCanMappings?.tx||[]],rx:[...this.state.mockCanMappings?.rx||[]]},this.state.isLoadingCanMappings=!1,this.emit("render");return}let t=await q.call(this);console.log("[OI] Loaded CAN mappings:",t),t&&(t.tx!==void 0||t.rx!==void 0)?this.state.canMappings={tx:t.tx||[],rx:t.rx||[]}:(console.warn("[OI] Unexpected CAN mappings format:",t),this.state.canMappings={tx:[],rx:[]}),this.state.isLoadingCanMappings=!1,this.emit("render")}catch(e){console.error("[OI] Failed to load CAN mappings:",e),this.state.isLoadingCanMappings=!1,this.state.canMappingError=e.message||"Failed to load CAN mappings",this.emit("render"),alert(`Failed to load CAN mappings: ${e.message}`)}}function C(){return this.state.oiDeviceConnected?this.html`
    <div id="can-message-sender" class="system-panel">
      ${We.call(this)}
      ${He.call(this)}
      ${Je.call(this)}
    </div>
  `:this.html`
      <div class="system-panel">
        <div class="panel-message">
          <p>Please connect to a device first</p>
        </div>
      </div>
    `}function We(){let e=this.state.canIo||{};return this.html`
    <div class="can-io-control">
      <h3>CAN I/O Control</h3>
      
      <div class="can-io-section">
        <div class="can-io-row">
          <label>CAN ID (hex)</label>
          <input 
            type="text"
            value="${e.canId||"3F"}"
            oninput=${t=>{this.state.canIo.canId=t.target.value}}
          />
        </div>
        <div class="can-io-row">
          <label>Interval (ms)</label>
          <input 
            type="number"
            value="${e.interval||100}"
            min="10"
            max="1000"
            oninput=${t=>{this.state.canIo.interval=parseInt(t.target.value)}}
          />
        </div>
      </div>

      <div class="can-io-section">
        <h4>Control Flags</h4>
        <div class="can-io-flags">
          ${["cruise","start","brake","forward","reverse","bms"].map(t=>this.html`
            <label class="can-io-checkbox">
              <input 
                type="checkbox"
                checked=${e[t]||!1}
                onchange=${s=>{this.state.canIo[t]=s.target.checked}}
              />
              <span>${t.charAt(0).toUpperCase()+t.slice(1)}</span>
            </label>
          `)}
        </div>
      </div>

      <div class="can-io-section">
        <div class="can-io-row">
          <label>Throttle (%)</label>
          <input 
            type="range"
            min="0"
            max="100"
            value="${e.throttlePercent||0}"
            oninput=${t=>{this.state.canIo.throttlePercent=parseInt(t.target.value),this.emit("render")}}
          />
          <span class="value">${e.throttlePercent||0}%</span>
        </div>
      </div>

      <div class="can-io-actions">
        ${e.active?this.html`
          <button class="stop-btn" onclick=${()=>Ge.call(this)}>
            Stop CAN IO
          </button>
          <div class="can-io-status-indicator">
            <div class="pulse"></div>
            Active
          </div>
        `:this.html`
          <button class="start-btn" onclick=${()=>qe.call(this)}>
            Start CAN IO
          </button>
        `}
      </div>
    </div>
  `}function He(){let e=this.state.canMessages||{};return this.html`
    <div class="message-section">
      <h3>Send One-Shot Message</h3>
      <div class="message-form">
        <div class="form-row">
          <label>
            CAN ID (hex)
            <input 
              class="input-hex"
              type="text"
              value="${e.canId||"3F"}"
              placeholder="3F"
              oninput=${t=>{this.state.canMessages.canId=t.target.value}}
            />
            <span class="input-hint">Enter hex value (e.g., 3F for 0x3F)</span>
          </label>
        </div>
        <div class="form-row">
          <label>
            Data Bytes (hex, space-separated)
            <input 
              class="input-data"
              type="text"
              value="${e.dataBytes||"00 00 00 00 00 00 00 00"}"
              placeholder="00 00 00 00 00 00 00 00"
              oninput=${t=>{this.state.canMessages.dataBytes=t.target.value}}
            />
            <span class="input-hint">Enter 8 bytes in hex (e.g., 01 02 03 04 05 06 07 08)</span>
          </label>
        </div>
        <div class="form-actions">
          <button 
            class="btn-send"
            onclick=${()=>Ye.call(this)}
          >
            Send Message
          </button>
        </div>
      </div>
    </div>
  `}function Je(){let e=this.state.canMessages?.periodicMessages||[];return this.html`
    <div class="message-section">
      <h3>Periodic Messages</h3>
      ${e.length>0?renderDataTable.call(this,{columns:[{key:"canId",label:"CAN ID",render:t=>`0x${toHex(t,2)}`},{key:"data",label:"Data",render:t=>formatBytes(t)},{key:"interval",label:"Interval (ms)"},{key:"active",label:"Status",render:t=>t?"Active":"Inactive"}],data:e,actions:[{label:"Toggle",className:"btn-secondary",onClick:(t,s)=>Ke.call(this,s)},{label:"Delete",className:"btn-remove",onClick:(t,s)=>Xe.call(this,s)}]}):this.html`<div class="no-messages">No periodic messages configured</div>`}
      
      <button class="btn-add" onclick=${()=>{this.state.canMessages.showAddPeriodicForm=!0,this.emit("render")}}>
        Add Periodic Message
      </button>
    </div>
  `}async function qe(){console.log("[CanIO] Starting..."),this.state.canIo.active=!0,this.emit("render")}function Ge(){console.log("[CanIO] Stopping..."),this.state.canIo.active=!1,this.emit("render")}async function Ye(){if(!this.state.oiDeviceConnected){alert("Not connected to device");return}let e=this.state.canMessages.canId||"",t=this.state.canMessages.dataBytes||"";if(!validateCanId(e)){alert("Invalid CAN ID (must be 0x000 to 0x7FF)");return}if(!validateDataBytes(t)){alert("Invalid data bytes");return}let s=parseHex(e),i=parseDataBytes(t);try{let r=await getCanConfig.call(this),a=`
import CAN
import json

# Get CAN config
tx_pin = ${r.txPin}
rx_pin = ${r.rxPin}
bitrate = ${r.bitrate}

# Initialize CAN (reuse if exists, otherwise create new)
try:
    # Try to reuse existing CAN device
    if 'can_dev' in globals() and can_dev is not None:
        can = can_dev
    else:
        can = CAN(0, extframe=False, tx=tx_pin, rx=rx_pin, bitrate=bitrate, mode=CAN.NORMAL, auto_restart=False)
        can_dev = can
except Exception as e:
    # If reuse fails, create new
    can = CAN(0, extframe=False, tx=tx_pin, rx=rx_pin, bitrate=bitrate, mode=CAN.NORMAL, auto_restart=False)
    can_dev = can

# Send message
can.send(${JSON.stringify(i)}, ${s})

# Return success
print(json.dumps({'success': True, 'can_id': ${s}}))
`,n=await this.device.execute(a),o=this.device.parseJSON(n);o&&o.error?alert(`Failed to send CAN message: ${o.error}`):alert(`CAN message sent: ID 0x${s.toString(16).toUpperCase()}`)}catch(r){console.error("[CAN] Send error:",r),alert("Failed to send CAN message: "+r.message)}}function Ke(e){let t=this.state.canMessages.periodicMessages[e];t.active=!t.active,this.emit("render")}function Xe(e){confirm("Delete this periodic message?")&&(this.state.canMessages.periodicMessages.splice(e,1),this.emit("render"))}function k(){this.state.firmwareUpgrade||(this.state.firmwareUpgrade={selectedFile:null,serialNumber:"",recoveryMode:!1,inProgress:!1,progress:0,status:"",error:null});let e=this.state.firmwareUpgrade;return this.html`
    <div style="padding: 20px;">
      <!-- Warning Notice -->
      <div style="background: #fef3c7; border: 2px solid #f59e0b; border-radius: 8px; padding: 16px; margin-bottom: 24px; color: #92400e;">
        <strong> Warning:</strong> Firmware upgrades are potentially dangerous. 
        Do not interrupt the process once started. Ensure stable power supply.
      </div>
      
      <!-- File Selection -->
      <div style="background: var(--bg-secondary); border: 1px solid var(--border-color); border-radius: 8px; padding: 20px; margin-bottom: 24px;">
        <h3 style="font-size: 16px; margin-bottom: 16px;">Firmware File</h3>
        
        <div style="display: flex; flex-direction: column; gap: 12px;">
          <input 
            type="file" 
            accept=".bin"
            onchange=${t=>Qe.call(this,t)}
            disabled=${e.inProgress}
            style="padding: 8px; border: 1px solid var(--border-color); border-radius: 4px; background: var(--bg-primary); color: var(--text-primary);"
          />
          
          ${e.selectedFile?this.html`
            <div style="font-size: 13px; color: var(--text-secondary);">
              Selected: <span style="font-family: monospace; color: var(--text-primary);">${e.selectedFile.name}</span>
              (${(e.selectedFile.size/1024).toFixed(1)} KB)
            </div>
          `:""}
        </div>
      </div>
      
      <!-- Upgrade Options -->
      <div style="background: var(--bg-secondary); border: 1px solid var(--border-color); border-radius: 8px; padding: 20px; margin-bottom: 24px;">
        <h3 style="font-size: 16px; margin-bottom: 16px;">Upgrade Options</h3>
        
        <div style="display: flex; flex-direction: column; gap: 16px;">
          <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
            <input 
              type="checkbox" 
              checked=${e.recoveryMode}
              onchange=${t=>{e.recoveryMode=t.target.checked,this.emit("render")}}
              disabled=${e.inProgress}
              style="width: 16px; height: 16px;"
            />
            <span>Recovery Mode (for bricked devices)</span>
          </label>
          
          ${e.recoveryMode?this.html`
            <label style="display: flex; flex-direction: column; gap: 4px;">
              <span style="font-size: 13px; color: var(--text-secondary);">
                Device Serial Number (8 hex digits, optional)
              </span>
              <input 
                type="text" 
                placeholder="e.g. 1A2B3C4D"
                maxlength="8"
                value=${e.serialNumber}
                oninput=${t=>{e.serialNumber=t.target.value.toUpperCase(),this.emit("render")}}
                disabled=${e.inProgress}
                style="padding: 8px; border: 1px solid var(--border-color); border-radius: 4px; background: var(--bg-primary); color: var(--text-primary); font-family: monospace; width: 200px;"
              />
              <span style="font-size: 12px; color: var(--text-secondary);">
                Leave empty to upgrade the first device that boots
              </span>
            </label>
          `:""}
          
          ${!e.recoveryMode&&this.state.oiDeviceConnected?this.html`
            <div style="font-size: 13px; color: var(--text-secondary);">
              Will upgrade device at Node ID ${this.state.selectedNodeId}. 
              ${this.state.currentDeviceSerial?`Serial: ${this.state.currentDeviceSerial}`:""}
            </div>
          `:e.recoveryMode?"":this.html`
            <div style="font-size: 13px; color: #ef4444;">
              Please connect to a device first (Device Manager)
            </div>
          `}
        </div>
      </div>
      
      <!-- Start/Cancel Buttons -->
      <div style="display: flex; gap: 12px; margin-bottom: 24px;">
        <button 
          class="primary-button"
          onclick=${()=>Ze.call(this)}
          disabled=${!e.selectedFile||e.inProgress||!e.recoveryMode&&!this.state.oiDeviceConnected}
          style="flex: 1;"
        >
          ${e.inProgress?"Upgrading...":"Start Upgrade"}
        </button>
        
        ${e.inProgress?this.html`
          <button 
            class="secondary-button"
            onclick=${()=>et.call(this)}
          >
            Cancel
          </button>
        `:""}
      </div>
      
      <!-- Progress/Status Display -->
      ${e.inProgress||e.status||e.error?this.html`
        <div style="background: var(--bg-secondary); border: 1px solid var(--border-color); border-radius: 8px; padding: 20px;">
          ${e.inProgress?this.html`
            <div>
              <div style="margin-bottom: 12px;">
                <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                  <span style="font-weight: 600;">Progress</span>
                  <span style="font-family: monospace;">${e.progress.toFixed(1)}%</span>
                </div>
                <div style="width: 100%; height: 24px; background: var(--bg-primary); border: 1px solid var(--border-color); border-radius: 4px; overflow: hidden;">
                  <div style="height: 100%; background: linear-gradient(90deg, #4ade80, #22c55e); width: ${e.progress}%; transition: width 0.3s;"></div>
                </div>
              </div>
              ${e.status?this.html`
                <div style="font-size: 13px; color: var(--text-secondary); margin-top: 8px;">
                  ${e.status}
                </div>
              `:""}
            </div>
          `:e.error?this.html`
            <div style="color: #ef4444;">
              <strong>Error:</strong> ${e.error}
            </div>
          `:e.status?this.html`
            <div style="color: #22c55e;">
              <strong>Success:</strong> ${e.status}
            </div>
          `:""}
        </div>
      `:""}
      
      <!-- Help Text -->
      ${e.inProgress?"":this.html`
        <div style="margin-top: 24px; padding: 16px; background: var(--bg-highlight); border: 1px solid var(--border-color); border-radius: 8px; font-size: 13px; color: var(--text-secondary);">
          <h4 style="margin: 0 0 8px 0; color: var(--text-primary);">How to use:</h4>
          <ul style="margin: 0; padding-left: 20px;">
            <li>Select a .bin firmware file from your computer</li>
            <li>For normal upgrades: Connect to a device first, then click "Start Upgrade"</li>
            <li>For recovery: Check "Recovery Mode", optionally enter device serial, then power cycle the device and click "Start Upgrade" immediately</li>
            <li>Do NOT disconnect power or WebREPL during the upgrade</li>
          </ul>
        </div>
      `}
    </div>
  `}function Qe(e){let t=e.target.files[0];t&&(this.state.firmwareUpgrade.selectedFile=t,this.state.firmwareUpgrade.error=null,this.emit("render"))}async function Ze(){let e=this.state.firmwareUpgrade;if(!e.selectedFile){alert("Please select a firmware file");return}if(!e.selectedFile.name.endsWith(".bin")){e.error="Firmware must be a .bin file",this.emit("render");return}if(confirm("Are you sure you want to upgrade the firmware? This process cannot be interrupted.")){e.inProgress=!0,e.progress=0,e.status="Reading firmware file...",e.error=null,this.emit("render");try{let t=await tt.call(this,e.selectedFile);e.status="Uploading firmware to device...",this.emit("render"),await st.call(this,t),e.status="Starting upgrade process...",this.emit("render");let s={recovery_mode:e.recoveryMode,serial_number:e.recoveryMode&&e.serialNumber?e.serialNumber:null,node_id:e.recoveryMode?null:this.state.selectedNodeId},i=JSON.stringify(s),r=await this.device.execute(`from lib.ext.openinverter.OI_helpers import startFirmwareUpgrade; startFirmwareUpgrade(${i})`),a=this.device.parseJSON(r);if(a.error)throw new Error(a.error);await it.call(this)}catch(t){console.error("[OI Firmware] Upgrade failed:",t),e.error=t.message||"Upgrade failed",e.inProgress=!1,this.emit("render")}}}function et(){if(!confirm("Cancel firmware upgrade? This may leave the device in an inconsistent state."))return;let e=this.state.firmwareUpgrade;e.inProgress=!1,e.status="Upgrade cancelled by user",e.error=null,this.emit("render")}async function tt(e){return new Promise((t,s)=>{let i=new FileReader;i.onload=r=>{let a=r.target.result,n=new Uint8Array(a);t(n)},i.onerror=s,i.readAsArrayBuffer(e)})}async function st(e){let t=this.state.firmwareUpgrade,s=4096,i=Math.ceil(e.length/s);for(let r=0;r<i;r++){let a=r*s,n=Math.min(a+s,e.length),o=Array.from(e.slice(a,n)),h=JSON.stringify({chunk:o,offset:a});await this.device.execute(`from lib.ext.openinverter.OI_helpers import uploadFirmwareChunk; uploadFirmwareChunk(${h})`),t.progress=r/i*30,t.status=`Uploading firmware... ${t.progress.toFixed(0)}%`,this.emit("render")}}async function it(){let e=this.state.firmwareUpgrade,t=600,s=0;for(;s<t;){await new Promise(i=>setTimeout(i,1e3));try{let i=await this.device.execute("from lib.ext.openinverter.OI_helpers import getFirmwareUpgradeStatus; getFirmwareUpgradeStatus()"),a=this.device.parseJSON(i);if(a.error)throw new Error(a.error);if(e.progress=30+a.progress*.7,e.status=a.message||"Upgrading...",this.emit("render"),a.complete){e.status="Upgrade completed successfully!",e.progress=100,e.inProgress=!1,this.emit("render");return}}catch(i){console.error("[OI Firmware] Status poll error:",i)}s++}throw new Error("Upgrade timeout")}function le(){return this.state.canScanResults||(this.state.canScanResults=[]),this.state.selectedNodeId||(this.state.selectedNodeId=1),this.state.oiDeviceConnected===void 0&&(this.state.oiDeviceConnected=!1),this.state.isScanning===void 0&&(this.state.isScanning=!1),this.state.discoveredDevices||(this.state.discoveredDevices=[]),this.state.editingDeviceName||(this.state.editingDeviceName=null),this.html`
    <div class="system-panel">
      <div class="panel-header" style="padding: 20px; border-bottom: 1px solid var(--border-color);">
        <h2 style="margin: 0; font-size: 24px;">
          Device Manager
        </h2>
        <p style="margin: 8px 0 0; font-size: 14px;">
          Scan and manage Open Inverter devices via CAN bus
        </p>
      </div>
      

        <!-- Saved Devices List -->
        ${this.state.discoveredDevices.length>0?this.html`
          <div style="margin-bottom: 24px;">
            <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 1.5rem;">
              ${this.state.discoveredDevices.map(e=>rt.call(this,e))}
            </div>
          </div>
        `:""}

        <!-- CAN Bus Scanner -->
        <div style="background: var(--bg-secondary); border: 1px solid var(--border-color); border-radius: 8px; padding: 20px; margin-bottom: 24px;">
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
            <h3 style="font-size: 16px; margin: 0; color: var(--text-primary);">Scan for Devices</h3>
            <div style="display: flex; gap: 8px;">
              <button 
                class="secondary-button" 
                onclick=${()=>ne.call(this,!1)}
                disabled=${!this.state.isConnected||this.state.isScanning}
                style="padding: 8px 16px; font-size: 13px;">
                ${this.state.isScanning?"Scanning...":"Quick Scan (1-10)"}
              </button>
              <button 
                class="secondary-button" 
                onclick=${()=>ne.call(this,!0)}
                disabled=${!this.state.isConnected||this.state.isScanning}
                style="padding: 8px 16px; font-size: 13px;">
                Full Scan (1-127)
              </button>
            </div>
          </div>
          
          ${this.state.isConnected?this.state.isScanning?this.html`
            <div style="padding: 24px;">
              <div style="text-align: center; color: var(--text-secondary); font-size: 14px;">
                <p style="margin: 0;">Scanning CAN bus for devices...</p>
                <p style="font-size: 12px; margin: 8px 0 0;">This may take a few seconds</p>
              </div>
            </div>
          `:this.state.scanMessage?this.html`
            <div style="text-align: center; padding: 20px; color: var(--text-secondary); font-size: 14px; background: var(--bg-tertiary); border-radius: 4px;">
              <p style="margin: 0;">${this.state.scanMessage}</p>
            </div>
          `:this.state.canScanResults.length===0?this.html`
            <div style="text-align: center; padding: 24px; color: var(--text-secondary); font-size: 14px;">
              <p style="margin: 0;">No scan results yet</p>
              <p style="font-size: 12px; margin: 8px 0 0;">Click Quick Scan or Full Scan to find devices</p>
            </div>
          `:this.html`
            <div style="border: 1px solid var(--border-color); border-radius: 4px; overflow: hidden;">
              <table style="width: 100%; border-collapse: collapse; font-size: 13px;">
                <thead>
                  <tr style="background: var(--scheme-primary); color: white;">
                    <th style="padding: 10px 12px; text-align: left; font-weight: 600;">Node ID</th>
                    <th style="padding: 10px 12px; text-align: left; font-weight: 600;">Serial Number</th>
                    <th style="padding: 10px 12px; text-align: right; font-weight: 600;">Actions</th>
                  </tr>
                </thead>
                <tbody>
                  ${this.state.canScanResults.map(e=>this.html`
                    <tr style="border-top: 1px solid var(--border-color); transition: background 0.2s;" onmouseover=${t=>t.currentTarget.style.background="var(--bg-tertiary)"} onmouseout=${t=>t.currentTarget.style.background="transparent"}>
                      <td style="padding: 12px;">${e.nodeId}</td>
                      <td style="padding: 12px; font-family: monospace; font-size: 12px;">${e.serialNumber||"\u2014"}</td>
                      <td style="padding: 12px; text-align: right;">
                        <div style="display: flex; gap: 8px; justify-content: flex-end;">
                          <button 
                            class="secondary-button" 
                            onclick=${t=>{t.stopPropagation(),nt.call(this,e)}}
                            style="padding: 6px 12px; font-size: 13px;">
                            Add
                          </button>
                          <button 
                            class="primary-button" 
                            onclick=${t=>{t.stopPropagation(),ot.call(this,e)}}
                            style="padding: 6px 16px; font-size: 13px;">
                            Connect
                          </button>
                        </div>
                      </td>
                    </tr>
                  `)}
                </tbody>
              </table>
            </div>
          `:this.html`
            <div style="text-align: center; padding: 24px; color: #ef4444; font-size: 14px; background: rgba(239, 68, 68, 0.1); border-radius: 4px;">
              <p style="margin: 0;"> Please connect to ESP32 device via WebREPL first</p>
              <p style="margin: 8px 0 0; font-size: 12px; color: var(--text-secondary);">
                Use the Connection panel to connect to your ESP32
              </p>
            </div>
          `}
        </div>

        <!-- Manual Connection -->
        <div style="background: var(--bg-secondary); border: 1px solid var(--border-color); border-radius: 8px; padding: 20px;">
          <h3 style="font-size: 16px; margin: 0 0 16px 0; color: var(--text-primary);">Manual Connection</h3>
          <div style="display: flex; gap: 12px; align-items: flex-end;">
            <div style="flex: 1;">
              <label style="display: block; font-size: 13px; color: var(--text-secondary); margin-bottom: 6px;">
                Node ID
              </label>
              <input 
                type="number" 
                min="1" 
                max="255"
                value="${this.state.selectedNodeId||1}"
                oninput=${e=>{this.state.selectedNodeId=parseInt(e.target.value)||1}}
                style="width: 100%; padding: 10px; border: 1px solid var(--border-color); border-radius: 4px; background: var(--bg-primary); color: var(--text-primary); font-size: 14px;"
              />
            </div>
            <div style="flex: 2;">
              <label style="display: block; font-size: 13px; color: var(--text-secondary); margin-bottom: 6px;">
                Serial Number (optional)
              </label>
              <input 
                type="text" 
                placeholder="e.g., ABC123..."
                value="${this.state.manualSerial||""}"
                oninput=${e=>{this.state.manualSerial=e.target.value}}
                style="width: 100%; padding: 10px; border: 1px solid var(--border-color); border-radius: 4px; background: var(--bg-primary); color: var(--text-primary); font-size: 14px;"
              />
            </div>
            <div style="display: flex; gap: 8px;">
              <button 
                class="secondary-button" 
                onclick=${()=>ce.call(this)}
                disabled=${this.state.selectedNodeId<=127&&!this.state.isConnected}
                style="min-width: 100px;">
                Add Device
              </button>
              <button 
                class="primary-button" 
                onclick=${()=>lt.call(this)}
                disabled=${this.state.selectedNodeId<=127&&!this.state.isConnected}
                style="min-width: 120px;">
                Connect
              </button>
            </div>
          </div>
          <p style="font-size: 12px; color: var(--text-secondary); margin: 12px 0 0;">
            Enter a Node ID (1-127) to connect to a real device, or >127 (e.g., 200, 201) for mock/demo devices.
          </p>
        </div>
      </div>
    </div>
  `}function D(){let e=this.state.discoveredDevices.find(t=>t.serial===this.state.selectedDeviceSerial);return e?(this.state.activeDeviceTab||(this.state.activeDeviceTab="telemetry"),this.html`
    <div style="display: flex; flex-direction: column; height: 100%;">
      <!-- Device Header -->
      <div style="border-bottom: 1px solid var(--border-color); padding: 20px;">
        <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 8px;">
          <div style="width: 12px; height: 12px; border-radius: 50%; background: ${e.online?"#4caf50":"#999"};"></div>
          <h1 style="margin: 0; font-size: 24px; color: var(--text-primary);">
            ${e.name||`Device ${e.nodeId}`}
          </h1>
          <span style="background: var(--oi-beige); padding: 4px 12px; border-radius: 12px; font-size: 12px; font-weight: 600; color: var(--text-secondary);">
            ${e.online?"Connected":"Offline"}
          </span>
        </div>
        <div style="display: flex; gap: 16px; color: var(--text-secondary); font-size: 13px;">
          <span>Serial: ${e.serial||"Unknown"}</span>
          <span>Node ID: ${e.nodeId}</span>
          <span>Firmware: ${e.firmware||"Unknown"}</span>
        </div>
      </div>

      <!-- Tab Navigation -->
      <div class="tabs-header">
        <div class="tabs-nav">
          <button 
            class="tab-button ${this.state.activeDeviceTab==="telemetry"?"active":""}"
            onclick=${()=>S.call(this,"telemetry")}>
            Telemetry
          </button>
          <button 
            class="tab-button ${this.state.activeDeviceTab==="parameters"?"active":""}"
            onclick=${()=>S.call(this,"parameters")}>
            Parameters
          </button>
          <button 
            class="tab-button ${this.state.activeDeviceTab==="canmapping"?"active":""}"
            onclick=${()=>S.call(this,"canmapping")}>
            CAN Mappings
          </button>
          <button 
            class="tab-button ${this.state.activeDeviceTab==="canmessages"?"active":""}"
            onclick=${()=>S.call(this,"canmessages")}>
            CAN Messages
          </button>
          <button 
            class="tab-button ${this.state.activeDeviceTab==="ota"?"active":""}"
            onclick=${()=>S.call(this,"ota")}>
            OTA Update
          </button>
        </div>
      </div>

      <!-- Tab Content -->
      <div class="tabs-content" style="flex: 1; overflow: auto; padding: 20px;">
        ${at.call(this)}
      </div>
    </div>
  `):this.html`
      <div class="panel-message">
        <p>Device not found</p>
      </div>
    `}function S(e){this.state.activeDeviceTab=e,this.emit("render")}function at(){switch(this.state.activeDeviceTab){case"telemetry":return x.call(this);case"parameters":return $.call(this);case"canmapping":return w.call(this);case"canmessages":return C.call(this);case"ota":return k.call(this);default:return this.html`<div class="panel-message">Unknown tab</div>`}}function rt(e){let t=this.state.oiDeviceConnected&&this.state.currentDeviceSerial===e.serial&&this.state.selectedNodeId===e.nodeId,s=this.state.editingDeviceName===e.serial;return this.html`
    <div 
      class="device-card"
      style="
        background: var(--oi-beige);
        border: 2px solid ${t?"var(--oi-blue)":"#e0e0e0"};
        border-radius: 8px;
        padding: 1.5rem;
        cursor: pointer;
        transition: all 0.3s;
        display: flex;
        flex-direction: column;
        gap: 1rem;
        position: relative;
        pointer-events: auto;
        user-select: none;
      "
      onmouseover=${i=>{t||(i.currentTarget.style.borderColor="var(--oi-blue)"),i.currentTarget.style.boxShadow="0 4px 12px rgba(30, 136, 229, 0.2)",i.currentTarget.style.transform="translateY(-2px)"}}
      onmouseout=${i=>{t||(i.currentTarget.style.borderColor="#e0e0e0"),i.currentTarget.style.boxShadow="none",i.currentTarget.style.transform="none"}}
    >
      <div 
        style="flex: 1; cursor: pointer;"
        onclick=${i=>{let r=i.target;if(r.tagName==="BUTTON"||r.tagName==="INPUT")return;let a=r.parentElement;for(;a&&a!==i.currentTarget;){if(a.tagName==="BUTTON"||a.classList.contains("secondary-button")||a.classList.contains("btn-danger"))return;a=a.parentElement}ct.call(this,e)}}
      >
        <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 4px;">
        <div style="width: 8px; height: 8px; border-radius: 50%; background: ${e.online!==!1?"#4caf50":"#999"};"></div>
        <div style="font-size: 1.2rem; font-weight: 600; color: #333; flex: 1;">
          ${s?this.html`
            <input 
              type="text"
              value="${e.name||""}"
              oninput=${i=>{this.state.editingDeviceNameValue=i.target.value}}
              onkeydown=${i=>{i.key==="Enter"?oe.call(this,e):i.key==="Escape"&&(this.state.editingDeviceName=null,this.emit("render"))}}
              onclick=${i=>i.stopPropagation()}
              onmousedown=${i=>i.stopPropagation()}
              style="width: 100%; padding: 4px 8px; border: 1px solid var(--oi-blue); border-radius: 4px; font-size: 1rem;"
              autofocus
            />
          `:e.name||`Device ${e.nodeId}`}
        </div>
        ${t?this.html`
          <span style="background: var(--oi-orange); color: white; padding: 0.25rem 0.75rem; border-radius: 12px; font-size: 0.75rem; font-weight: 500; text-transform: uppercase;">
            Connected
          </span>
        `:""}
      </div>
      
      <div style="display: flex; flex-direction: column; gap: 0.5rem; font-size: 0.9rem;">
        <div style="color: var(--text-secondary);">
          Serial: <span style="font-family: monospace;">${e.serial||"Unknown"}</span>
        </div>
        <div style="color: var(--text-secondary);">
          Node ID: ${e.nodeId}
        </div>
        ${e.firmware?this.html`
          <div style="color: var(--text-secondary);">
            Firmware: ${e.firmware}
          </div>
        `:""}
        <div style="color: ${e.online!==!1?"#4caf50":"#999"}; font-weight: 500;">
          ${e.online!==!1?"Online":"Offline"}
        </div>
      </div>
      </div>

      <div style="position: absolute; bottom: 0.75rem; right: 0.75rem; display: flex; gap: 0.5rem; z-index: 1; pointer-events: none;">
        ${s?this.html`
          <button 
            class="secondary-button"
            onclick=${i=>{i.stopPropagation(),oe.call(this,e)}}
            onmousedown=${i=>i.stopPropagation()}
            style="width: 32px; height: 32px; padding: 0; display: flex; align-items: center; justify-content: center; border-radius: 4px; pointer-events: auto;"
            title="Save"
          >
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width: 16px; height: 16px;">
              <polyline points="20 6 9 17 4 12"></polyline>
            </svg>
          </button>
          <button 
            class="secondary-button"
            onclick=${i=>{i.stopPropagation(),this.state.editingDeviceName=null,this.emit("render")}}
            onmousedown=${i=>i.stopPropagation()}
            style="width: 32px; height: 32px; padding: 0; display: flex; align-items: center; justify-content: center; border-radius: 4px; pointer-events: auto;"
            title="Cancel"
          >
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width: 16px; height: 16px;">
              <line x1="18" y1="6" x2="6" y2="18"></line>
              <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
          </button>
        `:this.html`
          ${e.name?this.html`
            <button 
              class="secondary-button"
              onclick=${i=>{i.stopPropagation(),dt.call(this,e)}}
              onmousedown=${i=>i.stopPropagation()}
              style="width: 32px; height: 32px; padding: 0; display: flex; align-items: center; justify-content: center; border-radius: 4px; pointer-events: auto;"
              title="Edit"
            >
              <img src=${this.icon("edit",16)} style="width: 16px; height: 16px;" />
            </button>
          `:""}
          <button 
            class="btn-danger"
            onclick=${i=>{i.stopPropagation(),pt.call(this,e)}}
            onmousedown=${i=>i.stopPropagation()}
            style="width: 32px; height: 32px; padding: 0; display: flex; align-items: center; justify-content: center; border-radius: 4px; background: #dc3545; color: white; border: none; pointer-events: auto;"
            title="Delete"
          >
            <img src=${this.icon("trash",16,"white")} style="width: 16px; height: 16px;" />
          </button>
        `}
      </div>
    </div>
  `}async function ne(e){this.state.isScanning=!0,this.state.scanMessage=null,this.emit("render");try{let t=await this.device.execute(`
from lib.ext.openinverter.OI_helpers import scanCanBus
import json
results = scanCanBus(${e?"True":"False"})
print(json.dumps(results))
    `),s=this.device.parseJSON(t);s&&Array.isArray(s)?(this.state.canScanResults=s,this.state.scanMessage=`Found ${s.length} device${s.length!==1?"s":""}`):(this.state.canScanResults=[],this.state.scanMessage="No devices found")}catch(t){console.error("[OI] Scan error:",t),this.state.scanMessage="Scan failed: "+t.message,this.state.canScanResults=[]}this.state.isScanning=!1,this.emit("render")}function nt(e){let t=this.state.discoveredDevices.find(s=>s.nodeId===e.nodeId||s.serial===e.serialNumber);if(t){alert(`Device already added: ${t.name||`Node ${t.nodeId}`}`);return}this.state.discoveredDevices.push({nodeId:e.nodeId,serial:e.serialNumber,name:`Device ${e.nodeId}`,online:!0,firmware:null}),this.emit("render")}function ot(e){this.state.discoveredDevices.find(i=>i.nodeId===e.nodeId||i.serial===e.serialNumber)||this.state.discoveredDevices.push({nodeId:e.nodeId,serial:e.serialNumber,name:`Device ${e.nodeId}`,online:!0,firmware:null}),L.call(this,e.nodeId,e.serialNumber);let s=e.serialNumber||`NODE_${e.nodeId}`;this.emit("change-extension-panel",{extensionId:"openinverter",panelId:`device-${s}`})}function ce(){let e=this.state.selectedNodeId,t=this.state.manualSerial;t||(e>127?t=`MOCK-${String(e).padStart(3,"0")}-${Date.now().toString(36).slice(-4).toUpperCase()}`:t=`MANUAL_${e}`);let s=this.state.discoveredDevices.find(r=>r.nodeId===e||r.serial===t);if(s){alert(`Device already added: ${s.name||`Node ${s.nodeId}`}`);return}let i={nodeId:e,serial:t,name:e>127?`Test Inverter ${e}`:`Device ${e}`,online:!0,firmware:e>127?"v4.2.0-mock":null};this.state.discoveredDevices.push(i),this.state.manualSerial="",this.emit("render"),console.log("[OI] Device added manually:",i)}function lt(){ce.call(this);let e=this.state.selectedNodeId,t=this.state.discoveredDevices.find(s=>s.nodeId===e);t&&(L.call(this,t.nodeId,t.serial),this.emit("change-extension-panel",{extensionId:"openinverter",panelId:`device-${t.serial}`}))}async function L(e,t){if(console.log("[OI] Connecting to device:",{nodeId:e,serial:t}),this.state.selectedNodeId=e,e>127){let s=t||`MOCK-${String(e).padStart(3,"0")}-${Date.now().toString(36).slice(-4).toUpperCase()}`;this.state.discoveredDevices||(this.state.discoveredDevices=[]);let i={nodeId:e,serial:s,name:`Test Inverter ${e}`,firmware:"v4.2.0-mock",online:!0},r=this.state.discoveredDevices.findIndex(a=>a.nodeId===e||a.serial===s);r>=0?this.state.discoveredDevices[r]=i:this.state.discoveredDevices.push(i),this.state.oiDeviceConnected=!0,this.state.currentDeviceSerial=s,this.state.oiParameters=null,console.log("[OI] Mock device connected:",i),this.getMenuItems&&this.emit("update-extension-menu");return}this.state.currentDeviceSerial=t,this.state.oiDeviceConnected=!0,this.state.oiParameters=null,this.getMenuItems&&this.emit("update-extension-menu")}function ct(e){L.call(this,e.nodeId,e.serial),this.emit("change-extension-panel",{extensionId:"openinverter",panelId:`device-${e.serial}`})}function dt(e){this.state.editingDeviceName=e.serial,this.state.editingDeviceNameValue=e.name||"",this.emit("render")}function oe(e){let t=this.state.editingDeviceNameValue?.trim();t&&(e.name=t),this.state.editingDeviceName=null,this.emit("render")}function pt(e){if(!confirm(`Delete ${e.name||`Device ${e.nodeId}`}?`))return;let t=this.state.discoveredDevices.findIndex(s=>s.serial===e.serial);t!==-1&&(this.state.discoveredDevices.splice(t,1),this.state.currentDeviceSerial===e.serial&&(this.state.oiDeviceConnected=!1,this.state.currentDeviceSerial=null,this.state.oiParameters=null),this.getMenuItems&&this.emit("update-extension-menu")),this.emit("render")}function de(){return this.state.canScanResults||(this.state.canScanResults=[]),this.state.selectedNodeId||(this.state.selectedNodeId=1),this.state.oiDeviceConnected===void 0&&(this.state.oiDeviceConnected=!1),this.state.isScanning===void 0&&(this.state.isScanning=!1),this.html`
    <div class="oi-parameters-container">
      <h2 style="color: var(--scheme-primary); margin-bottom: 20px;">Device Control</h2>
      
      <!-- Device Connection Status & Control -->
      <div style="background: var(--bg-secondary); border: 1px solid var(--border-color); border-radius: 8px; padding: 20px; margin-bottom: 24px;">
        <h3 style="font-size: 16px; margin-bottom: 16px;">OpenInverter Connection</h3>
        
        <!-- Connection Status -->
        ${this.state.oiDeviceConnected?this.html`
          <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 16px;">
            <div style="width: 12px; height: 12px; border-radius: 50%; background: #4ade80;"></div>
            <span style="color: #4ade80; font-weight: 600;">Connected to Node ID ${this.state.selectedNodeId}</span>
          </div>
          
          <button 
            class="secondary-button" 
            onclick=${()=>this.disconnectDevice()}>
            Disconnect
          </button>
        `:this.html`
          <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 16px;">
            <div style="width: 12px; height: 12px; border-radius: 50%; background: #ef4444;"></div>
            <span style="color: #ef4444; font-weight: 600;">Not Connected to OpenInverter Device</span>
          </div>
          
          <!-- CAN Bus Scanner -->
          <div style="margin-bottom: 20px;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
              <h4 style="font-size: 14px; margin: 0; color: var(--text-secondary);">Scan CAN Bus for Devices</h4>
              <div style="display: flex; gap: 8px;">
                <button 
                  class="primary-button" 
                  onclick=${()=>this.scanCanBus(!1)}
                  disabled=${!this.state.isConnected||this.state.isScanning}
                  style="padding: 8px 16px; font-size: 13px;">
                  ${this.state.isScanning?"Scanning...":"Quick Scan"}
                </button>
                <button 
                  class="secondary-button" 
                  onclick=${()=>this.scanCanBus(!0)}
                  disabled=${!this.state.isConnected||this.state.isScanning}
                  style="padding: 8px 16px; font-size: 13px;">
                  Full Scan
                </button>
              </div>
            </div>
            
            ${this.state.isConnected?this.state.isScanning?this.html`
              <div style="padding: 16px;">
                <div style="margin-bottom: 12px; color: var(--text-secondary); font-size: 13px; text-align: center;">
                  <p>Scanning CAN bus for devices...</p>
                  <p style="font-size: 12px; margin-top: 8px;">This may take a few seconds</p>
                </div>
              </div>
            `:this.state.scanMessage?this.html`
              <div style="text-align: center; padding: 16px; color: var(--text-secondary); font-size: 13px; background: var(--bg-tertiary); border-radius: 4px;">
                <p>${this.state.scanMessage}</p>
              </div>
            `:this.state.canScanResults.length===0?this.html`
              <div style="text-align: center; padding: 16px; color: var(--text-secondary); font-size: 13px;">
                <p>Click "Quick Scan" to check node IDs 1-10, or "Full Scan" to check all 127 node IDs</p>
              </div>
            `:this.html`
              <div style="border: 1px solid var(--border-color); border-radius: 4px; overflow: hidden; font-size: 13px;">
                <table style="width: 100%; border-collapse: collapse;">
                  <thead>
                    <tr style="background: var(--bg-tertiary);">
                      <th style="padding: 6px 8px; text-align: left;">Node</th>
                      <th style="padding: 6px 8px; text-align: left;">Serial</th>
                      <th style="padding: 6px 8px; text-align: left;">Type</th>
                      <th style="padding: 6px 8px; text-align: left;"></th>
                    </tr>
                  </thead>
                  <tbody>
                    ${this.state.canScanResults.map(e=>this.html`
                      <tr style="border-top: 1px solid var(--border-color);">
                        <td style="padding: 6px 8px;">${e.nodeId}</td>
                        <td style="padding: 6px 8px; font-family: monospace; font-size: 12px;">${e.serialNumber||"\u2014"}</td>
                        <td style="padding: 6px 8px; font-size: 12px;">OI</td>
                        <td style="padding: 6px 8px; text-align: right;">
                          <button 
                            class="secondary-button" 
                            style="padding: 4px 8px; font-size: 11px;"
                            onclick=${()=>this.connectToNode(e.nodeId)}>
                            Connect
                          </button>
                        </td>
                      </tr>
                    `)}
                  </tbody>
                </table>
              </div>
            `:this.html`
              <div style="text-align: center; padding: 16px; color: #ef4444; font-size: 13px; background: rgba(239, 68, 68, 0.1); border-radius: 4px;">
                <p> Please connect to ESP32 device via WebREPL first</p>
              </div>
            `}
          </div>
          
          <!-- Manual Connection -->
          <div style="border-top: 1px solid var(--border-color); padding-top: 16px;">
            <h4 style="font-size: 14px; margin-bottom: 12px; color: var(--text-secondary);">Or Connect Manually</h4>
            <div style="display: flex; gap: 12px; align-items: center;">
              <label style="display: flex; flex-direction: column; gap: 4px;">
                <span style="font-size: 13px; color: var(--text-secondary);">Node ID</span>
                <input 
                  type="number" 
                  min="1" 
                  max="127" 
                  value=${this.state.selectedNodeId}
                  style="padding: 8px; border: 1px solid var(--border-color); border-radius: 4px; background: var(--bg-primary); color: var(--text-primary); width: 100px;"
                  oninput=${e=>this.state.selectedNodeId=parseInt(e.target.value)}
                />
              </label>
              
              <button 
                class="primary-button" 
                style="margin-top: 20px;"
                onclick=${()=>this.connectToDevice()}
                disabled=${!this.state.isConnected}>
                Connect
              </button>
            </div>
          </div>
        `}
      </div>
      
      <!-- Parameter Storage -->
      <div style="margin-bottom: 32px;">
        <h3 style="font-size: 16px; margin-bottom: 12px;">Parameter Storage</h3>
        <div style="display: flex; gap: 12px; flex-wrap: wrap;">
          <button class="primary-button" onclick=${()=>this.deviceSave()} disabled=${!this.state.oiDeviceConnected}>
            Save to Flash
          </button>
          <button class="secondary-button" onclick=${()=>this.deviceLoad()} disabled=${!this.state.oiDeviceConnected}>
            Load from Flash
          </button>
          <button class="secondary-button" onclick=${()=>this.deviceLoadDefaults()} disabled=${!this.state.oiDeviceConnected}>
            Load Factory Defaults
          </button>
        </div>
        <p style="color: var(--text-secondary); font-size: 13px; margin-top: 8px;">
          Save parameters to persistent storage or restore defaults
        </p>
      </div>

      <!-- Motor Control -->
      <div style="margin-bottom: 32px;">
        <h3 style="font-size: 16px; margin-bottom: 12px;">Motor Control</h3>
        <div style="display: flex; gap: 12px; align-items: center; flex-wrap: wrap;">
          <select id="oi-start-mode" style="padding: 8px; border-radius: 4px; border: 1px solid var(--border-color); background: var(--bg-secondary); color: var(--text-primary);" disabled=${!this.state.oiDeviceConnected}>
            <option value="0">Off</option>
            <option value="1">Normal</option>
            <option value="2">Manual</option>
            <option value="3">Boost</option>
            <option value="4">Buck</option>
            <option value="5">Sine</option>
            <option value="6">ACHeat</option>
          </select>
          <button class="primary-button" onclick=${()=>this.deviceStart()} disabled=${!this.state.oiDeviceConnected}>
            Start Motor
          </button>
          <button class="secondary-button" onclick=${()=>this.deviceStop()} disabled=${!this.state.oiDeviceConnected}>
            Stop Motor
          </button>
        </div>
        <p style="color: var(--text-secondary); font-size: 13px; margin-top: 8px;">
          Start motor in selected mode or stop operation
        </p>
      </div>

      <!-- System Actions -->
      <div>
        <h3 style="font-size: 16px; margin-bottom: 12px;">System Actions</h3>
        <button class="secondary-button" style="background: #c0392b; color: white;" onclick=${()=>this.deviceReset()} disabled=${!this.state.oiDeviceConnected}>
          Reset Device
        </button>
        <p style="color: var(--text-secondary); font-size: 13px; margin-top: 8px;">
          Perform a software reset of the device
        </p>
      </div>
    </div>
  `}function pe(){return this.state.plotState||(this.state.plotState={isPlotting:!1,isPaused:!1,selectedVars:[],chart:null,maxDataPoints:100,updateInterval:100}),this.html`
    <div class="system-panel">
      <div class="panel-header oi-compact-header">
        <h2>Live Plot</h2>
        <div class="panel-actions oi-plot-controls">
          ${this.state.plotState.isPlotting?this.html`
            <div class="button">
              <button 
                class="${this.state.plotState.isPaused?"":"active"}"
                onclick=${()=>this.pauseResumePlot()}
                title="${this.state.plotState.isPaused?"Resume":"Pause"} plotting">
                ${this.state.plotState.isPaused?"\u25B6":"\u23F8"}
              </button>
              <div class="label active">${this.state.plotState.isPaused?"Run":"Pause"}</div>
            </div>
            <div class="button">
              <button 
                onclick=${()=>this.stopPlot()}
                title="Stop plotting">
                
              </button>
              <div class="label active">Stop</div>
            </div>
          `:this.html`
            <div class="button">
              <button 
                disabled=${!this.state.isConnected||this.state.plotState.selectedVars.length===0}
                onclick=${()=>this.startPlot()}
                title="Start plotting selected variables">
                
              </button>
              <div class="label ${!this.state.isConnected||this.state.plotState.selectedVars.length===0?"inactive":"active"}">Start Plot</div>
            </div>
          `}
        </div>
      </div>

      ${ht.call(this)}
    </div>
  `}function ht(){return this.state.isConnected?this.state.oiSpotValues?this.html`
    <div class="oi-plot-container">
      <div class="oi-plot-sidebar">
        <h3 class="oi-plot-section-title">Select Signals</h3>
        <div class="oi-plot-signal-list">
          ${Object.entries(this.state.oiSpotValues).map(([e,t])=>ut.call(this,e,t))}
        </div>
        
        <h3 class="oi-plot-section-title">Plot Settings</h3>
        <div class="oi-plot-settings">
          <label>
            Max Data Points:
            <input 
              type="number" 
              value="${this.state.plotState.maxDataPoints}" 
              min="50" 
              max="1000" 
              step="50"
              onchange=${e=>{this.state.plotState.maxDataPoints=parseInt(e.target.value)}}
            />
          </label>
          <label>
            Update Interval (ms):
            <input 
              type="number" 
              value="${this.state.plotState.updateInterval}" 
              min="50" 
              max="1000" 
              step="50"
              onchange=${e=>{this.state.plotState.updateInterval=parseInt(e.target.value)}}
            />
          </label>
        </div>
      </div>
      
      <div class="oi-plot-chart-area">
        <canvas id="oi-plot-canvas"></canvas>
      </div>
    </div>
  `:(this.state.isLoadingOiSpotValues||setTimeout(()=>this.refreshSpotValues(),0),this.html`
      <div class="panel-message">
        <p>Loading spot values...</p>
        <p>Please wait while we fetch available signals.</p>
      </div>
    `):this.html`
      <div class="panel-message">
        <p>Connect to device to use live plotting</p>
      </div>
    `}function ut(e,t){let s=this.state.plotState.selectedVars.includes(e);return this.html`
    <div class="oi-plot-signal">
      <label>
        <input 
          type="checkbox" 
          checked=${s}
          onchange=${i=>this.togglePlotVariable(e,i.target.checked)}
          disabled=${this.state.plotState.isPlotting}
        />
        <span class="oi-plot-signal-name">${e}</span>
        <span class="oi-plot-signal-unit">${t.unit||""}</span>
      </label>
    </div>
  `}function he(){return!this.state.oiDeviceInfo&&!this.state.isLoadingDeviceInfo&&this.state.isConnected&&setTimeout(()=>this.loadDeviceInfo(),0),this.html`
    <div class="oi-parameters-container">
      <h2 style="color: var(--scheme-primary); margin-bottom: 20px;">Device Information & Error Log</h2>
      
      ${mt.call(this)}
    </div>
  `}function mt(){if(this.state.isLoadingDeviceInfo)return this.html`
      <div style="text-align: center; padding: 40px;">
        <p style="color: var(--text-secondary);">Loading device information...</p>
      </div>
    `;if(!this.state.oiDeviceInfo)return this.html`
      <div style="text-align: center; padding: 40px;">
        <p style="color: var(--text-secondary);">No device information available</p>
        <button class="primary-button" style="margin-top: 16px;" onclick=${()=>this.loadDeviceInfo()}>
          Load Device Info
        </button>
      </div>
    `;let e=this.state.oiDeviceInfo,t=this.state.oiErrorLog||[];return this.html`
    <div>
      <!-- Device Info -->
      <div style="background: var(--bg-secondary); border: 1px solid var(--border-color); border-radius: 8px; padding: 16px; margin-bottom: 24px;">
        <h3 style="font-size: 16px; margin-bottom: 12px;">Device Info</h3>
        <div style="display: grid; grid-template-columns: 150px 1fr; gap: 8px; font-size: 14px;">
          <span style="color: var(--text-secondary);">Serial Number:</span>
          <span style="font-family: monospace;">${e.serialNumber||"N/A"}</span>
          
          <span style="color: var(--text-secondary);">Node ID:</span>
          <span>${e.nodeId||"N/A"}</span>
          
          <span style="color: var(--text-secondary);">Bitrate:</span>
          <span>${e.bitrate?e.bitrate/1e3+" kbps":"N/A"}</span>
          
          <span style="color: var(--text-secondary);">Uptime:</span>
          <span>${e.uptime?Math.floor(e.uptime/1e3)+" seconds":"N/A"}</span>
        </div>
      </div>

      <!-- Error Log -->
      <div>
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
          <h3 style="font-size: 16px; margin: 0;">Error Log</h3>
          <button class="secondary-button" onclick=${()=>this.loadDeviceInfo()}>
            Refresh
          </button>
        </div>
        
        ${t.length===0?this.html`
          <p style="color: var(--text-secondary); text-align: center; padding: 24px;">
            No errors logged
          </p>
        `:this.html`
          <div style="border: 1px solid var(--border-color); border-radius: 4px; overflow: hidden;">
            <table style="width: 100%; border-collapse: collapse;">
              <thead>
                <tr style="background: var(--scheme-primary); color: white;">
                  <th style="padding: 8px; text-align: left;">Timestamp</th>
                  <th style="padding: 8px; text-align: left;">Error Code</th>
                  <th style="padding: 8px; text-align: left;">Description</th>
                </tr>
              </thead>
              <tbody>
                ${t.map(s=>this.html`
                  <tr style="border-bottom: 1px solid var(--border-color);">
                    <td style="padding: 8px; font-family: monospace; font-size: 13px;">${s.timestamp||"N/A"}</td>
                    <td style="padding: 8px; font-family: monospace; font-weight: 600;">${s.code||"N/A"}</td>
                    <td style="padding: 8px;">${s.description||"N/A"}</td>
                  </tr>
                `)}
              </tbody>
            </table>
          </div>
        `}
      </div>
    </div>
  `}var P=class P{constructor(t,s,i,r){this.device=t,this.emit=s,this.state=i,this.html=r,this.state.discoveredDevices||(this.state.discoveredDevices=[]),this.state.selectedDeviceSerial||(this.state.selectedDeviceSerial=null),this.state.mockCanMappings||(this.state.mockCanMappings={tx:[],rx:[]}),this.state.activeDeviceTab||(this.state.activeDeviceTab="telemetry"),this.state.spotValueHistory||(this.state.spotValueHistory={}),this.state.selectedChartParams||(this.state.selectedChartParams=new Set),(this.state.autoRefreshInterval===void 0||this.state.autoRefreshInterval===null)&&(this.state.autoRefreshInterval=1e3),this.state.isEditingInterval===void 0&&(this.state.isEditingInterval=!1),this.state.canMessages||(this.state.canMessages={canId:"3F",dataBytes:"00 00 00 00 00 00 00 00",periodicMessages:[],showAddPeriodicForm:!1,periodicFormData:{canId:"",data:"",interval:100}}),this.state.canIo||(this.state.canIo={active:!1,canId:"3F",interval:100,cruise:!1,start:!1,brake:!1,forward:!1,reverse:!1,bms:!1,throttlePercent:0,cruisespeed:0,regenpreset:0,useCrc:!0}),this.state.oiParameters||(this.state.oiParameters=null),this.state.isLoadingOiParameters===void 0&&(this.state.isLoadingOiParameters=!1),this.state.collapsedCategories||(this.state.collapsedCategories=new Set),this.state.nodeId===void 0&&(this.state.nodeId=this.state.selectedNodeId?.toString()||"1"),this.state.isImporting===void 0&&(this.state.isImporting=!1),this.state.importProgress||(this.state.importProgress={current:0,total:0}),this.state.canMappings||(this.state.canMappings=null),this.state.isLoadingCanMappings===void 0&&(this.state.isLoadingCanMappings=!1),this.state.canMappingError||(this.state.canMappingError=null),this.state.showCanMappingForm||(this.state.showCanMappingForm=!1),this.state.canMappingFormData||(this.state.canMappingFormData={isrx:!1,id:0,paramid:0,position:0,length:16,gain:1,offset:0}),this.state.allParamsWithIds||(this.state.allParamsWithIds=null),this.state.isLoadingAllParamsWithIds===void 0&&(this.state.isLoadingAllParamsWithIds=!1),this._setupDynamicDevicePanels()}async onInstall(){if(!this.state.isConnected)return!1;console.log("[OpenInverter] Installing device files...");try{await this.device.mkdir("/lib/ext/openinverter");for(let[t,s]of Object.entries(this.deviceFiles)){let i=t.split("/").pop();console.log(`[OpenInverter] Writing ${i}...`),await this.device.saveFile(t,s)}return console.log("[OpenInverter] Installation complete! Device may need restart to use extension."),!0}catch(t){return console.error("[OpenInverter] Installation failed:",t),!1}}_setupDynamicDevicePanels(){let t=this;this.state.discoveredDevices&&this.state.discoveredDevices.forEach(i=>{let r=`renderDevice-${i.serial}`;t[r]||(t[r]=function(){return t.state.selectedDeviceSerial=i.serial,D.call(t)})});let s=this.state.discoveredDevices.push.bind(this.state.discoveredDevices);this.state.discoveredDevices.push=function(...i){let r=s(...i);return i.forEach(a=>{if(a&&a.serial){let n=`renderDevice-${a.serial}`;t[n]||(t[n]=function(){return t.state.selectedDeviceSerial=a.serial,D.call(t)})}}),r}}getMenuItems(){let t=[{id:"deviceselector",label:"Device Manager"}];if(this.state.discoveredDevices&&this.state.discoveredDevices.length>0){t.push({id:"devices-header",label:"--- DEVICES ---",disabled:!0});let s=this.state.discoveredDevices.map(i=>({id:`device-${i.serial}`,label:i.name||`Device ${i.nodeId}`,icon:i.online?"device":"device-off"}));return[...t,...s]}return t}renderDeviceselector(){return le.call(this)}render(t){if(t&&t.startsWith("device-")){let i=t.replace("device-","");return this.state.selectedDeviceSerial=i,D.call(this)}let s=`render${t.charAt(0).toUpperCase()+t.slice(1)}`;return typeof this[s]=="function"?this[s]():this.html`<div class="panel-message">Panel not found: ${t}</div>`}renderParameters(){return $.call(this)}renderSpotvalues(){return x.call(this)}renderCanmappings(){return w.call(this)}renderCharts(){return x.call(this)}renderCanmessages(){return C.call(this)}renderCommands(){return de.call(this)}renderPlot(){return pe.call(this)}renderErrors(){return he.call(this)}icon(t,s=24,i="#333"){let r=P.ICONS[t];if(!r)return"";let a=r.replace(/width="24"/g,`width="${s}"`).replace(/height="24"/g,`height="${s}"`).replace(/stroke="currentColor"/g,`stroke="${i}"`);return`data:image/svg+xml,${encodeURIComponent(a)}`}renderSidebarDevices(){return!this.state.discoveredDevices||this.state.discoveredDevices.length===0?this.html`
        <div style="padding: 16px; text-align: center; color: var(--text-secondary); font-size: 12px;">
          <p style="margin: 0;">No devices found</p>
          <p style="margin: 8px 0 0; font-size: 11px;">Use Device Selector to scan</p>
        </div>
      `:this.html`
      <div style="padding: 4px 0;">
        ${this.state.discoveredDevices.map(t=>this.html`
          <div 
            onclick=${()=>this.selectDeviceFromSidebar(t)}
            style="
              padding: 12px 16px;
              cursor: pointer;
              transition: background 0.2s;
              border-left: 3px solid ${this.state.selectedDeviceSerial===t.serial?"var(--oi-blue)":"transparent"};
              background: ${this.state.selectedDeviceSerial===t.serial?"var(--oi-blue-light)":"transparent"};
            "
            onmouseover=${s=>{this.state.selectedDeviceSerial!==t.serial&&(s.currentTarget.style.background="var(--bg-tertiary)")}}
            onmouseout=${s=>{this.state.selectedDeviceSerial!==t.serial&&(s.currentTarget.style.background="transparent")}}>
            
            <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 4px;">
              <div style="width: 8px; height: 8px; border-radius: 50%; background: ${t.online?"#4caf50":"#999"};"></div>
              <div style="font-weight: 600; font-size: 13px; color: var(--text-primary); overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">
                ${t.name||`Device ${t.nodeId}`}
              </div>
            </div>
            <div style="font-size: 11px; color: var(--text-secondary); margin-left: 16px;">
              ${t.serial?t.serial.substring(0,12)+"...":`Node ${t.nodeId}`}
            </div>
          </div>
        `)}
      </div>
    `}selectDeviceFromSidebar(t){this.state.selectedDeviceSerial=t.serial,this.state.selectedNodeId=t.nodeId,this.state.activeDeviceTab="telemetry",(!this.state.oiDeviceConnected||this.state.currentDeviceSerial!==t.serial)&&t.nodeId>127&&(this.state.oiDeviceConnected=!0,this.state.currentDeviceSerial=t.serial),this.emit("render")}renderDevicePanel(){let t=this.state.discoveredDevices.find(s=>s.serial===this.state.selectedDeviceSerial);return t?this.html`
      <div style="display: flex; flex-direction: column; height: 100%;">
        <!-- Device Header -->
        <div style="border-bottom: 1px solid var(--border-color); padding: 20px;">
          <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 8px;">
            <div style="width: 12px; height: 12px; border-radius: 50%; background: ${t.online?"#4caf50":"#999"};"></div>
            <h1 style="margin: 0; font-size: 24px; color: var(--text-primary);">
              ${t.name||`Device ${t.nodeId}`}
            </h1>
            <span style="background: var(--oi-beige); padding: 4px 12px; border-radius: 12px; font-size: 12px; font-weight: 600; color: var(--text-secondary);">
              ${t.online?"Connected":"Offline"}
            </span>
          </div>
          <div style="display: flex; gap: 16px; color: var(--text-secondary); font-size: 13px;">
            <span>Serial: ${t.serial||"Unknown"}</span>
            <span>Node ID: ${t.nodeId}</span>
            <span>Firmware: ${t.firmware||"Unknown"}</span>
          </div>
        </div>

        <!-- Tab Navigation -->
        <div class="tabs-header">
          <div class="tabs-nav">
            <button 
              class="tab-button ${this.state.activeDeviceTab==="telemetry"?"active":""}"
              onclick=${()=>this.switchDeviceTab("telemetry")}>
              Telemetry
            </button>
            <button 
              class="tab-button ${this.state.activeDeviceTab==="parameters"?"active":""}"
              onclick=${()=>this.switchDeviceTab("parameters")}>
              Parameters
            </button>
            <button 
              class="tab-button ${this.state.activeDeviceTab==="canmapping"?"active":""}"
              onclick=${()=>this.switchDeviceTab("canmapping")}>
              CAN Mappings
            </button>
            <button 
              class="tab-button ${this.state.activeDeviceTab==="canmessages"?"active":""}"
              onclick=${()=>this.switchDeviceTab("canmessages")}>
              CAN Messages
            </button>
            <button 
              class="tab-button ${this.state.activeDeviceTab==="ota"?"active":""}"
              onclick=${()=>this.switchDeviceTab("ota")}>
              OTA Update
            </button>
          </div>
        </div>

        <!-- Tab Content -->
        <div class="tabs-content" style="flex: 1; overflow: auto; padding: 20px;">
          ${this.renderDeviceTabContent()}
        </div>
      </div>
    `:this.html`
        <div class="panel-message">
          <p>Device not found</p>
        </div>
      `}switchDeviceTab(t){this.state.activeDeviceTab=t,this.emit("render")}renderDeviceTabContent(){switch(this.state.activeDeviceTab){case"telemetry":return x.call(this);case"parameters":return $.call(this);case"canmapping":return w.call(this);case"canmessages":return C.call(this);case"ota":return k.call(this);default:return this.html`<div class="panel-message">Unknown tab</div>`}}async scanCanBus(t=!1){this.state.isScanning=!0,this.state.canScanResults=[],this.state.scanProgress=null,this.emit("render");try{let s=JSON.stringify({quick:!t}),i=await this.device.execute(`from lib.ext.openinverter.OI_helpers import scanCanBus; scanCanBus(${s})`),r=this.device.parseJSON(i);r.ARG&&r.ARG.error?(this.state.scanMessage=`Error: ${r.ARG.error}`,this.state.canScanResults=[]):r.ARG&&r.ARG.devices?(this.state.canScanResults=r.ARG.devices,this.state.canScanResults.length===0?this.state.scanMessage=t?"No devices found (scanned all 127 node IDs)":'No devices found (scanned node IDs 1-10). Try "Full Scan" to check all 127 node IDs.':this.state.scanMessage=null):this.state.scanMessage="Scan completed but received unexpected response format"}catch(s){console.error("[OI Connection] Scan failed:",s),this.state.scanMessage=`Scan failed: ${s.message}`,this.state.canScanResults=[]}finally{this.state.isScanning=!1,this.state.scanProgress=null,this.emit("render")}}async connectToDevice(){try{let t=JSON.stringify({node_id:this.state.selectedNodeId}),s=await this.device.execute(`from lib.ext.openinverter.OI_helpers import initializeDevice; initializeDevice(${t})`),i=this.device.parseJSON(s);i.success||i.ARG&&i.ARG.success?this.state.oiDeviceConnected=!0:(console.error("[OI Connection] Connection failed:",i),alert("Failed to connect to device. Check console for details."))}catch(t){console.error("[OI Connection] Connection error:",t),alert("Failed to connect: "+t.message)}this.emit("render")}async connectToNode(t){this.state.selectedNodeId=t,await this.connectToDevice()}async disconnectDevice(){try{await this.device.execute("from lib.ext.openinverter.OI_helpers import disconnectDevice; disconnectDevice()"),this.state.oiDeviceConnected=!1}catch(t){console.error("[OI Connection] Disconnect error:",t)}this.emit("render")}async deviceSave(){try{await this.device.execute("from lib.ext.openinverter.OI_helpers import deviceSave; deviceSave()"),alert("Parameters saved to flash")}catch(t){alert("Failed to save parameters: "+t.message)}}async deviceLoad(){try{await this.device.execute("from lib.ext.openinverter.OI_helpers import deviceLoad; deviceLoad()"),alert("Parameters loaded from flash")}catch(t){alert("Failed to load parameters: "+t.message)}}async deviceLoadDefaults(){if(confirm("Load factory defaults? This will overwrite all current parameters."))try{await this.device.execute("from lib.ext.openinverter.OI_helpers import deviceLoadDefaults; deviceLoadDefaults()"),alert("Factory defaults loaded")}catch(t){alert("Failed to load defaults: "+t.message)}}async deviceStart(){let t=document.getElementById("oi-start-mode")?.value||"1";try{await this.device.execute(`from lib.ext.openinverter.OI_helpers import deviceStart; deviceStart({'mode': ${t}})`),alert("Device started in mode "+t)}catch(s){alert("Failed to start device: "+s.message)}}async deviceStop(){try{await this.device.execute("from lib.ext.openinverter.OI_helpers import deviceStop; deviceStop()"),alert("Device stopped")}catch(t){alert("Failed to stop device: "+t.message)}}async deviceReset(){if(confirm("Reset device? This will restart the controller."))try{await this.device.execute("from lib.ext.openinverter.OI_helpers import deviceReset; deviceReset()"),alert("Device reset command sent")}catch(t){alert("Failed to reset device: "+t.message)}}togglePlotVariable(t,s){s?this.state.plotState.selectedVars.includes(t)||this.state.plotState.selectedVars.push(t):this.state.plotState.selectedVars=this.state.plotState.selectedVars.filter(i=>i!==t),this.emit("render")}async startPlot(){if(this.state.plotState.selectedVars.length===0){alert("Please select at least one variable to plot");return}this.state.plotState.isPlotting=!0,this.state.plotState.isPaused=!1,this.emit("render"),setTimeout(()=>this.initializeChart(),100)}initializeChart(){let t=document.getElementById("oi-plot-canvas");if(!t){console.error("[OI Plot] Canvas not found");return}this.state.plotState.chart&&this.state.plotState.chart.destroy();let s=t.getContext("2d"),i=["rgb(255, 99, 132)","rgb(54, 162, 235)","rgb(255, 159, 64)","rgb(153, 102, 255)","rgb(255, 205, 86)","rgb(75, 192, 192)"],r=this.state.plotState.selectedVars.map((a,n)=>({label:a,data:[],borderColor:i[n%i.length],backgroundColor:i[n%i.length],fill:!1,pointRadius:0,borderWidth:2}));this.state.plotState.chart=new Chart(s,{type:"line",data:{labels:[],datasets:r},options:{responsive:!0,maintainAspectRatio:!1,animation:!1,scales:{x:{display:!0,title:{display:!0,text:"Time (s)"}},y:{display:!0,title:{display:!0,text:"Value"}}},plugins:{legend:{display:!0,position:"top"}}}}),this.state.plotState.dataTime=0,this.acquirePlotData()}async acquirePlotData(){if(!(!this.state.plotState.isPlotting||this.state.plotState.isPaused)){try{let t=this.state.plotState.selectedVars,s=JSON.stringify(t),i=await this.device.execute(`from lib.ext.openinverter.OI_helpers import getPlotData; getPlotData(${s})`),r=this.device.parseJSON(i),a=r.ARG||r;if(a&&this.state.plotState.chart){let n=this.state.plotState.chart;for(this.state.plotState.dataTime+=this.state.plotState.updateInterval/1e3,n.data.labels.push(this.state.plotState.dataTime.toFixed(1)),t.forEach((o,h)=>{let d=a[o]!==void 0?a[o]:0;n.data.datasets[h].data.push(d)});n.data.labels.length>this.state.plotState.maxDataPoints;)n.data.labels.shift(),n.data.datasets.forEach(o=>o.data.shift());n.update("none")}}catch(t){console.error("[OI Plot] Data acquisition error:",t)}setTimeout(()=>this.acquirePlotData(),this.state.plotState.updateInterval)}}pauseResumePlot(){this.state.plotState.isPaused=!this.state.plotState.isPaused,this.emit("render"),this.state.plotState.isPaused||this.acquirePlotData()}stopPlot(){this.state.plotState.isPlotting=!1,this.state.plotState.isPaused=!1,this.state.plotState.chart&&(this.state.plotState.chart.destroy(),this.state.plotState.chart=null),this.emit("render")}async loadDeviceInfo(){this.state.isLoadingDeviceInfo=!0,this.emit("render");try{let t=await this.device.execute("from lib.ext.openinverter.OI_helpers import getDeviceInfo; getDeviceInfo()"),s=this.device.parseJSON(t);this.state.oiDeviceInfo=s.ARG||s;let i=await this.device.execute("from lib.ext.openinverter.OI_helpers import getErrorLog; getErrorLog()"),r=this.device.parseJSON(i),a=r.ARG||r;this.state.oiErrorLog=Array.isArray(a)?a:[]}catch(t){console.error("[OI App] Failed to load device info:",t),this.state.oiDeviceInfo=null,this.state.oiErrorLog=[]}finally{this.state.isLoadingDeviceInfo=!1,this.emit("render")}}};W(P,"ICONS",{playerPlay:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M7 4v16l13 -8z" /></svg>',playerPause:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M6 5m0 1a1 1 0 0 1 1 -1h2a1 1 0 0 1 1 1v12a1 1 0 0 1 -1 1h-2a1 1 0 0 1 -1 -1z" /><path d="M14 5m0 1a1 1 0 0 1 1 -1h2a1 1 0 0 1 1 1v12a1 1 0 0 1 -1 1h-2a1 1 0 0 1 -1 -1z" /></svg>',playerStop:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M5 5m0 2a2 2 0 0 1 2 -2h10a2 2 0 0 1 2 2v10a2 2 0 0 1 -2 2h-10a2 2 0 0 1 -2 -2z" /></svg>',refresh:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M20 11a8.1 8.1 0 0 0 -15.5 -2m-.5 -4v4h4" /><path d="M4 13a8.1 8.1 0 0 0 15.5 2m.5 4v-4h-4" /></svg>',edit:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M7 7h-1a2 2 0 0 0 -2 2v9a2 2 0 0 0 2 2h9a2 2 0 0 0 2 -2v-1" /><path d="M20.385 6.585a2.1 2.1 0 0 0 -2.97 -2.97l-8.415 8.385v3h3l8.385 -8.415z" /><path d="M16 5l3 3" /></svg>',trash:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 7l16 0" /><path d="M10 11l0 6" /><path d="M14 11l0 6" /><path d="M5 7l1 12a2 2 0 0 0 2 2h8a2 2 0 0 0 2 -2l1 -12" /><path d="M9 7v-3a1 1 0 0 1 1 -1h4a1 1 0 0 1 1 1v3" /></svg>'});var U=P;export{U as default};

